<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FiggyBank | Smart Money Moves Made Simple</title>
  <meta name="description" content="Free financial calculators for Canadians ‚Äî mortgage, business valuation, tax estimator, M&A analysis, RRSP/TFSA, and more. Smart money moves made simple." />
  <meta name="keywords" content="financial calculator, business valuation, DCF calculator, mortgage calculator Canada, M&A accretion dilution, RRSP TFSA, investment returns, compound interest" />
  <meta property="og:title" content="FiggyBank | Smart Money Moves Made Simple" />
  <meta property="og:description" content="Free financial calculators for Canadians. Smart money moves made simple." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://rajkcho.github.io/FiggyBank/" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="canonical" href="https://rajkcho.github.io/FiggyBank/" />
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2C087D" />

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê∑</text></svg>" />

  <!-- Structured Data: WebApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "FiggyBank",
    "description": "Free financial calculators for Canadians ‚Äî business valuation, M&A analysis, mortgage, investment returns, RRSP/TFSA optimizer, tax estimator. Smart money moves made simple.",
    "url": "https://rajkcho.github.io/FiggyBank/",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "CAD"
    }
  }
  </script>

  <!-- Structured Data: FAQPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is FiggyBank free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, all financial calculators on FiggyBank are 100% free with no sign-up required."
        }
      },
      {
        "@type": "Question",
        "name": "Is my financial data safe?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. All calculations run entirely in your browser. No data is sent to any server ‚Äî your numbers never leave your device."
        }
      },
      {
        "@type": "Question",
        "name": "What calculators are available?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "FiggyBank includes 14+ professional-grade calculators: Business Valuation (DCF, Multiples, Asset-based), M&A Deal Analyzer, Canadian Mortgage Calculator, Investment Returns, RRSP vs TFSA Optimizer, Compound Interest, Startup Runway, Net Worth Tracker, Salary Calculator, Debt Payoff, Lease vs Buy, Tax Estimator, Currency Converter, and Side-by-Side Comparison."
        }
      },
      {
        "@type": "Question",
        "name": "How accurate are the mortgage calculations for Canada?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The mortgage calculator uses Canadian semi-annual compounding as required by law, includes CMHC insurance premiums, provincial land transfer taxes, and OSFI B-20 stress test calculations."
        }
      },
      {
        "@type": "Question",
        "name": "Should I choose RRSP or TFSA?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It depends on your current vs. expected retirement tax rate. Generally, RRSP is better if your current tax rate is higher than your expected retirement rate. Use our RRSP vs TFSA Optimizer to compare based on your specific situation."
        }
      }
    ]
  }
  </script>
  
  <style>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       FIGGYBANK ‚Äî Smart Money Moves Made Simple
       CreditGenie-Inspired Design System
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    
    :root {
      /* Brand Colors ‚Äî CreditGenie-inspired */
      --fg-purple: #2C087D;
      --fg-purple-light: #4A1CA0;
      --fg-coral: #FF6B6B;
      --fg-gold: #F5A623;
      --fg-cream: #FCFAF4;
      --fg-green: #10b981;

      --brand-primary: #2C087D;
      --brand-secondary: #4A1CA0;
      --brand-accent: #FF6B6B;
      --brand-success: #10b981;
      --brand-warning: #f59e0b;
      --brand-danger: #ef4444;
      
      /* Light Theme (default ‚Äî CreditGenie is light-first) */
      --bg-primary: #FCFAF4;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --bg-card-hover: #f9f8f5;
      --bg-elevated: #f5f3ee;
      --border-primary: #e8e4dc;
      --border-hover: #d4cfc5;
      --text-primary: #2C087D;
      --text-secondary: #5a4d7a;
      --text-muted: #9b8fb5;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(44, 8, 125, 0.08);
      --shadow-sm: 0 1px 3px rgba(44, 8, 125, 0.04);
      --shadow-md: 0 4px 16px rgba(44, 8, 125, 0.06);
      --shadow-lg: 0 8px 32px rgba(44, 8, 125, 0.08);
      --shadow-xl: 0 20px 60px rgba(44, 8, 125, 0.1);
      --shadow-glow: 0 0 30px rgba(44, 8, 125, 0.06);
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Radius */
      --radius-sm: 0.5rem;
      --radius-md: 0.75rem;
      --radius-lg: 1rem;
      --radius-xl: 1.5rem;
      --radius-full: 9999px;
    }
    
    /* Dark Theme */
    .dark {
      --bg-primary: #0f0a1a;
      --bg-secondary: #16102a;
      --bg-card: #1a1330;
      --bg-card-hover: #221a3d;
      --bg-elevated: #1e1635;
      --border-primary: #2d2450;
      --border-hover: #3d3466;
      --text-primary: #f4f0ff;
      --text-secondary: #b0a3cc;
      --text-muted: #7a6b9e;
      --glass-bg: rgba(26, 19, 48, 0.75);
      --glass-border: rgba(255, 255, 255, 0.08);
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.5);
      --shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.6);
      --shadow-glow: 0 0 30px rgba(44, 8, 125, 0.15);
    }
    
    /* ‚îÄ‚îÄ Reset & Base ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    html {
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    
    /* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-hover); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--brand-primary); }
    
    /* ‚îÄ‚îÄ Typography ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 700;
      line-height: 1.2;
      letter-spacing: -0.02em;
      color: var(--fg-purple);
    }
    .dark h1, .dark h2, .dark h3, .dark h4, .dark h5, .dark h6 { color: var(--text-primary); }
    
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .gradient-text {
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ANIMATION SYSTEM ‚Äî CreditGenie-style
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    
    /* Scroll-triggered fade up */
    .js-show {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    .js-show.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    .js-show-up-10 { transition-delay: 0.1s; }
    .js-show-up-20 { transition-delay: 0.2s; }
    .js-show-up-30 { transition-delay: 0.3s; }
    .js-show-up-40 { transition-delay: 0.4s; }
    .js-show-up-50 { transition-delay: 0.5s; }
    
    /* Button hover ‚Äî text slide */
    .btn-animated {
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-animated { overflow: hidden; position: relative; }
    .btn-animated .btn-text-wrap {
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
    }
    .btn-animated:hover .btn-text-wrap {
      transform: translateY(-50%);
    }
    .btn-animated .btn-initial,
    .btn-animated .btn-hover {
      display: block;
      line-height: 1;
      padding: 0.25em 0;
    }
    
    /* Parallax floating elements */
    .float-element { animation: figgyFloat 6s ease-in-out infinite; }
    .float-element-slow { animation: figgyFloat 8s ease-in-out infinite; }
    .float-element-fast { animation: figgyFloat 4s ease-in-out infinite; }
    @keyframes figgyFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    /* Rotating hero words */
    .hero-word-rotator {
      display: inline-block;
      position: relative;
      vertical-align: bottom;
      height: 1.2em;
    }
    .hero-word-rotator span {
      display: block;
      position: absolute;
      left: 0;
      top: 0;
      white-space: nowrap;
      opacity: 0;
      transform: translateY(50%);
      animation: wordFadeIn 10s infinite;
    }
    .hero-word-rotator span:nth-child(1) { animation-delay: 0s; }
    .hero-word-rotator span:nth-child(2) { animation-delay: 2.5s; }
    .hero-word-rotator span:nth-child(3) { animation-delay: 5s; }
    .hero-word-rotator span:nth-child(4) { animation-delay: 7.5s; }
    .hero-word-rotator span:nth-child(5) { display: none; }
    @keyframes wordFadeIn {
      0% { opacity: 0; transform: translateY(50%); }
      5% { opacity: 1; transform: translateY(0); }
      20% { opacity: 1; transform: translateY(0); }
      25% { opacity: 0; transform: translateY(-50%); }
      100% { opacity: 0; transform: translateY(-50%); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(44, 8, 125, 0.1); }
      50% { box-shadow: 0 0 40px rgba(44, 8, 125, 0.25); }
    }
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    @keyframes morphBlob {
      0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
      25% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
      50% { border-radius: 50% 60% 30% 60% / 30% 70% 60% 40%; }
      75% { border-radius: 60% 30% 60% 40% / 60% 40% 30% 70%; }
    }
    @keyframes ripple {
      0% { transform: scale(0); opacity: 0.6; }
      100% { transform: scale(4); opacity: 0; }
    }
    @keyframes spin-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @keyframes coinBounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(10deg); }
    }
    
    .animate-fade-up { animation: fadeInUp 0.6s ease both; }
    .animate-fade-up-1 { animation: fadeInUp 0.6s ease 0.1s both; }
    .animate-fade-up-2 { animation: fadeInUp 0.6s ease 0.2s both; }
    .animate-fade-up-3 { animation: fadeInUp 0.6s ease 0.3s both; }
    .animate-fade-up-4 { animation: fadeInUp 0.6s ease 0.4s both; }
    .animate-fade-in { animation: fadeIn 0.6s ease both; }
    .animate-scale-in { animation: scaleIn 0.5s ease both; }
    
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* ‚îÄ‚îÄ Glass Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .glass-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      transition: all 0.3s ease;
    }
    .glass-card:hover {
      border-color: var(--border-hover);
      box-shadow: var(--shadow-lg);
    }

    /* ‚îÄ‚îÄ Tool Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .tool-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      padding: 1.75rem;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    .tool-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(44, 8, 125, 0.2);
    }
    .tool-card .tool-icon {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      transition: transform 0.3s ease;
    }
    .tool-card:hover .tool-icon { transform: scale(1.1); }
    .tool-card .card-arrow {
      position: absolute;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
      color: var(--text-muted);
      transition: transform 0.3s ease, color 0.3s ease;
    }
    .tool-card:hover .card-arrow { transform: translateY(-50%) translateX(4px); color: var(--fg-purple); }
    
    /* ‚îÄ‚îÄ Button System ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.75rem;
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      text-decoration: none;
    }
    .btn:active { transform: scale(0.97); }
    
    .btn-primary {
      background: var(--fg-purple);
      color: white;
      box-shadow: 0 4px 15px rgba(44, 8, 125, 0.25);
    }
    .btn-primary:hover {
      box-shadow: 0 6px 25px rgba(44, 8, 125, 0.35);
      transform: translateY(-2px);
      background: var(--fg-purple-light);
    }
    
    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border-primary);
    }
    .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--brand-primary);
    }
    
    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }
    .btn-ghost:hover { color: var(--text-primary); }
    
    .btn-lg { padding: 1rem 2.25rem; font-size: 1rem; }
    .btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; }
    
    /* ‚îÄ‚îÄ Input System ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
    }
    .input-group label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .input-group input, .input-group select {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-md);
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-size: 0.95rem;
      font-family: 'JetBrains Mono', monospace;
      transition: all 0.3s ease;
      width: 100%;
    }
    .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 3px rgba(44, 8, 125, 0.15);
    }
    .input-group input::placeholder { color: var(--text-muted); }
    .input-help {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 0.125rem;
    }
    
    /* ‚îÄ‚îÄ Range Slider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: var(--border-primary);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--fg-purple);
      box-shadow: 0 2px 8px rgba(44, 8, 125, 0.4);
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }
    
    /* ‚îÄ‚îÄ Result Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .result-card {
      background: linear-gradient(135deg, rgba(44, 8, 125, 0.06), rgba(74, 28, 160, 0.03));
      border: 1px solid rgba(44, 8, 125, 0.15);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      animation: scaleIn 0.4s ease both;
    }
    .result-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .result-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }
    
    /* ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(252, 250, 244, 0.92);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(44, 8, 125, 0.06);
      padding: 0.75rem 1.5rem;
      transition: all 0.3s ease;
      animation: fadeInDown 0.6s ease both;
    }
    .dark .nav-bar {
      background: rgba(15, 10, 26, 0.92);
      border-bottom-color: rgba(255,255,255,0.06);
    }
    .nav-bar.scrolled {
      box-shadow: 0 1px 12px rgba(44, 8, 125, 0.06);
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .nav-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      font-weight: 800;
      font-size: 1.1rem;
      color: var(--fg-purple);
    }
    .dark .nav-logo { color: var(--text-primary); }
    .nav-links {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      list-style: none;
    }
    .nav-links a {
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-full);
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .nav-links a:hover, .nav-links a.active {
      color: var(--fg-purple);
      background: rgba(44, 8, 125, 0.06);
    }
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-primary);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }
    .theme-toggle:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
      border-color: var(--border-hover);
    }
    .mobile-menu-btn {
      display: none;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-primary);
      background: var(--bg-card);
      color: var(--text-primary);
      cursor: pointer;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    @media (max-width: 768px) {
      .nav-links { display: none; }
      .mobile-menu-btn { display: flex; }
      .nav-links.mobile-open {
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-primary);
        padding: 1rem;
        gap: 0.25rem;
      }
      .nav-links.mobile-open a {
        padding: 0.75rem 1rem;
        width: 100%;
      }
    }

    /* ‚ïê‚ïê HOME PAGE SECTIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    
    /* Hero */
    .figgy-hero {
      min-height: 90vh;
      display: flex;
      align-items: center;
      padding: 7rem 2rem 4rem;
      position: relative;
      overflow: hidden;
      background: var(--bg-primary);
    }
    .figgy-hero-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
      position: relative;
      z-index: 2;
    }
    @media (max-width: 900px) {
      .figgy-hero { min-height: auto; padding: 6rem 1.5rem 3rem; }
      .figgy-hero-inner { grid-template-columns: 1fr; text-align: center; gap: 2rem; }
      .figgy-hero-right { display: none; }
    }
    .figgy-hero h1 {
      font-size: clamp(2.5rem, 5vw, 3.75rem);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1.1;
      margin-bottom: 1.25rem;
      color: var(--fg-purple);
    }
    .figgy-hero p {
      font-size: 1.15rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      line-height: 1.7;
    }
    
    /* Decorative floaters */
    .hero-floater {
      position: absolute;
      z-index: 1;
      pointer-events: none;
    }
    
    /* Calculator mockup */
    .calc-mockup {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: var(--shadow-xl);
      position: relative;
    }
    .mockup-header {
      padding: 0.75rem 1rem;
      background: var(--bg-elevated);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 1px solid var(--border-primary);
    }
    .mockup-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .mockup-body {
      padding: 1.5rem;
    }
    
    /* Section alternating backgrounds */
    .section-cream { background: var(--bg-primary); }
    .section-white { background: var(--bg-secondary); }
    
    .section {
      padding: 5rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .section-full {
      padding: 5rem 2rem;
    }
    .section-full .section-inner {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .section-header {
      text-align: center;
      margin-bottom: 3.5rem;
    }
    .section-label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--fg-coral);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 1rem;
    }
    .section-title {
      font-size: clamp(2rem, 4vw, 3rem);
      letter-spacing: -0.03em;
      margin-bottom: 1rem;
      color: var(--fg-purple);
    }
    .dark .section-title { color: var(--text-primary); }
    .section-desc {
      font-size: 1.1rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Featured calculator sections ‚Äî alternating */
    .feature-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
      padding: 3rem 0;
    }
    .feature-row.reverse { direction: rtl; }
    .feature-row.reverse > * { direction: ltr; }
    .feature-row h3 {
      font-size: 1.75rem;
      margin-bottom: 0.75rem;
      color: var(--fg-purple);
    }
    .dark .feature-row h3 { color: var(--text-primary); }
    .feature-row p {
      color: var(--text-secondary);
      font-size: 1rem;
      line-height: 1.7;
      margin-bottom: 1rem;
    }
    .feature-bullets {
      list-style: none;
      padding: 0;
    }
    .feature-bullets li {
      padding: 0.4rem 0;
      font-size: 0.95rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .feature-bullets li::before {
      content: '‚úì';
      color: var(--fg-green);
      font-weight: 700;
    }
    @media (max-width: 900px) {
      .feature-row { grid-template-columns: 1fr; gap: 2rem; }
      .feature-row.reverse { direction: ltr; }
    }
    
    /* Tools grid */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.25rem;
    }
    .tools-category-label {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--fg-coral);
      margin-bottom: 1rem;
      margin-top: 2.5rem;
    }
    .tools-category-label:first-child { margin-top: 0; }
    @media (max-width: 960px) { .tools-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px) { .tools-grid { grid-template-columns: 1fr; } }
    
    /* How it works */
    .hiw-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 3rem;
      position: relative;
    }
    .hiw-step {
      text-align: center;
      position: relative;
    }
    .hiw-number {
      font-size: 4rem;
      font-weight: 900;
      color: rgba(44, 8, 125, 0.08);
      line-height: 1;
      margin-bottom: 0.5rem;
    }
    .dark .hiw-number { color: rgba(255,255,255,0.06); }
    .hiw-step h3 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .hiw-step p {
      font-size: 0.95rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    @media (max-width: 768px) {
      .hiw-grid { grid-template-columns: 1fr; gap: 2rem; }
    }
    
    /* Trust cards */
    .trust-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
    }
    .trust-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    .trust-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    .trust-card-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }
    .trust-card h4 {
      font-size: 1.05rem;
      margin-bottom: 0.5rem;
    }
    .trust-card p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    @media (max-width: 960px) { .trust-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 480px) { .trust-grid { grid-template-columns: 1fr; } }
    
    /* FAQ Accordion */
    .faq-list { max-width: 720px; margin: 0 auto; }
    .accordion-item {
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      margin-bottom: 0.75rem;
      overflow: hidden;
      background: var(--bg-card);
    }
    .accordion-header {
      padding: 1.25rem 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
      font-size: 0.95rem;
      transition: background 0.3s ease;
      color: var(--text-primary);
    }
    .accordion-header:hover { background: var(--bg-card-hover); }
    .accordion-arrow {
      transition: transform 0.3s ease;
      color: var(--text-muted);
      font-size: 1.2rem;
    }
    .accordion-item.open .accordion-arrow { transform: rotate(180deg); }
    .accordion-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
    }
    .accordion-item.open .accordion-body { max-height: 2000px; }
    .accordion-body-inner {
      padding: 0 1.5rem 1.25rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.7;
    }
    
    /* Footer */
    .figgy-footer {
      background: var(--fg-purple);
      color: rgba(255,255,255,0.9);
      padding: 4rem 2rem 2rem;
      text-align: center;
    }
    .figgy-footer h2 {
      color: white;
      font-size: clamp(1.5rem, 3vw, 2.25rem);
      margin-bottom: 1.5rem;
    }
    .figgy-footer-links {
      display: flex;
      gap: 2rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    .figgy-footer-links a {
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      font-size: 0.85rem;
      transition: color 0.3s;
    }
    .figgy-footer-links a:hover { color: white; }
    .figgy-footer-bottom {
      border-top: 1px solid rgba(255,255,255,0.15);
      padding-top: 1.5rem;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.5);
    }

    /* ‚îÄ‚îÄ Calculator Layout (for sub-pages) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .calc-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    .calc-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .calc-back {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .calc-back:hover { color: var(--text-primary); }
    .calc-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    .calc-inputs {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .calc-results {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    @media (max-width: 768px) {
      .calc-grid { grid-template-columns: 1fr; }
    }
    
    /* ‚îÄ‚îÄ Chart containers, tables, etc (from original) ‚îÄ‚îÄ */
    .chart-container {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin: 1rem 0;
    }
    .chart-bar {
      height: 8px;
      border-radius: 4px;
      background: var(--border-primary);
      overflow: hidden;
      margin: 0.5rem 0;
    }
    .chart-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral));
    }
    .sensitivity-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
    }
    .sensitivity-table th {
      background: var(--bg-elevated);
      color: var(--text-secondary);
      font-weight: 600;
      padding: 0.625rem 0.75rem;
      text-align: center;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid var(--border-primary);
    }
    .sensitivity-table th:first-child { border-radius: var(--radius-sm) 0 0 0; text-align: left; }
    .sensitivity-table th:last-child { border-radius: 0 var(--radius-sm) 0 0; }
    .sensitivity-table td {
      padding: 0.5rem 0.75rem;
      text-align: center;
      border-bottom: 1px solid var(--border-primary);
      transition: background 0.2s ease;
    }
    .sensitivity-table td:first-child { text-align: left; font-weight: 600; color: var(--text-secondary); }
    .sensitivity-table tr:hover td { background: rgba(44, 8, 125, 0.05); }
    .sensitivity-table .highlight { background: rgba(44, 8, 125, 0.1); font-weight: 700; color: var(--fg-purple); }
    .sensitivity-table .positive-val { color: var(--brand-success); }
    .sensitivity-table .negative-val { color: var(--brand-danger); }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 0.25rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 0.25rem;
      border: 1px solid var(--border-primary);
    }
    .tab {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      text-align: center;
    }
    .tab:hover { color: var(--text-primary); }
    .tab.active {
      background: var(--fg-purple);
      color: white;
      box-shadow: 0 2px 8px rgba(44, 8, 125, 0.3);
    }
    
    /* Metric pill */
    .metric-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }
    .metric-pill.positive { background: rgba(16, 185, 129, 0.1); color: var(--brand-success); border: 1px solid rgba(16, 185, 129, 0.2); }
    .metric-pill.negative { background: rgba(239, 68, 68, 0.1); color: var(--brand-danger); border: 1px solid rgba(239, 68, 68, 0.2); }
    .metric-pill.neutral { background: rgba(44, 8, 125, 0.1); color: var(--fg-purple); border: 1px solid rgba(44, 8, 125, 0.2); }
    
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-primary), transparent);
      margin: 2rem 0;
    }
    
    /* Tooltip */
    .tooltip-wrapper { position: relative; display: inline-flex; align-items: center; gap: 0.25rem; }
    .tooltip-icon {
      width: 16px; height: 16px; border-radius: 50%;
      background: var(--border-primary); color: var(--text-muted);
      font-size: 0.6rem; font-weight: 700;
      display: inline-flex; align-items: center; justify-content: center; cursor: help;
    }
    .tooltip-wrapper:hover .tooltip-content { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
    .tooltip-content {
      position: absolute; bottom: calc(100% + 8px); left: 50%;
      transform: translateX(-50%) translateY(5px);
      background: var(--bg-elevated); border: 1px solid var(--border-primary);
      border-radius: var(--radius-sm); padding: 0.5rem 0.75rem;
      font-size: 0.72rem; color: var(--text-secondary);
      opacity: 0; visibility: hidden; transition: all 0.2s ease; z-index: 10;
      box-shadow: var(--shadow-lg); max-width: 250px; white-space: normal;
    }

    /* SVG Charts */
    .svg-donut-chart { position: relative; display: inline-block; }
    .svg-donut-chart svg { transform: rotate(-90deg); }
    .svg-donut-segment { fill: none; stroke-width: 32; transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1), stroke-width 0.2s ease, filter 0.2s ease; cursor: pointer; }
    .svg-donut-segment:hover { stroke-width: 38; filter: drop-shadow(0 0 6px rgba(44,8,125,0.4)); }
    .svg-donut-segment.donut-init { stroke-dashoffset: var(--circumference) !important; }
    .svg-donut-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
    .svg-donut-center .donut-hover-label { font-size: 0.7rem; color: var(--text-muted); }
    .svg-donut-center .donut-hover-value { font-size: 0.85rem; font-weight: 700; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; }
    .svg-area-chart { width: 100%; overflow: visible; }
    .svg-area-path { opacity: 0; transition: opacity 0.8s ease, d 0.6s ease; }
    .svg-area-path.visible { opacity: 1; }
    .svg-area-gridline { stroke: var(--border-primary); stroke-width: 0.5; }
    .svg-area-label { font-size: 10px; fill: var(--text-muted); font-family: 'JetBrains Mono', monospace; }
    .svg-gauge { display: inline-block; position: relative; }
    .svg-gauge svg { overflow: visible; }
    .svg-gauge-arc { fill: none; stroke-width: 14; stroke-linecap: round; }
    .svg-gauge-needle { fill: var(--text-primary); transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: center center; }
    .svg-gauge-label { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); text-align: center; pointer-events: none; }
    .svg-gauge-label .gauge-value { font-size: 1.1rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--text-primary); }
    .svg-gauge-label .gauge-text { font-size: 0.65rem; color: var(--text-muted); }
    .sparkline-inline { display: inline-block; vertical-align: middle; margin-left: 0.5rem; }
    .sparkline-path { fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
    .sparkline-fill { opacity: 0.15; }
    .chart-animate-bar { transform: scaleY(0); transform-origin: bottom; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
    .chart-animate-bar.visible { transform: scaleY(1); }
    .progress-ring { transform: rotate(-90deg); }
    .progress-ring-bg { stroke: var(--border-primary); fill: none; }
    .progress-ring-fill { fill: none; stroke-linecap: round; transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1); }

    /* Scroll progress */
    #scroll-progress {
      position: fixed; top: 0; left: 0; width: 0%; height: 3px;
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral));
      z-index: 9999; transition: width 0.1s linear; pointer-events: none;
    }

    /* Page transitions */
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.4s ease both; }
    .page.fade-out { animation: pageFadeOut 0.15s ease forwards; }
    .page.fade-in { animation: pageFadeIn 0.25s ease forwards; }
    @keyframes pageFadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-8px); } }
    @keyframes pageFadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* Reveal */
    .reveal { opacity: 0; transform: translateY(30px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .reveal.visible { opacity: 1; transform: translateY(0); }

    /* Accessibility */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    .skip-to-content { position: absolute; top: -100%; left: 50%; transform: translateX(-50%); background: var(--fg-purple); color: white; padding: 0.75rem 1.5rem; border-radius: 0 0 var(--radius-md) var(--radius-md); z-index: 10000; font-weight: 600; text-decoration: none; transition: top 0.2s ease; }
    .skip-to-content:focus { top: 0; }
    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, [tabindex]:focus-visible {
      outline: 2px solid var(--fg-purple);
      outline-offset: 2px;
    }

    /* Shortcuts overlay */
    .shortcuts-overlay { position: fixed; inset: 0; z-index: 10000; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; animation: fadeIn 0.2s ease; }
    .shortcuts-overlay.hidden { display: none; }
    .shortcuts-card { background: var(--bg-card); border: 1px solid var(--border-primary); border-radius: var(--radius-xl); padding: 2rem; max-width: 420px; width: 90%; box-shadow: var(--shadow-xl); }
    .shortcuts-card h2 { font-size: 1.25rem; margin-bottom: 1.25rem; }
    .shortcut-row { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary); font-size: 0.85rem; }
    .shortcut-row:last-child { border-bottom: none; }
    .shortcut-key { display: inline-block; background: var(--bg-elevated); border: 1px solid var(--border-primary); border-radius: 4px; padding: 0.15rem 0.5rem; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 600; min-width: 28px; text-align: center; }

    /* Toast */
    .toast { position: fixed; bottom: 2rem; right: 2rem; z-index: 200; background: var(--bg-elevated); border: 1px solid var(--border-primary); border-radius: var(--radius-md); padding: 1rem 1.5rem; box-shadow: var(--shadow-xl); animation: slideInRight 0.4s ease both; display: flex; align-items: center; gap: 0.75rem; font-size: 0.85rem; }
    .toast.hidden { display: none; }
    .toast-success { position: fixed; bottom: 2rem; right: 2rem; z-index: 400; background: var(--bg-elevated); border: 1px solid rgba(16,185,129,0.3); border-radius: var(--radius-md); padding: 1rem 1.5rem; box-shadow: var(--shadow-xl); animation: slideInRight 0.4s ease both; font-size: 0.85rem; color: var(--brand-success); display: flex; align-items: center; gap: 0.5rem; }

    /* Action buttons */
    .action-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
    .action-buttons .btn { font-size: 0.78rem; padding: 0.5rem 1rem; }

    /* Affiliate CTA */
    .affiliate-cta { margin-top: 1rem; padding: 0.75rem 1rem; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-md); font-size: 0.8rem; color: var(--text-secondary); display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
    .affiliate-cta .ad-label { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); border: 1px solid var(--border-primary); padding: 0.1rem 0.35rem; border-radius: 3px; flex-shrink: 0; }
    .affiliate-cta a { color: var(--fg-coral); text-decoration: none; font-weight: 500; }
    .affiliate-cta a:hover { text-decoration: underline; }

    /* Confetti */
    @keyframes confettiFall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    .confetti-container { position: fixed; inset: 0; pointer-events: none; z-index: 10000; overflow: hidden; }
    .confetti-piece { position: absolute; width: 8px; height: 8px; top: -10px; animation: confettiFall 3s ease-in forwards; }

    /* Chart bar tooltip */
    .chart-bar-tooltip { position: relative; cursor: pointer; }
    .chart-bar-tooltip::after { content: attr(data-tooltip); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%) scale(0.8); background: var(--bg-elevated); color: var(--text-primary); border: 1px solid var(--border-primary); border-radius: var(--radius-sm); padding: 0.25rem 0.5rem; font-size: 0.65rem; font-family: 'JetBrains Mono', monospace; white-space: nowrap; opacity: 0; pointer-events: none; transition: all 0.2s ease; box-shadow: var(--shadow-md); z-index: 10; }
    .chart-bar-tooltip:hover::after { opacity: 1; transform: translateX(-50%) scale(1); }

    /* Showcase cards (kept for compatibility) */
    .showcase-scroll { overflow-x: auto; overflow-y: visible; padding: 1rem 0 1.5rem; margin: 0 -1.5rem; padding-left: 1.5rem; scrollbar-width: none; -ms-overflow-style: none; scroll-snap-type: x proximity; }
    .showcase-scroll::-webkit-scrollbar { display: none; }
    .showcase-track { display: flex; gap: 1.25rem; padding-right: 1.5rem; }
    .showcase-card { flex: 0 0 260px; cursor: pointer; scroll-snap-align: start; }
    .showcase-card-inner { position: relative; width: 100%; height: 100%; border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--border-primary); background: var(--bg-card); transition: transform 0.4s cubic-bezier(0.4,0,0.2,1), box-shadow 0.4s ease, border-color 0.4s ease; }
    .showcase-card:hover .showcase-card-inner { transform: scale(1.03); box-shadow: var(--shadow-lg); border-color: rgba(44,8,125,0.2); }
    .sc-overlay { position: absolute; inset: 0; background: rgba(252,250,244,0.9); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; border-radius: var(--radius-lg); }
    .dark .sc-overlay { background: rgba(15,10,26,0.85); }
    .showcase-card:hover .sc-overlay { opacity: 1; }
    .sc-overlay span { font-weight: 700; font-size: 1rem; color: white; background: var(--fg-purple); padding: 0.6rem 1.5rem; border-radius: var(--radius-full); }
    .sc-mini-ui { height: 100%; display: flex; flex-direction: column; }
    .sc-mini-header { padding: 0.65rem 0.85rem; font-size: 0.75rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.4rem; }
    .sc-mini-body { padding: 0.75rem 0.85rem; flex: 1; display: flex; flex-direction: column; gap: 0.4rem; }
    .sc-mini-field { display: flex; justify-content: space-between; align-items: center; font-size: 0.68rem; }
    .sc-label { color: var(--text-muted); }
    .sc-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--text-primary); font-size: 0.7rem; }
    .sc-mini-result { margin-top: auto; padding-top: 0.5rem; border-top: 1px solid var(--border-primary); display: flex; justify-content: space-between; align-items: center; }
    .sc-result-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 600; }
    .sc-result-num { font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; font-weight: 800; color: var(--text-primary); }
    .sc-mini-bar { height: 4px; background: var(--border-primary); border-radius: 2px; overflow: hidden; margin-top: 0.4rem; }
    .sc-bar-fill { height: 100%; border-radius: 2px; transition: width 1s ease; }

    /* Cookie banner */
    .cookie-banner { position: fixed; bottom: 0; left: 0; right: 0; z-index: 300; background: var(--bg-elevated); border-top: 1px solid var(--border-primary); padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: center; gap: 1rem; font-size: 0.85rem; color: var(--text-secondary); animation: fadeInUp 0.4s ease both; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); }
    .cookie-banner.hidden { display: none; }
    .cookie-banner-btns { display: flex; gap: 0.5rem; }
    @media (max-width: 640px) { .cookie-banner { flex-direction: column; text-align: center; gap: 0.75rem; } }

    /* Print */
    @media print {
      body { background: white !important; color: black !important; font-size: 12pt; }
      .nav-bar, .cookie-banner, .no-print, .figgy-footer, .btn, .action-buttons, .theme-toggle, .mobile-menu-btn { display: none !important; }
      * { box-shadow: none !important; text-shadow: none !important; }
      .page { display: block !important; }
      .glass-card, .result-card, .tool-card { background: white !important; border: 1px solid #ddd !important; break-inside: avoid; }
      h1, h2, h3 { page-break-after: avoid; color: #1a1a2e !important; -webkit-text-fill-color: #1a1a2e !important; }
      .result-value { -webkit-text-fill-color: #333 !important; color: #333 !important; }
      @page { margin: 2cm; }
      .page.active::before {
        content: "FiggyBank ‚Äî Smart Money Moves Made Simple";
        display: block; text-align: center; font-size: 14pt; font-weight: 700;
        color: #2C087D; border-bottom: 2px solid #2C087D; padding-bottom: 0.5rem; margin-bottom: 1.5rem;
      }
    }

    /* Mobile */
    @media (max-width: 768px) {
      .section { padding: 3rem 1rem; }
      .section-full { padding: 3rem 1rem; }
      .calc-container { padding: 1.5rem 1rem; }
      .glass-card { padding: var(--space-lg) !important; }
      .btn { width: 100%; }
      .figgy-hero .btn { width: auto; min-width: 140px; }
      .action-buttons .btn { flex: 1; min-width: 120px; }
      .result-value { font-size: 1.5rem; }
      [style*="grid-template-columns: repeat(3"] { grid-template-columns: 1fr !important; }
      [style*="grid-template-columns: 1fr 1fr 1fr"] { grid-template-columns: 1fr !important; }
      [style*="grid-template-columns:repeat(4"] { grid-template-columns: repeat(2, 1fr) !important; }
    }
    @media (max-width: 480px) {
      [style*="grid-template-columns:repeat(4"] { grid-template-columns: 1fr !important; }
    }
    input[type="range"] { height: 8px; padding: 18px 0; margin: 0; box-sizing: content-box; }
    input[type="range"]::-webkit-slider-thumb { width: 28px; height: 28px; }
    input[type="range"]::-moz-range-thumb { width: 28px; height: 28px; border: none; border-radius: 50%; background: var(--fg-purple); box-shadow: 0 2px 8px rgba(44, 8, 125, 0.4); cursor: pointer; }
    .hero-blob { will-change: transform; }
    .tool-card { will-change: transform; }
    .nav-logo-svg { flex-shrink: 0; }

    /* Skeleton */
    .skeleton-overlay { position: absolute; inset: 0; background: var(--bg-card); border-radius: var(--radius-lg); z-index: 5; display: flex; flex-direction: column; gap: 0.75rem; padding: var(--space-lg); }
    .skeleton-line { height: 16px; border-radius: 4px; background: linear-gradient(90deg, var(--border-primary) 25%, var(--bg-elevated) 50%, var(--border-primary) 75%); background-size: 200% 100%; animation: shimmer 1.5s ease infinite; }
    .skeleton-line.short { width: 60%; }
    .skeleton-line.medium { width: 80%; }
    .skeleton-line.tall { height: 48px; width: 50%; }

    /* Input ripple */
    .input-group { position: relative; }
    .input-group .input-ripple { position: absolute; border-radius: 50%; background: rgba(44, 8, 125, 0.25); transform: scale(0); animation: ripple 0.6s ease-out forwards; pointer-events: none; z-index: 1; }

    /* Loading skeleton */
    .skeleton-overlay { position: absolute; inset: 0; background: var(--bg-card); border-radius: var(--radius-lg); z-index: 5; display: flex; flex-direction: column; gap: 0.75rem; padding: var(--space-lg); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       V6.0 ‚Äî DRAMATIC HOMEPAGE ENHANCEMENTS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* Scroll progress bar */
    #scroll-progress {
      position: fixed; top: 0; left: 0; width: 0%; height: 3px;
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral), var(--fg-gold));
      z-index: 9999; transition: width 0.1s linear; pointer-events: none;
    }

    /* Animated gradient text */
    .gradient-text-animated {
      background: linear-gradient(270deg, #2C087D, #FF6B6B, #F5A623, #2C087D);
      background-size: 400% 400%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 4s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Hero animated mesh background */
    .hero-mesh-bg {
      position: absolute; inset: 0; z-index: 0; overflow: hidden;
      background: linear-gradient(135deg, rgba(44,8,125,0.03), rgba(255,107,107,0.03), rgba(245,166,35,0.02));
    }
    .hero-mesh-bg::before {
      content: ''; position: absolute; inset: -50%;
      background: radial-gradient(ellipse at 20% 50%, rgba(44,8,125,0.08) 0%, transparent 50%),
                  radial-gradient(ellipse at 80% 20%, rgba(255,107,107,0.06) 0%, transparent 50%),
                  radial-gradient(ellipse at 50% 80%, rgba(245,166,35,0.05) 0%, transparent 50%);
      animation: meshShift 12s ease-in-out infinite;
    }
    @keyframes meshShift {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(5%, -3%) scale(1.05); }
      66% { transform: translate(-3%, 5%) scale(0.98); }
    }

    /* Sparkle effect */
    .sparkle-container { position: absolute; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
    .sparkle {
      position: absolute; width: 4px; height: 4px; border-radius: 50%;
      background: var(--fg-gold);
      animation: sparkle 3s ease-in-out infinite;
    }
    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 0.8; transform: scale(1) rotate(180deg); }
    }

    /* Hero huge typography */
    .figgy-hero h1.hero-huge {
      font-size: clamp(3rem, 8vw, 6rem) !important;
      font-weight: 900 !important;
      line-height: 1.05 !important;
      letter-spacing: -0.04em !important;
    }

    /* Pulse CTA */
    .btn-pulse {
      animation: btnPulse 2.5s ease-in-out infinite;
      font-size: 1.15rem !important;
      padding: 1.25rem 3rem !important;
    }
    @keyframes btnPulse {
      0%, 100% { box-shadow: 0 4px 15px rgba(44,8,125,0.25); }
      50% { box-shadow: 0 8px 40px rgba(44,8,125,0.45), 0 0 60px rgba(44,8,125,0.15); }
    }

    /* Animated piggy bank SVG scene */
    .hero-scene { position: relative; width: 100%; max-width: 420px; margin: 0 auto; }
    .hero-scene svg { width: 100%; height: auto; }
    .piggy-bounce { animation: piggyBounce 3s ease-in-out infinite; transform-origin: center bottom; }
    @keyframes piggyBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }
    .coin-float { animation: coinFloat 4s ease-in-out infinite; }
    @keyframes coinFloat {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
      50% { transform: translateY(-25px) rotate(15deg); opacity: 1; }
    }
    .coin-float-2 { animation: coinFloat2 5s ease-in-out infinite 0.5s; }
    @keyframes coinFloat2 {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.5; }
      50% { transform: translateY(-30px) rotate(-20deg); opacity: 1; }
    }
    .coin-float-3 { animation: coinFloat3 3.5s ease-in-out infinite 1s; }
    @keyframes coinFloat3 {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.6; }
      50% { transform: translateY(-20px) rotate(25deg); opacity: 1; }
    }
    .chart-draw { stroke-dasharray: 200; stroke-dashoffset: 200; animation: drawLine 3s ease forwards 0.5s; }
    @keyframes drawLine { to { stroke-dashoffset: 0; } }
    .dollar-fade { animation: dollarFade 4s ease-in-out infinite; }
    @keyframes dollarFade {
      0%, 100% { opacity: 0; transform: translateY(5px); }
      30%, 70% { opacity: 0.6; transform: translateY(-5px); }
    }
    .dollar-fade-2 { animation: dollarFade 4s ease-in-out infinite 1.5s; }
    .dollar-fade-3 { animation: dollarFade 4s ease-in-out infinite 2.5s; }

    /* Interactive showcase tabs */
    .showcase-tabs { display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
    .showcase-tab {
      padding: 0.75rem 1.5rem; border-radius: var(--radius-full); border: 2px solid var(--border-primary);
      background: var(--bg-card); color: var(--text-secondary); cursor: pointer; font-weight: 600;
      font-size: 0.85rem; transition: all 0.3s ease;
    }
    .showcase-tab:hover { border-color: var(--fg-purple); color: var(--fg-purple); }
    .showcase-tab.active {
      background: var(--fg-purple); color: white; border-color: var(--fg-purple);
      box-shadow: 0 4px 20px rgba(44,8,125,0.3);
    }
    .showcase-panel { display: none; animation: showcaseFadeIn 0.5s ease both; }
    .showcase-panel.active { display: block; }
    @media (max-width: 768px) {
      .showcase-panel > div { grid-template-columns: 1fr !important; gap: 1.5rem !important; }
      .hiw-timeline { grid-template-columns: 1fr !important; }
    }
    @keyframes showcaseFadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* Glassmorphism card */
    .glass-showcase {
      background: rgba(255,255,255,0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.3); border-radius: var(--radius-xl);
      box-shadow: 0 8px 32px rgba(44,8,125,0.1); padding: 2.5rem; position: relative; overflow: hidden;
    }
    .dark .glass-showcase {
      background: rgba(26,19,48,0.6); border-color: rgba(255,255,255,0.08);
    }

    /* Floating 3D shapes */
    .floating-shape {
      position: absolute; pointer-events: none; z-index: 0;
    }
    .shape-cube {
      width: 40px; height: 40px; transform-style: preserve-3d;
      animation: rotateCube 8s linear infinite;
    }
    @keyframes rotateCube {
      from { transform: rotateX(0deg) rotateY(0deg); }
      to { transform: rotateX(360deg) rotateY(360deg); }
    }
    .shape-sphere {
      width: 30px; height: 30px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,107,107,0.3), rgba(44,8,125,0.1));
      animation: float3D 6s ease-in-out infinite;
    }
    @keyframes float3D {
      0%, 100% { transform: translateY(0) rotateX(0) rotateY(0); }
      25% { transform: translateY(-10px) rotateX(5deg) rotateY(-5deg); }
      50% { transform: translateY(-20px) rotateX(-3deg) rotateY(8deg); }
      75% { transform: translateY(-8px) rotateX(4deg) rotateY(-3deg); }
    }

    /* Tool card 3D tilt and unique hover gradients */
    .tool-card { perspective: 800px; }
    .tool-card.tilt-active { transition: transform 0.1s ease-out, box-shadow 0.3s ease; }
    .tool-card:nth-child(1):hover { background: linear-gradient(135deg, rgba(44,8,125,0.04), rgba(99,102,241,0.06)); }
    .tool-card:nth-child(2):hover { background: linear-gradient(135deg, rgba(139,92,246,0.04), rgba(168,85,247,0.06)); }
    .tool-card:nth-child(3):hover { background: linear-gradient(135deg, rgba(236,72,153,0.04), rgba(244,63,94,0.06)); }
    .tool-card:nth-child(4):hover { background: linear-gradient(135deg, rgba(6,182,212,0.04), rgba(20,184,166,0.06)); }
    .tool-card:nth-child(5):hover { background: linear-gradient(135deg, rgba(16,185,129,0.04), rgba(34,197,94,0.06)); }
    .tool-card:nth-child(6):hover { background: linear-gradient(135deg, rgba(245,158,11,0.04), rgba(249,115,22,0.06)); }
    .tool-card:hover .tool-icon { animation: iconBounce 0.5s ease; }
    @keyframes iconBounce {
      0%, 100% { transform: scale(1.1) rotate(0deg); }
      25% { transform: scale(1.2) rotate(-5deg); }
      75% { transform: scale(1.15) rotate(5deg); }
    }

    /* Staggered scroll entrance */
    .stagger-item { opacity: 0; transform: translateY(40px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .stagger-item.is-visible { opacity: 1; transform: translateY(0); }

    /* Animated timeline for How It Works */
    .hiw-timeline { position: relative; }
    .hiw-timeline::before {
      content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 2px;
      background: var(--border-primary); z-index: 0;
    }
    .hiw-timeline-line {
      position: absolute; top: 50%; left: 0; height: 2px; width: 0;
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral));
      z-index: 1; transition: width 1.5s ease;
    }
    .hiw-timeline-line.drawn { width: 100%; }
    @media (max-width: 768px) {
      .hiw-timeline::before { top: 0; left: 50%; width: 2px; height: 100%; }
      .hiw-timeline-line { top: 0; left: 50%; width: 2px !important; height: 0; transition: height 1.5s ease; }
      .hiw-timeline-line.drawn { height: 100%; width: 2px !important; }
    }

    /* HIW step enhanced */
    .hiw-step-enhanced {
      position: relative; z-index: 2; text-align: center;
      background: var(--bg-card); border-radius: var(--radius-xl); padding: 2rem;
      border: 1px solid var(--border-primary); transition: all 0.3s ease;
    }
    .hiw-step-enhanced:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .hiw-step-icon {
      width: 80px; height: 80px; margin: 0 auto 1rem; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-size: 2rem;
      background: linear-gradient(135deg, rgba(44,8,125,0.08), rgba(255,107,107,0.08));
    }

    /* Trust cards glassmorphism */
    .trust-card-v6 {
      background: rgba(255,255,255,0.5); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border: 2px solid transparent; border-radius: var(--radius-xl); padding: 2rem; text-align: center;
      transition: all 0.4s ease; position: relative; overflow: hidden;
    }
    .dark .trust-card-v6 { background: rgba(26,19,48,0.5); }
    .trust-card-v6::before {
      content: ''; position: absolute; inset: -2px; border-radius: var(--radius-xl);
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral), var(--fg-gold), var(--fg-purple));
      background-size: 300% 300%; animation: gradientBorder 6s ease infinite; z-index: -1;
    }
    .trust-card-v6::after {
      content: ''; position: absolute; inset: 2px; border-radius: calc(var(--radius-xl) - 2px);
      background: var(--bg-card); z-index: -1;
    }
    @keyframes gradientBorder {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .trust-card-v6:hover { transform: translateY(-6px); box-shadow: 0 12px 40px rgba(44,8,125,0.15); }
    .trust-card-v6 .trust-svg-icon { width: 80px; height: 80px; margin: 0 auto 1rem; }

    /* Animated trust SVG icons */
    .flag-wave { animation: flagWave 3s ease-in-out infinite; transform-origin: left center; }
    @keyframes flagWave {
      0%, 100% { transform: skewY(0deg); }
      25% { transform: skewY(2deg); }
      75% { transform: skewY(-2deg); }
    }
    .lock-click { animation: lockClick 3s ease infinite; }
    @keyframes lockClick {
      0%, 70%, 100% { transform: translateY(0); }
      80% { transform: translateY(-3px); }
      90% { transform: translateY(0); }
    }
    .coins-stack { animation: coinsStack 3s ease-in-out infinite; }
    @keyframes coinsStack {
      0%, 100% { transform: translateY(0); opacity: 0.6; }
      50% { transform: translateY(-5px); opacity: 1; }
    }
    .page-turn { animation: pageTurn 4s ease-in-out infinite; transform-origin: left center; }
    @keyframes pageTurn {
      0%, 100% { transform: rotateY(0deg); }
      50% { transform: rotateY(-15deg); }
    }

    /* Numbers Don't Lie section */
    .stats-grid {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem;
    }
    @media (max-width: 960px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 480px) { .stats-grid { grid-template-columns: 1fr; } }
    .stat-card {
      text-align: center; padding: 2.5rem 1.5rem; position: relative; overflow: hidden;
      border-radius: var(--radius-xl); background: var(--bg-card);
      border: 1px solid var(--border-primary); transition: all 0.3s ease;
    }
    .stat-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .stat-number {
      font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; line-height: 1;
      font-family: 'JetBrains Mono', monospace; margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .stat-label { font-size: 1rem; color: var(--text-secondary); font-weight: 600; }
    .stat-bg-element {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 6rem; opacity: 0.04; pointer-events: none;
    }

    /* CTA Banner */
    .cta-banner {
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-purple-light));
      padding: 4rem 2rem; text-align: center; position: relative; overflow: hidden;
    }
    .cta-banner::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(270deg, rgba(255,107,107,0.1), transparent, rgba(245,166,35,0.1));
      background-size: 400% 400%; animation: gradientShift 8s ease infinite;
    }
    .cta-banner h2 { color: white; font-size: clamp(1.75rem, 4vw, 2.75rem); margin-bottom: 1rem; position: relative; z-index: 1; }
    .cta-banner p { color: rgba(255,255,255,0.75); font-size: 1.1rem; margin-bottom: 2rem; position: relative; z-index: 1; }

    /* Footer v6 */
    .figgy-footer-v6 {
      background: linear-gradient(180deg, #1a0e3a, #0f0a1a); color: rgba(255,255,255,0.9);
      padding: 4rem 2rem 2rem; text-align: center; position: relative; overflow: hidden;
    }
    .figgy-footer-v6::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(270deg, rgba(44,8,125,0.2), transparent, rgba(255,107,107,0.1));
      background-size: 400% 400%; animation: gradientShift 12s ease infinite;
    }

    /* Scroll to top piggy */
    .scroll-top-piggy {
      position: fixed; bottom: 2rem; right: 2rem; width: 48px; height: 48px;
      border-radius: 50%; background: var(--fg-purple); color: white; border: none;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; box-shadow: 0 4px 20px rgba(44,8,125,0.3);
      opacity: 0; transform: translateY(20px); transition: all 0.3s ease; z-index: 100;
    }
    .scroll-top-piggy.visible { opacity: 1; transform: translateY(0); }
    .scroll-top-piggy:hover { transform: translateY(-4px); box-shadow: 0 8px 30px rgba(44,8,125,0.4); }

    /* Cursor trail */
    .cursor-dot {
      position: fixed; width: 8px; height: 8px; border-radius: 50%;
      background: rgba(44,8,125,0.3); pointer-events: none; z-index: 9998;
      transition: transform 0.15s ease, opacity 0.3s ease; mix-blend-mode: multiply;
    }
    .dark .cursor-dot { background: rgba(255,107,107,0.3); mix-blend-mode: screen; }

    /* Coin rain animation */
    .coin-rain-piece {
      position: fixed; font-size: 1.5rem; top: -50px; z-index: 10000; pointer-events: none;
      animation: coinFall 3s ease-in forwards;
    }
    @keyframes coinFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
    }

    /* Page load stagger */
    .load-stagger { opacity: 0; transform: translateY(30px); }
    .load-stagger.loaded { opacity: 1; transform: translateY(0); transition: all 0.6s cubic-bezier(0.4,0,0.2,1); }

    /* Counter animation */
    .count-up { display: inline-block; }

    /* Parallax mouse class */
    .parallax-mouse { transition: transform 0.3s ease-out; will-change: transform; }

    /* Animated data viz in showcase */
    .viz-bar { transition: height 1s cubic-bezier(0.4,0,0.2,1); }
    .viz-number { font-family: 'JetBrains Mono', monospace; font-weight: 800; }

    @media (prefers-reduced-motion: reduce) {
      .sparkle, .piggy-bounce, .coin-float, .coin-float-2, .coin-float-3,
      .chart-draw, .dollar-fade, .dollar-fade-2, .dollar-fade-3,
      .gradient-text-animated, .hero-mesh-bg::before, .shape-cube, .shape-sphere,
      .flag-wave, .lock-click, .coins-stack, .page-turn, .btn-pulse,
      .cursor-dot, .coin-rain-piece, .trust-card-v6::before {
        animation: none !important;
      }
      .hiw-timeline-line { transition: none !important; width: 100% !important; }
      .load-stagger { opacity: 1 !important; transform: none !important; }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-to-content">Skip to main content</a>

  <!-- Keyboard Shortcuts Overlay -->
  <div class="shortcuts-overlay hidden" id="shortcuts-overlay" role="dialog" aria-label="Keyboard shortcuts" onclick="if(event.target===this)this.classList.add('hidden')">
    <div class="shortcuts-card">
      <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
      <div class="shortcut-row"><span>Show this help</span><span class="shortcut-key">?</span></div>
      <div class="shortcut-row"><span>Business Valuation</span><span class="shortcut-key">1</span></div>
      <div class="shortcut-row"><span>Mortgage Calculator</span><span class="shortcut-key">2</span></div>
      <div class="shortcut-row"><span>Investment Returns</span><span class="shortcut-key">3</span></div>
      <div class="shortcut-row"><span>RRSP vs TFSA</span><span class="shortcut-key">4</span></div>
      <div class="shortcut-row"><span>Compound Interest</span><span class="shortcut-key">5</span></div>
      <div class="shortcut-row"><span>M&A Analyzer</span><span class="shortcut-key">6</span></div>
      <div class="shortcut-row"><span>Startup Runway</span><span class="shortcut-key">7</span></div>
      <div class="shortcut-row"><span>Net Worth</span><span class="shortcut-key">8</span></div>
      <div class="shortcut-row"><span>Toggle Theme</span><span class="shortcut-key">T</span></div>
      <div class="shortcut-row"><span>Home</span><span class="shortcut-key">H</span></div>
    </div>
  </div>

  <div id="scroll-progress"></div>

  <!-- ‚ïê‚ïê NAVIGATION ‚ïê‚ïê -->
  <nav class="nav-bar" id="navbar">
    <div class="nav-inner">
      <a href="#" class="nav-logo" onclick="showPage('home'); return false;">
        <!-- FiggyBank Piggy Bank Logo SVG -->
        <svg class="nav-logo-svg" width="36" height="36" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="32" cy="36" rx="22" ry="18" fill="#FF8A8A"/>
          <ellipse cx="32" cy="36" rx="22" ry="18" fill="url(#piggyGrad)" opacity="0.5"/>
          <!-- Ears -->
          <ellipse cx="16" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(-15 16 22)"/>
          <ellipse cx="16" cy="22" rx="4" ry="5" fill="#FFB5B5" transform="rotate(-15 16 22)"/>
          <ellipse cx="48" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(15 48 22)"/>
          <ellipse cx="48" cy="22" rx="4" ry="5" fill="#FFB5B5" transform="rotate(15 48 22)"/>
          <!-- Coin slot -->
          <rect x="26" y="19" width="12" height="3" rx="1.5" fill="#F5A623"/>
          <rect x="27" y="20" width="10" height="1" rx="0.5" fill="#D4891A"/>
          <!-- Snout -->
          <ellipse cx="32" cy="40" rx="8" ry="6" fill="#FFB5B5"/>
          <circle cx="29" cy="39.5" r="1.5" fill="#E88A8A"/>
          <circle cx="35" cy="39.5" r="1.5" fill="#E88A8A"/>
          <!-- Eyes -->
          <circle cx="24" cy="32" r="2.5" fill="#2C087D"/>
          <circle cx="40" cy="32" r="2.5" fill="#2C087D"/>
          <circle cx="25" cy="31" r="1" fill="white"/>
          <circle cx="41" cy="31" r="1" fill="white"/>
          <!-- Smile -->
          <path d="M28 43 Q32 46 36 43" stroke="#E88A8A" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <!-- Legs -->
          <rect x="20" y="50" width="5" height="6" rx="2.5" fill="#FF8A8A"/>
          <rect x="39" y="50" width="5" height="6" rx="2.5" fill="#FF8A8A"/>
          <!-- Tail -->
          <path d="M54 34 Q58 30 56 26 Q54 22 58 20" stroke="#FF8A8A" stroke-width="2.5" fill="none" stroke-linecap="round"/>
          <defs>
            <linearGradient id="piggyGrad" x1="10" y1="18" x2="54" y2="54">
              <stop offset="0%" stop-color="#FFD4D4"/>
              <stop offset="100%" stop-color="#FF6B6B" stop-opacity="0.3"/>
            </linearGradient>
          </defs>
        </svg>
        <span>FiggyBank</span>
      </a>
      
      <ul class="nav-links" id="nav-links">
        <li><a href="#tools-section" onclick="showPage('home')">Tools</a></li>
        <li><a href="#" onclick="showPage('valuation'); return false;">Valuation</a></li>
        <li><a href="#" onclick="showPage('mortgage'); return false;">Mortgage</a></li>
        <li><a href="#" onclick="showPage('investment'); return false;">Investment</a></li>
        <li><a href="#" onclick="showPage('retirement'); return false;">Retirement</a></li>
        <li><a href="#" onclick="showPage('compound'); return false;">Compound</a></li>
        <li><a href="#" onclick="showPage('salary'); return false;">Salary</a></li>
        <li><a href="#" onclick="showPage('debt'); return false;">Debt</a></li>
        <li><a href="#" onclick="showPage('compare'); return false;">Compare</a></li>
        <li><a href="#" onclick="showPage('currency'); return false;">Currency</a></li>
        <li><a href="#" onclick="showPage('lease'); return false;">Lease vs Buy</a></li>
        <li><a href="#" onclick="showPage('tax'); return false;">Tax</a></li>
      </ul>
      
      <div class="nav-actions">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">‚òÄÔ∏è</button>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">‚ò∞</button>
      </div>
    </div>
  </nav>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       HOME PAGE ‚Äî CreditGenie-inspired
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main id="main-content">
  <div class="page active" id="page-home">

    <!-- ‚ïê‚ïê HERO v6 ‚Äî DRAMATIC ‚ïê‚ïê -->
    <section class="figgy-hero" style="position:relative;">
      <div class="hero-mesh-bg"></div>
      <div class="sparkle-container" id="sparkle-container"></div>

      <!-- Parallax floating decorations -->
      <div class="hero-floater parallax-mouse" data-speed="15" style="top:12%;left:6%;opacity:0.2;">
        <svg width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="25" r="22" fill="none" stroke="#FF6B6B" stroke-width="2" stroke-dasharray="5 4"/></svg>
      </div>
      <div class="hero-floater parallax-mouse" data-speed="25" style="top:20%;right:8%;opacity:0.15;">
        <svg width="60" height="60" viewBox="0 0 60 60"><circle cx="30" cy="30" r="26" fill="#F5A623" opacity="0.25"/><text x="30" y="37" text-anchor="middle" font-size="22" fill="#F5A623" font-weight="700">$</text></svg>
      </div>
      <div class="hero-floater parallax-mouse" data-speed="10" style="bottom:18%;left:10%;opacity:0.12;">
        <svg width="45" height="45" viewBox="0 0 45 45"><rect x="5" y="5" width="35" height="35" rx="6" fill="none" stroke="#2C087D" stroke-width="2" opacity="0.3"/></svg>
      </div>
      <div class="hero-floater parallax-mouse" data-speed="20" style="bottom:25%;right:5%;opacity:0.15;">
        <svg width="55" height="55" viewBox="0 0 55 55"><polygon points="27,4 34,20 52,22 39,34 42,52 27,44 12,52 15,34 2,22 20,20" fill="none" stroke="#FF6B6B" stroke-width="1.5" opacity="0.35"/></svg>
      </div>

      <div class="figgy-hero-inner">
        <div class="figgy-hero-left">
          <h1 class="hero-huge load-stagger" style="transition-delay:0.1s;">
            Crunch your<br>
            <span class="hero-word-rotator">
              <span class="gradient-text-animated">mortgage</span>
              <span class="gradient-text-animated">taxes</span>
              <span class="gradient-text-animated">investments</span>
              <span class="gradient-text-animated">business valuation</span>
              <span class="gradient-text-animated">mortgage</span>
            </span>
          </h1>
          <p class="load-stagger" style="transition-delay:0.25s;">Free financial calculators built for Canadians. No sign-ups, no nonsense ‚Äî just smart tools that help you make better money decisions.</p>
          <div class="load-stagger" style="display:flex;gap:1rem;flex-wrap:wrap;transition-delay:0.4s;">
            <a href="#tools-section" class="btn btn-primary btn-lg btn-pulse btn-animated" style="min-width:220px;font-size:1.15rem;">
              <span class="btn-text-wrap">
                <span class="btn-initial">Explore Tools ‚Üí</span>
                <span class="btn-hover">Let's go! üê∑</span>
              </span>
            </a>
          </div>
        </div>
        <div class="figgy-hero-right load-stagger" style="transition-delay:0.5s;">
          <!-- Animated SVG piggy bank scene -->
          <div class="hero-scene">
            <svg viewBox="0 0 400 320" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Chart lines (self-drawing) -->
              <polyline class="chart-draw" points="30,250 80,230 130,240 180,200 230,180 280,140 330,100 370,60" stroke="#2C087D" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.3"/>
              <polyline class="chart-draw" style="animation-delay:0.8s" points="30,260 80,255 130,250 180,235 230,220 280,195 330,160 370,120" stroke="#FF6B6B" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.25"/>
              <!-- Grid lines -->
              <line x1="30" y1="280" x2="370" y2="280" stroke="#2C087D" stroke-width="1" opacity="0.1"/>
              <line x1="30" y1="220" x2="370" y2="220" stroke="#2C087D" stroke-width="1" opacity="0.05"/>
              <line x1="30" y1="160" x2="370" y2="160" stroke="#2C087D" stroke-width="1" opacity="0.05"/>
              <!-- Piggy bank (bouncing) -->
              <g class="piggy-bounce">
                <ellipse cx="200" cy="230" rx="70" ry="55" fill="#FF8A8A"/>
                <ellipse cx="200" cy="230" rx="70" ry="55" fill="url(#heroGrad)" opacity="0.4"/>
                <!-- Ears -->
                <ellipse cx="150" cy="185" rx="16" ry="20" fill="#FF8A8A" transform="rotate(-12 150 185)"/>
                <ellipse cx="150" cy="185" rx="11" ry="15" fill="#FFB5B5" transform="rotate(-12 150 185)"/>
                <ellipse cx="250" cy="185" rx="16" ry="20" fill="#FF8A8A" transform="rotate(12 250 185)"/>
                <ellipse cx="250" cy="185" rx="11" ry="15" fill="#FFB5B5" transform="rotate(12 250 185)"/>
                <!-- Coin slot -->
                <rect x="184" y="172" width="32" height="7" rx="3.5" fill="#F5A623"/>
                <rect x="186" y="174" width="28" height="3" rx="1.5" fill="#D4891A"/>
                <!-- Snout -->
                <ellipse cx="200" cy="245" rx="22" ry="16" fill="#FFB5B5"/>
                <circle cx="192" cy="243" r="4" fill="#E88A8A"/>
                <circle cx="208" cy="243" r="4" fill="#E88A8A"/>
                <!-- Eyes -->
                <circle cx="178" cy="218" r="7" fill="#2C087D"/>
                <circle cx="222" cy="218" r="7" fill="#2C087D"/>
                <circle cx="180" cy="216" r="2.5" fill="white"/>
                <circle cx="224" cy="216" r="2.5" fill="white"/>
                <!-- Smile -->
                <path d="M188 255 Q200 265 212 255" stroke="#E88A8A" stroke-width="3" fill="none" stroke-linecap="round"/>
                <!-- Legs -->
                <rect x="163" y="278" width="14" height="16" rx="7" fill="#FF8A8A"/>
                <rect x="223" y="278" width="14" height="16" rx="7" fill="#FF8A8A"/>
                <!-- Tail -->
                <path d="M270 225 Q282 218 278 205 Q275 195 282 188" stroke="#FF8A8A" stroke-width="4" fill="none" stroke-linecap="round"/>
              </g>
              <!-- Floating coins -->
              <g class="coin-float">
                <circle cx="100" cy="140" r="18" fill="#F5A623" opacity="0.9"/>
                <circle cx="100" cy="140" r="13" fill="none" stroke="#D4891A" stroke-width="1.5"/>
                <text x="100" y="146" text-anchor="middle" font-size="16" fill="#8B6914" font-weight="700">$</text>
              </g>
              <g class="coin-float-2">
                <circle cx="310" cy="90" r="14" fill="#F5A623" opacity="0.8"/>
                <circle cx="310" cy="90" r="10" fill="none" stroke="#D4891A" stroke-width="1"/>
                <text x="310" y="95" text-anchor="middle" font-size="12" fill="#8B6914" font-weight="700">$</text>
              </g>
              <g class="coin-float-3">
                <circle cx="70" cy="80" r="11" fill="#F5A623" opacity="0.7"/>
                <text x="70" y="85" text-anchor="middle" font-size="10" fill="#8B6914" font-weight="700">$</text>
              </g>
              <!-- Dollar signs floating -->
              <text class="dollar-fade" x="340" y="180" font-size="20" fill="#2C087D" opacity="0.4" font-weight="700">$</text>
              <text class="dollar-fade-2" x="55" y="200" font-size="16" fill="#FF6B6B" opacity="0.3" font-weight="700">$</text>
              <text class="dollar-fade-3" x="290" y="260" font-size="14" fill="#F5A623" opacity="0.3" font-weight="700">$</text>
              <defs>
                <linearGradient id="heroGrad" x1="130" y1="175" x2="270" y2="285">
                  <stop offset="0%" stop-color="#FFD4D4"/>
                  <stop offset="100%" stop-color="#FF6B6B" stop-opacity="0.3"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- ‚ïê‚ïê FEATURED CALCULATORS ‚Äî Interactive Tabbed Showcase ‚ïê‚ïê -->
    <div class="section-white" style="position:relative;overflow:hidden;">
      <!-- Floating 3D shapes -->
      <div class="floating-shape parallax-mouse" data-speed="30" style="top:10%;left:5%;"><div class="shape-sphere" style="width:50px;height:50px;"></div></div>
      <div class="floating-shape parallax-mouse" data-speed="20" style="top:60%;right:3%;"><div class="shape-cube"><div style="width:40px;height:40px;background:rgba(44,8,125,0.08);border:1px solid rgba(44,8,125,0.15);border-radius:4px;"></div></div></div>
      <div class="floating-shape parallax-mouse" data-speed="15" style="bottom:15%;left:8%;"><div class="shape-sphere" style="width:35px;height:35px;background:radial-gradient(circle at 30% 30%,rgba(245,166,35,0.25),rgba(255,107,107,0.1));"></div></div>

      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">‚ú® Featured Calculators</div>
          <h2 class="section-title js-show">Powerful tools,<br>ridiculously simple</h2>
        </div>

        <!-- Tabs -->
        <div class="showcase-tabs js-show">
          <button class="showcase-tab active" onclick="switchShowcase('mortgage')">üè† Mortgage</button>
          <button class="showcase-tab" onclick="switchShowcase('valuation')">üè¢ Business Valuation</button>
          <button class="showcase-tab" onclick="switchShowcase('tax')">üßæ Tax</button>
          <button class="showcase-tab" onclick="switchShowcase('ma')">ü§ù M&A</button>
        </div>

        <!-- Glassmorphism showcase card -->
        <div class="glass-showcase js-show" id="showcase-card">
          <!-- Mortgage Panel -->
          <div class="showcase-panel active" id="showcase-mortgage">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">Canadian Mortgage Calculator</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">The only mortgage calculator that actually does Canadian semi-annual compounding correctly. CMHC, stress test, and land transfer tax built in.</p>
                <ul class="feature-bullets">
                  <li>Semi-annual compounding (as required by law)</li>
                  <li>CMHC insurance premiums</li>
                  <li>OSFI B-20 stress test</li>
                  <li>Provincial land transfer taxes</li>
                </ul>
                <a href="#" onclick="showPage('mortgage'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:4px;align-items:flex-end;height:140px;padding:1rem;background:rgba(44,8,125,0.03);border-radius:var(--radius-lg);">
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="55%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="70%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="45%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="80%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="65%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#FF6B6B,rgba(255,107,107,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="95%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="85%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="60%"></div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">Monthly Payment</div>
                  <div class="viz-number count-up" data-count-up="3584" data-suffix="" style="font-size:2.25rem;font-weight:900;background:linear-gradient(135deg,#2C087D,#FF6B6B);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">$3,584</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Valuation Panel -->
          <div class="showcase-panel" id="showcase-valuation">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">Business Valuation</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">Three professional valuation methods ‚Äî DCF, comparable multiples, and asset-based approaches. Sensitivity tables included.</p>
                <ul class="feature-bullets">
                  <li>5-year DCF with terminal value</li>
                  <li>Industry-specific multiples</li>
                  <li>Sensitivity analysis tables</li>
                  <li>Professional PDF export</li>
                </ul>
                <a href="#" onclick="showPage('valuation'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:4px;align-items:flex-end;height:140px;padding:1rem;background:rgba(99,102,241,0.03);border-radius:var(--radius-lg);">
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="40%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="55%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="65%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="75%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#8b5cf6,rgba(139,92,246,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="100%"></div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">Enterprise Value</div>
                  <div class="viz-number" style="font-size:2.25rem;font-weight:900;background:linear-gradient(135deg,#6366f1,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">$8.2M</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tax Panel -->
          <div class="showcase-panel" id="showcase-tax">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">Canadian Tax Estimator</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">Federal + provincial tax calculations with all Canadian-specific brackets. See exactly where your money goes.</p>
                <ul class="feature-bullets">
                  <li>2025/2026 federal & provincial brackets</li>
                  <li>CPP, EI, and basic personal amount</li>
                  <li>Marginal vs effective rate breakdown</li>
                  <li>Compare across provinces</li>
                </ul>
                <a href="#" onclick="showPage('tax'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:6px;align-items:flex-end;height:140px;padding:1rem;background:rgba(239,68,68,0.03);border-radius:var(--radius-lg);">
                  <div style="flex:1;display:flex;flex-direction:column;gap:2px;justify-content:flex-end;height:100%;">
                    <div class="viz-bar" style="background:#ef4444;border-radius:4px;height:0;" data-target-height="35%"></div>
                    <div class="viz-bar" style="background:#f59e0b;border-radius:4px;height:0;" data-target-height="20%"></div>
                    <div class="viz-bar" style="background:#10b981;border-radius:4px;height:0;" data-target-height="45%"></div>
                  </div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">Effective Rate</div>
                  <div class="viz-number" style="font-size:2.25rem;font-weight:900;color:#ef4444;">28.7%</div>
                </div>
              </div>
            </div>
          </div>

          <!-- M&A Panel -->
          <div class="showcase-panel" id="showcase-ma">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">M&A Deal Analyzer</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">Model accretion/dilution, financing mix, and synergy impact. The same analysis investment banks charge thousands for.</p>
                <ul class="feature-bullets">
                  <li>Accretion/dilution analysis</li>
                  <li>Cash, stock, and mixed financing</li>
                  <li>Synergy modeling</li>
                  <li>Sensitivity tables</li>
                </ul>
                <a href="#" onclick="showPage('merger'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:4px;align-items:flex-end;height:140px;padding:1rem;background:rgba(16,185,129,0.03);border-radius:var(--radius-lg);">
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="50%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="62%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="78%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="90%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="100%"></div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">EPS Impact</div>
                  <div class="viz-number" style="font-size:2.25rem;font-weight:900;color:#10b981;">+12.4% Accretive</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê ALL TOOLS GRID ‚ïê‚ïê -->
    <div class="section-cream" id="tools-section">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üßÆ All Tools</div>
          <h2 class="section-title js-show">Every calculator you need</h2>
          <p class="section-desc js-show">14 professional-grade tools, zero price tag.</p>
        </div>

        <div class="tools-category-label js-show" style="display:flex;align-items:center;gap:0.75rem;"><span style="width:30px;height:2px;background:var(--fg-coral);display:inline-block;flex-shrink:0;"></span>Business & M&A<span style="flex:1;height:1px;background:var(--border-primary);"></span></div>
        <div class="tools-grid">
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('valuation')">
            <div class="tool-icon" style="background:rgba(44,8,125,0.08);">üè¢</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Business Valuation</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">DCF, multiples & asset-based approaches</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('merger')">
            <div class="tool-icon" style="background:rgba(139,92,246,0.08);">ü§ù</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">M&A Deal Analyzer</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Accretion/dilution & financing mix</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('runway')">
            <div class="tool-icon" style="background:rgba(168,85,247,0.08);">üöÄ</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Startup Runway</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Burn rate, hiring & fundraising timing</p>
            <span class="card-arrow">‚Üí</span>
          </div>
        </div>

        <div class="tools-category-label js-show" style="display:flex;align-items:center;gap:0.75rem;"><span style="width:30px;height:2px;background:var(--fg-coral);display:inline-block;flex-shrink:0;"></span>Personal Finance<span style="flex:1;height:1px;background:var(--border-primary);"></span></div>
        <div class="tools-grid">
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('mortgage')">
            <div class="tool-icon" style="background:rgba(6,182,212,0.08);">üè†</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Canadian Mortgage</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Semi-annual compounding, CMHC, stress test</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('investment')">
            <div class="tool-icon" style="background:rgba(16,185,129,0.08);">üìà</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Investment Returns</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">CAGR, DCA & portfolio growth</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('compound')">
            <div class="tool-icon" style="background:rgba(236,72,153,0.08);">üìä</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Compound Interest</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Visualize the power of compounding</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('networth')">
            <div class="tool-icon" style="background:rgba(34,197,94,0.08);">üí∞</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Net Worth Tracker</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Track assets, liabilities & progress</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('salary')">
            <div class="tool-icon" style="background:rgba(20,184,166,0.08);">üíº</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Salary & Compensation</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Total comp, take-home & benefits</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('debt')">
            <div class="tool-icon" style="background:rgba(239,68,68,0.08);">üí≥</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Debt Payoff</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Snowball, avalanche & payoff timeline</p>
            <span class="card-arrow">‚Üí</span>
          </div>
        </div>

        <div class="tools-category-label js-show" style="display:flex;align-items:center;gap:0.75rem;"><span style="width:30px;height:2px;background:var(--fg-coral);display:inline-block;flex-shrink:0;"></span>Tax & Planning<span style="flex:1;height:1px;background:var(--border-primary);"></span></div>
        <div class="tools-grid">
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('retirement')">
            <div class="tool-icon" style="background:rgba(245,158,11,0.08);">üè¶</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">RRSP vs TFSA</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Compare tax-advantaged accounts</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('tax')">
            <div class="tool-icon" style="background:rgba(239,68,68,0.08);">üßæ</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Canadian Tax Estimator</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Federal + provincial brackets</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('lease')">
            <div class="tool-icon" style="background:rgba(245,158,11,0.08);">üöó</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Lease vs Buy</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Total cost comparison over time</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('currency')">
            <div class="tool-icon" style="background:rgba(20,184,166,0.08);">üí±</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Currency Converter</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Live exchange rates</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('compare')">
            <div class="tool-icon" style="background:rgba(168,85,247,0.08);">‚öñÔ∏è</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Side-by-Side Compare</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Compare any two financial options</p>
            <span class="card-arrow">‚Üí</span>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê HOW IT WORKS ‚Äî Animated Timeline ‚ïê‚ïê -->
    <div class="section-white">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üéØ How It Works</div>
          <h2 class="section-title js-show">Three steps. Zero friction.</h2>
        </div>
        <div class="hiw-timeline" id="hiw-timeline" style="display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;position:relative;">
          <div class="hiw-timeline-line" id="hiw-line"></div>
          <div class="hiw-step-enhanced js-show">
            <div class="hiw-step-icon">
              <svg width="40" height="40" viewBox="0 0 40 40"><rect x="4" y="8" width="32" height="24" rx="4" fill="none" stroke="#2C087D" stroke-width="2.5"/><circle cx="20" cy="20" r="6" fill="#FF6B6B" opacity="0.3"/><path d="M14 20h12M20 14v12" stroke="#2C087D" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <div style="font-size:0.75rem;color:var(--fg-coral);font-weight:800;letter-spacing:0.1em;margin-bottom:0.5rem;">STEP 01</div>
            <h3 style="font-size:1.1rem;margin-bottom:0.5rem;">Pick your calculator</h3>
            <p style="font-size:0.9rem;color:var(--text-secondary);">Browse 14+ financial tools ‚Äî from mortgage to M&A, we've got you covered.</p>
          </div>
          <div class="hiw-step-enhanced js-show js-show-up-20">
            <div class="hiw-step-icon">
              <svg width="40" height="40" viewBox="0 0 40 40"><rect x="8" y="4" width="24" height="32" rx="3" fill="none" stroke="#2C087D" stroke-width="2.5"/><line x1="13" y1="12" x2="27" y2="12" stroke="#FF6B6B" stroke-width="2" stroke-linecap="round"/><line x1="13" y1="18" x2="23" y2="18" stroke="#2C087D" stroke-width="1.5" stroke-linecap="round" opacity="0.4"/><line x1="13" y1="24" x2="25" y2="24" stroke="#2C087D" stroke-width="1.5" stroke-linecap="round" opacity="0.4"/><circle cx="27" cy="28" r="5" fill="#F5A623" opacity="0.3"/><path d="M25 28l2 2 3-4" stroke="#F5A623" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <div style="font-size:0.75rem;color:var(--fg-coral);font-weight:800;letter-spacing:0.1em;margin-bottom:0.5rem;">STEP 02</div>
            <h3 style="font-size:1.1rem;margin-bottom:0.5rem;">Punch in your numbers</h3>
            <p style="font-size:0.9rem;color:var(--text-secondary);">Easy inputs with smart defaults. Watch results update in real time.</p>
          </div>
          <div class="hiw-step-enhanced js-show js-show-up-40">
            <div class="hiw-step-icon">
              <svg width="40" height="40" viewBox="0 0 40 40"><path d="M6 30 L14 18 L22 24 L34 8" stroke="#2C087D" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><circle cx="34" cy="8" r="4" fill="#10b981" opacity="0.4"/><path d="M30 8h4v4" stroke="#10b981" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="32" width="32" height="2" rx="1" fill="#2C087D" opacity="0.15"/></svg>
            </div>
            <div style="font-size:0.75rem;color:var(--fg-coral);font-weight:800;letter-spacing:0.1em;margin-bottom:0.5rem;">STEP 03</div>
            <h3 style="font-size:1.1rem;margin-bottom:0.5rem;">Make better decisions</h3>
            <p style="font-size:0.9rem;color:var(--text-secondary);">Export PDF reports, compare scenarios, and act with confidence.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê NUMBERS DON'T LIE ‚ïê‚ïê -->
    <div class="section-cream">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üìä Numbers Don't Lie</div>
          <h2 class="section-title js-show">The proof is in the pudding</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card js-show">
            <div class="stat-bg-element">üßÆ</div>
            <div class="stat-number count-up" data-count-up="14" data-suffix="+">0</div>
            <div class="stat-label">Calculators</div>
          </div>
          <div class="stat-card js-show js-show-up-10">
            <div class="stat-bg-element">üí∞</div>
            <div class="stat-number count-up" data-count-up="100" data-suffix="%">0</div>
            <div class="stat-label">Free Forever</div>
          </div>
          <div class="stat-card js-show js-show-up-20">
            <div class="stat-bg-element">üîí</div>
            <div class="stat-number" style="font-size:clamp(2.5rem,5vw,4rem);">0</div>
            <div class="stat-label">Data Stored</div>
          </div>
          <div class="stat-card js-show js-show-up-30">
            <div class="stat-bg-element">üçÅ</div>
            <div class="stat-number" style="font-size:clamp(2rem,4vw,3rem);">üá®üá¶</div>
            <div class="stat-label">Canadian-Built</div>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê TRUST / FEATURES ‚Äî Glassmorphism v6 ‚ïê‚ïê -->
    <div class="section-white">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üí™ Why FiggyBank</div>
          <h2 class="section-title js-show">Built different. Built for you.</h2>
        </div>
        <div class="trust-grid">
          <div class="trust-card-v6 js-show">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <rect x="10" y="20" width="50" height="32" rx="3" fill="#ef4444" opacity="0.15"/>
                <g class="flag-wave">
                  <rect x="15" y="22" width="44" height="28" rx="2" fill="white"/>
                  <rect x="15" y="22" width="12" height="28" fill="#ef4444"/>
                  <rect x="47" y="22" width="12" height="28" fill="#ef4444"/>
                  <path d="M37 26 L38.5 30 L42 29 L40 32 L44 33 L40.5 35 L41.5 39 L37 37 L32.5 39 L33.5 35 L30 33 L34 32 L32 29 L35.5 30Z" fill="#ef4444"/>
                </g>
                <rect x="10" y="20" width="3" height="40" rx="1.5" fill="#666"/>
              </svg>
            </div>
            <h4>Canadian-First</h4>
            <p>Built for Canadian tax brackets, CMHC rules, RRSP limits, and semi-annual mortgage compounding.</p>
          </div>
          <div class="trust-card-v6 js-show js-show-up-10">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <g class="lock-click">
                  <rect x="22" y="38" width="36" height="28" rx="5" fill="#2C087D" opacity="0.9"/>
                  <path d="M28 38V28a12 12 0 0 1 24 0v10" stroke="#2C087D" stroke-width="4" fill="none" stroke-linecap="round"/>
                  <circle cx="40" cy="50" r="4" fill="white"/>
                  <rect x="38" y="52" width="4" height="6" rx="2" fill="white"/>
                </g>
              </svg>
            </div>
            <h4>Privacy-First</h4>
            <p>All calculations run in your browser. Nothing stored. Nothing sent. Your numbers never leave your device.</p>
          </div>
          <div class="trust-card-v6 js-show js-show-up-20">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <g class="coins-stack">
                  <ellipse cx="40" cy="55" rx="22" ry="7" fill="#F5A623" opacity="0.6"/>
                  <ellipse cx="40" cy="48" rx="22" ry="7" fill="#F5A623" opacity="0.7"/>
                  <ellipse cx="40" cy="41" rx="22" ry="7" fill="#F5A623" opacity="0.8"/>
                  <ellipse cx="40" cy="34" rx="22" ry="7" fill="#F5A623"/>
                  <text x="40" y="38" text-anchor="middle" font-size="12" fill="#8B6914" font-weight="700">$</text>
                </g>
              </svg>
            </div>
            <h4>Always Free</h4>
            <p>No accounts, no paywalls, no BS. Just open the page and start crunching numbers.</p>
          </div>
          <div class="trust-card-v6 js-show js-show-up-30">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <g class="page-turn">
                  <rect x="15" y="12" width="40" height="52" rx="3" fill="white" stroke="#ddd" stroke-width="1.5"/>
                  <rect x="25" y="12" width="40" height="52" rx="3" fill="white" stroke="#ccc" stroke-width="1.5"/>
                  <line x1="32" y1="24" x2="58" y2="24" stroke="#2C087D" stroke-width="2" opacity="0.3" stroke-linecap="round"/>
                  <line x1="32" y1="32" x2="55" y2="32" stroke="#2C087D" stroke-width="2" opacity="0.2" stroke-linecap="round"/>
                  <line x1="32" y1="40" x2="52" y2="40" stroke="#2C087D" stroke-width="2" opacity="0.15" stroke-linecap="round"/>
                  <rect x="32" y="48" width="20" height="8" rx="2" fill="#FF6B6B" opacity="0.15"/>
                  <text x="42" y="55" text-anchor="middle" font-size="6" fill="#FF6B6B" font-weight="700">PDF</text>
                </g>
              </svg>
            </div>
            <h4>Export Ready</h4>
            <p>Professional PDF reports for client meetings, boardrooms, or your own records.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê FAQ ‚ïê‚ïê -->
    <div class="section-white">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">‚ùì FAQ</div>
          <h2 class="section-title js-show">Got questions?</h2>
        </div>
        <div class="faq-list">
          <div class="accordion-item js-show">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Is FiggyBank really free?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Yes, 100% free. All 14+ calculators are available without creating an account or paying anything. We believe everyone deserves access to quality financial tools.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-10">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Is my data safe?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Absolutely. All calculations run entirely in your browser using JavaScript. No data is sent to any server. Your financial numbers never leave your device. We don't even have a database.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-20">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>How accurate are the Canadian mortgage calculations?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Our mortgage calculator uses Canadian semi-annual compounding as required by law, includes CMHC insurance premiums for high-ratio mortgages, provincial land transfer taxes, and OSFI B-20 stress test calculations. Results match major bank calculators.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-30">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Should I choose RRSP or TFSA?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">It depends on your current vs. expected retirement tax rate. Generally, RRSP is better if your current tax rate is higher than your expected retirement rate. Use our RRSP vs TFSA Optimizer to compare based on your specific situation ‚Äî it'll show you the exact dollar difference.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-40">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Can I export results as PDF?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Yes! Most calculators have an "Export PDF" button that generates a professional report with your inputs, results, and charts. Great for client meetings, personal records, or sharing with your financial advisor.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-50">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Are the tax brackets up to date?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">We update federal and provincial tax brackets annually. The current calculator reflects 2025/2026 Canadian tax rates, CPP/EI contributions, and basic personal amounts for all provinces and territories.</div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê CTA BANNER ‚ïê‚ïê -->
    <div class="cta-banner">
      <div style="max-width:700px;margin:0 auto;position:relative;">
        <div style="font-size:4rem;margin-bottom:1rem;">üê∑</div>
        <h2>Ready to crunch some numbers?</h2>
        <p>14+ free calculators. Zero sign-ups. 100% Canadian.</p>
        <a href="#tools-section" class="btn" style="background:white;color:#2C087D;font-weight:700;padding:1rem 2.5rem;border-radius:var(--radius-full);font-size:1.1rem;position:relative;z-index:1;">Explore All Tools ‚Üí</a>
      </div>
    </div>

    <!-- ‚ïê‚ïê FOOTER v6 ‚ïê‚ïê -->
    <!-- ‚ïê‚ïê CONTACT US ‚ïê‚ïê -->
    <section id="contact-section" style="padding:4rem 1.5rem;background:var(--bg-primary);">
      <div style="max-width:600px;margin:0 auto;">
        <h2 class="js-show" style="text-align:center;font-size:clamp(1.5rem,3vw,2.25rem);font-weight:900;color:var(--text-primary);margin-bottom:0.5rem;">Get in Touch</h2>
        <p class="js-show js-show-up-10" style="text-align:center;color:var(--text-secondary);margin-bottom:2rem;">Have a question, suggestion, or just want to say hi? Drop us a line.</p>
        <form class="js-show js-show-up-20" action="https://formsubmit.co/rajankchopra@gmail.com" method="POST" style="display:flex;flex-direction:column;gap:1rem;">
          <input type="hidden" name="_subject" value="FiggyBank Contact Form">
          <input type="hidden" name="_captcha" value="true">
          <input type="hidden" name="_template" value="table">
          <input type="hidden" name="_next" value="https://rajkcho.github.io/Babaganoush/">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
            <div>
              <label style="display:block;font-size:0.8rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">Name</label>
              <input type="text" name="name" required placeholder="Your name" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--border-primary);border-radius:var(--radius-md);background:var(--bg-card);color:var(--text-primary);font-size:0.9rem;transition:border-color 0.3s;outline:none;" onfocus="this.style.borderColor='var(--fg-purple)'" onblur="this.style.borderColor='var(--border-primary)'">
            </div>
            <div>
              <label style="display:block;font-size:0.8rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">Email</label>
              <input type="email" name="email" required placeholder="you@example.com" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--border-primary);border-radius:var(--radius-md);background:var(--bg-card);color:var(--text-primary);font-size:0.9rem;transition:border-color 0.3s;outline:none;" onfocus="this.style.borderColor='var(--fg-purple)'" onblur="this.style.borderColor='var(--border-primary)'">
            </div>
          </div>
          <div>
            <label style="display:block;font-size:0.8rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">Message</label>
            <textarea name="message" required rows="4" placeholder="What's on your mind?" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--border-primary);border-radius:var(--radius-md);background:var(--bg-card);color:var(--text-primary);font-size:0.9rem;resize:vertical;font-family:inherit;transition:border-color 0.3s;outline:none;" onfocus="this.style.borderColor='var(--fg-purple)'" onblur="this.style.borderColor='var(--border-primary)'"></textarea>
          </div>
          <button type="submit" style="padding:0.85rem 2rem;background:var(--fg-purple);color:white;border:none;border-radius:var(--radius-md);font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.3s;align-self:flex-start;" onmouseover="this.style.background='var(--fg-purple-light)';this.style.transform='translateY(-2px)'" onmouseout="this.style.background='var(--fg-purple)';this.style.transform='translateY(0)'">Send Message ‚Üí</button>
        </form>
      </div>
    </section>

    <footer class="figgy-footer-v6">
      <div style="max-width:800px;margin:0 auto;position:relative;z-index:1;">
        <div style="margin-bottom:1.5rem;">
          <svg width="56" height="56" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="22" ry="18" fill="#FF8A8A"/>
            <ellipse cx="16" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(-15 16 22)"/>
            <ellipse cx="48" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(15 48 22)"/>
            <rect x="26" y="19" width="12" height="3" rx="1.5" fill="#F5A623"/>
            <ellipse cx="32" cy="40" rx="8" ry="6" fill="#FFB5B5"/>
            <circle cx="29" cy="39.5" r="1.5" fill="#E88A8A"/>
            <circle cx="35" cy="39.5" r="1.5" fill="#E88A8A"/>
            <circle cx="24" cy="32" r="2.5" fill="white"/>
            <circle cx="40" cy="32" r="2.5" fill="white"/>
            <circle cx="25" cy="31" r="1" fill="#2C087D"/>
            <circle cx="41" cy="31" r="1" fill="#2C087D"/>
          </svg>
        </div>
        <h2 style="color:white;font-size:clamp(1.75rem,3.5vw,2.5rem);margin-bottom:1rem;">Your money. Your math. Your move.</h2>
        <p style="color:rgba(255,255,255,0.55);margin-bottom:2rem;font-size:1.05rem;">Smart money moves made simple ‚Äî start crunching numbers today.</p>
        <div style="display:flex;gap:2rem;justify-content:center;flex-wrap:wrap;margin-bottom:2.5rem;">
          <a href="#" onclick="document.getElementById('tools-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Business & M&A</a>
          <a href="#" onclick="document.getElementById('tools-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Personal Finance</a>
          <a href="#" onclick="document.getElementById('tools-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Tax & Planning</a>
          <a href="#contact-section" onclick="document.getElementById('contact-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Contact Us</a>
        </div>
        <div style="border-top:1px solid rgba(255,255,255,0.08);padding-top:1.5rem;">
          <p style="font-size:0.7rem;color:rgba(255,255,255,0.3);max-width:600px;margin:0 auto 1rem;line-height:1.6;">‚ö†Ô∏è <strong>Disclaimer:</strong> All calculations provided by FiggyBank are for illustrative and educational purposes only. They do not constitute financial, tax, legal, or investment advice. Always verify results independently and consult a qualified professional before making financial decisions.</p>
          <p style="font-size:0.8rem;color:rgba(255,255,255,0.35);">Built with ‚ù§Ô∏è in Canada üá®üá¶</p>
          <p style="margin-top:0.5rem;font-size:0.8rem;color:rgba(255,255,255,0.35);">¬© 2026 FiggyBank</p>
        </div>
      </div>
    </footer>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CALCULATOR PAGES (preserved from original)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-valuation" role="region" aria-label="Business Valuation Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè¢</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Business Valuation Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Estimate business value using DCF, comparable multiples, and asset-based approaches.</p>
      </div>
      
      <!-- Method Tabs -->
      <div class="tabs" style="max-width: 400px; margin: 2rem auto;" id="val-tabs">
        <button class="tab active" onclick="switchValTab('dcf')">DCF</button>
        <button class="tab" onclick="switchValTab('multiples')">Multiples</button>
        <button class="tab" onclick="switchValTab('asset')">Asset-Based</button>
      </div>
      
      <!-- Action Buttons -->
      <div class="action-buttons" style="justify-content: center; margin-bottom: 1rem;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport(document.getElementById('val-dcf').style.display!=='none'?'Business Valuation (DCF)':document.getElementById('val-multiples').style.display!=='none'?'Business Valuation (Multiples)':'Business Valuation (Asset-Based)')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults(document.getElementById('val-dcf').style.display!=='none'?'Business Valuation (DCF)':document.getElementById('val-multiples').style.display!=='none'?'Business Valuation (Multiples)':'Business Valuation (Asset-Based)')">üìã Copy Results</button>
      </div>

      <!-- Compare All Methods -->
      <div id="val-compare" class="chart-container" style="margin-bottom: 2rem; display: none;">
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìä Compare All Methods (Football Field)</div>
        <div id="val-compare-chart"></div>
      </div>

      <!-- DCF Method -->
      <div id="val-dcf" class="animate-fade-up" style="margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Assumptions</h3>
            
            <div class="input-group">
              <label>
                Annual Free Cash Flow (FCF)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Net cash generated by the business after all operating expenses and capital expenditures</span>
                </span>
              </label>
              <input type="number" id="dcf-fcf" value="1000000" placeholder="1,000,000" oninput="calculateDCF()" />
              <span class="input-help">Current annual free cash flow ($)</span>
            </div>
            
            <div class="input-group">
              <label>
                Growth Rate (Year 1-5)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Expected annual growth rate for the projection period</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-growth" min="0" max="30" value="10" step="0.5" oninput="calculateDCF(); document.getElementById('dcf-growth-val').textContent = this.value + '%'" />
                <span id="dcf-growth-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-primary);">10%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>
                Terminal Growth Rate
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Long-term sustainable growth rate (typically 2-3%, matching GDP growth)</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-terminal" min="0" max="5" value="2.5" step="0.25" oninput="calculateDCF(); document.getElementById('dcf-terminal-val').textContent = this.value + '%'" />
                <span id="dcf-terminal-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-accent);">2.5%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>
                Discount Rate (WACC)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Weighted Average Cost of Capital ‚Äî the required rate of return for investors</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-wacc" min="5" max="25" value="12" step="0.5" oninput="calculateDCF(); document.getElementById('dcf-wacc-val').textContent = this.value + '%'" />
                <span id="dcf-wacc-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">12%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>Projection Years</label>
              <select id="dcf-years" onchange="calculateDCF()">
                <option value="5" selected>5 Years</option>
                <option value="7">7 Years</option>
                <option value="10">10 Years</option>
              </select>
            </div>
            
            <div class="input-group">
              <label>Net Debt</label>
              <input type="number" id="dcf-debt" value="0" placeholder="0" oninput="calculateDCF()" />
              <span class="input-help">Total debt minus cash (negative = net cash position)</span>
            </div>
          </div>
          
          <div class="calc-results" id="dcf-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
        
        <!-- DCF Sensitivity Table -->
        <div class="chart-container" style="margin-top: 2rem;" id="dcf-sensitivity">
          <!-- Populated by JS -->
        </div>
        
        <!-- FCF Projection Chart -->
        <div class="chart-container" style="margin-top: 1rem;" id="dcf-chart">
          <!-- Populated by JS -->
        </div>
      </div>
      
      <!-- Multiples Method -->
      <div id="val-multiples" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Company Metrics</h3>
            
            <div class="input-group">
              <label>Annual Revenue</label>
              <input type="number" id="mult-revenue" value="5000000" oninput="calculateMultiples()" />
            </div>
            
            <div class="input-group">
              <label>EBITDA</label>
              <input type="number" id="mult-ebitda" value="1200000" oninput="calculateMultiples()" />
            </div>
            
            <div class="input-group">
              <label>Net Income</label>
              <input type="number" id="mult-income" value="800000" oninput="calculateMultiples()" />
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Industry Presets</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 0.375rem; margin-bottom: 1rem;">
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('saas')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">SaaS</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('manufacturing')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Manufacturing</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('retail')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Retail</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('healthcare')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Healthcare</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('professional')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Prof Services</button>
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 0.5rem 0 1rem;">Industry Multiples</h3>
            
            <div class="input-group">
              <label>EV/Revenue Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-ev-rev" min="0.5" max="15" value="3" step="0.25" oninput="calculateMultiples(); document.getElementById('mult-ev-rev-val').textContent = this.value + 'x'" />
                <span id="mult-ev-rev-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">3x</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>EV/EBITDA Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-ev-ebitda" min="3" max="25" value="10" step="0.5" oninput="calculateMultiples(); document.getElementById('mult-ev-ebitda-val').textContent = this.value + 'x'" />
                <span id="mult-ev-ebitda-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">10x</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>P/E Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-pe" min="5" max="40" value="15" step="0.5" oninput="calculateMultiples(); document.getElementById('mult-pe-val').textContent = this.value + 'x'" />
                <span id="mult-pe-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">15x</span>
              </div>
            </div>
          </div>
          
          <div class="calc-results" id="multiples-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
      </div>
      
      <!-- Asset-Based Method -->
      <div id="val-asset" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Assets</h3>
            
            <div class="input-group">
              <label>Cash & Equivalents</label>
              <input type="number" id="asset-cash" value="500000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Accounts Receivable</label>
              <input type="number" id="asset-ar" value="300000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Inventory</label>
              <input type="number" id="asset-inv" value="200000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Property & Equipment</label>
              <input type="number" id="asset-ppe" value="1000000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Other Assets</label>
              <input type="number" id="asset-other" value="150000" oninput="calculateAsset()" />
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Liabilities</h3>
            
            <div class="input-group">
              <label>Accounts Payable</label>
              <input type="number" id="asset-ap" value="200000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Loans & Debt</label>
              <input type="number" id="asset-debt" value="400000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Other Liabilities</label>
              <input type="number" id="asset-otherliab" value="100000" oninput="calculateAsset()" />
            </div>
          </div>
          
          <div class="calc-results" id="asset-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MORTGAGE CALCULATOR PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-mortgage" role="region" aria-label="Canadian Mortgage Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè†</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Canadian Mortgage Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Calculate payments with OSFI stress test, land transfer tax, and complete amortization schedule.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Canadian Mortgage Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Canadian Mortgage Calculator')">üìã Copy Results</button>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Mortgage Details</h3>
          
          <div class="input-group">
            <label>Home Price</label>
            <input type="number" id="mort-price" value="800000" oninput="calculateMortgage()" />
          </div>
          
          <div class="input-group">
            <label>Down Payment (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="mort-down" min="5" max="50" value="20" step="1" oninput="calculateMortgage(); document.getElementById('mort-down-val').textContent = this.value + '%'" />
              <span id="mort-down-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">20%</span>
            </div>
            <span class="input-help" id="mort-down-help">Down payment: $160,000</span>
          </div>
          
          <div class="input-group">
            <label>Interest Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="mort-rate" min="1" max="10" value="5.5" step="0.05" oninput="calculateMortgage(); document.getElementById('mort-rate-val').textContent = this.value + '%'" />
              <span id="mort-rate-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">5.5%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Amortization Period</label>
            <select id="mort-amort" onchange="calculateMortgage()">
              <option value="25" selected>25 Years</option>
              <option value="30">30 Years</option>
              <option value="20">20 Years</option>
              <option value="15">15 Years</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Payment Frequency</label>
            <select id="mort-freq" onchange="calculateMortgage()">
              <option value="12" selected>Monthly</option>
              <option value="26">Bi-Weekly</option>
              <option value="52">Weekly</option>
              <option value="24">Semi-Monthly</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Province</label>
            <select id="mort-province" onchange="calculateMortgage()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland</option>
              <option value="PE">PEI</option>
            </select>
          </div>
        </div>
        
        <div class="calc-results" id="mortgage-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <!-- Stress Test -->
      <div class="chart-container" style="margin-top: 2rem;" id="mortgage-stress">
        <!-- Populated by JS -->
      </div>

      <!-- Rate Increase Stress Test -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-rate-stress">
        <!-- Populated by JS -->
      </div>

      <!-- Payment Breakdown Donut -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-breakdown">
        <!-- Populated by JS -->
      </div>
      
      <!-- Amortization Schedule -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-amort">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       INVESTMENT RETURNS PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-investment" role="region" aria-label="Investment Returns Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìà</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Investment Returns Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Calculate CAGR, simulate dollar-cost averaging, and project portfolio growth over time.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport(document.getElementById('inv-cagr').style.display!=='none'?'Investment Returns (CAGR)':'Investment Returns (DCA)')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults(document.getElementById('inv-cagr').style.display!=='none'?'Investment Returns (CAGR)':'Investment Returns (DCA)')">üìã Copy Results</button>
      </div>

      <div class="tabs" style="max-width: 300px; margin: 2rem auto;" id="inv-tabs">
        <button class="tab active" onclick="switchInvTab('cagr')">CAGR</button>
        <button class="tab" onclick="switchInvTab('dca')">DCA Sim</button>
      </div>
      
      <!-- CAGR Calculator -->
      <div id="inv-cagr" style="margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Investment Details</h3>
            
            <div class="input-group">
              <label>Initial Investment</label>
              <input type="number" id="cagr-initial" value="10000" oninput="calculateCAGR()" />
            </div>
            <div class="input-group">
              <label>Final Value</label>
              <input type="number" id="cagr-final" value="25000" oninput="calculateCAGR()" />
            </div>
            <div class="input-group">
              <label>Time Period (Years)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="cagr-years" min="1" max="30" value="5" step="1" oninput="calculateCAGR(); document.getElementById('cagr-years-val').textContent = this.value + ' yrs'" />
                <span id="cagr-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">5 yrs</span>
              </div>
            </div>
          </div>
          
          <div class="calc-results" id="cagr-results" aria-live="polite"></div>
        </div>
      </div>
      
      <!-- DCA Simulator -->
      <div id="inv-dca" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">DCA Parameters</h3>
            
            <div class="input-group">
              <label>Monthly Investment</label>
              <input type="number" id="dca-monthly" value="500" oninput="calculateDCA()" />
            </div>
            <div class="input-group">
              <label>Expected Annual Return (%)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-return" min="1" max="20" value="8" step="0.5" oninput="calculateDCA(); document.getElementById('dca-return-val').textContent = this.value + '%'" />
                <span id="dca-return-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">8%</span>
              </div>
            </div>
            <div class="input-group">
              <label>Investment Period (Years)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-years" min="1" max="40" value="20" step="1" oninput="calculateDCA(); document.getElementById('dca-years-val').textContent = this.value + ' yrs'" />
                <span id="dca-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">20 yrs</span>
              </div>
            </div>
            <div class="input-group">
              <label>Initial Lump Sum (optional)</label>
              <input type="number" id="dca-initial" value="0" oninput="calculateDCA()" />
            </div>
            <div class="input-group">
              <label>Dividend Yield (%)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-dividend" min="0" max="8" value="0" step="0.25" oninput="calculateDCA(); document.getElementById('dca-dividend-val').textContent = this.value + '%'" />
                <span id="dca-dividend-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-success);">0%</span>
              </div>
              <span class="input-help">Dividends reinvested (DRIP) ‚Äî added to return</span>
            </div>
            <div class="input-group">
              <label>Inflation Rate (%) ‚Äî optional</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-inflation" min="0" max="5" value="2.5" step="0.1" oninput="calculateDCA(); document.getElementById('dca-inflation-val').textContent = this.value + '%'" />
                <span id="dca-inflation-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">2.5%</span>
              </div>
              <span class="input-help">Shows real (inflation-adjusted) values alongside nominal</span>
            </div>
          </div>
          
          <div class="calc-results" id="dca-results" aria-live="polite"></div>
        </div>
        
        <div class="chart-container" style="margin-top: 2rem;" id="dca-chart"></div>
        <div class="chart-container" style="margin-top: 1rem;" id="dca-table"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       RRSP vs TFSA PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-retirement" role="region" aria-label="RRSP vs TFSA Optimizer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè¶</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">RRSP vs TFSA Optimizer</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Compare tax-sheltered strategies and find your optimal Canadian retirement plan.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('RRSP vs TFSA Optimizer')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('RRSP vs TFSA Optimizer')">üìã Copy Results</button>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Your Situation</h3>
          
          <div class="input-group">
            <label>Annual Income</label>
            <input type="number" id="ret-income" value="120000" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Annual Contribution</label>
            <input type="number" id="ret-contribution" value="20000" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Current Age</label>
            <input type="number" id="ret-age" value="35" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Retirement Age</label>
            <input type="number" id="ret-retire-age" value="60" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Expected Annual Return (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ret-return" min="3" max="12" value="7" step="0.5" oninput="calculateRetirement(); document.getElementById('ret-return-val').textContent = this.value + '%'" />
              <span id="ret-return-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">7%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Expected Retirement Income</label>
            <input type="number" id="ret-retire-income" value="60000" oninput="calculateRetirement()" />
            <span class="input-help">Annual income in retirement (for tax bracket comparison)</span>
          </div>
          <div class="input-group">
            <label>Province</label>
            <select id="ret-province" onchange="calculateRetirement()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
            </select>
          </div>
        </div>
        
        <div class="calc-results" id="retirement-results" aria-live="polite"></div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="retirement-chart"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       COMPOUND INTEREST PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-compound" role="region" aria-label="Compound Interest Visualizer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Compound Interest Visualizer</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">See the magic of compound growth. Small contributions today become extraordinary wealth tomorrow.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Compound Interest')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Compound Interest')">üìã Copy Results</button>
      </div>

      <!-- Rule of 72 Quick Calculator -->
      <div class="glass-card animate-fade-up" style="padding: var(--space-xl); margin-top: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">‚ö° Rule of 72 ‚Äî Quick Doubling Calculator</div>
        <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">Enter an interest rate to see how long it takes to double, or enter a target doubling time to find the required rate.</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="input-group">
            <label>Annual Rate (%)</label>
            <input type="number" id="r72-rate" value="7" step="0.1" min="0.1" oninput="calcRule72('rate')" />
            <span class="input-help" id="r72-rate-result" style="font-weight:600; color: var(--brand-primary);">‚âà 10.3 years to double</span>
          </div>
          <div class="input-group">
            <label>Doubling Time (Years)</label>
            <input type="number" id="r72-years" value="10" step="0.5" min="0.5" oninput="calcRule72('years')" />
            <span class="input-help" id="r72-years-result" style="font-weight:600; color: var(--brand-primary);">‚âà 7.2% rate needed</span>
          </div>
        </div>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Initial Amount ($)</label>
            <input type="number" id="comp-initial" value="10000" min="0" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Monthly Contribution ($)</label>
            <input type="number" id="comp-monthly" value="300" min="0" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Annual Interest Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="comp-rate" min="1" max="15" value="7" step="0.25" oninput="calculateCompound(); document.getElementById('comp-rate-val').textContent = this.value + '%'" />
              <span id="comp-rate-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">7%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Time Period (Years)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="comp-years" min="1" max="50" value="25" step="1" oninput="calculateCompound(); document.getElementById('comp-years-val').textContent = this.value + ' yrs'" />
              <span id="comp-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">25 yrs</span>
            </div>
          </div>
          <div class="input-group">
            <label>Compounding Frequency</label>
            <select id="comp-freq" onchange="calculateCompound()">
              <option value="12" selected>Monthly</option>
              <option value="4">Quarterly</option>
              <option value="1">Annually</option>
              <option value="365">Daily</option>
            </select>
          </div>
          
          <div class="divider"></div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">üìä Compare Scenario B</h3>
          <div class="input-group">
            <label>Rate B (%)</label>
            <input type="number" id="comp-rate-b" value="5" step="0.25" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Monthly Contribution B</label>
            <input type="number" id="comp-monthly-b" value="500" oninput="calculateCompound()" />
          </div>
        </div>
        
        <div class="calc-results" id="compound-results" aria-live="polite"></div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="compound-chart"></div>
      <div class="chart-container" style="margin-top: 1rem;" id="compound-comparison"></div>
    </div>
  </div>

  <!-- Placeholder pages for remaining tools -->
  <div class="page" id="page-merger" role="region" aria-label="M&A Deal Analyzer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ü§ù</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">M&A Deal Analyzer</h1>
        <p style="color: var(--text-secondary);">Accretion/dilution analysis, synergy modeling, and deal structuring.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('M&A Deal Analyzer')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('M&A Deal Analyzer')">üìã Copy Results</button>
      </div>

      <div class="calc-grid animate-fade-up" style="margin-top: 2rem;">
        <!-- Inputs -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Acquirer</h3>

          <div class="input-group">
            <label>Earnings Per Share (EPS)
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Acquirer's current diluted EPS</span></span>
            </label>
            <input type="number" id="ma-acq-eps" value="5.00" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Share Price ($)</label>
            <input type="number" id="ma-acq-price" value="100" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Shares Outstanding (M)</label>
            <input type="number" id="ma-acq-shares" value="500" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>P/E Multiple
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Acquirer's current price-to-earnings ratio</span></span>
            </label>
            <input type="number" id="ma-acq-pe" value="20" step="0.1" oninput="calculateMA()" />
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Target</h3>

          <div class="input-group">
            <label>Earnings Per Share (EPS)</label>
            <input type="number" id="ma-tgt-eps" value="2.50" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Share Price ($)</label>
            <input type="number" id="ma-tgt-price" value="40" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Shares Outstanding (M)</label>
            <input type="number" id="ma-tgt-shares" value="200" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Offer Premium</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-premium" min="10" max="50" value="25" step="1" oninput="calculateMA(); document.getElementById('ma-premium-val').textContent = this.value + '%'" />
              <span id="ma-premium-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-primary);">25%</span>
            </div>
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Deal Structure</h3>

          <div class="input-group">
            <label>Cash Portion</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-cash-pct" min="0" max="100" value="50" step="5" oninput="calculateMA(); document.getElementById('ma-cash-val').textContent = this.value + '% Cash / ' + (100 - this.value) + '% Stock'" />
              <span id="ma-cash-val" class="mono" style="font-size: 0.85rem; min-width: 10rem; text-align: right; color: var(--brand-accent);">50% Cash / 50% Stock</span>
            </div>
          </div>
          <div class="input-group">
            <label>Cost of Debt (for Cash Financing)
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Pre-tax interest rate on new debt raised to fund the cash portion</span></span>
            </label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-debt-cost" min="1" max="12" value="5" step="0.25" oninput="calculateMA(); document.getElementById('ma-debt-cost-val').textContent = this.value + '%'" />
              <span id="ma-debt-cost-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">5%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Tax Rate</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-tax" min="0" max="40" value="25" step="1" oninput="calculateMA(); document.getElementById('ma-tax-val').textContent = this.value + '%'" />
              <span id="ma-tax-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-danger);">25%</span>
            </div>
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Synergies</h3>

          <div class="input-group">
            <label>Expected Revenue Synergies ($M)</label>
            <input type="number" id="ma-rev-syn" value="0" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Expected Cost Synergies ($M)</label>
            <input type="number" id="ma-cost-syn" value="50" step="1" oninput="calculateMA()" />
          </div>
        </div>

        <!-- Results -->
        <div class="calc-results" id="ma-results" aria-live="polite">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Sensitivity Table -->
      <div class="chart-container animate-fade-up" style="margin-top: 2rem;" id="ma-sensitivity">
        <!-- Populated by JS -->
      </div>

      <!-- Sources & Uses -->
      <div class="chart-container animate-fade-up" style="margin-top: 1rem;" id="ma-sources-uses">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       STARTUP RUNWAY CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-runway" role="region" aria-label="Startup Runway Calculator">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üöÄ</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Startup Runway Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Calculate your burn rate, runway, and break-even point. Plan with multiple scenarios.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Startup Runway')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Startup Runway')">üìã Copy Results</button>
      </div>

      <!-- Scenario Tabs -->
      <div class="tabs" id="runway-tabs" style="max-width: 420px; margin: 0 auto 2rem;">
        <button class="tab" onclick="switchRunwayTab('conservative')" id="runway-tab-conservative">Conservative</button>
        <button class="tab active" onclick="switchRunwayTab('base')" id="runway-tab-base">Base Case</button>
        <button class="tab" onclick="switchRunwayTab('aggressive')" id="runway-tab-aggressive">Aggressive</button>
      </div>

      <div class="calc-grid">
        <!-- Inputs -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üì• Financial Inputs</h3>

          <div class="input-group">
            <label>Cash in Bank ($)</label>
            <input type="number" id="rw-cash" value="500000" min="0" oninput="calculateRunway()" placeholder="500000" />
          </div>

          <div class="input-group">
            <label>Monthly Revenue ($)</label>
            <input type="number" id="rw-revenue" value="20000" min="0" oninput="calculateRunway()" placeholder="20000" />
          </div>

          <div class="input-group">
            <label>Monthly Revenue Growth Rate: <span id="rw-growth-val" class="mono" style="color:var(--brand-primary);">5%</span></label>
            <input type="range" id="rw-growth" min="0" max="30" step="0.5" value="5" oninput="document.getElementById('rw-growth-val').textContent=this.value+'%'; calculateRunway();" />
            <div class="input-help">0% ‚Äî 30% monthly growth</div>
          </div>

          <div class="input-group">
            <label>Monthly Fixed Costs ($)</label>
            <input type="number" id="rw-fixed" value="45000" oninput="calculateRunway()" placeholder="Rent, salaries, tools" />
            <div class="input-help">Rent, salaries, tools, subscriptions</div>
          </div>

          <div class="input-group">
            <label>Monthly Variable Costs ($)</label>
            <input type="number" id="rw-variable" value="8000" oninput="calculateRunway()" placeholder="8000" />
          </div>

          <div class="input-group">
            <label>One-Time Upcoming Expenses ($)</label>
            <input type="number" id="rw-onetime" value="0" oninput="calculateRunway()" placeholder="0" />
          </div>

          <div class="input-group">
            <label>General Monthly Cost Escalation ($)</label>
            <input type="number" id="rw-hiring" value="2000" min="0" oninput="calculateRunway()" placeholder="2000" />
            <div class="input-help">Additional cost increase per month (cumulative) ‚Äî separate from named hires below</div>
          </div>
          
          <div class="divider"></div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">üë• Hiring Plan</h3>
          <div id="rw-hiring-plan" style="font-size: 0.8rem;">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 0.375rem; margin-bottom: 0.5rem; align-items: end;">
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Role</label><input type="text" value="Engineer" class="rw-hire-role" oninput="calculateRunway()" /></div>
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Salary/mo</label><input type="number" value="8000" class="rw-hire-salary" oninput="calculateRunway()" /></div>
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Start Month</label><input type="number" value="3" class="rw-hire-month" min="1" oninput="calculateRunway()" /></div>
              <button class="btn btn-secondary btn-sm" onclick="this.closest('[style]').remove();calculateRunway();" style="padding:0.2rem 0.4rem;margin-bottom:2px;font-size:0.7rem;">‚úï</button>
            </div>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="addHireRow()" style="font-size:0.7rem;">+ Add Hire</button>
        </div>

        <!-- Results -->
        <div class="calc-results">
          <div class="result-card" style="text-align: center;">
            <div class="result-label">Monthly Burn Rate</div>
            <div class="result-value" id="rw-burn">$0</div>
            <div class="input-help">Current costs ‚àí revenue</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Runway (No Growth)</div>
            <div class="result-value" id="rw-runway-flat" style="font-size: 1.5rem;">0 months</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Runway (With Growth)</div>
            <div class="result-value" id="rw-runway-growth" style="font-size: 1.5rem;">0 months</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Cash Zero Date</div>
            <div class="result-value" id="rw-zero-date" style="font-size: 1.25rem;">‚Äî</div>
          </div>

          <div id="rw-safe-zone" class="result-card" style="text-align: center;">
            <div class="result-label">Safety Zone</div>
            <div class="result-value" id="rw-safe-text" style="font-size: 1.5rem;">‚Äî</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Break-Even Month</div>
            <div class="result-value" id="rw-breakeven" style="font-size: 1.25rem;">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-container" style="margin-top: 2rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìä Monthly Cash Balance Projection</h3>
        <div id="rw-scenario-label" style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">Base Case Scenario</div>
        <div id="rw-chart" style="display: flex; align-items: flex-end; gap: 3px; height: 220px; position: relative; padding-bottom: 24px;">
          <!-- bars injected by JS -->
        </div>
        <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.75rem; font-size: 0.72rem; color: var(--text-muted);">
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:linear-gradient(135deg,var(--brand-primary),var(--brand-accent));display:inline-block;"></span> Positive Balance</span>
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:var(--brand-danger);display:inline-block;"></span> Negative / Danger</span>
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:var(--brand-success);display:inline-block;"></span> Break-Even Reached</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       NET WORTH TRACKER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-networth" role="region" aria-label="Net Worth Tracker">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí∞</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Net Worth Tracker</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Track your complete financial picture. Save snapshots to monitor progress over time.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Net Worth Tracker')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Net Worth Tracker')">üìã Copy Results</button>
      </div>

      <div class="calc-grid">
        <!-- Assets Column -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--brand-success);">üìà Assets</h3>

          <div class="input-group">
            <label>Cash & Savings ($)</label>
            <input type="number" id="nw-cash" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>TFSA ($)</label>
            <input type="number" id="nw-tfsa" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>RRSP ($)</label>
            <input type="number" id="nw-rrsp" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Non-Registered Investments ($)</label>
            <input type="number" id="nw-nonreg" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Real Estate ($)</label>
            <input type="number" id="nw-realestate" value="0" oninput="calculateNetWorth()" />
            <div class="input-help">Primary residence market value</div>
          </div>
          <div class="input-group">
            <label>Vehicles ($)</label>
            <input type="number" id="nw-vehicles" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Other Assets ($)</label>
            <input type="number" id="nw-other-assets" value="0" oninput="calculateNetWorth()" />
            <div class="input-help">Business equity, crypto, collectibles</div>
          </div>
        </div>

        <!-- Liabilities Column -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--brand-danger);">üìâ Liabilities</h3>

          <div class="input-group">
            <label>Mortgage Balance ($)</label>
            <input type="number" id="nw-mortgage" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Car Loans ($)</label>
            <input type="number" id="nw-carloans" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Student Loans ($)</label>
            <input type="number" id="nw-student" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Credit Card Debt ($)</label>
            <input type="number" id="nw-cc" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Line of Credit ($)</label>
            <input type="number" id="nw-loc" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Other Debt ($)</label>
            <input type="number" id="nw-other-debt" value="0" oninput="calculateNetWorth()" />
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Assets</div>
          <div class="result-value" id="nw-total-assets" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Liabilities</div>
          <div class="result-value" id="nw-total-liabilities" style="font-size: 1.5rem; color: var(--brand-danger); -webkit-text-fill-color: var(--brand-danger);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Liquid Net Worth</div>
          <div class="result-value" id="nw-liquid" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Excludes real estate & vehicles</div>
        </div>
      </div>

      <!-- Big Net Worth Card -->
      <div class="result-card" style="text-align: center; margin-top: 1.5rem; padding: var(--space-2xl);">
        <div class="result-label" style="font-size: 0.9rem;">Net Worth</div>
        <div class="result-value" id="nw-networth" style="font-size: 3rem;">$0</div>
        <div id="nw-dta" style="margin-top: 0.75rem;"></div>
      </div>

      <!-- Pie Chart + Snapshot -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
        <!-- Asset Allocation Pie -->
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ü•ß Asset Allocation</h3>
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div id="nw-pie" style="width: 150px; height: 150px; border-radius: 50%; flex-shrink: 0; background: var(--border-primary);"></div>
            <div id="nw-pie-legend" style="font-size: 0.75rem; display: flex; flex-direction: column; gap: 0.375rem;"></div>
          </div>
        </div>

        <!-- Snapshots -->
        <div class="chart-container">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
            <h3 style="font-size: 0.95rem;">üì∏ Snapshots</h3>
            <button class="btn btn-primary btn-sm" onclick="saveNetWorthSnapshot()">Save Snapshot</button>
          </div>
          <div id="nw-snapshots" style="max-height: 250px; overflow-y: auto; font-size: 0.8rem;"></div>
        </div>
      </div>

      <!-- Net Worth Trend Chart -->
      <div class="chart-container" style="margin-top: 1.5rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìà Net Worth Over Time</h3>
        <div id="nw-trend-chart"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       LEASE VS BUY CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-lease" role="region" aria-label="Lease vs Buy Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üöó</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Lease vs Buy Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Compare the total cost of leasing versus buying a vehicle over the same period.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Lease vs Buy')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Lease vs Buy')">üìã Copy Results</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Vehicle & Lease</h3>
          <div class="input-group">
            <label>Vehicle Price ($)</label>
            <input type="number" id="lb-price" value="45000" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Lease Payment / Month ($)</label>
            <input type="number" id="lb-lease-payment" value="450" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Lease Term (Months)</label>
            <input type="number" id="lb-lease-term" value="48" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Residual Value ($)</label>
            <input type="number" id="lb-residual" value="18000" oninput="calculateLeaseBuy()" />
            <span class="input-help">Value at end of lease / what you'd sell for</span>
          </div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Buy Financing</h3>
          <div class="input-group">
            <label>Buy Loan Rate (%)</label>
            <input type="number" id="lb-buy-rate" value="5.5" step="0.1" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Buy Loan Term (Months)</label>
            <input type="number" id="lb-buy-term" value="60" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Down Payment ($)</label>
            <input type="number" id="lb-down" value="5000" oninput="calculateLeaseBuy()" />
          </div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Running Costs Difference</h3>
          <div class="input-group">
            <label>Insurance Difference / Month ($)</label>
            <input type="number" id="lb-insurance-diff" value="50" oninput="calculateLeaseBuy()" />
            <span class="input-help">How much MORE buying costs for insurance (can be negative)</span>
          </div>
          <div class="input-group">
            <label>Maintenance Difference / Month ($)</label>
            <input type="number" id="lb-maint-diff" value="30" oninput="calculateLeaseBuy()" />
            <span class="input-help">How much MORE buying costs for maintenance (can be negative)</span>
          </div>
        </div>
        <div class="calc-results" id="lease-buy-results" aria-live="polite"></div>
      </div>
      <div class="chart-container" style="margin-top: 2rem;" id="lease-buy-chart"></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CANADIAN TAX ESTIMATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-tax" role="region" aria-label="Canadian Tax Estimator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üßæ</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Canadian Tax Estimator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Estimate your 2025 federal and provincial income tax across all 10 Canadian provinces.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Canadian Tax Estimator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Canadian Tax Estimator')">üìã Copy Results</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Province</label>
            <select id="tax-province" onchange="calculateTax()">
              <option value="ON">Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="PE">Prince Edward Island</option>
            </select>
          </div>
          <div class="input-group">
            <label>Employment Income ($)</label>
            <input type="number" id="tax-employment" value="85000" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Self-Employment Income ($)</label>
            <input type="number" id="tax-self" value="0" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Capital Gains ($)</label>
            <input type="number" id="tax-capgains" value="0" oninput="calculateTax()" />
            <span class="input-help">Only 50% is taxable</span>
          </div>
          <div class="input-group">
            <label>Eligible Dividends ($)</label>
            <input type="number" id="tax-dividends" value="0" oninput="calculateTax()" />
            <span class="input-help">Grossed up by 38% for tax, then dividend tax credit applied</span>
          </div>
          <div class="input-group">
            <label>RRSP Deduction ($)</label>
            <input type="number" id="tax-rrsp" value="0" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Other Deductions ($)</label>
            <input type="number" id="tax-other-ded" value="0" oninput="calculateTax()" />
          </div>
        </div>
        <div class="calc-results" id="tax-results" aria-live="polite"></div>
      </div>
      <div class="chart-container" style="margin-top: 2rem;" id="tax-chart"></div>
      <div class="chart-container" style="margin-top: 1rem;" id="tax-province-compare"></div>
    </div>
  </div>

  </main>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SALARY & COMPENSATION ANALYZER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-salary" role="region" aria-label="Salary & Compensation Analyzer">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üíº</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Salary & Compensation Analyzer</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Analyze your total compensation package including base, bonus, equity, and benefits with Canadian tax estimates.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Salary & Compensation Analyzer')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Salary & Compensation Analyzer')">üìã Copy Results</button>
      </div>

      <div class="calc-grid">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: #14b8a6;">üí∞ Cash Compensation</h3>
          <div class="input-group">
            <label>Annual Base Salary ($)</label>
            <input type="number" id="sal-base" value="85000" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Bonus (%)</label>
            <input type="number" id="sal-bonus-pct" value="10" step="1" oninput="calculateSalary()" />
            <div class="input-help">Annual bonus as % of base salary</div>
          </div>

          <h3 style="font-size: 0.95rem; margin: 1.5rem 0 1rem; color: #14b8a6;">üìä Stock Options / Equity</h3>
          <div class="input-group">
            <label>Number of Shares</label>
            <input type="number" id="sal-shares" value="1000" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Strike Price ($)</label>
            <input type="number" id="sal-strike" value="10" step="0.01" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Current Share Price ($)</label>
            <input type="number" id="sal-current-price" value="25" step="0.01" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Vesting Period (years)</label>
            <input type="number" id="sal-vesting" value="4" min="1" oninput="calculateSalary()" />
          </div>
        </div>

        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: #14b8a6;">üè• Benefits</h3>
          <div class="input-group">
            <label>Health Benefits Value ($/yr)</label>
            <input type="number" id="sal-health" value="5000" oninput="calculateSalary()" />
            <div class="input-help">Employer-paid health, dental, vision</div>
          </div>
          <div class="input-group">
            <label>Pension / RRSP Match ($/yr)</label>
            <input type="number" id="sal-pension" value="4000" oninput="calculateSalary()" />
          </div>

          <h3 style="font-size: 0.95rem; margin: 1.5rem 0 1rem; color: #14b8a6;">üçÅ Tax Province</h3>
          <div class="input-group">
            <label>Province</label>
            <select id="sal-province" onchange="calculateSalary()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="PE">Prince Edward Island</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Compensation</div>
          <div class="result-value" id="sal-total-comp" style="font-size: 1.5rem;">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">After-Tax Take-Home</div>
          <div class="result-value" id="sal-take-home" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
          <div class="input-help">After income tax, CPP &amp; EI</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Effective Deduction Rate</div>
          <div class="result-value" id="sal-eff-tax" style="font-size: 1.5rem;">0%</div>
          <div class="input-help">Includes tax, CPP &amp; EI</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Hourly Rate Equivalent</div>
          <div class="result-value" id="sal-hourly" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Based on 2,080 hrs/yr</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Stock Option Value</div>
          <div class="result-value" id="sal-equity-val" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Intrinsic value (annualized)</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Annual Bonus</div>
          <div class="result-value" id="sal-bonus-val" style="font-size: 1.5rem;">$0</div>
        </div>
      </div>

      <!-- Deduction Breakdown -->
      <div class="glass-card" style="padding: var(--space-lg); margin-top: 1rem;">
        <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">üçÅ Canadian Deductions Breakdown</div>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; font-size: 0.85rem;" id="sal-deductions">
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">Income Tax</div><div class="mono" style="font-weight: 700;" id="sal-income-tax">$0</div></div>
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">CPP</div><div class="mono" style="font-weight: 700;" id="sal-cpp">$0</div></div>
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">EI</div><div class="mono" style="font-weight: 700;" id="sal-ei">$0</div></div>
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">Total Deductions</div><div class="mono" style="font-weight: 700; color: var(--brand-danger);" id="sal-total-ded">$0</div></div>
        </div>
      </div>

      <!-- Comparison + Pie -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ü•ß Compensation Breakdown</h3>
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div id="sal-pie" style="width: 150px; height: 150px; border-radius: 50%; flex-shrink: 0; background: var(--border-primary);"></div>
            <div id="sal-pie-legend" style="font-size: 0.75rem; display: flex; flex-direction: column; gap: 0.375rem;"></div>
          </div>
        </div>
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìä How You Compare</h3>
          <div id="sal-comparison" style="font-size: 0.85rem;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       DEBT PAYOFF CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-debt" role="region" aria-label="Debt Payoff Calculator">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí≥</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Debt Payoff Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Compare Avalanche vs Snowball strategies. See your debt-free date and how extra payments save you money.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Debt Payoff Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Debt Payoff Calculator')">üìã Copy Results</button>
      </div>

      <div class="calc-inputs glass-card" style="padding: var(--space-xl); margin-top: 1.5rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
          <h3 style="font-size: 0.95rem; color: #ef4444;">üìã Your Debts</h3>
          <button class="btn btn-primary btn-sm" onclick="addDebtRow()">+ Add Debt</button>
        </div>
        <div id="debt-rows">
          <div class="debt-row" style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 1.5fr auto; gap: 0.5rem; align-items: end; margin-bottom: 0.5rem;">
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="Credit Card" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="8000" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="19.99" step="0.01" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="200" oninput="calculateDebt()" /></div>
            <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">‚úï</button>
          </div>
          <div class="debt-row" style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 1.5fr auto; gap: 0.5rem; align-items: end; margin-bottom: 0.5rem;">
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="Car Loan" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="15000" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="6.5" step="0.01" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="350" oninput="calculateDebt()" /></div>
            <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">‚úï</button>
          </div>
        </div>
      </div>

      <div class="calc-inputs glass-card" style="padding: var(--space-xl); margin-top: 1rem;">
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
          <div>
            <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem;">‚öîÔ∏è Strategy</h3>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn-primary btn-sm" id="debt-btn-avalanche" onclick="setDebtStrategy('avalanche')">üèîÔ∏è Avalanche</button>
              <button class="btn btn-secondary btn-sm" id="debt-btn-snowball" onclick="setDebtStrategy('snowball')">‚õÑ Snowball</button>
            </div>
            <div class="input-help" style="margin-top:0.25rem" id="debt-strategy-help">Highest interest rate first ‚Äî saves the most money</div>
          </div>
          <div style="flex:1; min-width: 200px;">
            <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem;">üí™ Extra Monthly Payment</h3>
            <input type="range" id="debt-extra" min="0" max="2000" step="25" value="200" oninput="document.getElementById('debt-extra-val').textContent='$'+this.value; calculateDebt();" style="width:100%;" />
            <div style="display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-secondary)"><span>$0</span><span id="debt-extra-val">$200</span><span>$2,000</span></div>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Interest Paid</div>
          <div class="result-value" id="debt-total-interest" style="font-size: 1.5rem; color: var(--brand-danger); -webkit-text-fill-color: var(--brand-danger);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Debt-Free Date</div>
          <div class="result-value" id="debt-free-date" style="font-size: 1.3rem;">‚Äî</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Months to Debt-Free</div>
          <div class="result-value" id="debt-months" style="font-size: 1.5rem;">0</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Savings vs Minimum Only</div>
          <div class="result-value" id="debt-savings" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
          <div class="input-help">Interest saved with extra payments</div>
        </div>
        <div class="result-card" style="text-align: center; padding: var(--space-xl);">
          <div class="result-label" style="font-size: 1rem;">üéØ Debt-Free Countdown</div>
          <div class="result-value" id="debt-countdown" style="font-size: 2rem;">‚Äî</div>
        </div>
      </div>

      <!-- Timeline Chart -->
      <div class="chart-container" style="margin-top: 1.5rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìà Payoff Timeline</h3>
        <div id="debt-timeline-chart" style="height: 250px; position: relative;"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SIDE-BY-SIDE COMPARISON
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-compare" role="region" aria-label="Side-by-Side Comparison">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1100px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚öñÔ∏è</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Side-by-Side Comparison</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Compare two mortgage scenarios to see which option saves you more money.</p>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
        <!-- Scenario A -->
        <div class="glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--brand-primary);">üÖ∞Ô∏è Scenario A</h3>
          <div class="input-group"><label>Home Price ($)</label><input type="number" id="cmp-a-price" value="600000" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Interest Rate (%)</label><input type="number" id="cmp-a-rate" value="5.5" step="0.01" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Amortization (years)</label><input type="number" id="cmp-a-amort" value="25" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Down Payment (%)</label><input type="number" id="cmp-a-down" value="20" oninput="calculateComparison()" /></div>
        </div>
        <!-- Scenario B -->
        <div class="glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--brand-accent);">üÖ±Ô∏è Scenario B</h3>
          <div class="input-group"><label>Home Price ($)</label><input type="number" id="cmp-b-price" value="550000" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Interest Rate (%)</label><input type="number" id="cmp-b-rate" value="4.8" step="0.01" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Amortization (years)</label><input type="number" id="cmp-b-amort" value="30" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Down Payment (%)</label><input type="number" id="cmp-b-down" value="20" oninput="calculateComparison()" /></div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üÖ∞Ô∏è Monthly Payment</div>
          <div class="result-value" id="cmp-a-payment" style="font-size: 1.5rem;">$0</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Total Interest: <span id="cmp-a-interest">$0</span></div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Cost: <span id="cmp-a-total">$0</span></div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üÖ±Ô∏è Monthly Payment</div>
          <div class="result-value" id="cmp-b-payment" style="font-size: 1.5rem;">$0</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Total Interest: <span id="cmp-b-interest">$0</span></div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Cost: <span id="cmp-b-total">$0</span></div>
        </div>
      </div>

      <!-- Verdict -->
      <div class="result-card" style="margin-top: 1.5rem; text-align: center; padding: var(--space-xl);">
        <div class="result-label" style="font-size: 1.1rem;">üèÜ Verdict</div>
        <div class="result-value" id="cmp-verdict" style="font-size: 1.2rem; line-height: 1.6;">Enter values to compare</div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CURRENCY CONVERTER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-currency" role="region" aria-label="Currency Converter">
    <div class="calc-container" style="padding-top: 6rem; max-width: 700px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí±</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Currency Converter</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Convert Canadian Dollars to major world currencies. Rates are approximate.</p>
      </div>

      <div class="glass-card" style="padding: var(--space-xl); margin-top: 2rem;">
        <div class="input-group">
          <label>Amount in CAD ($)</label>
          <input type="number" id="currency-amount" value="1000" oninput="convertCurrency()" style="font-size: 1.2rem; text-align: center;" />
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;" id="currency-results">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá∫üá∏ US Dollar (USD)</div>
          <div class="result-value" id="cur-usd" style="font-size: 1.4rem;">$0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.7353 USD</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá™üá∫ Euro (EUR)</div>
          <div class="result-value" id="cur-eur" style="font-size: 1.4rem;">‚Ç¨0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.6803 EUR</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá¨üáß British Pound (GBP)</div>
          <div class="result-value" id="cur-gbp" style="font-size: 1.4rem;">¬£0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.5814 GBP</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üáÆüá≥ Indian Rupee (INR)</div>
          <div class="result-value" id="cur-inr" style="font-size: 1.4rem;">‚Çπ0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 62.50 INR</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üáØüáµ Japanese Yen (JPY)</div>
          <div class="result-value" id="cur-jpy" style="font-size: 1.4rem;">¬•0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 111.11 JPY</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá¶üá∫ Australian Dollar (AUD)</div>
          <div class="result-value" id="cur-aud" style="font-size: 1.4rem;">A$0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 1.1236 AUD</div>
        </div>
      </div>

      <p style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-top: 1.5rem;">‚ö†Ô∏è Rates are approximate and for reference only. Check a live source for current rates.</p>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       JAVASCRIPT ENGINE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    console.log('FiggyBank v6.0 loaded ‚Äî run runTests() in console to verify');

    // ‚ïê‚ïê‚ïê v6 HOMEPAGE ENHANCEMENTS ‚ïê‚ïê‚ïê

    // Scroll progress bar
    const scrollProgress = document.getElementById('scroll-progress');
    if (scrollProgress) {
      window.addEventListener('scroll', () => {
        const h = document.documentElement.scrollHeight - window.innerHeight;
        scrollProgress.style.width = h > 0 ? (window.scrollY / h * 100) + '%' : '0%';
      }, { passive: true });
    }

    // Sparkle generator
    (function initSparkles() {
      const c = document.getElementById('sparkle-container');
      if (!c) return;
      for (let i = 0; i < 20; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = Math.random() * 100 + '%';
        s.style.top = Math.random() * 100 + '%';
        s.style.animationDelay = (Math.random() * 4) + 's';
        s.style.animationDuration = (2 + Math.random() * 3) + 's';
        const size = 2 + Math.random() * 4;
        s.style.width = size + 'px';
        s.style.height = size + 'px';
        c.appendChild(s);
      }
    })();

    // Mouse parallax
    document.addEventListener('mousemove', (e) => {
      const x = (e.clientX / window.innerWidth - 0.5) * 2;
      const y = (e.clientY / window.innerHeight - 0.5) * 2;
      document.querySelectorAll('.parallax-mouse').forEach(el => {
        const speed = parseFloat(el.dataset.speed) || 20;
        el.style.transform = `translate(${x * speed}px, ${y * speed}px)`;
      });
    });

    // Cursor glow trail
    (function initCursorTrail() {
      if (window.matchMedia('(pointer: coarse)').matches) return;
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const dot = document.createElement('div');
      dot.className = 'cursor-dot';
      document.body.appendChild(dot);
      let mx = 0, my = 0;
      document.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
      function tick() {
        dot.style.left = mx + 'px';
        dot.style.top = my + 'px';
        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    })();

    // Showcase tab switching
    function switchShowcase(tab) {
      document.querySelectorAll('.showcase-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.showcase-panel').forEach(p => p.classList.remove('active'));
      event.target.classList.add('active');
      const panel = document.getElementById('showcase-' + tab);
      if (panel) {
        panel.classList.add('active');
        // Animate bars in the active panel
        panel.querySelectorAll('.viz-bar').forEach((bar, i) => {
          bar.style.height = '0';
          setTimeout(() => { bar.style.height = bar.dataset.targetHeight || '50%'; }, 100 + i * 80);
        });
      }
    }
    // Init first panel bars
    setTimeout(() => {
      const firstPanel = document.querySelector('.showcase-panel.active');
      if (firstPanel) {
        firstPanel.querySelectorAll('.viz-bar').forEach((bar, i) => {
          setTimeout(() => { bar.style.height = bar.dataset.targetHeight || '50%'; }, 200 + i * 80);
        });
      }
    }, 600);

    // 3D tilt on tool cards
    document.querySelectorAll('.tool-card').forEach(card => {
      card.addEventListener('mousemove', e => {
        const rect = card.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width - 0.5;
        const y = (e.clientY - rect.top) / rect.height - 0.5;
        card.style.transform = `perspective(800px) rotateY(${x * 8}deg) rotateX(${-y * 8}deg) translateY(-4px)`;
      });
      card.addEventListener('mouseleave', () => {
        card.style.transform = '';
      });
    });

    // Staggered entrance for tool cards
    const staggerObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const cards = entry.target.querySelectorAll('.tool-card');
          cards.forEach((card, i) => {
            setTimeout(() => { card.classList.add('is-visible'); card.style.opacity = '1'; card.style.transform = 'translateY(0)'; }, i * 50);
          });
          staggerObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.tools-grid').forEach(g => staggerObserver.observe(g));

    // HIW timeline line animation
    const hiwObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const line = document.getElementById('hiw-line');
          if (line) line.classList.add('drawn');
          hiwObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.3 });
    const hiwEl = document.getElementById('hiw-timeline');
    if (hiwEl) hiwObserver.observe(hiwEl);

    // Page load stagger animation
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        document.querySelectorAll('.load-stagger').forEach(el => el.classList.add('loaded'));
      }, 100);
    });
    // In case DOMContentLoaded already fired
    setTimeout(() => {
      document.querySelectorAll('.load-stagger').forEach(el => el.classList.add('loaded'));
    }, 200);

    // Scroll-to-top piggy button
    (function initScrollTop() {
      const btn = document.createElement('button');
      btn.className = 'scroll-top-piggy';
      btn.innerHTML = 'üê∑';
      btn.setAttribute('aria-label', 'Scroll to top');
      btn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
      document.body.appendChild(btn);
      window.addEventListener('scroll', () => {
        btn.classList.toggle('visible', window.scrollY > 500);
      }, { passive: true });
    })();

    // Easter egg: click piggy logo 5 times for coin rain
    (function initEasterEgg() {
      let clicks = 0, timer;
      const logo = document.querySelector('.nav-logo');
      if (!logo) return;
      logo.addEventListener('click', function(e) {
        clicks++;
        clearTimeout(timer);
        timer = setTimeout(() => { clicks = 0; }, 2000);
        if (clicks >= 5) {
          clicks = 0;
          const coins = ['ü™ô', 'üí∞', 'üíµ', 'üê∑', '‚ú®', '$'];
          for (let i = 0; i < 40; i++) {
            const coin = document.createElement('div');
            coin.className = 'coin-rain-piece';
            coin.textContent = coins[Math.floor(Math.random() * coins.length)];
            coin.style.left = Math.random() * 100 + 'vw';
            coin.style.animationDuration = (2 + Math.random() * 2) + 's';
            coin.style.animationDelay = (Math.random() * 0.5) + 's';
            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 4000);
          }
        }
      });
    })();

    // ‚îÄ‚îÄ IntersectionObserver for js-show elements (CreditGenie-style) ‚îÄ‚îÄ
    const jsShowObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          jsShowObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
    document.querySelectorAll('.js-show').forEach(el => jsShowObserver.observe(el));

    // ‚îÄ‚îÄ Floating Particles Generator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    (function initParticles() {
      const container = document.getElementById('hero-particles');
      if (!container) return;
      const colors = ['var(--brand-primary)', 'var(--brand-secondary)', 'var(--brand-accent)', 'var(--brand-success)'];
      for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const size = 2 + Math.random() * 6;
        p.style.width = size + 'px';
        p.style.height = size + 'px';
        p.style.left = Math.random() * 100 + '%';
        p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        p.style.animationDuration = (15 + Math.random() * 25) + 's';
        p.style.animationDelay = (-Math.random() * 30) + 's';
        container.appendChild(p);
      }
    })();

    // ‚îÄ‚îÄ Featured Calculator Demo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateFeaturedDemo() {
      const fcf = parseFloat(document.getElementById('featured-fcf').value) || 0;
      const growth = (parseFloat(document.getElementById('featured-growth').value) || 0) / 100;
      const wacc = 0.12, terminal = 0.025, years = 5;
      if (wacc <= terminal || fcf <= 0) { document.getElementById('featured-result').textContent = '$0'; return; }
      let pv = 0;
      for (let i = 1; i <= years; i++) pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
      const ff = fcf * Math.pow(1 + growth, years) * (1 + terminal);
      pv += (ff / (wacc - terminal)) / Math.pow(1 + wacc, years);
      document.getElementById('featured-result').textContent = fmt(pv);
    }
    setTimeout(updateFeaturedDemo, 100);

    // ‚îÄ‚îÄ Industry Multiplier Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setIndustryPreset(industry) {
      const presets = {
        saas: { evRev: 8, evEbitda: 25, pe: 35 },
        manufacturing: { evRev: 1.5, evEbitda: 8, pe: 14 },
        retail: { evRev: 0.75, evEbitda: 7, pe: 12 },
        healthcare: { evRev: 3, evEbitda: 14, pe: 22 },
        professional: { evRev: 2, evEbitda: 10, pe: 18 }
      };
      const p = presets[industry];
      if (!p) return;
      document.getElementById('mult-ev-rev').value = p.evRev;
      document.getElementById('mult-ev-rev-val').textContent = p.evRev + 'x';
      document.getElementById('mult-ev-ebitda').value = p.evEbitda;
      document.getElementById('mult-ev-ebitda-val').textContent = p.evEbitda + 'x';
      document.getElementById('mult-pe').value = p.pe;
      document.getElementById('mult-pe-val').textContent = p.pe + 'x';
      calculateMultiples();
    }

    // ‚îÄ‚îÄ Hiring Plan Row ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addHireRow() {
      const plan = document.getElementById('rw-hiring-plan');
      const row = document.createElement('div');
      row.style.cssText = 'display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:0.375rem;margin-bottom:0.5rem;align-items:end;';
      row.innerHTML = '<div class="input-group" style="margin:0"><label style="font-size:0.65rem">Role</label><input type="text" value="New Hire" class="rw-hire-role" oninput="calculateRunway()" /></div><div class="input-group" style="margin:0"><label style="font-size:0.65rem">Salary/mo</label><input type="number" value="6000" class="rw-hire-salary" oninput="calculateRunway()" /></div><div class="input-group" style="margin:0"><label style="font-size:0.65rem">Start Month</label><input type="number" value="6" class="rw-hire-month" min="1" oninput="calculateRunway()" /></div><button class="btn btn-secondary btn-sm" onclick="this.closest(\'[style]\').remove();calculateRunway();" style="padding:0.2rem 0.4rem;margin-bottom:2px;font-size:0.7rem;">‚úï</button>';
      plan.appendChild(row);
    }

    // ‚îÄ‚îÄ Utility Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const fmt = (n, decimals = 0) => {
      if (n === undefined || n === null || isNaN(n)) return '$0';
      const abs = Math.abs(n);
      if (abs >= 1e9) return (n < 0 ? '-' : '') + '$' + (abs / 1e9).toFixed(1) + 'B';
      if (abs >= 1e6) return (n < 0 ? '-' : '') + '$' + (abs / 1e6).toFixed(1) + 'M';
      if (abs >= 1e3) return (n < 0 ? '-' : '') + '$' + (abs / 1e3).toFixed(decimals > 0 ? decimals : 0) + 'K';
      return new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD', minimumFractionDigits: decimals, maximumFractionDigits: decimals }).format(n);
    };
    
    const fmtFull = (n) => new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n || 0);
    
    const fmtPct = (n, decimals = 1) => (n || 0).toFixed(decimals) + '%';
    
    const fmtNum = (n) => new Intl.NumberFormat('en-CA', { maximumFractionDigits: 0 }).format(n || 0);
    
    // ‚îÄ‚îÄ Page Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const target = document.getElementById('page-' + pageId);
      if (target) {
        target.classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      
      // Close mobile menu
      document.getElementById('nav-links').classList.remove('mobile-open');
      
      // Initialize calculators
      if (pageId === 'valuation') calculateDCF();
      if (pageId === 'mortgage') calculateMortgage();
      if (pageId === 'investment') calculateCAGR();
      if (pageId === 'retirement') calculateRetirement();
      if (pageId === 'compound') calculateCompound();
      if (pageId === 'runway') calculateRunway();
      if (pageId === 'networth') { calculateNetWorth(); loadNetWorthSnapshots(); }
      if (pageId === 'salary') calculateSalary();
      if (pageId === 'debt') calculateDebt();
      if (pageId === 'compare') calculateComparison();
      if (pageId === 'currency') convertCurrency();
      if (pageId === 'lease') calculateLeaseBuy();
      if (pageId === 'tax') calculateTax();
    }
    
    // ‚îÄ‚îÄ Theme Toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let isDark = localStorage.getItem('theme') === 'dark';
    
    function toggleTheme() {
      isDark = !isDark;
      document.documentElement.classList.toggle('dark', isDark);
      document.querySelector('.theme-toggle').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }
    
    // Initialize theme (light is default)
    if (isDark) {
      document.documentElement.classList.add('dark');
      document.querySelector('.theme-toggle').textContent = 'üåô';
    }
    
    // ‚îÄ‚îÄ Mobile Menu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function toggleMobileMenu() {
      document.getElementById('nav-links').classList.toggle('mobile-open');
    }
    
    // ‚îÄ‚îÄ Navbar Scroll Effect ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.addEventListener('scroll', () => {
      document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
    });
    
    // ‚îÄ‚îÄ Intersection Observer for Reveals ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    
    // ‚îÄ‚îÄ Hero Counter Animation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function animateCounters() {
      document.querySelectorAll('[data-count]').forEach(el => {
        const target = parseInt(el.dataset.count) || 0;
        const suffix = el.dataset.suffix || (target > 10 ? '+' : '');
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(timer);
          }
          const val = Math.floor(current);
          el.textContent = (val >= 1000 ? (val / 1000).toFixed(val >= 10000 ? 0 : 1) + 'K' : val) + suffix;
        }, 35);
      });
    }
    
    // Use IntersectionObserver for hero stats
    const heroStatsObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounters();
          heroStatsObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });
    const heroStats = document.querySelector('.hero-stats');
    if (heroStats) heroStatsObserver.observe(heroStats);

    // ‚îÄ‚îÄ Count-up animation for social proof numbers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const countUpObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const el = entry.target;
          const target = parseFloat(el.getAttribute('data-count-up'));
          const suffix = el.getAttribute('data-suffix') || '';
          const decimals = parseInt(el.getAttribute('data-decimals') || '0');
          const duration = 2000;
          const start = performance.now();
          function tick(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            const eased = 1 - Math.pow(1 - progress, 3);
            const current = eased * target;
            el.textContent = (decimals > 0 ? current.toFixed(decimals) : Math.floor(current).toLocaleString()) + suffix;
            if (progress < 1) requestAnimationFrame(tick);
          }
          requestAnimationFrame(tick);
          countUpObserver.unobserve(el);
        }
      });
    }, { threshold: 0.5 });
    document.querySelectorAll('[data-count-up]').forEach(el => countUpObserver.observe(el));
    
    // ‚îÄ‚îÄ Valuation Tab Switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchValTab(tab) {
      document.querySelectorAll('#val-tabs .tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('val-dcf').style.display = tab === 'dcf' ? 'block' : 'none';
      document.getElementById('val-multiples').style.display = tab === 'multiples' ? 'block' : 'none';
      document.getElementById('val-asset').style.display = tab === 'asset' ? 'block' : 'none';
      
      if (tab === 'dcf') calculateDCF();
      if (tab === 'multiples') calculateMultiples();
      if (tab === 'asset') calculateAsset();
      updateValuationComparison();
    }
    
    // ‚îÄ‚îÄ Investment Tab Switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchInvTab(tab) {
      document.querySelectorAll('#inv-tabs .tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('inv-cagr').style.display = tab === 'cagr' ? 'block' : 'none';
      document.getElementById('inv-dca').style.display = tab === 'dca' ? 'block' : 'none';
      
      if (tab === 'cagr') calculateCAGR();
      if (tab === 'dca') calculateDCA();
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // DCF CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateDCF() {
      const fcf = parseFloat(document.getElementById('dcf-fcf').value) || 0;
      const growth = (parseFloat(document.getElementById('dcf-growth').value) || 0) / 100;
      const terminal = (parseFloat(document.getElementById('dcf-terminal').value) || 0) / 100;
      const wacc = (parseFloat(document.getElementById('dcf-wacc').value) || 0) / 100;
      const years = parseInt(document.getElementById('dcf-years').value) || 5;
      const debt = parseFloat(document.getElementById('dcf-debt').value) || 0;
      
      if (wacc <= terminal) {
        document.getElementById('dcf-results').innerHTML = `
          <div class="result-card" style="border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
            <p style="color: var(--brand-danger); font-weight: 600;">‚ö†Ô∏è Discount rate must be higher than terminal growth rate</p>
          </div>`;
        return;
      }
      if (fcf <= 0) {
        document.getElementById('dcf-results').innerHTML = `
          <div class="result-card" style="border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
            <p style="color: var(--brand-danger); font-weight: 600;">‚ö†Ô∏è Enter a positive Free Cash Flow to calculate valuation</p>
          </div>`;
        document.getElementById('dcf-sensitivity').innerHTML = '';
        document.getElementById('dcf-chart').innerHTML = '';
        return;
      }
      
      // Project FCFs
      let projections = [];
      let pvSum = 0;
      
      for (let i = 1; i <= years; i++) {
        const projFCF = fcf * Math.pow(1 + growth, i);
        const pvFactor = Math.pow(1 + wacc, i);
        const pvFCF = projFCF / pvFactor;
        pvSum += pvFCF;
        projections.push({ year: i, fcf: projFCF, pv: pvFCF });
      }
      
      // Terminal value (Gordon Growth Model)
      const finalFCF = fcf * Math.pow(1 + growth, years);
      const terminalFCF = finalFCF * (1 + terminal);
      const terminalValue = terminalFCF / (wacc - terminal);
      const pvTerminal = terminalValue / Math.pow(1 + wacc, years);
      
      const enterpriseValue = pvSum + pvTerminal;
      const equityValue = enterpriseValue - debt;
      const tvPct = (pvTerminal / enterpriseValue * 100);
      
      // Results
      document.getElementById('dcf-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Enterprise Value</div>
          <div class="result-value">${fmt(enterpriseValue)}</div>
          <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">PV of FCFs: ${fmt(pvSum)}</span>
            <span class="metric-pill neutral">PV Terminal: ${fmt(pvTerminal)}</span>
          </div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Equity Value</div>
          <div class="result-value" style="${equityValue < 0 ? 'background: linear-gradient(135deg, var(--brand-danger), #f97316); -webkit-background-clip: text;' : ''}">${fmt(equityValue)}</div>
          ${debt !== 0 ? `<div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">After ${debt > 0 ? 'subtracting' : 'adding'} ${fmtFull(Math.abs(debt))} net debt</div>` : ''}
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Key Metrics</div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Terminal Value %</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700; color: ${tvPct > 75 ? 'var(--brand-warning)' : 'var(--text-primary)'};">${tvPct.toFixed(1)}%</div>
              ${tvPct > 75 ? '<div style="font-size: 0.65rem; color: var(--brand-warning);">‚ö†Ô∏è High TV reliance</div>' : ''}
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Implied Multiple</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${(enterpriseValue / fcf).toFixed(1)}x FCF</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Year ${years} FCF</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${fmt(finalFCF)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Terminal Value</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${fmt(terminalValue)}</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">FCF Projections</div>
          ${projections.map(p => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
              <span style="font-size: 0.8rem; color: var(--text-muted);">Year ${p.year}</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(p.fcf)}</span>
              <span class="mono" style="font-size: 0.75rem; color: var(--text-muted);">PV: ${fmt(p.pv)}</span>
            </div>
          `).join('')}
        </div>
      `;
      
      // Sensitivity table
      const waccRange = [-2, -1, 0, 1, 2].map(d => wacc * 100 + d);
      const growthRange = [-1, -0.5, 0, 0.5, 1].map(d => terminal * 100 + d).filter(g => g >= 0);
      
      let tableHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Sensitivity Analysis: Enterprise Value</div>
        <div style="overflow-x: auto;">
        <table class="sensitivity-table">
          <tr>
            <th>WACC \\ Terminal G</th>
            ${growthRange.map(g => `<th>${g.toFixed(1)}%</th>`).join('')}
          </tr>
      `;
      
      waccRange.forEach(w => {
        tableHTML += `<tr><td>${w.toFixed(1)}%</td>`;
        growthRange.forEach(g => {
          if (w / 100 <= g / 100) {
            tableHTML += '<td style="color: var(--text-muted);">N/A</td>';
            return;
          }
          let pv = 0;
          for (let i = 1; i <= years; i++) {
            pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + w / 100, i);
          }
          const tFCF = fcf * Math.pow(1 + growth, years) * (1 + g / 100);
          const tv = tFCF / (w / 100 - g / 100);
          const pvTV = tv / Math.pow(1 + w / 100, years);
          const ev = pv + pvTV;
          const isBase = Math.abs(w - wacc * 100) < 0.01 && Math.abs(g - terminal * 100) < 0.01;
          tableHTML += `<td class="${isBase ? 'highlight' : ''}">${fmt(ev)}</td>`;
        });
        tableHTML += '</tr>';
      });
      
      tableHTML += '</table></div>';
      document.getElementById('dcf-sensitivity').innerHTML = tableHTML;
      updateValuationComparison();
      
      // Bar chart
      const maxFCF = Math.max(...projections.map(p => p.fcf));
      document.getElementById('dcf-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Projected Free Cash Flow</div>
        <div style="display: flex; align-items: flex-end; gap: 0.5rem; height: 200px; padding: 0 0.5rem;">
          ${projections.map(p => `
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <span class="mono" style="font-size: 0.65rem; color: var(--text-muted);">${fmt(p.fcf)}</span>
              <div style="width: 100%; height: ${(p.fcf / maxFCF * 150)}px; background: linear-gradient(180deg, var(--brand-primary), var(--brand-accent)); border-radius: 4px 4px 0 0; transition: height 1s ease; min-height: 4px;"></div>
              <span style="font-size: 0.7rem; color: var(--text-muted);">Y${p.year}</span>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MULTIPLES CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateMultiples() {
      const revenue = parseFloat(document.getElementById('mult-revenue').value) || 0;
      const ebitda = parseFloat(document.getElementById('mult-ebitda').value) || 0;
      const income = parseFloat(document.getElementById('mult-income').value) || 0;
      const evRev = parseFloat(document.getElementById('mult-ev-rev').value) || 0;
      const evEbitda = parseFloat(document.getElementById('mult-ev-ebitda').value) || 0;
      const pe = parseFloat(document.getElementById('mult-pe').value) || 0;
      
      const valRevenue = revenue * evRev;
      const valEbitda = ebitda * evEbitda;
      const valEarnings = income * pe;
      const average = (valRevenue + valEbitda + valEarnings) / 3;
      const median = [valRevenue, valEbitda, valEarnings].sort((a, b) => a - b)[1];
      const low = Math.min(valRevenue, valEbitda, valEarnings);
      const high = Math.max(valRevenue, valEbitda, valEarnings);
      
      // Football field chart
      const maxVal = high * 1.1;
      const barWidth = (v) => (v / maxVal * 100).toFixed(1);
      
      document.getElementById('multiples-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Blended Valuation</div>
          <div class="result-value">${fmt(average)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Average of three methodologies</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Median Valuation</div>
          <div class="result-value">${fmt(median)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Valuation Range (Football Field)</div>
          
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">EV/Revenue (${evRev}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valRevenue)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valRevenue)}%; background: linear-gradient(90deg, #6366f1, #818cf8);"></div>
            </div>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">EV/EBITDA (${evEbitda}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valEbitda)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valEbitda)}%; background: linear-gradient(90deg, #8b5cf6, #a78bfa);"></div>
            </div>
          </div>
          
          <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">P/E (${pe}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valEarnings)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valEarnings)}%; background: linear-gradient(90deg, #06b6d4, #22d3ee);"></div>
            </div>
          </div>
          
          <div class="divider"></div>
          <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
            <span style="color: var(--text-muted);">Range: ${fmt(low)} ‚Äî ${fmt(high)}</span>
            <span style="color: var(--text-muted);">Spread: ${((high - low) / average * 100).toFixed(0)}%</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Implied Metrics</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">EBITDA Margin</div>
              <div class="mono" style="font-weight: 700;">${revenue > 0 ? (ebitda / revenue * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Net Margin</div>
              <div class="mono" style="font-weight: 700;">${revenue > 0 ? (income / revenue * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MULTIPLES - hook comparison
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // (comparison updated via tab switch)

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ASSET-BASED CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateAsset() {
      const cash = parseFloat(document.getElementById('asset-cash').value) || 0;
      const ar = parseFloat(document.getElementById('asset-ar').value) || 0;
      const inv = parseFloat(document.getElementById('asset-inv').value) || 0;
      const ppe = parseFloat(document.getElementById('asset-ppe').value) || 0;
      const other = parseFloat(document.getElementById('asset-other').value) || 0;
      const ap = parseFloat(document.getElementById('asset-ap').value) || 0;
      const debt = parseFloat(document.getElementById('asset-debt').value) || 0;
      const otherLiab = parseFloat(document.getElementById('asset-otherliab').value) || 0;
      
      const totalAssets = cash + ar + inv + ppe + other;
      const totalLiab = ap + debt + otherLiab;
      const nav = totalAssets - totalLiab;
      const currentRatio = (ap + otherLiab) > 0 ? (cash + ar + inv) / (ap + otherLiab) : 0;
      
      document.getElementById('asset-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Net Asset Value (NAV)</div>
          <div class="result-value">${fmtFull(nav)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Balance Sheet</div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem; color: var(--brand-success);">Total Assets</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(totalAssets)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem; color: var(--brand-danger);">Total Liabilities</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(totalLiab)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; font-weight: 700;">
            <span style="font-size: 0.85rem;">Net Asset Value</span>
            <span class="mono" style="font-size: 0.85rem; color: ${nav >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)'};">${fmtFull(nav)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Ratios</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Current Ratio</div>
              <div class="mono" style="font-weight: 700; color: ${currentRatio >= 1.5 ? 'var(--brand-success)' : currentRatio >= 1 ? 'var(--brand-warning)' : 'var(--brand-danger)'};">${currentRatio.toFixed(2)}x</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Debt Ratio</div>
              <div class="mono" style="font-weight: 700;">${totalAssets > 0 ? (totalLiab / totalAssets * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MORTGAGE CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateMortgage() {
      const price = parseFloat(document.getElementById('mort-price').value) || 0;
      const downPct = (parseFloat(document.getElementById('mort-down').value) || 0) / 100;
      const rate = (parseFloat(document.getElementById('mort-rate').value) || 0) / 100;
      const amort = parseInt(document.getElementById('mort-amort').value) || 25;
      const freq = parseInt(document.getElementById('mort-freq').value) || 12;
      const province = document.getElementById('mort-province').value;
      
      const downPayment = price * downPct;
      const principal = price - downPayment;
      
      if (price <= 0 || rate <= 0) {
        document.getElementById('mortgage-results').innerHTML = '<div class="result-card"><p style="color: var(--text-muted);">Enter a home price and interest rate to calculate.</p></div>';
        return;
      }
      
      // Update down payment help
      document.getElementById('mort-down-help').textContent = `Down payment: ${fmtFull(downPayment)}`;
      
      // CMHC Insurance (if down < 20%)
      // CMHC does not insure homes over $1,000,000 ‚Äî 20% min down required
      let cmhcPremium = 0;
      let cmhcWarning = '';
      if (downPct < 0.20 && price <= 1000000) {
        // For homes $500K-$1M: min 5% on first $500K + 10% on remainder
        if (price > 500000) {
          const minDown = 500000 * 0.05 + (price - 500000) * 0.10;
          if (downPayment < minDown - 0.01) {
            cmhcWarning = `‚ö†Ô∏è Minimum down payment for homes $500K‚Äì$1M is ${fmtFull(minDown)} (5% on first $500K + 10% on remainder).`;
          }
        }
        if (downPct >= 0.15) cmhcPremium = principal * 0.028;
        else if (downPct >= 0.10) cmhcPremium = principal * 0.031;
        else cmhcPremium = principal * 0.04;
      } else if (downPct < 0.20 && price > 1000000) {
        cmhcWarning = '‚ö†Ô∏è CMHC mortgage insurance is not available for homes over $1,000,000. Minimum 20% down payment required.';
      }
      
      const totalMortgage = principal + cmhcPremium;
      
      // Canadian mortgage: semi-annual compounding
      const semiAnnualRate = Math.pow(1 + rate / 2, 2) - 1;
      const periodicRate = Math.pow(1 + semiAnnualRate, 1 / freq) - 1;
      const totalPayments = amort * freq;
      
      // Payment calculation
      const payment = totalMortgage * (periodicRate * Math.pow(1 + periodicRate, totalPayments)) / (Math.pow(1 + periodicRate, totalPayments) - 1);
      const monthlyEquiv = payment * freq / 12;
      const totalCost = payment * totalPayments;
      const totalInterest = totalCost - totalMortgage;
      
      // OSFI Stress Test
      const stressRate = Math.max(rate + 0.02, 0.0525);
      const stressSemiAnnual = Math.pow(1 + stressRate / 2, 2) - 1;
      const stressPeriodic = Math.pow(1 + stressSemiAnnual, 1 / 12) - 1;
      const stressPayment = totalMortgage * (stressPeriodic * Math.pow(1 + stressPeriodic, amort * 12)) / (Math.pow(1 + stressPeriodic, amort * 12) - 1);
      
      // Land Transfer Tax
      let ltt = 0;
      if (province === 'ON') {
        // Ontario LTT
        if (price <= 55000) ltt = price * 0.005;
        else if (price <= 250000) ltt = 275 + (price - 55000) * 0.01;
        else if (price <= 400000) ltt = 2225 + (price - 250000) * 0.015;
        else if (price <= 2000000) ltt = 4475 + (price - 400000) * 0.02;
        else ltt = 36475 + (price - 2000000) * 0.025;
      } else if (province === 'BC') {
        if (price <= 200000) ltt = price * 0.01;
        else if (price <= 2000000) ltt = 2000 + (price - 200000) * 0.02;
        else if (price <= 3000000) ltt = 38000 + (price - 2000000) * 0.03;
        else ltt = 68000 + (price - 3000000) * 0.05;
      } else if (province === 'QC') {
        // Quebec welcome tax (droits de mutation)
        if (price <= 58900) ltt = price * 0.005;
        else if (price <= 294500) ltt = 294.50 + (price - 58900) * 0.01;
        else if (price <= 500000) ltt = 2650.50 + (price - 294500) * 0.015;
        else if (price <= 1000000) ltt = 5733.00 + (price - 500000) * 0.02;
        else ltt = 15733.00 + (price - 1000000) * 0.025;
      } else if (province === 'MB') {
        if (price <= 30000) ltt = 0;
        else if (price <= 90000) ltt = (price - 30000) * 0.005;
        else if (price <= 150000) ltt = 300 + (price - 90000) * 0.01;
        else if (price <= 200000) ltt = 900 + (price - 150000) * 0.015;
        else ltt = 1650 + (price - 200000) * 0.02;
      }
      // AB, SK, NB, NL, PE, NS: no provincial land transfer tax (or minimal)
      
      const freqLabel = { 12: 'Monthly', 26: 'Bi-Weekly', 52: 'Weekly', 24: 'Semi-Monthly' }[freq];
      
      document.getElementById('mortgage-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">${freqLabel} Payment</div>
          <div class="result-value">${fmtFull(payment)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Monthly equivalent: ${fmtFull(monthlyEquiv)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Total Cost of Mortgage</div>
          <div class="result-value">${fmt(totalCost)}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">Principal: ${fmt(totalMortgage)}</span>
            <span class="metric-pill negative">Interest: ${fmt(totalInterest)}</span>
          </div>
        </div>
        
        ${cmhcPremium > 0 ? `
        <div class="glass-card" style="padding: var(--space-lg); border-color: rgba(245, 158, 11, 0.3);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--brand-warning); margin-bottom: 0.375rem;">‚ö†Ô∏è CMHC INSURANCE REQUIRED</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary);">Down payment is less than 20%. CMHC premium of <span class="mono" style="font-weight: 700;">${fmtFull(cmhcPremium)}</span> added to mortgage.</div>
          ${cmhcWarning ? `<div style="font-size: 0.8rem; color: var(--brand-warning); margin-top: 0.5rem;">${cmhcWarning}</div>` : ''}
        </div>
        ` : ''}
        ${cmhcWarning && cmhcPremium === 0 ? `
        <div class="glass-card" style="padding: var(--space-lg); border-color: rgba(239, 68, 68, 0.3);">
          <div style="font-size: 0.85rem; color: var(--brand-danger); font-weight: 600;">${cmhcWarning}</div>
        </div>
        ` : ''}
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Closing Costs</div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Down Payment</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(downPayment)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Land Transfer Tax</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(ltt)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Legal Fees (est.)</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(2000)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; font-weight: 700;">
            <span style="font-size: 0.85rem;">Total Cash Needed</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(downPayment + ltt + 2000)}</span>
          </div>
        </div>
      `;
      
      // Stress test
      document.getElementById('mortgage-stress').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üèõÔ∏è OSFI Stress Test (B-20)</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
            <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Your Rate</div>
            <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--brand-success);">${(rate * 100).toFixed(2)}%</div>
            <div class="mono" style="font-size: 1rem; margin-top: 0.375rem;">${fmtFull(monthlyEquiv)}/mo</div>
          </div>
          <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
            <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Stress Test Rate</div>
            <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--brand-warning);">${(stressRate * 100).toFixed(2)}%</div>
            <div class="mono" style="font-size: 1rem; margin-top: 0.375rem;">${fmtFull(stressPayment)}/mo</div>
          </div>
        </div>
        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 1rem; text-align: center;">
          You must qualify at the stress test rate (contract rate + 2% or 5.25%, whichever is higher). Monthly payment increases by ${fmtFull(stressPayment - monthlyEquiv)}.
        </div>
      `;
      
      // Rate Increase Stress Test
      const rateStressEl = document.getElementById('mortgage-rate-stress');
      if (rateStressEl) {
        const calcPaymentAtRate = (r) => {
          const sr = Math.pow(1 + r / 2, 2) - 1;
          const mr = Math.pow(1 + sr, 1 / 12) - 1;
          return totalMortgage * (mr * Math.pow(1 + mr, amort * 12)) / (Math.pow(1 + mr, amort * 12) - 1);
        };
        const p0 = monthlyEquiv;
        const p1 = calcPaymentAtRate(rate + 0.01);
        const p2 = calcPaymentAtRate(rate + 0.02);
        rateStressEl.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìà Rate Increase Impact</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">Current Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-success);">${(rate * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p0)}/mo</div>
            </div>
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">+1% Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-warning);">${((rate + 0.01) * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p1)}/mo</div>
              <div style="font-size: 0.72rem; color: var(--brand-danger); margin-top: 0.25rem;">+${fmtFull(p1 - p0)}/mo</div>
            </div>
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">+2% Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-danger);">${((rate + 0.02) * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p2)}/mo</div>
              <div style="font-size: 0.72rem; color: var(--brand-danger); margin-top: 0.25rem;">+${fmtFull(p2 - p0)}/mo</div>
            </div>
          </div>
        `;
      }

      // Payment Breakdown Donut
      const breakdownEl = document.getElementById('mortgage-breakdown');
      if (breakdownEl) {
        breakdownEl.innerHTML = '<div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ü•ß Total Payment Breakdown</div><div style="display:flex;align-items:center;gap:1.5rem;"><div id="mort-donut" style="width:160px;height:160px;"></div><div id="mort-donut-legend" style="font-size:0.8rem;"></div></div>';
        const donutSegs = [
          { label: 'Principal', value: totalMortgage, color: '#6366f1' },
          { label: 'Interest', value: totalInterest, color: '#ef4444' }
        ];
        if (cmhcPremium > 0) donutSegs.push({ label: 'CMHC', value: cmhcPremium, color: '#f59e0b' });
        renderDonutChart('mort-donut', donutSegs, 160);
        document.getElementById('mort-donut-legend').innerHTML = donutSegs.map(s => 
          `<div style="display:flex;align-items:center;gap:6px;margin-bottom:0.375rem;"><span style="width:10px;height:10px;border-radius:2px;background:${s.color};"></span>${s.label}: ${fmtFull(s.value)}</div>`
        ).join('');
      }

      // Simple amortization visualization
      let balance = totalMortgage;
      const monthlyRate = Math.pow(1 + semiAnnualRate, 1 / 12) - 1;
      const monthlyPmt = totalMortgage * (monthlyRate * Math.pow(1 + monthlyRate, amort * 12)) / (Math.pow(1 + monthlyRate, amort * 12) - 1);
      let yearlyData = [];
      
      for (let year = 1; year <= amort; year++) {
        let yearInterest = 0;
        let yearPrincipal = 0;
        for (let m = 0; m < 12; m++) {
          const interestPmt = balance * monthlyRate;
          const principalPmt = monthlyPmt - interestPmt;
          yearInterest += interestPmt;
          yearPrincipal += principalPmt;
          balance -= principalPmt;
          if (balance < 0) balance = 0;
        }
        yearlyData.push({ year, balance, interest: yearInterest, principal: yearPrincipal });
      }
      
      let amortTableRows = yearlyData.map(d => `
          <tr>
            <td>${d.year}</td>
            <td>${fmtFull(d.year === 1 ? totalMortgage : yearlyData[d.year-2].balance)}</td>
            <td>${fmtFull(monthlyPmt * 12)}</td>
            <td>${fmtFull(d.principal)}</td>
            <td>${fmtFull(d.interest)}</td>
            <td>${fmtFull(d.balance)}</td>
          </tr>`).join('');

      document.getElementById('mortgage-amort').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Amortization ‚Äî Balance Over Time</div>
        <div style="display: flex; align-items: flex-end; gap: 2px; height: 200px; padding: 0;">
          ${yearlyData.map(d => `
            <div style="flex: 1; height: ${(d.balance / totalMortgage * 190)}px; background: linear-gradient(180deg, var(--brand-primary), var(--brand-accent)); border-radius: 2px 2px 0 0; min-height: 2px; position: relative;" title="Year ${d.year}: ${fmtFull(d.balance)} remaining"></div>
          `).join('')}
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">
          <span>Year 1</span>
          <span>Year ${Math.floor(amort / 2)}</span>
          <span>Year ${amort}</span>
        </div>
        <div class="accordion-item" style="margin-top: 1.5rem;">
          <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
            <span>üìã View Full Amortization Schedule</span>
            <span class="accordion-arrow">‚ñº</span>
          </div>
          <div class="accordion-body">
            <div class="accordion-body-inner" style="overflow-x: auto; padding: 0.5rem;">
              <table class="sensitivity-table">
                <thead>
                  <tr>
                    <th>Year</th>
                    <th>Opening Balance</th>
                    <th>Annual Payment</th>
                    <th>Principal</th>
                    <th>Interest</th>
                    <th>Closing Balance</th>
                  </tr>
                </thead>
                <tbody>${amortTableRows}</tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CAGR CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateCAGR() {
      const initial = parseFloat(document.getElementById('cagr-initial').value) || 0;
      const final_ = parseFloat(document.getElementById('cagr-final').value) || 0;
      const years = parseFloat(document.getElementById('cagr-years').value) || 1;
      
      if (initial <= 0) {
        document.getElementById('cagr-results').innerHTML = `<div class="result-card"><p style="color: var(--text-muted);">Enter a positive initial investment.</p></div>`;
        return;
      }
      
      const cagr = (Math.pow(final_ / initial, 1 / years) - 1) * 100;
      const totalReturn = ((final_ - initial) / initial) * 100;
      const gain = final_ - initial;
      
      document.getElementById('cagr-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">CAGR</div>
          <div class="result-value">${cagr.toFixed(2)}%</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Compound Annual Growth Rate</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Total Return</div>
          <div class="result-value" style="${totalReturn >= 0 ? '' : 'background: linear-gradient(135deg, var(--brand-danger), #f97316); -webkit-background-clip: text;'}">${totalReturn.toFixed(1)}%</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <span class="metric-pill ${gain >= 0 ? 'positive' : 'negative'}">${gain >= 0 ? '+' : ''}${fmtFull(gain)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Rule of 72</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary);">
            At ${cagr.toFixed(1)}% CAGR, your money doubles every <strong style="color: var(--text-primary);">${cagr > 0 ? (72 / cagr).toFixed(1) : '‚àû'} years</strong>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Benchmarks</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); display: flex; flex-direction: column; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between;">
              <span>S&P 500 (30yr avg)</span>
              <span class="mono" style="color: ${cagr > 10.7 ? 'var(--brand-success)' : 'var(--text-muted)'};">~10.7%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Warren Buffett</span>
              <span class="mono" style="color: ${cagr > 20 ? 'var(--brand-success)' : 'var(--text-muted)'};">~20%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>GIC (Canada)</span>
              <span class="mono">~4-5%</span>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SVG CHART COMPONENTS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    /**
     * Animated SVG Donut Chart
     * @param {string} containerId - ID of the container element
     * @param {Array} segments - [{label, value, color}]
     * @param {number} size - diameter in px (default 150)
     */
    function renderDonutChart(containerId, segments, size) {
      size = size || 150;
      const container = document.getElementById(containerId);
      if (!container) return;
      const total = segments.reduce(function(s, seg) { return s + seg.value; }, 0);
      if (total <= 0) {
        container.innerHTML = '<div style="width:'+size+'px;height:'+size+'px;border-radius:50%;background:var(--border-primary);"></div>';
        return;
      }
      const r = 50, cx = 60, cy = 60;
      const circumference = 2 * Math.PI * r;
      let cumOffset = 0;
      let svgSegments = '';
      segments.forEach(function(seg, i) {
        const pct = seg.value / total;
        const dashLen = pct * circumference;
        const dashGap = circumference - dashLen;
        const offset = -cumOffset * circumference;
        svgSegments += '<circle class="svg-donut-segment donut-init" cx="'+cx+'" cy="'+cy+'" r="'+r+'" ' +
          'stroke="'+seg.color+'" ' +
          'stroke-dasharray="'+dashLen+' '+dashGap+'" ' +
          'stroke-dashoffset="'+offset+'" ' +
          'style="--circumference:'+circumference+'" ' +
          'data-label="'+seg.label+'" data-value="'+seg.value+'" data-pct="'+(pct*100).toFixed(1)+'" />';
        cumOffset += pct;
      });
      container.innerHTML = '<div class="svg-donut-chart" style="width:'+size+'px;height:'+size+'px;">' +
        '<svg viewBox="0 0 120 120" width="'+size+'" height="'+size+'">' + svgSegments + '</svg>' +
        '<div class="svg-donut-center"><div class="donut-hover-label">Total</div><div class="donut-hover-value">' + fmtFull(total) + '</div></div></div>';

      // Animate in
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          container.querySelectorAll('.donut-init').forEach(function(c) { c.classList.remove('donut-init'); });
        });
      });

      // Hover interactivity
      var centerLabel = container.querySelector('.donut-hover-label');
      var centerValue = container.querySelector('.donut-hover-value');
      container.querySelectorAll('.svg-donut-segment').forEach(function(seg) {
        seg.addEventListener('mouseenter', function() {
          centerLabel.textContent = seg.getAttribute('data-label');
          centerValue.textContent = fmtFull(parseFloat(seg.getAttribute('data-value'))) + ' (' + seg.getAttribute('data-pct') + '%)';
        });
        seg.addEventListener('mouseleave', function() {
          centerLabel.textContent = 'Total';
          centerValue.textContent = fmtFull(total);
        });
      });
    }

    /**
     * SVG Gauge Chart (half-circle)
     * @param {string} containerId
     * @param {number} value - current value (0-100 scale)
     * @param {Array} zones - [{from, to, color}] in 0-100 range
     * @param {string} label - text label
     * @param {number} width - width in px
     */
    function renderGauge(containerId, value, zones, label, width) {
      width = width || 180;
      var container = document.getElementById(containerId);
      if (!container) return;
      value = Math.max(0, Math.min(100, value));
      var cx = 100, cy = 90, r = 70;
      // Arc from 180deg to 0deg (left to right)
      var arcSvg = '';
      zones.forEach(function(z) {
        var startAngle = Math.PI - (z.from / 100) * Math.PI;
        var endAngle = Math.PI - (z.to / 100) * Math.PI;
        var x1 = cx + r * Math.cos(startAngle);
        var y1 = cy - r * Math.sin(startAngle);
        var x2 = cx + r * Math.cos(endAngle);
        var y2 = cy - r * Math.sin(endAngle);
        var largeArc = (z.to - z.from) > 50 ? 1 : 0;
        arcSvg += '<path class="svg-gauge-arc" d="M '+x1+' '+y1+' A '+r+' '+r+' 0 '+largeArc+' 1 '+x2+' '+y2+'" stroke="'+z.color+'" />';
      });
      // Needle
      var needleAngle = Math.PI - (value / 100) * Math.PI;
      var needleLen = r - 10;
      var nx = cx + needleLen * Math.cos(needleAngle);
      var ny = cy - needleLen * Math.sin(needleAngle);
      // Start with needle at 0 position (left), animate to target
      var startAngle = 180; // pointing left
      var targetAngle = 180 - (value / 100) * 180;

      container.innerHTML = '<div class="svg-gauge" style="width:'+width+'px;">' +
        '<svg viewBox="0 0 200 110" width="'+width+'">' +
        arcSvg +
        '<circle cx="'+cx+'" cy="'+cy+'" r="4" fill="var(--text-primary)" />' +
        '<line id="'+containerId+'-needle" x1="'+cx+'" y1="'+cy+'" x2="'+(cx-needleLen)+'" y2="'+cy+'" stroke="var(--text-primary)" stroke-width="2.5" stroke-linecap="round" style="transform-origin:'+cx+'px '+cy+'px;transform:rotate(0deg);transition:transform 1.2s cubic-bezier(0.4,0,0.2,1);" />' +
        '</svg>' +
        '<div class="svg-gauge-label"><div class="gauge-value">'+(label || value.toFixed(0)+'%')+'</div></div></div>';

      // Animate needle
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          var needle = document.getElementById(containerId + '-needle');
          if (needle) {
            var rot = -(value / 100) * 180;
            needle.style.transform = 'rotate(' + rot + 'deg)';
          }
        });
      });
    }

    /**
     * Sparkline SVG inline component
     * @param {Array} data - array of numbers
     * @param {number} width
     * @param {number} height
     * @param {string} color
     * @returns {string} HTML string
     */
    function sparkline(data, width, height, color) {
      if (!data || data.length < 2) return '';
      width = width || 80;
      height = height || 24;
      color = color || 'var(--brand-primary)';
      var min = Math.min.apply(null, data);
      var max = Math.max.apply(null, data);
      var range = max - min || 1;
      var step = width / (data.length - 1);
      var points = data.map(function(v, i) {
        return { x: i * step, y: height - ((v - min) / range) * (height - 2) - 1 };
      });
      // Build smooth path with quadratic bezier
      var d = 'M ' + points[0].x + ' ' + points[0].y;
      for (var i = 1; i < points.length; i++) {
        var cpx = (points[i-1].x + points[i].x) / 2;
        d += ' Q ' + cpx + ' ' + points[i-1].y + ' ' + points[i].x + ' ' + points[i].y;
      }
      // Fill area
      var fillD = d + ' L ' + points[points.length-1].x + ' ' + height + ' L 0 ' + height + ' Z';
      return '<span class="sparkline-inline"><svg width="'+width+'" height="'+height+'" viewBox="0 0 '+width+' '+height+'">' +
        '<path class="sparkline-fill" d="'+fillD+'" fill="'+color+'" />' +
        '<path class="sparkline-path" d="'+d+'" stroke="'+color+'" />' +
        '</svg></span>';
    }

    /**
     * SVG Stacked Area Chart
     * @param {string} containerId
     * @param {Array} data - [{label, bottom, top}] where bottom=contributions, top=total
     * @param {object} opts - {bottomColor, topColor, bottomLabel, topLabel, xLabels, yPrefix}
     */
    function renderAreaChart(containerId, data, opts) {
      var container = document.getElementById(containerId);
      if (!container || !data || data.length === 0) return;
      opts = opts || {};
      var bColor = opts.bottomColor || 'var(--brand-primary)';
      var tColor = opts.topColor || 'var(--brand-success)';
      var bLabel = opts.bottomLabel || 'Contributions';
      var tLabel = opts.topLabel || 'Earnings';
      var yPrefix = opts.yPrefix || '$';

      var maxVal = 0;
      data.forEach(function(d) { if (d.top > maxVal) maxVal = d.top; });
      if (maxVal === 0) maxVal = 1;

      var W = 600, H = 260, padL = 55, padR = 15, padT = 15, padB = 35;
      var chartW = W - padL - padR, chartH = H - padT - padB;
      var n = data.length;
      var stepX = chartW / Math.max(n - 1, 1);

      // Gridlines + Y labels
      var gridCount = 5;
      var gridSvg = '';
      for (var g = 0; g <= gridCount; g++) {
        var gy = padT + (g / gridCount) * chartH;
        var gVal = maxVal * (1 - g / gridCount);
        gridSvg += '<line class="svg-area-gridline" x1="'+padL+'" y1="'+gy+'" x2="'+(W-padR)+'" y2="'+gy+'" />';
        var yLabel = gVal >= 1e6 ? (gVal/1e6).toFixed(1)+'M' : gVal >= 1e3 ? (gVal/1e3).toFixed(0)+'K' : gVal.toFixed(0);
        gridSvg += '<text class="svg-area-label" x="'+(padL-5)+'" y="'+(gy+3)+'" text-anchor="end">'+yPrefix+yLabel+'</text>';
      }

      // X labels
      var xLabelSvg = '';
      var labelInterval = Math.max(1, Math.ceil(n / 10));
      data.forEach(function(d, i) {
        if (i % labelInterval === 0 || i === n - 1) {
          var lx = padL + i * stepX;
          xLabelSvg += '<text class="svg-area-label" x="'+lx+'" y="'+(H - 5)+'" text-anchor="middle">'+(d.label || 'Y'+(i+1))+'</text>';
        }
      });

      // Build paths
      function toY(v) { return padT + chartH - (v / maxVal) * chartH; }
      function toX(i) { return padL + i * stepX; }

      // Bottom area (contributions)
      var bottomPts = data.map(function(d, i) { return { x: toX(i), y: toY(d.bottom) }; });
      // Top area (total)
      var topPts = data.map(function(d, i) { return { x: toX(i), y: toY(d.top) }; });

      function smoothPath(pts) {
        if (pts.length < 2) return 'M ' + pts[0].x + ' ' + pts[0].y;
        var d = 'M ' + pts[0].x + ' ' + pts[0].y;
        for (var i = 1; i < pts.length; i++) {
          var cpx = (pts[i-1].x + pts[i].x) / 2;
          d += ' Q ' + cpx + ' ' + pts[i-1].y + ' ' + pts[i].x + ' ' + pts[i].y;
        }
        return d;
      }

      var baseLine = padT + chartH;
      // Earnings fill (between top line and bottom line)
      var earningsFill = smoothPath(topPts);
      for (var i = bottomPts.length - 1; i >= 0; i--) {
        var cpx2 = i > 0 ? (bottomPts[i].x + bottomPts[i-1].x) / 2 : bottomPts[i].x;
        earningsFill += ' L ' + bottomPts[i].x + ' ' + bottomPts[i].y;
      }
      earningsFill += ' Z';

      // Contributions fill (bottom to baseline)
      var contribFill = smoothPath(bottomPts) + ' L ' + bottomPts[bottomPts.length-1].x + ' ' + baseLine + ' L ' + bottomPts[0].x + ' ' + baseLine + ' Z';

      container.innerHTML = '<div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Portfolio Growth Over Time</div>' +
        '<svg class="svg-area-chart" viewBox="0 0 '+W+' '+H+'">' +
        gridSvg + xLabelSvg +
        '<path class="svg-area-path" d="'+contribFill+'" fill="'+bColor+'" opacity="0.35" />' +
        '<path class="svg-area-path" d="'+earningsFill+'" fill="'+tColor+'" opacity="0.35" />' +
        '<path class="svg-area-path" d="'+smoothPath(bottomPts)+'" fill="none" stroke="'+bColor+'" stroke-width="2" />' +
        '<path class="svg-area-path" d="'+smoothPath(topPts)+'" fill="none" stroke="'+tColor+'" stroke-width="2" />' +
        '</svg>' +
        '<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 0.75rem; font-size: 0.75rem;">' +
        '<div style="display: flex; align-items: center; gap: 0.375rem;"><div style="width: 12px; height: 12px; border-radius: 2px; background: '+bColor+';"></div> '+bLabel+'</div>' +
        '<div style="display: flex; align-items: center; gap: 0.375rem;"><div style="width: 12px; height: 12px; border-radius: 2px; background: '+tColor+';"></div> '+tLabel+'</div></div>';

      // Animate paths in
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          container.querySelectorAll('.svg-area-path').forEach(function(p) { p.classList.add('visible'); });
        });
      });
    }

    // DCA SIMULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateDCA() {
      const monthly = parseFloat(document.getElementById('dca-monthly').value) || 0;
      const annualReturn = (parseFloat(document.getElementById('dca-return').value) || 0) / 100;
      const dividendYield = (parseFloat(document.getElementById('dca-dividend').value) || 0) / 100;
      const totalReturn = annualReturn + dividendYield;
      const years = parseInt(document.getElementById('dca-years').value) || 1;
      const initial = parseFloat(document.getElementById('dca-initial').value) || 0;
      
      const monthlyRate = Math.pow(1 + totalReturn, 1 / 12) - 1;
      const totalMonths = years * 12;
      
      let balance = initial;
      let totalContributed = initial;
      let yearlyData = [];
      
      for (let m = 1; m <= totalMonths; m++) {
        balance = balance * (1 + monthlyRate) + monthly;
        totalContributed += monthly;
        if (m % 12 === 0) {
          yearlyData.push({ year: m / 12, balance, contributed: totalContributed, earnings: balance - totalContributed });
        }
      }
      
      const totalEarnings = balance - totalContributed;
      const inflationRate = (parseFloat(document.getElementById('dca-inflation').value) || 0) / 100;
      const realValue = balance / Math.pow(1 + inflationRate, years);
      
      document.getElementById('dca-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Final Portfolio Value (Nominal)</div>
          <div class="result-value">${fmtFull(balance)}</div>
        </div>
        
        <div class="result-card" style="border-color: rgba(245, 158, 11, 0.3); background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.03));">
          <div class="result-label">Real Value (Inflation-Adjusted)</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-warning), #f97316); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(realValue)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">In today's dollars at ${(inflationRate*100).toFixed(1)}% inflation</div>
          <div style="font-size: 0.75rem; color: var(--text-muted);">Purchasing power erosion: ${fmtFull(balance - realValue)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Investment Earnings</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-success), #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(totalEarnings)}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">Contributed: ${fmtFull(totalContributed)}</span>
            <span class="metric-pill positive">Earned: ${fmtFull(totalEarnings)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Breakdown</div>
          <div style="margin-bottom: 0.75rem;">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
              <span>Contributions</span>
              <span class="mono">${(totalContributed / balance * 100).toFixed(0)}%</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${(totalContributed / balance * 100)}%; background: var(--brand-primary);"></div>
            </div>
          </div>
          <div>
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
              <span>Earnings (Compound Growth)</span>
              <span class="mono">${(totalEarnings / balance * 100).toFixed(0)}%</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${(totalEarnings / balance * 100)}%; background: linear-gradient(90deg, var(--brand-success), var(--brand-accent));"></div>
            </div>
          </div>
        </div>
      `;
      
      // Growth chart ‚Äî SVG area chart + sparkline for YoY growth
      if (yearlyData.length > 0) {
        var areaData = yearlyData.map(function(d) {
          return { label: 'Y' + d.year, bottom: d.contributed, top: d.balance };
        });
        renderAreaChart('dca-chart', areaData, {
          bottomColor: '#6366f1', topColor: '#10b981',
          bottomLabel: 'Contributions', topLabel: 'Total Value'
        });

        // Sparkline: year-over-year growth rates
        if (yearlyData.length > 1) {
          var yoyGrowth = [];
          for (var si = 1; si < yearlyData.length; si++) {
            yoyGrowth.push(yearlyData[si].balance / yearlyData[si-1].balance - 1);
          }
          var sparkHtml = '<div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.75rem;">YoY Growth ' + sparkline(yoyGrowth, 100, 20, '#10b981') + '</div>';
          var dcaChart = document.getElementById('dca-chart');
          if (dcaChart) dcaChart.innerHTML += sparkHtml;
        }
      }

      // Year-by-year table
      if (yearlyData.length > 0) {
        const tableEl = document.getElementById('dca-table');
        if (tableEl) {
          let rows = yearlyData.map(d => `<tr><td>Year ${d.year}</td><td>${fmtFull(d.contributed)}</td><td>${fmtFull(d.earnings)}</td><td style="font-weight:700;">${fmtFull(d.balance)}</td></tr>`).join('');
          tableEl.innerHTML = `
            <div class="accordion-item">
              <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
                <span>üìã Year-by-Year Breakdown</span>
                <span class="accordion-arrow">‚ñº</span>
              </div>
              <div class="accordion-body">
                <div class="accordion-body-inner" style="overflow-x:auto;padding:0.5rem;">
                  <table class="sensitivity-table">
                    <thead><tr><th>Year</th><th>Contributed</th><th>Earnings</th><th>Balance</th></tr></thead>
                    <tbody>${rows}</tbody>
                  </table>
                </div>
              </div>
            </div>`;
        }
      }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // RETIREMENT (RRSP vs TFSA)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateRetirement() {
      const income = parseFloat(document.getElementById('ret-income').value) || 0;
      const contribution = parseFloat(document.getElementById('ret-contribution').value) || 0;
      const age = parseInt(document.getElementById('ret-age').value) || 30;
      const retireAge = parseInt(document.getElementById('ret-retire-age').value) || 65;
      const annualReturn = (parseFloat(document.getElementById('ret-return').value) || 0) / 100;
      const retireIncome = parseFloat(document.getElementById('ret-retire-income').value) || 0;
      const province = document.getElementById('ret-province').value;
      
      const years = retireAge - age;
      if (years <= 0) {
        document.getElementById('retirement-results').innerHTML = '<div class="result-card"><p style="color: var(--text-muted);">Retirement age must be greater than current age.</p></div>';
        return;
      }
      
      // Canadian federal tax brackets (2025)
      const fedTax = (inc) => {
        if (inc <= 0) return 0;
        let tax = 0;
        const brackets = [
          [55867, 0.15], [55867, 0.205], [61942, 0.26], [70000, 0.29], [Infinity, 0.33]
        ];
        let remaining = inc;
        for (const [limit, rate] of brackets) {
          const taxable = Math.min(remaining, limit);
          tax += taxable * rate;
          remaining -= taxable;
          if (remaining <= 0) break;
        }
        return tax;
      };
      
      // Provincial tax brackets (2025 approximations)
      const provBrackets = {
        'ON': [[51446, 0.0505], [51446, 0.0915], [47046, 0.1116], [100000, 0.1216], [Infinity, 0.1316]],
        'BC': [[47937, 0.0506], [47937, 0.077], [13554, 0.105], [24517, 0.1229], [47937, 0.147], [Infinity, 0.168]],
        'AB': [[148269, 0.10], [29654, 0.12], [59308, 0.13], [118616, 0.14], [Infinity, 0.15]],
        'QC': [[51780, 0.14], [51780, 0.19], [21480, 0.24], [Infinity, 0.2575]]
      };
      const provTax = (inc) => {
        if (inc <= 0) return 0;
        const brackets = provBrackets[province] || provBrackets['ON'];
        let tax = 0, remaining = inc;
        for (const [limit, rate] of brackets) {
          const taxable = Math.min(remaining, limit);
          tax += taxable * rate;
          remaining -= taxable;
          if (remaining <= 0) break;
        }
        return tax;
      };
      
      const marginalRate = (inc) => {
        const tax1 = fedTax(inc) + provTax(inc);
        const tax2 = fedTax(inc + 1) + provTax(inc + 1);
        return tax2 - tax1;
      };
      
      const currentMarginal = marginalRate(income);
      const retireMarginal = marginalRate(retireIncome);
      
      // RRSP: Tax deduction now, taxed on withdrawal
      const rrspTaxSavings = contribution * currentMarginal;
      const rrspGross = contribution; // Full amount invested
      let rrspBalance = 0;
      for (let y = 0; y < years; y++) {
        rrspBalance = (rrspBalance + rrspGross) * (1 + annualReturn);
      }
      const rrspAfterTax = rrspBalance * (1 - retireMarginal);
      
      // TFSA: No deduction, tax-free growth and withdrawal
      const tfsaNet = contribution; // Same contribution amount
      let tfsaBalance = 0;
      for (let y = 0; y < years; y++) {
        tfsaBalance = (tfsaBalance + tfsaNet) * (1 + annualReturn);
      }
      
      // RRSP with reinvested refund
      const rrspWithRefund = contribution + rrspTaxSavings;
      let rrspRefundBalance = 0;
      for (let y = 0; y < years; y++) {
        rrspRefundBalance = (rrspRefundBalance + rrspWithRefund) * (1 + annualReturn);
      }
      const rrspRefundAfterTax = rrspRefundBalance * (1 - retireMarginal);
      
      const winner = rrspRefundAfterTax > tfsaBalance ? 'RRSP' : 'TFSA';
      const advantage = Math.abs(rrspRefundAfterTax - tfsaBalance);
      
      // Contribution limit warnings
      const rrspLimit = Math.min(income * 0.18, 31560); // 2024 limit
      const tfsaLimit = 7000; // 2024 annual limit
      const contribWarning = contribution > rrspLimit ? `‚ö†Ô∏è RRSP limit is ${fmtFull(rrspLimit)} (18% of income or $31,560 max). ` : '';
      const tfsaWarning = contribution > tfsaLimit ? `‚ö†Ô∏è TFSA annual limit is ${fmtFull(tfsaLimit)}. Excess may incur 1%/month penalty.` : '';
      
      document.getElementById('retirement-results').innerHTML = `
        <div class="gradient-border-card">
          <div class="gradient-border-card-inner" style="text-align: center;">
            <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem;">Recommendation</div>
            <div style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.25rem;">${winner} Wins</div>
            <div style="font-size: 0.85rem; color: var(--text-secondary);">by ${fmtFull(advantage)} over ${years} years</div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div style="text-align: center; padding: 1rem; border-radius: var(--radius-md); background: ${winner === 'RRSP' ? 'rgba(99, 102, 241, 0.1)' : 'transparent'};">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">RRSP (After Tax)</div>
              <div class="mono" style="font-size: 1.25rem; font-weight: 700; color: var(--brand-primary);">${fmtFull(rrspRefundAfterTax)}</div>
              <div style="font-size: 0.72rem; color: var(--text-muted); margin-top: 0.25rem;">Pre-tax: ${fmtFull(rrspRefundBalance)}</div>
            </div>
            <div style="text-align: center; padding: 1rem; border-radius: var(--radius-md); background: ${winner === 'TFSA' ? 'rgba(6, 182, 212, 0.1)' : 'transparent'};">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">TFSA (Tax-Free)</div>
              <div class="mono" style="font-size: 1.25rem; font-weight: 700; color: var(--brand-accent);">${fmtFull(tfsaBalance)}</div>
              <div style="font-size: 0.72rem; color: var(--text-muted); margin-top: 0.25rem;">100% tax-free</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Tax Analysis</div>
          <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.85rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Current Marginal Rate</span>
              <span class="mono" style="font-weight: 700;">${(currentMarginal * 100).toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Retirement Marginal Rate</span>
              <span class="mono" style="font-weight: 700;">${(retireMarginal * 100).toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">RRSP Tax Refund (Annual)</span>
              <span class="mono" style="font-weight: 700; color: var(--brand-success);">${fmtFull(rrspTaxSavings)}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Tax Rate Arbitrage</span>
              <span class="mono" style="font-weight: 700; color: ${currentMarginal > retireMarginal ? 'var(--brand-success)' : 'var(--brand-danger)'};">${((currentMarginal - retireMarginal) * 100).toFixed(1)}%</span>
            </div>
          </div>
          <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 1rem; padding: 0.75rem; background: rgba(99,102,241,0.05); border-radius: var(--radius-sm);">
            üí° <strong>Rule of thumb:</strong> RRSP wins when your current tax rate is higher than your expected retirement tax rate. TFSA wins when rates are the same or lower now.
          </div>
          ${contribWarning || tfsaWarning ? `<div style="font-size: 0.75rem; color: var(--brand-warning); margin-top: 0.75rem; padding: 0.75rem; background: rgba(245,158,11,0.08); border-radius: var(--radius-sm);">${contribWarning}${tfsaWarning}</div>` : ''}
        </div>
      `;
      
      // Growth comparison chart
      let rrspYearly = [], tfsaYearly = [], rrspBal = 0, tfsaBal = 0;
      for (let y = 1; y <= years; y++) {
        rrspBal = (rrspBal + rrspWithRefund) * (1 + annualReturn);
        tfsaBal = (tfsaBal + tfsaNet) * (1 + annualReturn);
        if (y % Math.max(1, Math.floor(years / 15)) === 0 || y === years) {
          rrspYearly.push({ year: y, rrsp: rrspBal * (1 - retireMarginal), tfsa: tfsaBal });
        }
      }
      const chartData = rrspYearly.map(d => ({ label: 'Y' + d.year, bottom: Math.min(d.rrsp, d.tfsa), top: Math.max(d.rrsp, d.tfsa) }));
      if (chartData.length > 0 && typeof renderAreaChart === 'function') {
        renderAreaChart('retirement-chart', chartData, {
          bottomColor: winner === 'RRSP' ? '#06b6d4' : '#6366f1',
          topColor: winner === 'RRSP' ? '#6366f1' : '#06b6d4',
          bottomLabel: winner === 'RRSP' ? 'TFSA' : 'RRSP (After Tax)',
          topLabel: winner === 'RRSP' ? 'RRSP (After Tax)' : 'TFSA'
        });
      } else {
        const maxRetVal = Math.max(rrspRefundAfterTax, tfsaBalance);
        document.getElementById('retirement-chart').innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìä Growth Over ${years} Years</div>
          <div style="display: flex; align-items: flex-end; gap: 1rem; height: 180px;">
            ${rrspYearly.map(d => `
              <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px;">
                <div style="display: flex; gap: 2px; align-items: flex-end; width: 100%; justify-content: center;">
                  <div style="width: 45%; height: ${(d.rrsp / maxRetVal * 150)}px; background: var(--brand-primary); border-radius: 3px 3px 0 0; min-height: 4px;" title="RRSP: ${fmtFull(d.rrsp)}"></div>
                  <div style="width: 45%; height: ${(d.tfsa / maxRetVal * 150)}px; background: var(--brand-accent); border-radius: 3px 3px 0 0; min-height: 4px;" title="TFSA: ${fmtFull(d.tfsa)}"></div>
                </div>
                <span style="font-size: 0.65rem; color: var(--text-muted);">Y${d.year}</span>
              </div>
            `).join('')}
          </div>
          <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 0.75rem; font-size: 0.75rem;">
            <span><span style="display:inline-block;width:10px;height:10px;background:var(--brand-primary);border-radius:2px;"></span> RRSP (After Tax)</span>
            <span><span style="display:inline-block;width:10px;height:10px;background:var(--brand-accent);border-radius:2px;"></span> TFSA</span>
          </div>
        `;
      }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // COMPOUND INTEREST
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateCompound() {
      const initial = parseFloat(document.getElementById('comp-initial').value) || 0;
      const monthly = parseFloat(document.getElementById('comp-monthly').value) || 0;
      const rate = (parseFloat(document.getElementById('comp-rate').value) || 0) / 100;
      const years = parseInt(document.getElementById('comp-years').value) || 1;
      const freq = parseInt(document.getElementById('comp-freq').value) || 12;
      
      if (rate < 0 || years < 1) return;
      
      // Effective monthly rate based on compounding frequency
      // For freq compoundings/year: effective annual = (1 + r/freq)^freq
      // Then convert to monthly: (1 + effectiveAnnual)^(1/12) - 1
      const effectiveAnnual = Math.pow(1 + rate / freq, freq) - 1;
      const monthlyRate = Math.pow(1 + effectiveAnnual, 1 / 12) - 1;
      
      // Calculate with contributions
      let balance = initial;
      let totalContributed = initial;
      let yearlyData = [];
      
      for (let month = 1; month <= years * 12; month++) {
        balance = balance * (1 + monthlyRate) + monthly;
        totalContributed += monthly;
        
        if (month % 12 === 0) {
          yearlyData.push({
            year: month / 12,
            balance,
            contributed: totalContributed,
            interest: balance - totalContributed
          });
        }
      }
      
      // Without contributions (initial only, using selected compounding)
      const withoutContrib = initial * Math.pow(1 + effectiveAnnual, years);
      
      const totalInterest = balance - totalContributed;
      const effectiveRate = (Math.pow(balance / totalContributed, 1 / years) - 1) * 100;
      
      document.getElementById('compound-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Future Value</div>
          <div class="result-value">${fmtFull(balance)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Interest Earned</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-success), var(--brand-accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(totalInterest)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Summary</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Total Contributed</div>
              <div class="mono" style="font-weight: 700;">${fmtFull(totalContributed)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Growth Multiple</div>
              <div class="mono" style="font-weight: 700;">${(balance / totalContributed).toFixed(2)}x</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Without Contributions</div>
              <div class="mono" style="font-weight: 700;">${fmtFull(withoutContrib)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Contribution Impact</div>
              <div class="mono" style="font-weight: 700; color: var(--brand-success);">+${fmtFull(balance - withoutContrib)}</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">The Power of Compound Interest</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.7;">
            Your ${fmtFull(monthly)}/month contributions turn into <strong style="color: var(--text-primary);">${fmtFull(balance)}</strong> over ${years} years.
            That's <strong style="color: var(--brand-success);">${fmtFull(totalInterest)}</strong> in pure compound growth ‚Äî money your money earned for you.
          </div>
        </div>
      `;
      
      // Growth chart ‚Äî SVG area chart with sparkline trajectory preview
      if (yearlyData.length > 0) {
        var compAreaData = yearlyData.map(function(d) {
          return { label: 'Y' + d.year, bottom: d.contributed, top: d.balance };
        });
        renderAreaChart('compound-chart', compAreaData, {
          bottomColor: '#6366f1', topColor: '#10b981',
          bottomLabel: 'Contributions', topLabel: 'Total (with Interest)'
        });

        // Sparkline: balance trajectory preview
        var balTrajectory = yearlyData.map(function(d) { return d.balance; });
        var compChart = document.getElementById('compound-chart');
        if (compChart) {
          compChart.innerHTML += '<div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.75rem;">Growth Trajectory ' + sparkline(balTrajectory, 100, 20, '#06b6d4') + '</div>';
        }
      }

      // Comparison mode (Scenario B)
      const rateB = (parseFloat(document.getElementById('comp-rate-b').value) || 0) / 100;
      const monthlyB = parseFloat(document.getElementById('comp-monthly-b').value) || 0;
      const compCompare = document.getElementById('compound-comparison');
      if (compCompare && (rateB > 0 || monthlyB > 0)) {
        let balB = initial, contribB = initial;
        let yearlyB = [];
        const effectiveAnnualB = Math.pow(1 + rateB / freq, freq) - 1;
        const monthlyRateB = Math.pow(1 + effectiveAnnualB, 1/12) - 1;
        for (let m = 1; m <= years * 12; m++) {
          balB = balB * (1 + monthlyRateB) + monthlyB;
          contribB += monthlyB;
          if (m % 12 === 0) yearlyB.push({ year: m/12, balance: balB, contributed: contribB });
        }
        const diff = balance - balB;
        compCompare.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìä Scenario Comparison</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
            <div class="glass-card" style="padding:var(--space-lg);text-align:center;">
              <div style="font-size:0.72rem;color:var(--text-muted);text-transform:uppercase;">Scenario A</div>
              <div style="font-size:0.8rem;color:var(--text-secondary);">${(rate*100).toFixed(1)}% ¬∑ ${fmtFull(monthly)}/mo</div>
              <div class="mono" style="font-size:1.5rem;font-weight:700;color:var(--brand-primary);margin-top:0.5rem;">${fmtFull(balance)}</div>
            </div>
            <div class="glass-card" style="padding:var(--space-lg);text-align:center;">
              <div style="font-size:0.72rem;color:var(--text-muted);text-transform:uppercase;">Scenario B</div>
              <div style="font-size:0.8rem;color:var(--text-secondary);">${(rateB*100).toFixed(1)}% ¬∑ ${fmtFull(monthlyB)}/mo</div>
              <div class="mono" style="font-size:1.5rem;font-weight:700;color:var(--brand-accent);margin-top:0.5rem;">${fmtFull(balB)}</div>
            </div>
          </div>
          <div style="text-align:center;margin-top:1rem;font-size:0.9rem;color:var(--text-secondary);">
            Scenario ${diff > 0 ? 'A' : 'B'} wins by <strong style="color:var(--brand-success);">${fmtFull(Math.abs(diff))}</strong>
          </div>
        `;
      } else if (compCompare) {
        compCompare.innerHTML = '';
      }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TEST SUITE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function runTests() {
      const results = [];
      let passed = 0;
      let failed = 0;
      
      function assert(name, condition, detail) {
        if (condition) {
          passed++;
          results.push({ name, status: 'PASS', detail });
        } else {
          failed++;
          results.push({ name, status: 'FAIL', detail });
        }
      }
      
      // ‚îÄ‚îÄ Formatting Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      assert('fmt: millions', fmt(5000000) === '$5.0M', fmt(5000000));
      assert('fmt: billions', fmt(2500000000) === '$2.5B', fmt(2500000000));
      assert('fmt: thousands', fmt(50000) === '$50.0K', fmt(50000));
      assert('fmt: zero', fmt(0) === '$0.00', fmt(0));
      assert('fmt: negative', fmt(-3000000).includes('-'), fmt(-3000000));
      assert('fmt: NaN guard', fmt(NaN) === '$0', fmt(NaN));
      assert('fmt: undefined guard', fmt(undefined) === '$0', fmt(undefined));
      assert('fmtPct: basic', fmtPct(12.345) === '12.3%', fmtPct(12.345));
      assert('fmtFull: formats number', fmtFull(1234).length > 0, fmtFull(1234));
      
      // ‚îÄ‚îÄ DCF Calculation Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const fcf = 1000000;
      const growth = 0.10;
      const terminal = 0.025;
      const wacc = 0.12;
      const years = 5;
      
      let pvSum = 0;
      for (let i = 1; i <= years; i++) {
        pvSum += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
      }
      const finalFCF = fcf * Math.pow(1 + growth, years);
      const tv = finalFCF * (1 + terminal) / (wacc - terminal);
      const pvTV = tv / Math.pow(1 + wacc, years);
      const ev = pvSum + pvTV;
      
      assert('DCF: PV of FCFs > 0', pvSum > 0, `PV sum = ${pvSum.toFixed(0)}`);
      assert('DCF: Terminal value > 0', tv > 0, `TV = ${tv.toFixed(0)}`);
      assert('DCF: EV > initial FCF', ev > fcf, `EV = ${ev.toFixed(0)}`);
      assert('DCF: EV reasonable range', ev > 5000000 && ev < 50000000, `EV = ${fmt(ev)}`);
      
      // ‚îÄ‚îÄ M&A Accretion/Dilution Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const acqEPS = 5.00, acqShares = 100, acqPrice = 50;
      const tgtEPS = 2.00, tgtShares = 50, tgtPrice = 20;
      const maPremium = 0.25, maCashPct = 0.50, maDebtCost = 0.05, maTaxRate = 0.25;
      const maOfferPrice = tgtPrice * (1 + maPremium);
      const maDealValue = maOfferPrice * tgtShares;
      const maCashPortion = maDealValue * maCashPct;
      const maStockPortion = maDealValue * (1 - maCashPct);
      const maNewShares = maStockPortion / acqPrice;
      const maProFormaShares = acqShares + maNewShares;
      const maAcqNI = acqEPS * acqShares;
      const maTgtNI = tgtEPS * tgtShares;
      const maInterest = maCashPortion * maDebtCost * (1 - maTaxRate);
      const maProFormaNI = maAcqNI + maTgtNI - maInterest;
      const maProFormaEPS = maProFormaNI / maProFormaShares;
      const maAccDil = ((maProFormaEPS - acqEPS) / acqEPS) * 100;
      assert('M&A: offer price includes premium', maOfferPrice === 25, `Offer = ${maOfferPrice}`);
      assert('M&A: deal value correct', maDealValue === 1250, `Deal = ${maDealValue}`);
      assert('M&A: accretive deal detected', maAccDil > 0, `Accretion = ${maAccDil.toFixed(2)}%`);
      // Dilutive scenario: high premium
      const dilOfferPrice = tgtPrice * 3;
      const dilDealValue = dilOfferPrice * tgtShares;
      const dilNewShares = dilDealValue / acqPrice;
      const dilProFormaShares = acqShares + dilNewShares;
      const dilProFormaEPS = (maAcqNI + maTgtNI) / dilProFormaShares;
      const dilAccDil = ((dilProFormaEPS - acqEPS) / acqEPS) * 100;
      assert('M&A: dilutive with high premium', dilAccDil < 0, `Dilution = ${dilAccDil.toFixed(2)}%`);
      
      // ‚îÄ‚îÄ Mortgage Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const price = 800000;
      const mortDownPct = 0.20;
      const rate = 0.055;
      const principal = price * (1 - mortDownPct);
      const semiRate = Math.pow(1 + rate / 2, 2) - 1;
      const mRate = Math.pow(1 + semiRate, 1 / 12) - 1;
      const mPayment = principal * (mRate * Math.pow(1 + mRate, 300)) / (Math.pow(1 + mRate, 300) - 1);
      
      assert('Mortgage: payment > 0', mPayment > 0, `Payment = ${mPayment.toFixed(2)}`);
      assert('Mortgage: payment reasonable', mPayment > 2000 && mPayment < 6000, `Payment = ${fmtFull(mPayment)}`);
      assert('Mortgage: semi-annual compounding', semiRate > rate, `Effective = ${(semiRate * 100).toFixed(3)}%`);
      
      // ‚îÄ‚îÄ CMHC Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      assert('CMHC: not required at 20% down', mortDownPct >= 0.20, 'Down 20% = no CMHC');
      const cmhc10Down = 0.10;
      const cmhc10Principal = price * (1 - cmhc10Down);
      const cmhc10Premium = cmhc10Principal * 0.031;
      assert('CMHC: premium applies at 10% down', cmhc10Premium > 0, `CMHC = ${cmhc10Premium.toFixed(0)}`);
      assert('CMHC: 10% down premium > 0', cmhc10Down < 0.20 && cmhc10Premium > 20000, `Premium = ${cmhc10Premium.toFixed(0)}`);
      assert('CMHC: no premium at 20%+', mortDownPct >= 0.20, '20% down = exempt');
      
      // ‚îÄ‚îÄ CAGR Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const cagr = (Math.pow(25000 / 10000, 1 / 5) - 1) * 100;
      assert('CAGR: basic calc', Math.abs(cagr - 20.11) < 0.1, `CAGR = ${cagr.toFixed(2)}%`);
      
      // ‚îÄ‚îÄ Compound Interest Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      let balance = 10000;
      for (let m = 0; m < 12; m++) {
        balance *= (1 + 0.07 / 12);
      }
      assert('Compound: 1yr @7%', Math.abs(balance - 10722.9) < 5, `Balance = ${balance.toFixed(2)}`);
      
      // ‚îÄ‚îÄ DCA Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      let dcaBalance = 0;
      const dcaMonthly = 500;
      const dcaRate = Math.pow(1.08, 1 / 12) - 1;
      for (let m = 0; m < 240; m++) {
        dcaBalance = dcaBalance * (1 + dcaRate) + dcaMonthly;
      }
      const dcaTotalContributed = 500 * 240;
      assert('DCA: 20yr result > contributions', dcaBalance > dcaTotalContributed, `Balance = ${dcaBalance.toFixed(0)} > ${dcaTotalContributed}`);
      
      // ‚îÄ‚îÄ DCA with Inflation Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const dcaInflation = 0.03;
      const dcaNominal = dcaBalance;
      const dcaReal = dcaNominal / Math.pow(1 + dcaInflation, 20);
      assert('DCA inflation: real < nominal', dcaReal < dcaNominal, `Real = ${dcaReal.toFixed(0)} < Nominal = ${dcaNominal.toFixed(0)}`);
      assert('DCA inflation: real still positive', dcaReal > 0, `Real = ${dcaReal.toFixed(0)}`);
      
      // ‚îÄ‚îÄ Startup Runway Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const rwCosts = 50000;
      const rwRevenue = 20000;
      const rwBurnRate = rwCosts - rwRevenue;
      assert('Runway: burn rate = costs - revenue', rwBurnRate === 30000, `Burn = ${rwBurnRate}`);
      const rwCash = 300000;
      const rwMonths = rwCash / rwBurnRate;
      assert('Runway: months = cash / burn', rwMonths === 10, `Months = ${rwMonths}`);
      assert('Runway: zero burn when revenue >= costs', (50000 - 50000) === 0, 'Break-even');
      
      // ‚îÄ‚îÄ Net Worth Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const nwAssets = 500000;
      const nwLiabilities = 200000;
      const nwNetWorth = nwAssets - nwLiabilities;
      assert('Net worth: assets - liabilities', nwNetWorth === 300000, `NW = ${nwNetWorth}`);
      assert('Net worth: negative when liabilities > assets', (100000 - 300000) < 0, 'Negative NW');
      
      // ‚îÄ‚îÄ Tax Bracket Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const fedTaxResult = fedTax(120000);
      assert('Fed tax: positive for 120K', fedTaxResult > 0, `Tax = ${fedTaxResult.toFixed(0)}`);
      assert('Fed tax: reasonable', fedTaxResult > 15000 && fedTaxResult < 35000, `Tax = ${fedTaxResult.toFixed(0)}`);
      
      // ‚îÄ‚îÄ Page Navigation Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const allPages = ['home', 'valuation', 'mortgage', 'investment', 'retirement', 'compound', 'merger', 'runway', 'networth', 'salary', 'debt'];
      allPages.forEach(p => {
        assert(`Nav: page-${p} exists`, !!document.getElementById('page-' + p), '');
      });
      
      // ‚îÄ‚îÄ Theme Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const wasDark = isDark;
      const wasCls = document.documentElement.classList.contains('light');
      toggleTheme();
      assert('Theme: toggles isDark', isDark !== wasDark, `isDark changed to ${isDark}`);
      assert('Theme: light class toggles', document.documentElement.classList.contains('light') !== wasCls, '');
      const themeStored = localStorage.getItem('figgybank-theme');
      assert('Theme: persists to localStorage', themeStored !== null, `Stored: ${themeStored}`);
      toggleTheme(); // Reset
      const themeReset = localStorage.getItem('figgybank-theme');
      assert('Theme: localStorage updates on re-toggle', themeReset !== themeStored, `Now: ${themeReset}`);
      
      // Print results
      console.log(`\nüß™ FIGGYBANK TEST SUITE`);
      console.log(`${'‚ïê'.repeat(50)}`);
      results.forEach(r => {
        console.log(`${r.status === 'PASS' ? '‚úÖ' : '‚ùå'} ${r.name} ${r.detail ? `(${r.detail})` : ''}`);
      });
      console.log(`${'‚ïê'.repeat(50)}`);
      console.log(`Results: ${passed} passed, ${failed} failed, ${passed + failed} total`);
      console.log(failed === 0 ? 'üéâ ALL TESTS PASSED!' : `‚ö†Ô∏è ${failed} TEST(S) FAILED`);
      
      return { passed, failed, total: passed + failed, results };
    }
    
    // Run tests on load (dev mode)
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1' || location.search.includes('test=true')) {
      window.addEventListener('load', () => {
        setTimeout(runTests, 500);
      });
    }
    
    // Expose for manual testing
    window.runTests = runTests;

    // ‚îÄ‚îÄ M&A Deal Analyzer ‚îÄ‚îÄ
    function calculateMA() {
      const v = id => parseFloat(document.getElementById(id).value) || 0;
      const fmt = (n, d=1) => n.toLocaleString('en-US', {minimumFractionDigits:d, maximumFractionDigits:d});
      const fmtM = n => '$' + fmt(n, 1) + 'M';
      const fmtD = n => '$' + fmt(n, 2);

      // Inputs
      const acqEPS = v('ma-acq-eps'), acqPrice = v('ma-acq-price'), acqShares = v('ma-acq-shares'), acqPE = v('ma-acq-pe');
      const tgtEPS = v('ma-tgt-eps'), tgtPrice = v('ma-tgt-price'), tgtShares = v('ma-tgt-shares');
      const premium = v('ma-premium') / 100;
      const cashPct = v('ma-cash-pct') / 100, stockPct = 1 - cashPct;
      const debtCost = v('ma-debt-cost') / 100, taxRate = v('ma-tax') / 100;
      const revSyn = v('ma-rev-syn'), costSyn = v('ma-cost-syn');

      if (acqEPS <= 0 || acqPrice <= 0 || tgtEPS <= 0 || tgtPrice <= 0) {
        document.getElementById('ma-results').innerHTML = '<div class="result-card"><p style="color: var(--text-muted);">Enter positive values for EPS and share prices to analyze the deal.</p></div>';
        document.getElementById('ma-sensitivity').innerHTML = '';
        document.getElementById('ma-sources-uses').innerHTML = '';
        return;
      }

      // Core calcs
      const offerPrice = tgtPrice * (1 + premium);
      const dealValue = offerPrice * tgtShares; // in $M
      const cashPortion = dealValue * cashPct;
      const stockPortion = dealValue * stockPct;
      const newSharesIssued = acqPrice > 0 ? stockPortion / acqPrice : 0;
      const proFormaShares = acqShares + newSharesIssued;

      // Earnings
      const acqNetIncome = acqEPS * acqShares;
      const tgtNetIncome = tgtEPS * tgtShares;
      const synergies = (revSyn + costSyn) * (1 - taxRate);
      const interestExpense = cashPortion * debtCost * (1 - taxRate);
      const proFormaNetIncome = acqNetIncome + tgtNetIncome + synergies - interestExpense;
      const proFormaEPS = proFormaShares > 0 ? proFormaNetIncome / proFormaShares : 0;
      const accretionDilution = acqEPS !== 0 ? ((proFormaEPS - acqEPS) / acqEPS) * 100 : 0;

      // Goodwill
      const tgtBookValue = tgtShares * tgtPrice; // simplified: book ‚âà market pre-premium
      const goodwill = dealValue - tgtBookValue;

      // Combined P/E
      const combinedPE = proFormaEPS > 0 ? acqPrice / proFormaEPS : 0;

      // Break-even synergies: find synergies needed so accretion = 0
      // proFormaEPS = acqEPS when synergies = S_be
      // (acqNI + tgtNI + S_be*(1-t) - interest) / proFormaShares = acqEPS
      const beNumerator = acqEPS * proFormaShares - acqNetIncome - tgtNetIncome + interestExpense;
      const breakEvenSyn = (1 - taxRate) > 0 ? beNumerator / (1 - taxRate) : 0;

      // Transaction fees
      const txnFees = dealValue * 0.02;

      const adColor = accretionDilution >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)';
      const adLabel = accretionDilution >= 0 ? 'Accretive' : 'Dilutive';

      // Results
      document.getElementById('ma-results').innerHTML = `
        <div class="result-card glass-card" style="padding: var(--space-lg);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Deal Summary</h3>
          <div style="display: grid; gap: 1rem;">
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Offer Price / Share</span><div class="mono" style="font-size: 1.3rem; color: var(--brand-primary);">${fmtD(offerPrice)}</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Total Deal Value</span><div class="mono" style="font-size: 1.3rem; color: var(--brand-primary);">${fmtM(dealValue)}</div></div>
            <div style="border-top: 1px solid rgba(255,255,255,0.06); padding-top: 1rem;">
              <span style="color: var(--text-secondary); font-size: 0.85rem;">Pro Forma EPS</span>
              <div class="mono" style="font-size: 1.3rem; color: var(--brand-accent);">${fmtD(proFormaEPS)}</div>
              <span style="font-size: 0.75rem; color: var(--text-muted);">vs. standalone ${fmtD(acqEPS)}</span>
            </div>
            <div style="background: rgba(${accretionDilution >= 0 ? '46,204,113' : '231,76,60'},0.1); border-radius: 0.75rem; padding: 1rem; text-align: center;">
              <span style="color: var(--text-secondary); font-size: 0.85rem;">${adLabel}</span>
              <div class="mono" style="font-size: 1.8rem; font-weight: 700; color: ${adColor};">${accretionDilution >= 0 ? '+' : ''}${fmt(accretionDilution,2)}%</div>
            </div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Goodwill Created</span><div class="mono" style="font-size: 1.1rem;">${fmtM(goodwill)}</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Combined P/E</span><div class="mono" style="font-size: 1.1rem;">${fmt(combinedPE,1)}x</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Break-even Synergies Needed</span><div class="mono" style="font-size: 1.1rem; color: ${breakEvenSyn > 0 ? 'var(--brand-warning)' : 'var(--brand-success)'};">${fmtM(breakEvenSyn)}</div></div>
          </div>
        </div>
      `;

      // Sensitivity table
      const premiums = [10, 20, 30, 40];
      const cashMixes = [0, 25, 50, 75, 100];
      let tbl = '<h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Sensitivity: Accretion / Dilution %</h3>';
      tbl += '<table class="sensitivity-table"><thead><tr><th>Premium \\ Cash%</th>';
      cashMixes.forEach(c => tbl += `<th>${c}%</th>`);
      tbl += '</tr></thead><tbody>';
      premiums.forEach(p => {
        tbl += `<tr><td style="font-weight:600;">${p}%</td>`;
        cashMixes.forEach(c => {
          const op = tgtPrice * (1 + p/100);
          const dv = op * tgtShares;
          const cp = dv * c/100, sp = dv * (1 - c/100);
          const ns = acqPrice > 0 ? sp / acqPrice : 0;
          const pfs = acqShares + ns;
          const ie = cp * debtCost * (1 - taxRate);
          const pfni = acqNetIncome + tgtNetIncome + synergies - ie;
          const pfeps = pfs > 0 ? pfni / pfs : 0;
          const ad = acqEPS !== 0 ? ((pfeps - acqEPS) / acqEPS) * 100 : 0;
          const cls = ad >= 0 ? 'positive-val' : 'negative-val';
          const hl = (p === v('ma-premium') && c === v('ma-cash-pct')) ? ' highlight' : '';
          tbl += `<td class="${cls}${hl}">${ad >= 0 ? '+' : ''}${ad.toFixed(1)}%</td>`;
        });
        tbl += '</tr>';
      });
      tbl += '</tbody></table>';
      document.getElementById('ma-sensitivity').innerHTML = tbl;

      // Sources & Uses
      const cashOnHand = 0; // simplified
      const newDebt = cashPortion;
      const stockIssued = stockPortion;
      let su = '<h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Sources & Uses ($M)</h3>';
      su += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">';
      su += '<div><table class="sensitivity-table"><thead><tr><th colspan="2">Sources</th></tr></thead><tbody>';
      su += `<tr><td>New Debt</td><td class="mono">${fmtM(newDebt)}</td></tr>`;
      su += `<tr><td>Stock Issued</td><td class="mono">${fmtM(stockIssued)}</td></tr>`;
      su += `<tr><td>Cash on Hand</td><td class="mono">${fmtM(cashOnHand)}</td></tr>`;
      su += `<tr style="border-top:2px solid rgba(255,255,255,0.1);"><td style="font-weight:700;">Total Sources</td><td class="mono" style="font-weight:700;">${fmtM(dealValue + txnFees)}</td></tr>`;
      su += '</tbody></table></div>';
      su += '<div><table class="sensitivity-table"><thead><tr><th colspan="2">Uses</th></tr></thead><tbody>';
      su += `<tr><td>Purchase Price</td><td class="mono">${fmtM(dealValue)}</td></tr>`;
      su += `<tr><td>Transaction Fees (2%)</td><td class="mono">${fmtM(txnFees)}</td></tr>`;
      su += `<tr><td>Refinancing</td><td class="mono">${fmtM(0)}</td></tr>`;
      su += `<tr style="border-top:2px solid rgba(255,255,255,0.1);"><td style="font-weight:700;">Total Uses</td><td class="mono" style="font-weight:700;">${fmtM(dealValue + txnFees)}</td></tr>`;
      su += '</tbody></table></div></div>';
      document.getElementById('ma-sources-uses').innerHTML = su;
    }

    // Initialize M&A on page load
    document.addEventListener('DOMContentLoaded', function() { if(document.getElementById('ma-acq-eps')) calculateMA(); });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  STARTUP RUNWAY CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let runwayScenario = 'base';

    function switchRunwayTab(tab) {
      runwayScenario = tab;
      document.querySelectorAll('#runway-tabs .tab').forEach(t => t.classList.remove('active'));
      document.getElementById('runway-tab-' + tab).classList.add('active');
      calculateRunway();
    }

    function getHiringPlan() {
      const roles = document.querySelectorAll('.rw-hire-role');
      const salaries = document.querySelectorAll('.rw-hire-salary');
      const months = document.querySelectorAll('.rw-hire-month');
      const plan = [];
      for (let i = 0; i < roles.length; i++) {
        plan.push({
          role: roles[i].value,
          salary: parseFloat(salaries[i].value) || 0,
          startMonth: parseInt(months[i].value) || 1
        });
      }
      return plan;
    }

    function calculateRunway() {
      const cash = parseFloat(document.getElementById('rw-cash').value) || 0;
      const revenue = parseFloat(document.getElementById('rw-revenue').value) || 0;
      let growthPct = parseFloat(document.getElementById('rw-growth').value) || 0;
      const fixed = parseFloat(document.getElementById('rw-fixed').value) || 0;
      const variable = parseFloat(document.getElementById('rw-variable').value) || 0;
      const onetime = parseFloat(document.getElementById('rw-onetime').value) || 0;
      const hiring = parseFloat(document.getElementById('rw-hiring').value) || 0;
      const hiringPlan = getHiringPlan();

      let scenarioLabel = 'Base Case Scenario';
      let effectiveGrowth = growthPct;
      if (runwayScenario === 'conservative') { effectiveGrowth = 0; scenarioLabel = 'Conservative Scenario (No Growth)'; }
      if (runwayScenario === 'aggressive') { effectiveGrowth = growthPct * 2; scenarioLabel = 'Aggressive Scenario (' + (growthPct * 2) + '% Growth)'; }

      document.getElementById('rw-scenario-label').textContent = scenarioLabel;

      const totalCosts = fixed + variable;
      const burnRate = totalCosts - revenue;
      document.getElementById('rw-burn').textContent = fmtFull(burnRate);

      const maxMonths = 60;
      let balances = [];
      let flatRunway = 0;
      let growthRunway = 0;
      let breakEvenMonth = null;
      let hitZeroGrowth = false;

      // Flat runway (no growth)
      let flatBal = cash - onetime;
      for (let m = 1; m <= maxMonths; m++) {
        let flatCosts = totalCosts + (hiring * m);
        flatBal -= (flatCosts - revenue);
        if (flatBal <= 0) { flatRunway = m; break; }
        if (m === maxMonths) flatRunway = maxMonths;
      }

      // Growth runway
      let bal = cash - onetime;
      let rev = revenue;
      for (let m = 1; m <= maxMonths; m++) {
        rev = rev * (1 + effectiveGrowth / 100);
        let hiringCost = 0;
        hiringPlan.forEach(h => { if (m >= h.startMonth) hiringCost += h.salary; });
        let costs = totalCosts + (hiring * m) + hiringCost;
        bal -= (costs - rev);
        balances.push({ month: m, balance: bal, revenue: rev, costs: costs });
        if (!breakEvenMonth && rev >= costs) breakEvenMonth = m;
        if (!hitZeroGrowth && bal <= 0) { growthRunway = m; hitZeroGrowth = true; }
      }
      if (!hitZeroGrowth) growthRunway = maxMonths;

      document.getElementById('rw-runway-flat').textContent = flatRunway >= maxMonths ? '60+ months' : flatRunway + ' months';
      document.getElementById('rw-runway-growth').textContent = growthRunway >= maxMonths ? '60+ months' : growthRunway + ' months';

      const now = new Date();
      if (growthRunway < maxMonths) {
        const zeroDate = new Date(now.getFullYear(), now.getMonth() + growthRunway, 1);
        document.getElementById('rw-zero-date').textContent = zeroDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      } else {
        document.getElementById('rw-zero-date').textContent = 'N/A (sustainable)';
      }

      const rw = growthRunway;
      const safeEl = document.getElementById('rw-safe-zone');
      const safeText = document.getElementById('rw-safe-text');
      var safeLabel;
      if (rw > 12 || rw >= maxMonths) {
        safeLabel = '\u{1F7E2} Safe Zone';
        safeEl.style.borderColor = 'rgba(16, 185, 129, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.03))';
      } else if (rw >= 6) {
        safeLabel = '\u{1F7E1} Caution';
        safeEl.style.borderColor = 'rgba(245, 158, 11, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.03))';
      } else {
        safeLabel = '\u{1F534} Danger';
        safeEl.style.borderColor = 'rgba(239, 68, 68, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.03))';
      }
      // Render gauge for safety zone (0-24 months mapped to 0-100)
      var gaugeVal = Math.min(rw, 24) / 24 * 100;
      safeText.innerHTML = safeLabel + '<div id="rw-gauge" style="margin-top:0.5rem;display:flex;justify-content:center;"></div>';
      renderGauge('rw-gauge', gaugeVal, [
        { from: 0, to: 25, color: '#ef4444' },
        { from: 25, to: 50, color: '#f59e0b' },
        { from: 50, to: 100, color: '#10b981' }
      ], rw >= maxMonths ? '60+ mo' : rw + ' mo', 140);

      document.getElementById('rw-breakeven').textContent = breakEvenMonth ? 'Month ' + breakEvenMonth : 'Not within 60 months';

      // Chart
      const chart = document.getElementById('rw-chart');
      const maxBal = Math.max(...balances.map(b => Math.abs(b.balance)), 1);
      const months = Math.min(balances.length, 36);
      let html = '';
      for (let i = 0; i < months; i++) {
        const b = balances[i];
        const pct = Math.min(Math.abs(b.balance) / maxBal * 100, 100);
        const isNeg = b.balance < 0;
        const isBE = breakEvenMonth && i + 1 === breakEvenMonth;
        let color = isNeg ? 'var(--brand-danger)' : (isBE ? 'var(--brand-success)' : 'linear-gradient(to top, var(--brand-primary), var(--brand-accent))');
        const title = 'Month ' + (i + 1) + ': ' + fmtFull(b.balance);
        html += '<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%;position:relative;" title="' + title + '">';
        html += '<div style="width:100%;height:' + Math.max(pct, 2) + '%;background:' + color + ';border-radius:3px 3px 0 0;min-height:2px;transition:height 0.5s ease;"></div>';
        if (i % 6 === 0 || i === months - 1) html += '<span style="font-size:0.55rem;color:var(--text-muted);position:absolute;bottom:-18px;">M' + (i + 1) + '</span>';
        html += '</div>';
      }
      chart.innerHTML = html;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  NET WORTH TRACKER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function nwVal(id) { return parseFloat(document.getElementById(id).value) || 0; }

    function calculateNetWorth() {
      const assets = {
        'Cash & Savings': nwVal('nw-cash'),
        'TFSA': nwVal('nw-tfsa'),
        'RRSP': nwVal('nw-rrsp'),
        'Non-Registered': nwVal('nw-nonreg'),
        'Real Estate': nwVal('nw-realestate'),
        'Vehicles': nwVal('nw-vehicles'),
        'Other Assets': nwVal('nw-other-assets'),
      };
      const liabilities = {
        'Mortgage': nwVal('nw-mortgage'),
        'Car Loans': nwVal('nw-carloans'),
        'Student Loans': nwVal('nw-student'),
        'Credit Cards': nwVal('nw-cc'),
        'Line of Credit': nwVal('nw-loc'),
        'Other Debt': nwVal('nw-other-debt'),
      };

      const totalAssets = Object.values(assets).reduce((a, b) => a + b, 0);
      const totalLiabilities = Object.values(liabilities).reduce((a, b) => a + b, 0);
      const netWorth = totalAssets - totalLiabilities;
      const liquidNW = totalAssets - assets['Real Estate'] - assets['Vehicles'] - totalLiabilities;

      document.getElementById('nw-total-assets').textContent = fmtFull(totalAssets);
      document.getElementById('nw-total-liabilities').textContent = fmtFull(totalLiabilities);
      document.getElementById('nw-networth').textContent = fmtFull(netWorth);
      document.getElementById('nw-liquid').textContent = fmtFull(liquidNW);

      // Debt-to-asset ratio
      const dtaEl = document.getElementById('nw-dta');
      if (totalAssets > 0) {
        const dta = (totalLiabilities / totalAssets * 100);
        let pillClass = dta > 80 ? 'negative' : dta > 50 ? 'neutral' : 'positive';
        let icon = dta > 80 ? '\u{1F534}' : dta > 50 ? '\u{1F7E1}' : '\u{1F7E2}';
        dtaEl.innerHTML = '<span class="metric-pill ' + pillClass + '">' + icon + ' Debt-to-Asset: ' + dta.toFixed(1) + '%</span>';
      } else {
        dtaEl.innerHTML = '';
      }

      // SVG Donut Chart for asset allocation
      const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];
      const assetEntries = Object.entries(assets).filter(function(e) { return e[1] > 0; });
      if (totalAssets > 0 && assetEntries.length > 0) {
        var donutSegments = assetEntries.map(function(entry, i) {
          return { label: entry[0], value: entry[1], color: colors[i % colors.length] };
        });
        renderDonutChart('nw-pie', donutSegments, 150);
        document.getElementById('nw-pie-legend').innerHTML = assetEntries.map(function(entry, i) {
          var pct = (entry[1] / totalAssets * 100).toFixed(0);
          return '<div style="display:flex;align-items:center;gap:6px;"><span style="width:10px;height:10px;border-radius:2px;background:' + colors[i % colors.length] + ';flex-shrink:0;"></span>' + entry[0] + ' <span class="mono" style="color:var(--text-muted);">' + pct + '%</span></div>';
        }).join('');
      } else {
        document.getElementById('nw-pie').innerHTML = '<div style="width:150px;height:150px;border-radius:50%;background:var(--border-primary);"></div>';
        document.getElementById('nw-pie-legend').innerHTML = '<span style="color:var(--text-muted);">Enter assets to see allocation</span>';
      }

      // Gauge for Debt-to-Asset ratio
      if (totalAssets > 0) {
        var dtaVal = totalLiabilities / totalAssets * 100;
        var dtaContainer = document.getElementById('nw-dta');
        dtaContainer.innerHTML = '<div id="nw-dta-gauge"></div>';
        renderGauge('nw-dta-gauge', Math.min(dtaVal, 100), [
          { from: 0, to: 33, color: '#10b981' },
          { from: 33, to: 66, color: '#f59e0b' },
          { from: 66, to: 100, color: '#ef4444' }
        ], 'D/A: ' + dtaVal.toFixed(1) + '%', 160);
      }
    }

    function saveNetWorthSnapshot() {
      const snap = {
        date: new Date().toISOString(),
        assets: nwVal('nw-cash') + nwVal('nw-tfsa') + nwVal('nw-rrsp') + nwVal('nw-nonreg') + nwVal('nw-realestate') + nwVal('nw-vehicles') + nwVal('nw-other-assets'),
        liabilities: nwVal('nw-mortgage') + nwVal('nw-carloans') + nwVal('nw-student') + nwVal('nw-cc') + nwVal('nw-loc') + nwVal('nw-other-debt'),
      };
      snap.netWorth = snap.assets - snap.liabilities;
      const snaps = JSON.parse(localStorage.getItem('nw-snapshots') || '[]');
      snaps.push(snap);
      localStorage.setItem('nw-snapshots', JSON.stringify(snaps));
      loadNetWorthSnapshots();
    }

    function loadNetWorthSnapshots() {
      const snaps = JSON.parse(localStorage.getItem('nw-snapshots') || '[]');
      const el = document.getElementById('nw-snapshots');
      if (snaps.length === 0) {
        el.innerHTML = '<p style="color:var(--text-muted);font-size:0.8rem;">No snapshots yet. Save one to start tracking.</p>';
        return;
      }
      let html = '<div style="display:flex;flex-direction:column;gap:0.5rem;">';
      snaps.slice().reverse().forEach(function(s) {
        const d = new Date(s.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        const nwColor = s.netWorth >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)';
        html += '<div style="display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0.75rem;background:var(--bg-secondary);border-radius:var(--radius-sm);border:1px solid var(--border-primary);">';
        html += '<span style="color:var(--text-secondary);">' + d + '</span>';
        html += '<span class="mono" style="font-weight:600;color:' + nwColor + ';">' + fmtFull(s.netWorth) + '</span>';
        html += '</div>';
      });
      html += '</div>';
      html += '<button class="btn btn-ghost btn-sm" style="margin-top:0.75rem;color:var(--brand-danger);font-size:0.72rem;" onclick="if(confirm(\'Clear all snapshots?\')){localStorage.removeItem(\'nw-snapshots\');loadNetWorthSnapshots();}">Clear All Snapshots</button>';
      el.innerHTML = html;

      // Trend chart
      const trendEl = document.getElementById('nw-trend-chart');
      if (trendEl && snaps.length >= 2) {
        const trendData = snaps.map(s => ({
          label: new Date(s.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
          bottom: 0,
          top: s.netWorth
        }));
        const maxNW = Math.max(...snaps.map(s => Math.abs(s.netWorth)), 1);
        trendEl.innerHTML = '<div style="display:flex;align-items:flex-end;gap:4px;height:150px;">' +
          snaps.map(s => {
            const h = Math.max(2, Math.abs(s.netWorth) / maxNW * 140);
            const color = s.netWorth >= 0 ? 'linear-gradient(to top,var(--brand-primary),var(--brand-accent))' : 'var(--brand-danger)';
            return '<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%;"><div style="font-size:0.55rem;color:var(--text-muted);margin-bottom:2px;">' + fmtFull(s.netWorth) + '</div><div style="width:100%;height:' + h + 'px;background:' + color + ';border-radius:3px 3px 0 0;"></div></div>';
          }).join('') + '</div>' +
          '<div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text-muted);margin-top:0.25rem;">' +
          '<span>' + new Date(snaps[0].date).toLocaleDateString('en-US',{month:'short',day:'numeric'}) + '</span>' +
          '<span>' + new Date(snaps[snaps.length-1].date).toLocaleDateString('en-US',{month:'short',day:'numeric'}) + '</span></div>';
      } else if (trendEl) {
        trendEl.innerHTML = '<p style="color:var(--text-muted);font-size:0.8rem;">Save 2+ snapshots to see trend</p>';
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  NEWSLETTER SIGNUP
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function subscribeNewsletter() {
      const input = document.getElementById('newsletter-email');
      const email = input.value.trim();
      if (!email || !email.includes('@') || !email.includes('.')) {
        input.style.borderColor = 'var(--brand-danger)';
        setTimeout(function() { input.style.borderColor = ''; }, 2000);
        return;
      }
      const subs = JSON.parse(localStorage.getItem('bb-newsletter') || '[]');
      if (!subs.includes(email)) { subs.push(email); localStorage.setItem('bb-newsletter', JSON.stringify(subs)); }
      input.value = '';
      // Show toast
      const toast = document.createElement('div');
      toast.className = 'toast-success';
      toast.innerHTML = '‚úÖ You\'re subscribed! Welcome aboard.';
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 3500);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  COOKIE CONSENT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    (function() {
      if (localStorage.getItem('bb-cookie-consent')) return;
      var banner = document.createElement('div');
      banner.className = 'cookie-banner';
      banner.innerHTML = '<span>üç™ We use cookies to improve your experience.</span><div class="cookie-banner-btns"><button class="btn btn-primary btn-sm" onclick="acceptCookies(true)">Accept</button><button class="btn btn-secondary btn-sm" onclick="acceptCookies(false)">Decline</button></div>';
      document.body.appendChild(banner);
    })();
    function acceptCookies(accepted) {
      localStorage.setItem('bb-cookie-consent', accepted ? 'accepted' : 'declined');
      var b = document.querySelector('.cookie-banner');
      if (b) b.remove();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MICRO-INTERACTIONS v1.6
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // 1. Smooth Number Animations
    function animateValue(element, start, end, duration) {
      if (!element || duration <= 0) { element.textContent = end; return; }
      const startTime = performance.now();
      const isFormatted = typeof end === 'string';
      const endNum = isFormatted ? parseFloat(end.replace(/[^0-9.\-]/g, '')) : end;
      const startNum = isFormatted ? parseFloat(start.toString().replace(/[^0-9.\-]/g, '')) || 0 : (start || 0);
      if (isNaN(endNum)) { element.textContent = end; return; }
      const prefix = isFormatted ? (end.match(/^[^0-9.\-]*/)||[''])[0] : '';
      const suffix = isFormatted ? (end.match(/[^0-9.\-]*$/)||[''])[0] : '';
      const hasDecimal = isFormatted && end.includes('.');
      const decimals = hasDecimal ? (end.split('.')[1] || '').replace(/[^0-9]/g, '').length : 0;

      function tick(now) {
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
        const current = startNum + (endNum - startNum) * eased;
        if (isFormatted) {
          element.textContent = prefix + current.toLocaleString('en-US', {minimumFractionDigits: decimals, maximumFractionDigits: decimals}) + suffix;
        } else {
          element.textContent = Math.round(current);
        }
        if (progress < 1) requestAnimationFrame(tick);
        else element.textContent = end; // ensure exact final value
      }
      requestAnimationFrame(tick);
    }

    // Observe .result-value changes and animate them
    (function() {
      const resultObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(m) {
          if (m.type === 'childList' || m.type === 'characterData') {
            const el = m.target.nodeType === 1 ? m.target : m.target.parentElement;
            if (!el || !el.classList || !el.classList.contains('result-value')) return;
            const newVal = el.textContent;
            const oldVal = el.getAttribute('data-prev') || '0';
            if (newVal !== oldVal && !el._animating) {
              el._animating = true;
              el.setAttribute('data-prev', newVal);
              animateValue(el, oldVal, newVal, 600);
              setTimeout(function() { el._animating = false; }, 650);
            }
          }
        });
      });
      // Observe the whole body for result-value text changes
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.result-value').forEach(function(el) {
          el.setAttribute('data-prev', el.textContent);
        });
      });
      // Use a simpler approach: patch innerHTML setters on result containers
      const origShowPage = window.showPage;
      // We'll hook into calculator functions instead via a post-render observer
      setInterval(function() {
        document.querySelectorAll('.result-value').forEach(function(el) {
          if (!el.hasAttribute('data-prev')) el.setAttribute('data-prev', el.textContent);
        });
      }, 200);
    })();

    // 2. Input Ripple Effect
    document.addEventListener('click', function(e) {
      const input = e.target.closest('.input-group input, .input-group select');
      if (!input) return;
      const group = input.closest('.input-group');
      if (!group) return;
      const ripple = document.createElement('div');
      ripple.className = 'input-ripple';
      const rect = input.getBoundingClientRect();
      const grect = group.getBoundingClientRect();
      const size = 30;
      ripple.style.width = size + 'px';
      ripple.style.height = size + 'px';
      ripple.style.left = (e.clientX - grect.left - size/2) + 'px';
      ripple.style.top = (e.clientY - grect.top - size/2) + 'px';
      group.appendChild(ripple);
      setTimeout(function() { ripple.remove(); }, 600);
    });

    // 3. Page Transition (fade-out / fade-in)
    (function() {
      const origShowPage = window.showPage;
      window.showPage = function(pageId) {
        const currentPage = document.querySelector('.page.active');
        const targetPage = document.getElementById('page-' + pageId);
        if (!targetPage || currentPage === targetPage) {
          origShowPage(pageId);
          return;
        }
        if (currentPage) {
          currentPage.classList.add('fade-out');
          setTimeout(function() {
            currentPage.classList.remove('active', 'fade-out');
            targetPage.classList.add('active', 'fade-in');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            setTimeout(function() { targetPage.classList.remove('fade-in'); }, 250);
            // Close mobile menu & init calculators
            document.getElementById('nav-links').classList.remove('mobile-open');
            if (pageId === 'valuation') calculateDCF();
            if (pageId === 'mortgage') calculateMortgage();
            if (pageId === 'investment') calculateCAGR();
            if (pageId === 'retirement') calculateRetirement();
            if (pageId === 'compound') calculateCompound();
            if (pageId === 'runway') calculateRunway();
            if (pageId === 'networth') { calculateNetWorth(); loadNetWorthSnapshots(); }
          }, 150);
        } else {
          origShowPage(pageId);
        }
      };
    })();

    // 4. Parallax Hero Blobs
    (function() {
      let ticking = false;
      const blobs = document.querySelectorAll('.hero-blob');
      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            const scrollY = window.scrollY;
            blobs.forEach(function(blob, i) {
              const speed = (i + 1) * 0.05;
              blob.style.transform = 'translateY(' + (scrollY * speed * -1) + 'px)';
            });
            ticking = false;
          });
          ticking = true;
        }
      });
    })();

    // 5. Chart Bar Tooltips ‚Äî handled via CSS class .chart-bar-tooltip + data-tooltip attr
    // The chart rendering functions already use title attrs; we enhance them with CSS tooltips
    // by adding a MutationObserver that converts title attrs on chart bars to our tooltip class
    (function() {
      function enhanceChartBars() {
        document.querySelectorAll('[title]').forEach(function(el) {
          if (el.closest('.chart-container, #rw-chart, #dca-chart, #compound-chart, #dcf-chart')) {
            if (!el.classList.contains('chart-bar-tooltip')) {
              el.classList.add('chart-bar-tooltip');
              el.setAttribute('data-tooltip', el.getAttribute('title'));
              el.removeAttribute('title');
            }
          }
        });
      }
      setInterval(enhanceChartBars, 500);
    })();

    // 6. Loading Skeleton
    (function() {
      const origShowPage2 = window.showPage;
      window.showPage = (function(prev) {
        return function(pageId) {
          prev(pageId);
          if (pageId === 'home') return;
          const page = document.getElementById('page-' + pageId);
          if (!page) return;
          const results = page.querySelectorAll('.calc-results');
          results.forEach(function(r) {
            if (r._skeletonShown) return;
            r._skeletonShown = true;
            r.style.position = 'relative';
            const skel = document.createElement('div');
            skel.className = 'skeleton-overlay';
            skel.innerHTML = '<div class="skeleton-line tall"></div><div class="skeleton-line medium"></div><div class="skeleton-line"></div><div class="skeleton-line short"></div>';
            r.appendChild(skel);
            setTimeout(function() {
              skel.style.transition = 'opacity 0.2s ease';
              skel.style.opacity = '0';
              setTimeout(function() { skel.remove(); r._skeletonShown = false; }, 200);
            }, 300);
          });
        };
      })(window.showPage);
    })();

    // 7. Scroll Progress Bar
    (function() {
      const bar = document.getElementById('scroll-progress');
      let ticking = false;
      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const pct = scrollHeight > 0 ? (scrollTop / scrollHeight * 100) : 0;
            bar.style.width = pct + '%';
            ticking = false;
          });
          ticking = true;
        }
      });
    })();

    // 8. Easter Egg ‚Äî type "calcstack" anywhere
    (function() {
      let buffer = '';
      const secret = 'figgybank';
      document.addEventListener('keypress', function(e) {
        buffer += e.key.toLowerCase();
        if (buffer.length > secret.length) buffer = buffer.slice(-secret.length);
        if (buffer === secret) {
          buffer = '';
          triggerConfetti();
        }
      });

      function triggerConfetti() {
        const container = document.createElement('div');
        container.className = 'confetti-container';
        document.body.appendChild(container);
        const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#f97316'];
        for (let i = 0; i < 80; i++) {
          const piece = document.createElement('div');
          piece.className = 'confetti-piece';
          piece.style.left = Math.random() * 100 + 'vw';
          piece.style.background = colors[Math.floor(Math.random() * colors.length)];
          piece.style.animationDelay = (Math.random() * 1.5) + 's';
          piece.style.animationDuration = (2 + Math.random() * 2) + 's';
          piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
          piece.style.width = (5 + Math.random() * 8) + 'px';
          piece.style.height = (5 + Math.random() * 8) + 'px';
          container.appendChild(piece);
        }
        setTimeout(function() { container.remove(); }, 5000);
      }
    })();


    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SALARY & COMPENSATION ANALYZER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateSalary() {
      const base = parseFloat(document.getElementById('sal-base').value) || 0;
      const bonusPct = parseFloat(document.getElementById('sal-bonus-pct').value) || 0;
      const shares = parseFloat(document.getElementById('sal-shares').value) || 0;
      const strike = parseFloat(document.getElementById('sal-strike').value) || 0;
      const currentPrice = parseFloat(document.getElementById('sal-current-price').value) || 0;
      const vesting = parseFloat(document.getElementById('sal-vesting').value) || 4;
      const health = parseFloat(document.getElementById('sal-health').value) || 0;
      const pension = parseFloat(document.getElementById('sal-pension').value) || 0;
      const province = document.getElementById('sal-province').value;

      const bonus = base * (bonusPct / 100);
      const intrinsicPerShare = Math.max(0, currentPrice - strike);
      const totalEquity = shares * intrinsicPerShare;
      const annualEquity = totalEquity / vesting;
      const benefits = health + pension;
      const totalComp = base + bonus + annualEquity + benefits;

      // Simplified Canadian marginal tax rates (combined federal + provincial, 2024 approx)
      const taxRates = {
        ON: [[ 55867, 0.2005], [111733, 0.2965], [154906, 0.3148], [220000, 0.3389], [Infinity, 0.5353]],
        BC: [[ 45654, 0.2006], [ 91310, 0.2272], [104835, 0.2950], [127299, 0.3148], [172602, 0.3267], [240716, 0.4070], [Infinity, 0.5350]],
        AB: [[ 55867, 0.2500], [111733, 0.3050], [154906, 0.3600], [208000, 0.4200], [Infinity, 0.4800]],
        QC: [[ 49275, 0.2753], [ 55867, 0.3253], [ 98540, 0.3802], [111733, 0.4397], [154906, 0.4797], [Infinity, 0.5331]],
        MB: [[ 36842, 0.2580], [ 55867, 0.2775], [ 79625, 0.3340], [111733, 0.3783], [154906, 0.4340], [Infinity, 0.5040]],
        SK: [[ 49720, 0.2550], [ 55867, 0.2775], [111733, 0.3577], [142058, 0.3577], [Infinity, 0.4477]],
        NS: [[ 29590, 0.2379], [ 55867, 0.2995], [ 59180, 0.3495], [ 93000, 0.3695], [111733, 0.4295], [150000, 0.4595], [Infinity, 0.5400]],
        NB: [[ 47715, 0.2440], [ 55867, 0.2682], [ 95524, 0.3182], [111733, 0.3552], [154906, 0.3952], [176756, 0.4352], [Infinity, 0.5302]],
        NL: [[ 41457, 0.2350], [ 55867, 0.2850], [ 82913, 0.3150], [111733, 0.3350], [148027, 0.3850], [154906, 0.4350], [207239, 0.4580], [Infinity, 0.5180]],
        PE: [[ 31984, 0.2480], [ 55867, 0.2880], [ 63969, 0.3330], [111733, 0.3530], [140000, 0.3730], [154906, 0.4430], [Infinity, 0.5130]]
      };

      const brackets = taxRates[province] || taxRates['ON'];
      const taxableIncome = base + bonus; // equity/benefits not directly taxed this way
      let tax = 0, prev = 0;
      for (const [limit, rate] of brackets) {
        if (taxableIncome <= prev) break;
        const taxable = Math.min(taxableIncome, limit) - prev;
        tax += taxable * rate;
        prev = limit;
      }

      // CPP contributions (2025 rates)
      const cppExemption = 3500;
      const cppMax1 = 68500; // YMPE
      const cppRate1 = 0.0595;
      const cppMax2 = 73200; // YAMPE (CPP2)
      const cppRate2 = 0.04;
      const cpp1 = Math.max(0, Math.min(taxableIncome, cppMax1) - cppExemption) * cppRate1;
      const cpp2 = taxableIncome > cppMax1 ? Math.max(0, Math.min(taxableIncome, cppMax2) - cppMax1) * cppRate2 : 0;
      const totalCPP = Math.min(cpp1, 3867.50) + Math.min(cpp2, 188);

      // EI contributions (2025 rates)
      const eiMax = 65700;
      const eiRate = province === 'QC' ? 0.01312 : 0.01660; // Quebec has lower EI
      const totalEI = Math.min(taxableIncome * eiRate, province === 'QC' ? 862.62 : 1077.48);

      // QPP for Quebec (replaces CPP with slightly different rates)
      const totalDeductions = tax + totalCPP + totalEI;
      const takeHome = taxableIncome - totalDeductions + annualEquity + benefits;
      const effTaxRate = taxableIncome > 0 ? (totalDeductions / taxableIncome) * 100 : 0;
      const hourly = totalComp / 2080;

      document.getElementById('sal-total-comp').textContent = fmtFull(totalComp);
      document.getElementById('sal-take-home').textContent = fmtFull(takeHome);
      document.getElementById('sal-eff-tax').textContent = fmtPct(effTaxRate);
      document.getElementById('sal-hourly').textContent = '$' + hourly.toFixed(2);
      document.getElementById('sal-equity-val').textContent = fmtFull(annualEquity);
      document.getElementById('sal-bonus-val').textContent = fmtFull(bonus);

      // Deduction breakdown
      document.getElementById('sal-income-tax').textContent = fmtFull(tax);
      document.getElementById('sal-cpp').textContent = fmtFull(totalCPP);
      document.getElementById('sal-ei').textContent = fmtFull(totalEI);
      document.getElementById('sal-total-ded').textContent = fmtFull(totalDeductions);

      // Pie chart
      const parts = [
        { label: 'Base Salary', value: base, color: '#14b8a6' },
        { label: 'Bonus', value: bonus, color: '#f59e0b' },
        { label: 'Equity', value: annualEquity, color: '#8b5cf6' },
        { label: 'Benefits', value: benefits, color: '#3b82f6' }
      ].filter(p => p.value > 0);

      const total = parts.reduce((s, p) => s + p.value, 0);
      let gradParts = [], cumPct = 0;
      parts.forEach(p => {
        const pct = (p.value / total) * 100;
        gradParts.push(`${p.color} ${cumPct}% ${cumPct + pct}%`);
        cumPct += pct;
      });
      // SVG Donut Chart for salary breakdown
      if (total > 0) {
        var salDonutSegs = parts.map(function(p) { return { label: p.label, value: p.value, color: p.color }; });
        renderDonutChart('sal-pie', salDonutSegs, 150);
      } else {
        document.getElementById('sal-pie').innerHTML = '<div style="width:150px;height:150px;border-radius:50%;background:var(--border-primary);"></div>';
      }
      document.getElementById('sal-pie-legend').innerHTML = parts.map(p =>
        `<div style="display:flex;align-items:center;gap:0.5rem;"><span style="width:10px;height:10px;border-radius:50%;background:${p.color};display:inline-block;"></span>${p.label}: ${fmtFull(p.value)} (${((p.value/total)*100).toFixed(0)}%)</div>`
      ).join('');

      // Comparison
      const canadianMedian = 55000;
      const techMedian = 95000;
      const compEl = document.getElementById('sal-comparison');
      const bar = (label, val, max) => {
        const pct = Math.min(100, (val / max) * 100);
        return `<div style="margin-bottom:0.75rem;">
          <div style="display:flex;justify-content:space-between;margin-bottom:0.25rem;"><span>${label}</span><span>${fmtFull(val)}</span></div>
          <div style="height:8px;background:var(--border-primary);border-radius:4px;overflow:hidden;">
            <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#14b8a6,#0d9488);border-radius:4px;transition:width 0.5s;"></div>
          </div>
        </div>`;
      };
      const maxVal = Math.max(totalComp, canadianMedian, techMedian) * 1.1;
      compEl.innerHTML = bar('Your Total Comp', totalComp, maxVal)
        + bar('Canadian Median', canadianMedian, maxVal)
        + bar('Tech Median', techMedian, maxVal)
        + `<div style="margin-top:0.5rem;font-size:0.8rem;color:var(--text-secondary);">You earn <strong>${totalComp > canadianMedian ? ((totalComp/canadianMedian - 1)*100).toFixed(0) + '% more' : ((1 - totalComp/canadianMedian)*100).toFixed(0) + '% less'}</strong> than the Canadian median</div>`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DEBT PAYOFF CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let debtStrategy = 'avalanche';

    function setDebtStrategy(s) {
      debtStrategy = s;
      document.getElementById('debt-btn-avalanche').className = s === 'avalanche' ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm';
      document.getElementById('debt-btn-snowball').className = s === 'snowball' ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm';
      document.getElementById('debt-strategy-help').textContent = s === 'avalanche'
        ? 'Highest interest rate first ‚Äî saves the most money'
        : 'Lowest balance first ‚Äî quick wins for motivation';
      calculateDebt();
    }

    function addDebtRow() {
      const container = document.getElementById('debt-rows');
      const row = document.createElement('div');
      row.className = 'debt-row';
      row.style.cssText = 'display:grid;grid-template-columns:2fr 1.5fr 1fr 1.5fr auto;gap:0.5rem;align-items:end;margin-bottom:0.5rem;';
      row.innerHTML = `
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="New Debt" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="5000" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="12" step="0.01" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="150" oninput="calculateDebt()" /></div>
        <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">‚úï</button>`;
      container.appendChild(row);
      calculateDebt();
    }

    function removeDebtRow(btn) {
      const rows = document.querySelectorAll('#debt-rows .debt-row');
      if (rows.length <= 1) return;
      btn.closest('.debt-row').remove();
      calculateDebt();
    }

    function getDebts() {
      const rows = document.querySelectorAll('#debt-rows .debt-row');
      return Array.from(rows).map(row => {
        const inputs = row.querySelectorAll('input');
        return {
          name: inputs[0].value || 'Debt',
          balance: parseFloat(inputs[1].value) || 0,
          rate: parseFloat(inputs[2].value) || 0,
          minPayment: parseFloat(inputs[3].value) || 0
        };
      }).filter(d => d.balance > 0);
    }

    function simulatePayoff(debts, extraMonthly, strategy) {
      let balances = debts.map(d => ({ ...d }));
      let totalInterest = 0;
      let months = 0;
      const maxMonths = 600; // 50 year cap
      const timeline = [{ month: 0, total: balances.reduce((s, d) => s + d.balance, 0) }];

      while (balances.some(d => d.balance > 0.01) && months < maxMonths) {
        months++;
        let extraLeft = extraMonthly;

        // Apply interest
        balances.forEach(d => {
          if (d.balance > 0) {
            const interest = d.balance * (d.rate / 100 / 12);
            d.balance += interest;
            totalInterest += interest;
          }
        });

        // Make minimum payments
        balances.forEach(d => {
          if (d.balance > 0) {
            const payment = Math.min(d.balance, d.minPayment);
            d.balance -= payment;
          }
        });

        // Sort for strategy and apply extra payment
        const sorted = balances.filter(d => d.balance > 0.01);
        if (strategy === 'avalanche') sorted.sort((a, b) => b.rate - a.rate);
        else sorted.sort((a, b) => a.balance - b.balance);

        for (const d of sorted) {
          if (extraLeft <= 0) break;
          const payment = Math.min(d.balance, extraLeft);
          d.balance -= payment;
          extraLeft -= payment;
        }

        timeline.push({ month: months, total: balances.reduce((s, d) => s + Math.max(0, d.balance), 0) });
      }

      return { totalInterest, months, timeline };
    }

    function calculateDebt() {
      const debts = getDebts();
      if (debts.length === 0) return;

      // Warn if any minimum payment doesn't cover monthly interest
      const warnings = debts.filter(d => d.minPayment < d.balance * (d.rate / 100 / 12));
      const warnEl = document.getElementById('debt-warnings');
      if (warnings.length > 0 && !document.getElementById('debt-warnings')) {
        const wDiv = document.createElement('div');
        wDiv.id = 'debt-warnings';
        wDiv.style.cssText = 'margin-top:0.75rem;padding:0.75rem;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius-sm);font-size:0.8rem;color:var(--brand-danger);';
        wDiv.innerHTML = '‚ö†Ô∏è <strong>' + warnings.map(w => w.name).join(', ') + '</strong>: minimum payment doesn\'t cover monthly interest ‚Äî balance will grow!';
        document.querySelector('#debt-rows').parentElement.appendChild(wDiv);
      } else if (warnEl && warnings.length === 0) {
        warnEl.remove();
      } else if (warnEl && warnings.length > 0) {
        warnEl.innerHTML = '‚ö†Ô∏è <strong>' + warnings.map(w => w.name).join(', ') + '</strong>: minimum payment doesn\'t cover monthly interest ‚Äî balance will grow!';
      }

      const extra = parseFloat(document.getElementById('debt-extra').value) || 0;
      const result = simulatePayoff(debts, extra, debtStrategy);
      const minOnly = simulatePayoff(debts, 0, debtStrategy);

      document.getElementById('debt-total-interest').textContent = fmtFull(result.totalInterest);
      document.getElementById('debt-months').textContent = result.months;

      const now = new Date();
      const freeDate = new Date(now.getFullYear(), now.getMonth() + result.months, 1);
      document.getElementById('debt-free-date').textContent = freeDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });

      const savings = minOnly.totalInterest - result.totalInterest;
      document.getElementById('debt-savings').textContent = fmtFull(Math.max(0, savings));

      const yrs = Math.floor(result.months / 12);
      const mos = result.months % 12;
      document.getElementById('debt-countdown').textContent = yrs > 0 ? `${yrs}y ${mos}m` : `${mos} months`;

      // Timeline chart (simple bar chart)
      const chart = document.getElementById('debt-timeline-chart');
      const tl = result.timeline;
      const maxBalance = tl[0].total || 1;
      const step = Math.max(1, Math.floor(tl.length / 30));
      const sampled = tl.filter((_, i) => i % step === 0 || i === tl.length - 1);

      chart.innerHTML = `
        <div style="display:flex;align-items:flex-end;gap:2px;height:200px;">
          ${sampled.map(p => {
            const h = Math.max(1, (p.total / maxBalance) * 100);
            return `<div title="Month ${p.month}: ${fmtFull(p.total)}" style="flex:1;height:${h}%;background:linear-gradient(to top,#ef4444,#f97316);border-radius:2px 2px 0 0;min-width:3px;transition:height 0.3s;cursor:pointer;"></div>`;
          }).join('')}
        </div>
        <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:var(--text-secondary);margin-top:0.5rem;">
          <span>Month 0</span><span>Month ${result.months}</span>
        </div>`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PDF EXPORT & COPY RESULTS (All Calculators)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function generatePDFReport(calcName) {
      const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      let assumptions = '';
      let resultsText = '';
      const gv = (id) => { const el = document.getElementById(id); return el ? (el.value || el.textContent || '') : ''; };
      const gvf = (id) => fmtFull(parseFloat(gv(id)) || 0);

      const calcMap = {
        'Business Valuation (DCF)': () => {
          assumptions = `<tr><td>Annual FCF</td><td>${gvf('dcf-fcf')}</td></tr><tr><td>Growth Rate</td><td>${gv('dcf-growth')}%</td></tr><tr><td>Terminal Growth</td><td>${gv('dcf-terminal')}%</td></tr><tr><td>WACC</td><td>${gv('dcf-wacc')}%</td></tr><tr><td>Years</td><td>${gv('dcf-years')}</td></tr><tr><td>Net Debt</td><td>${gvf('dcf-debt')}</td></tr>`;
          resultsText = (document.getElementById('dcf-results') || {}).innerText || '';
        },
        'Business Valuation (Multiples)': () => {
          assumptions = `<tr><td>Revenue</td><td>${gvf('mult-revenue')}</td></tr><tr><td>EBITDA</td><td>${gvf('mult-ebitda')}</td></tr><tr><td>Net Income</td><td>${gvf('mult-income')}</td></tr><tr><td>EV/Revenue</td><td>${gv('mult-ev-rev')}x</td></tr><tr><td>EV/EBITDA</td><td>${gv('mult-ev-ebitda')}x</td></tr><tr><td>P/E</td><td>${gv('mult-pe')}x</td></tr>`;
          resultsText = (document.getElementById('multiples-results') || {}).innerText || '';
        },
        'Business Valuation (Asset-Based)': () => {
          assumptions = `<tr><td>Cash</td><td>${gvf('asset-cash')}</td></tr><tr><td>A/R</td><td>${gvf('asset-ar')}</td></tr><tr><td>Inventory</td><td>${gvf('asset-inv')}</td></tr><tr><td>PP&E</td><td>${gvf('asset-ppe')}</td></tr><tr><td>A/P</td><td>${gvf('asset-ap')}</td></tr><tr><td>Debt</td><td>${gvf('asset-debt')}</td></tr>`;
          resultsText = (document.getElementById('asset-results') || {}).innerText || '';
        },
        'Canadian Mortgage Calculator': () => {
          assumptions = `<tr><td>Home Price</td><td>${gvf('mort-price')}</td></tr><tr><td>Down Payment</td><td>${gv('mort-down')}%</td></tr><tr><td>Rate</td><td>${gv('mort-rate')}%</td></tr><tr><td>Amortization</td><td>${gv('mort-amort')} yrs</td></tr>`;
          resultsText = (document.getElementById('mortgage-results') || {}).innerText || '';
        },
        'Investment Returns (CAGR)': () => {
          assumptions = `<tr><td>Initial</td><td>${gvf('cagr-initial')}</td></tr><tr><td>Final</td><td>${gvf('cagr-final')}</td></tr><tr><td>Period</td><td>${gv('cagr-years')} yrs</td></tr>`;
          resultsText = (document.getElementById('cagr-results') || {}).innerText || '';
        },
        'Investment Returns (DCA)': () => {
          assumptions = `<tr><td>Monthly</td><td>${gvf('dca-monthly')}</td></tr><tr><td>Return</td><td>${gv('dca-return')}%</td></tr><tr><td>Years</td><td>${gv('dca-years')}</td></tr><tr><td>Initial</td><td>${gvf('dca-initial')}</td></tr><tr><td>Inflation</td><td>${gv('dca-inflation')}%</td></tr>`;
          resultsText = (document.getElementById('dca-results') || {}).innerText || '';
        },
        'RRSP vs TFSA Optimizer': () => {
          assumptions = `<tr><td>Income</td><td>${gvf('ret-income')}</td></tr><tr><td>Contribution</td><td>${gvf('ret-contribution')}</td></tr><tr><td>Age</td><td>${gv('ret-age')}</td></tr><tr><td>Retire Age</td><td>${gv('ret-retire-age')}</td></tr><tr><td>Return</td><td>${gv('ret-return')}%</td></tr>`;
          resultsText = (document.getElementById('retirement-results') || {}).innerText || '';
        },
        'Compound Interest': () => {
          assumptions = `<tr><td>Initial</td><td>${gvf('comp-initial')}</td></tr><tr><td>Monthly</td><td>${gvf('comp-monthly')}</td></tr><tr><td>Rate</td><td>${gv('comp-rate')}%</td></tr><tr><td>Years</td><td>${gv('comp-years')}</td></tr>`;
          resultsText = (document.getElementById('compound-results') || {}).innerText || '';
        },
        'M&A Deal Analyzer': () => {
          assumptions = `<tr><td>Acquirer EPS</td><td>$${gv('ma-acq-eps')}</td></tr><tr><td>Target EPS</td><td>$${gv('ma-tgt-eps')}</td></tr><tr><td>Premium</td><td>${gv('ma-premium')}%</td></tr>`;
          resultsText = (document.getElementById('ma-results') || {}).innerText || '';
        },
        'Startup Runway': () => {
          assumptions = `<tr><td>Cash</td><td>${gvf('rw-cash')}</td></tr><tr><td>Revenue</td><td>${gvf('rw-revenue')}</td></tr><tr><td>Growth</td><td>${gv('rw-growth')}%</td></tr><tr><td>Fixed Costs</td><td>${gvf('rw-fixed')}</td></tr>`;
          resultsText = 'Burn Rate: ' + gv('rw-burn') + '\nRunway: ' + gv('rw-runway-growth') + '\nCash Zero: ' + gv('rw-zero-date');
        },
        'Net Worth Tracker': () => {
          assumptions = `<tr><td>Assets</td><td>${gv('nw-total-assets')}</td></tr><tr><td>Liabilities</td><td>${gv('nw-total-liabilities')}</td></tr>`;
          resultsText = 'Net Worth: ' + gv('nw-networth') + '\nLiquid: ' + gv('nw-liquid');
        }
      };

      if (calcMap[calcName]) calcMap[calcName]();

      const fullDate = new Date().toLocaleString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', timeZoneName: 'short' });
      const html = `<!DOCTYPE html><html><head><title>FiggyBank ‚Äî ${calcName}</title><style>
@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact}.no-print{display:none!important}@page{margin:1.5cm 2cm 2cm 2cm;}}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Segoe UI',system-ui,-apple-system,Arial,sans-serif;max-width:700px;margin:0 auto;padding:2.5rem 2rem;color:#1a1a2e;font-size:14px;line-height:1.6;}
.header{text-align:center;padding-bottom:1.5rem;margin-bottom:2rem;border-bottom:3px solid #6366f1;position:relative;}
.header::after{content:'';display:block;width:60px;height:3px;background:linear-gradient(90deg,#6366f1,#10b981);margin:0 auto;position:absolute;bottom:-3px;left:50%;transform:translateX(-50%);}
.header .logo{font-size:2rem;margin-bottom:0.25rem;}
.header h1{color:#6366f1;margin:0;font-size:1.6rem;font-weight:700;letter-spacing:-0.02em;}
.header .brand{font-size:0.85rem;color:#6366f1;margin-top:0.35rem;font-weight:600;letter-spacing:0.05em;text-transform:uppercase;}
.header .date{font-size:0.78rem;color:#999;margin-top:0.5rem;}
h2{color:#1a1a2e;font-size:1.05rem;font-weight:700;border-bottom:2px solid #e5e7eb;padding-bottom:0.5rem;margin:2rem 0 1rem;letter-spacing:-0.01em;}
h2 .icon{margin-right:0.4rem;}
table{width:100%;border-collapse:collapse;margin:0.75rem 0 1.5rem;}
tr:nth-child(even){background:#f9fafb;}
td{padding:0.6rem 0.85rem;border-bottom:1px solid #f0f0f5;font-size:0.88rem;}
td:first-child{color:#555;width:50%;}
td:last-child{font-weight:600;text-align:right;color:#1a1a2e;font-variant-numeric:tabular-nums;}
.results{background:linear-gradient(135deg,#f8f8ff,#f0f0ff);border:1px solid #e5e5f5;border-radius:10px;padding:1.75rem;margin:1rem 0 2rem;white-space:pre-line;font-size:0.88rem;line-height:1.9;}
.section-divider{height:1px;background:linear-gradient(90deg,transparent,#d1d5db,transparent);margin:1.5rem 0;}
.footer{margin-top:2.5rem;padding-top:1.25rem;border-top:2px solid #e5e7eb;text-align:center;}
.footer .disclaimer{font-size:0.7rem;color:#999;margin-bottom:0.75rem;line-height:1.5;}
.footer .branding{font-size:0.75rem;color:#6366f1;font-weight:600;}
.footer .branding a{color:#6366f1;text-decoration:none;}
.print-btn{display:block;margin:1.5rem auto 0;padding:0.75rem 2.5rem;background:linear-gradient(135deg,#6366f1,#4f46e5);color:white;border:none;border-radius:8px;font-size:0.95rem;cursor:pointer;font-weight:600;letter-spacing:0.02em;transition:transform 0.15s;}
.print-btn:hover{transform:scale(1.03);}
</style></head><body>
<div class="header">
<div class="logo">üßÆ</div>
<h1>${calcName}</h1>
<div class="brand">FiggyBank</div>
<div class="date">${fullDate}</div>
</div>
<h2><span class="icon">üìã</span>Input Assumptions</h2>
<table>${assumptions}</table>
<div class="section-divider"></div>
<h2><span class="icon">üìä</span>Results</h2>
<div class="results">${resultsText.replace(/\n/g, '<br>')}</div>
<div class="footer">
<div class="disclaimer"><strong>Disclaimer:</strong> This report is for informational and educational purposes only. It does not constitute financial, investment, tax, or legal advice. Consult a qualified professional before making financial decisions.</div>
<div class="branding">Generated by <a href="https://figgybank.ca">FiggyBank</a> ‚Äî figgybank.ca</div>
<div style="font-size:0.68rem;color:#bbb;margin-top:0.4rem;">¬© ${new Date().getFullYear()} FiggyBank. All rights reserved.</div>
</div>
<button class="print-btn no-print" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
</body></html>`;

      const w = window.open('', '_blank');
      w.document.write(html);
      w.document.close();
    }

    function copyResults(calcName) {
      let text = '\ud83d\udcca ' + calcName + ' \u2014 FiggyBank Report\n' + '\u2500'.repeat(40) + '\n';
      const resultIds = {
        'Business Valuation (DCF)': 'dcf-results',
        'Business Valuation (Multiples)': 'multiples-results',
        'Business Valuation (Asset-Based)': 'asset-results',
        'Canadian Mortgage Calculator': 'mortgage-results',
        'Investment Returns (CAGR)': 'cagr-results',
        'Investment Returns (DCA)': 'dca-results',
        'RRSP vs TFSA Optimizer': 'retirement-results',
        'Compound Interest': 'compound-results',
        'M&A Deal Analyzer': 'ma-results'
      };
      if (resultIds[calcName]) {
        const el = document.getElementById(resultIds[calcName]);
        if (el) text += el.innerText;
      } else if (calcName === 'Startup Runway') {
        text += 'Burn Rate: ' + document.getElementById('rw-burn').textContent + '\n';
        text += 'Runway: ' + document.getElementById('rw-runway-growth').textContent + '\n';
        text += 'Cash Zero: ' + document.getElementById('rw-zero-date').textContent + '\n';
      } else if (calcName === 'Net Worth Tracker') {
        text += 'Assets: ' + document.getElementById('nw-total-assets').textContent + '\n';
        text += 'Liabilities: ' + document.getElementById('nw-total-liabilities').textContent + '\n';
        text += 'Net Worth: ' + document.getElementById('nw-networth').textContent + '\n';
      }
      text += '\n' + '\u2500'.repeat(40) + '\nGenerated by FiggyBank \u00b7 figgybank.ca';
      navigator.clipboard.writeText(text).then(showCopyToast).catch(function() {
        const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showCopyToast();
      });
    }

    function showCopyToast() {
      const existing = document.querySelector('.copy-toast');
      if (existing) existing.remove();
      const toast = document.createElement('div');
      toast.className = 'toast-success copy-toast';
      toast.innerHTML = '\ud83d\udccb Results copied!';
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 2500);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  VALUATION COMPARISON CHART
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function updateValuationComparison() {
      const compare = document.getElementById('val-compare');
      const chart = document.getElementById('val-compare-chart');
      if (!compare || !chart) return;

      let values = [];

      // DCF value
      try {
        const fcf = parseFloat(document.getElementById('dcf-fcf').value) || 0;
        const growth = (parseFloat(document.getElementById('dcf-growth').value) || 0) / 100;
        const terminal = (parseFloat(document.getElementById('dcf-terminal').value) || 0) / 100;
        const wacc = (parseFloat(document.getElementById('dcf-wacc').value) || 0) / 100;
        const years = parseInt(document.getElementById('dcf-years').value) || 5;
        const debt = parseFloat(document.getElementById('dcf-debt').value) || 0;
        if (wacc > terminal && fcf > 0) {
          let pv = 0;
          for (let i = 1; i <= years; i++) pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
          const ff = fcf * Math.pow(1 + growth, years) * (1 + terminal);
          const tv = ff / (wacc - terminal);
          pv += tv / Math.pow(1 + wacc, years);
          values.push({ label: 'DCF', value: pv - debt, color: '#6366f1' });
        }
      } catch(e) {}

      // Multiples
      try {
        const rev = parseFloat(document.getElementById('mult-revenue').value) || 0;
        const ebitda = parseFloat(document.getElementById('mult-ebitda').value) || 0;
        const income = parseFloat(document.getElementById('mult-income').value) || 0;
        const evRev = parseFloat(document.getElementById('mult-ev-rev').value) || 0;
        const evEb = parseFloat(document.getElementById('mult-ev-ebitda').value) || 0;
        const pe = parseFloat(document.getElementById('mult-pe').value) || 0;
        const avg = (rev * evRev + ebitda * evEb + income * pe) / 3;
        if (avg > 0) values.push({ label: 'Multiples (Avg)', value: avg, color: '#8b5cf6' });
      } catch(e) {}

      // Asset
      try {
        const totalA = ['asset-cash','asset-ar','asset-inv','asset-ppe','asset-other'].reduce((s,id) => s + (parseFloat(document.getElementById(id).value)||0), 0);
        const totalL = ['asset-ap','asset-debt','asset-otherliab'].reduce((s,id) => s + (parseFloat(document.getElementById(id).value)||0), 0);
        const nav = totalA - totalL;
        if (nav !== 0) values.push({ label: 'Asset-Based (NAV)', value: nav, color: '#06b6d4' });
      } catch(e) {}

      if (values.length < 2) { compare.style.display = 'none'; return; }
      compare.style.display = 'block';

      const maxVal = Math.max(...values.map(v => Math.abs(v.value)));
      let html = '';
      values.forEach(v => {
        const pct = Math.abs(v.value) / maxVal * 100;
        html += '<div style="margin-bottom: 1rem;"><div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;"><span style="font-size: 0.85rem; font-weight: 600;">' + v.label + '</span><span class="mono" style="font-size: 0.85rem;">' + fmt(v.value) + '</span></div><div class="chart-bar"><div class="chart-bar-fill" style="width: ' + pct.toFixed(1) + '%; background: ' + v.color + ';"></div></div></div>';
      });

      const vals = values.map(v => v.value);
      const low = Math.min(...vals);
      const high = Math.max(...vals);
      const avg = vals.reduce((a,b) => a+b, 0) / vals.length;
      html += '<div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); border-top: 1px solid var(--border-primary); padding-top: 0.75rem; margin-top: 0.5rem;"><span>Low: ' + fmt(low) + '</span><span>Average: ' + fmt(avg) + '</span><span>High: ' + fmt(high) + '</span></div>';

      chart.innerHTML = html;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DEBOUNCE UTILITY (Performance)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function debounce(fn, ms) {
      let timer;
      return function() {
        const args = arguments, ctx = this;
        clearTimeout(timer);
        timer = setTimeout(function() { fn.apply(ctx, args); }, ms);
      };
    }

    // Debounce all slider inputs (50ms)
    (function() {
      const debouncedHandlers = new WeakMap();
      document.querySelectorAll('input[type="range"]').forEach(function(slider) {
        const origHandler = slider.getAttribute('oninput');
        if (origHandler) {
          const debouncedFn = debounce(function() {
            new Function(origHandler).call(slider);
          }, 50);
          // Keep display updates instant, debounce calculations
          slider.removeAttribute('oninput');
          slider.addEventListener('input', function() {
            // Update display value instantly (the span next to slider)
            const displayPart = origHandler.match(/document\.getElementById\([^)]+\)\.textContent\s*=\s*[^;]+/);
            if (displayPart) { try { new Function(displayPart[0]).call(slider); } catch(e){} }
            debouncedFn();
          });
        }
      });
    })();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  KEYBOARD SHORTCUTS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    (function() {
      const toolMap = {
        '1': 'valuation',
        '2': 'merger',
        '3': 'mortgage',
        '4': 'investment',
        '5': 'retirement',
        '6': 'compound',
        '7': 'runway',
        '8': 'networth',
        '9': 'lease',
        '0': 'tax'
      };

      document.addEventListener('keydown', function(e) {
        // Don't trigger when typing in inputs
        const tag = (e.target.tagName || '').toLowerCase();
        if (tag === 'input' || tag === 'textarea' || tag === 'select') return;

        const overlay = document.getElementById('shortcuts-overlay');

        if (e.key === '?') {
          e.preventDefault();
          overlay.classList.toggle('hidden');
          return;
        }

        if (e.key === 'Escape') {
          if (!overlay.classList.contains('hidden')) {
            overlay.classList.add('hidden');
          } else {
            showPage('home');
          }
          return;
        }

        if ((e.key === 'd' || e.key === 'D') && !e.ctrlKey && !e.metaKey) {
          toggleTheme();
          return;
        }

        if (toolMap[e.key]) {
          e.preventDefault();
          showPage(toolMap[e.key]);
        }
      });
    })();

    // ‚îÄ‚îÄ Global Calculation Counter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function incrementCalcCounter() {
      var count = parseInt(localStorage.getItem('figgybank-calc-count') || '0', 10) + 1;
      localStorage.setItem('figgybank-calc-count', count.toString());
      var el = document.getElementById('global-calc-counter');
      if (el) el.textContent = count.toLocaleString();
    }
    (function initCounter() {
      var count = parseInt(localStorage.getItem('figgybank-calc-count') || '0', 10);
      var el = document.getElementById('global-calc-counter');
      if (el) el.textContent = count > 0 ? count.toLocaleString() : '0';
    })();

    // ‚îÄ‚îÄ Side-by-Side Comparison ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calcMortgagePayment(principal, annualRate, amortYears) {
      // Canadian semi-annual compounding
      var semiRate = annualRate / 100 / 2;
      var monthlyRate = Math.pow(1 + semiRate, 1/6) - 1;
      var n = amortYears * 12;
      if (monthlyRate === 0) return { payment: principal / n, totalInterest: 0, totalCost: principal };
      var payment = principal * monthlyRate * Math.pow(1 + monthlyRate, n) / (Math.pow(1 + monthlyRate, n) - 1);
      var totalCost = payment * n;
      return { payment: payment, totalInterest: totalCost - principal, totalCost: totalCost };
    }

    function calculateComparison() {
      incrementCalcCounter();
      var aPrice = parseFloat(document.getElementById('cmp-a-price').value) || 0;
      var aRate = parseFloat(document.getElementById('cmp-a-rate').value) || 0;
      var aAmort = parseInt(document.getElementById('cmp-a-amort').value) || 25;
      var aDown = Math.min(100, Math.max(0, parseFloat(document.getElementById('cmp-a-down').value) || 0));
      var bPrice = Math.max(0, parseFloat(document.getElementById('cmp-b-price').value) || 0);
      var bRate = Math.max(0, parseFloat(document.getElementById('cmp-b-rate').value) || 0);
      var bAmort = Math.max(1, parseInt(document.getElementById('cmp-b-amort').value) || 25);
      var bDown = Math.min(100, Math.max(0, parseFloat(document.getElementById('cmp-b-down').value) || 0));

      var aPrincipal = aPrice * (1 - aDown / 100);
      var bPrincipal = bPrice * (1 - bDown / 100);
      var a = calcMortgagePayment(aPrincipal, aRate, aAmort);
      var b = calcMortgagePayment(bPrincipal, bRate, bAmort);

      document.getElementById('cmp-a-payment').textContent = fmtFull(a.payment);
      document.getElementById('cmp-b-payment').textContent = fmtFull(b.payment);
      document.getElementById('cmp-a-interest').textContent = fmtFull(a.totalInterest);
      document.getElementById('cmp-b-interest').textContent = fmtFull(b.totalInterest);
      document.getElementById('cmp-a-total').textContent = fmtFull(a.totalCost);
      document.getElementById('cmp-b-total').textContent = fmtFull(b.totalCost);

      var diff = Math.abs(a.totalCost - b.totalCost);
      var verdict = '';
      if (a.totalCost < b.totalCost) {
        verdict = 'üÖ∞Ô∏è Scenario A saves you <strong>' + fmtFull(diff) + '</strong> in total cost!';
      } else if (b.totalCost < a.totalCost) {
        verdict = 'üÖ±Ô∏è Scenario B saves you <strong>' + fmtFull(diff) + '</strong> in total cost!';
      } else {
        verdict = 'Both scenarios have the same total cost.';
      }
      var pmtDiff = Math.abs(a.payment - b.payment);
      verdict += '<br><span style="font-size:0.9rem;">Monthly payment difference: ' + fmtFull(pmtDiff) + '</span>';
      // CMHC warning
      if (aDown < 20) verdict += '<br><span style="font-size:0.8rem;color:var(--brand-warning);">‚ö†Ô∏è Scenario A requires CMHC insurance (down payment &lt; 20%)</span>';
      if (bDown < 20) verdict += '<br><span style="font-size:0.8rem;color:var(--brand-warning);">‚ö†Ô∏è Scenario B requires CMHC insurance (down payment &lt; 20%)</span>';
      document.getElementById('cmp-verdict').innerHTML = verdict;
    }

    // ‚îÄ‚îÄ Currency Converter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function convertCurrency() {
      incrementCalcCounter();
      var cad = parseFloat(document.getElementById('currency-amount').value) || 0;
      if (cad < 0) cad = 0;
      // Rates: how many foreign units per 1 CAD (derived from "how many CAD per 1 foreign")
      var usd = cad / 1.36;
      var eur = cad / 1.47;
      var gbp = cad / 1.72;
      var inr = cad / 0.016;
      var jpy = cad / 0.009;
      function fmtCur(symbol, val, decimals) {
        return symbol + val.toLocaleString('en-CA', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
      }
      document.getElementById('cur-usd').textContent = fmtCur('$', usd, 2);
      document.getElementById('cur-eur').textContent = fmtCur('‚Ç¨', eur, 2);
      document.getElementById('cur-gbp').textContent = fmtCur('¬£', gbp, 2);
      document.getElementById('cur-inr').textContent = fmtCur('‚Çπ', inr, 0);
      document.getElementById('cur-jpy').textContent = fmtCur('¬•', jpy, 0);
      var aud = cad * 1.1236;
      document.getElementById('cur-aud').textContent = fmtCur('A$', aud, 2);
    }

    // ‚îÄ‚îÄ Rule of 72 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calcRule72(source) {
      if (source === 'rate') {
        var rate = parseFloat(document.getElementById('r72-rate').value) || 0;
        if (rate > 0) {
          var years = 72 / rate;
          document.getElementById('r72-rate-result').textContent = '‚âà ' + years.toFixed(1) + ' years to double';
          document.getElementById('r72-years').value = years.toFixed(1);
          document.getElementById('r72-years-result').textContent = '‚âà ' + rate.toFixed(1) + '% rate needed';
        } else {
          document.getElementById('r72-rate-result').textContent = 'Enter a rate above 0%';
          document.getElementById('r72-rate-result').style.color = 'var(--text-muted)';
          return;
        }
      } else {
        var years = parseFloat(document.getElementById('r72-years').value) || 0;
        if (years > 0) {
          var rate = 72 / years;
          document.getElementById('r72-years-result').textContent = '‚âà ' + rate.toFixed(1) + '% rate needed';
          document.getElementById('r72-rate').value = rate.toFixed(1);
          document.getElementById('r72-rate-result').textContent = '‚âà ' + years.toFixed(1) + ' years to double';
        } else {
          document.getElementById('r72-years-result').textContent = 'Enter a time above 0 years';
          document.getElementById('r72-years-result').style.color = 'var(--text-muted)';
          return;
        }
      }
      // Reset colors after valid input
      document.getElementById('r72-rate-result').style.color = 'var(--brand-primary)';
      document.getElementById('r72-years-result').style.color = 'var(--brand-primary)';
    }

    // ‚îÄ‚îÄ Lease vs Buy Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateLeaseBuy() {
      var price = Math.max(0, parseFloat(document.getElementById('lb-price').value) || 0);
      var leasePayment = Math.max(0, parseFloat(document.getElementById('lb-lease-payment').value) || 0);
      var leaseTerm = Math.max(1, parseInt(document.getElementById('lb-lease-term').value) || 48);
      var residual = Math.max(0, parseFloat(document.getElementById('lb-residual').value) || 0);
      var buyRate = Math.max(0, (parseFloat(document.getElementById('lb-buy-rate').value) || 0)) / 100 / 12;
      var buyTerm = Math.max(1, parseInt(document.getElementById('lb-buy-term').value) || 60);
      var down = Math.max(0, parseFloat(document.getElementById('lb-down').value) || 0);
      var insDiff = parseFloat(document.getElementById('lb-insurance-diff').value) || 0;
      var maintDiff = parseFloat(document.getElementById('lb-maint-diff').value) || 0;
      if (price === 0 && leasePayment === 0) {
        document.getElementById('lease-buy-results').innerHTML = '<div class="glass-card" style="padding:var(--space-lg);text-align:center;color:var(--text-secondary);">Enter vehicle price and lease details to compare.</div>';
        document.getElementById('lease-buy-chart').innerHTML = '';
        return;
      }

      // Total lease cost
      var totalLease = leasePayment * leaseTerm;

      // Buy: monthly loan payment
      var loanAmt = price - down;
      var buyMonthly = buyRate > 0
        ? loanAmt * buyRate * Math.pow(1 + buyRate, buyTerm) / (Math.pow(1 + buyRate, buyTerm) - 1)
        : loanAmt / buyTerm;
      var totalLoanPayments = buyMonthly * buyTerm;
      var totalBuyInterest = totalLoanPayments - loanAmt;

      // Depreciation calculation (buy scenario)
      var annualDepreciation = (price - residual) / (leaseTerm / 12);
      var totalDepreciation = price - residual;

      // Compare over lease term period
      var compMonths = leaseTerm;
      var leaseCostOverPeriod = leasePayment * compMonths;
      // Buy cost over same period: payments made + down - residual value + running cost diffs
      var buyPaymentsInPeriod = buyMonthly * Math.min(compMonths, buyTerm);
      var buyCostOverPeriod = down + buyPaymentsInPeriod - residual + (insDiff + maintDiff) * compMonths;
      var costDiff = leaseCostOverPeriod - buyCostOverPeriod;

      // Break-even: find month where cumulative lease = cumulative buy
      var cumLease = 0, cumBuy = down;
      var breakEven = null;
      for (var m = 1; m <= Math.max(leaseTerm, buyTerm) + 12; m++) {
        cumLease += leasePayment;
        if (m <= buyTerm) cumBuy += buyMonthly;
        cumBuy += (insDiff + maintDiff);
        // After lease term, lessee has nothing; buyer has residual
        if (m === leaseTerm && cumLease <= cumBuy - residual && !breakEven) {
          breakEven = m;
        }
        if (!breakEven && cumBuy - residual <= cumLease) {
          breakEven = m;
        }
      }

      var verdict = buyCostOverPeriod < leaseCostOverPeriod ? 'Buying is cheaper' : 'Leasing is cheaper';
      var verdictColor = buyCostOverPeriod < leaseCostOverPeriod ? 'var(--brand-success)' : 'var(--brand-primary)';
      var savings = Math.abs(costDiff);

      document.getElementById('lease-buy-results').innerHTML = `
        <div class="result-card" style="border-left: 4px solid var(--brand-primary);">
          <div class="result-label">Total Lease Cost (${compMonths} mo)</div>
          <div class="result-value">${fmtFull(leaseCostOverPeriod)}</div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.25rem;">${fmtFull(leasePayment)}/mo ¬∑ No ownership at end</div>
        </div>
        <div class="result-card" style="border-left: 4px solid var(--brand-success);">
          <div class="result-label">Total Buy Cost (${compMonths} mo, net of residual)</div>
          <div class="result-value" style="background:linear-gradient(135deg,var(--brand-success),var(--brand-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">${fmtFull(buyCostOverPeriod)}</div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.25rem;">${fmtFull(buyMonthly)}/mo loan ¬∑ ${fmtFull(residual)} residual value</div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${buyCostOverPeriod < leaseCostOverPeriod ? 'üèÜ' : 'üèÜ'}</div>
          <div style="font-size: 1.1rem; font-weight: 700; color: ${verdictColor};">${verdict}</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">You save <strong>${fmtFull(savings)}</strong> over ${compMonths} months</div>
          ${breakEven ? `<div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.5rem;">Break-even point: ~${breakEven} months</div>` : ''}
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Details</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Down Payment</div><div class="mono" style="font-weight:700;">${fmtFull(down)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Loan Interest</div><div class="mono" style="font-weight:700;">${fmtFull(totalBuyInterest)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Monthly Buy Payment</div><div class="mono" style="font-weight:700;">${fmtFull(buyMonthly)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Running Cost Diff/mo</div><div class="mono" style="font-weight:700;">${fmtFull(insDiff + maintDiff)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Total Depreciation</div><div class="mono" style="font-weight:700;color:var(--brand-danger);">${fmtFull(totalDepreciation)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Annual Depreciation</div><div class="mono" style="font-weight:700;">${fmtFull(annualDepreciation)}/yr</div></div>
          </div>
        </div>
      `;

      // Bar chart comparison
      var maxCost = Math.max(leaseCostOverPeriod, buyCostOverPeriod);
      document.getElementById('lease-buy-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Cost Comparison Over ${compMonths} Months</div>
        <div style="margin-bottom: 1rem;">
          <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;"><span>Lease</span><span class="mono">${fmtFull(leaseCostOverPeriod)}</span></div>
          <div class="chart-bar"><div class="chart-bar-fill" style="width:${(leaseCostOverPeriod/maxCost*100).toFixed(1)}%;background:linear-gradient(90deg,var(--brand-primary),var(--brand-secondary));"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;"><span>Buy (net of residual)</span><span class="mono">${fmtFull(buyCostOverPeriod)}</span></div>
          <div class="chart-bar"><div class="chart-bar-fill" style="width:${(buyCostOverPeriod/maxCost*100).toFixed(1)}%;background:linear-gradient(90deg,var(--brand-success),var(--brand-accent));"></div></div>
        </div>
        <div style="margin-top:1rem;font-size:0.8rem;color:var(--text-muted);text-align:center;">
          Difference: <strong style="color:${verdictColor}">${fmtFull(savings)}</strong> in favour of ${buyCostOverPeriod < leaseCostOverPeriod ? 'buying' : 'leasing'}
        </div>
      `;
    }

    // ‚îÄ‚îÄ Canadian Tax Estimator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateTax() {
      var province = document.getElementById('tax-province').value;
      var employment = Math.max(0, parseFloat(document.getElementById('tax-employment').value) || 0);
      var selfEmp = Math.max(0, parseFloat(document.getElementById('tax-self').value) || 0);
      var capGains = Math.max(0, parseFloat(document.getElementById('tax-capgains').value) || 0);
      var dividends = Math.max(0, parseFloat(document.getElementById('tax-dividends').value) || 0);
      var rrsp = Math.max(0, parseFloat(document.getElementById('tax-rrsp').value) || 0);
      var otherDed = Math.max(0, parseFloat(document.getElementById('tax-other-ded').value) || 0);
      if (employment === 0 && selfEmp === 0 && capGains === 0 && dividends === 0) {
        document.getElementById('tax-results').innerHTML = '<div class="glass-card" style="padding:var(--space-lg);text-align:center;color:var(--text-secondary);">Enter your income to estimate taxes.</div>';
        document.getElementById('tax-chart').innerHTML = '';
        var pc = document.getElementById('tax-province-compare'); if (pc) pc.innerHTML = '';
        return;
      }

      // Gross income
      var grossIncome = employment + selfEmp + capGains * 0.5 + dividends * 1.38; // gross-up dividends
      var deductions = rrsp + otherDed;
      var taxableIncome = Math.max(0, grossIncome - deductions);

      // 2025 Federal brackets
      var fedBrackets = [
        [57375, 0.15], [57375, 0.205], [43718, 0.26], [61532, 0.29], [Infinity, 0.33]
      ];
      var fedBasic = 16129; // basic personal amount
      var fedTax = calcBracketTax(taxableIncome, fedBrackets) - fedBasic * 0.15;
      // Dividend tax credit (federal): 15.0198% of grossed-up amount
      var fedDTC = dividends * 1.38 * 0.150198;
      fedTax = Math.max(0, fedTax - fedDTC);

      // Provincial brackets
      var provBrackets = getProvBrackets(province);
      var provBasic = getProvBasic(province);
      var provRate1 = provBrackets[0][1];
      var provTax = calcBracketTax(taxableIncome, provBrackets) - provBasic * provRate1;
      // Provincial dividend tax credit
      var provDTCRate = getProvDTCRate(province);
      var provDTC = dividends * 1.38 * provDTCRate;
      provTax = Math.max(0, provTax - provDTC);

      // CPP (2025): max pensionable earnings $71,300, basic exemption $3,500, rate 5.95%
      var cppEarnings = Math.min(employment + selfEmp, 71300) - 3500;
      var cppEmployee = Math.max(0, cppEarnings * 0.0595);
      var cppSelf = selfEmp > 0 ? cppEmployee * 2 * (selfEmp / (employment + selfEmp)) : 0;
      var cpp = employment > 0 ? cppEmployee : 0;
      cpp += cppSelf;
      // CPP2: earnings between $71,300 and $81,200 at 4%
      var cpp2Earnings = Math.min(employment + selfEmp, 81200) - 71300;
      if (cpp2Earnings > 0) cpp += cpp2Earnings * 0.04;

      // EI (2025): max insurable $65,700, rate 1.64%
      var eiEarnings = Math.min(employment, 65700);
      var ei = eiEarnings * 0.0164;

      var totalTax = fedTax + provTax + cpp + ei;
      var afterTax = employment + selfEmp + capGains + dividends - totalTax;
      var avgRate = grossIncome > 0 ? (totalTax / (employment + selfEmp + capGains + dividends)) * 100 : 0;

      // Marginal rate: federal + provincial top bracket
      var margFed = getMarginalRate(taxableIncome, fedBrackets);
      var margProv = getMarginalRate(taxableIncome, provBrackets);
      var margRate = (margFed + margProv) * 100;

      var totalGross = employment + selfEmp + capGains + dividends;

      document.getElementById('tax-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Total Tax</div>
          <div class="result-value">${fmtFull(totalTax)}</div>
        </div>
        <div class="result-card" style="border-left: 4px solid var(--brand-success);">
          <div class="result-label">After-Tax Income</div>
          <div class="result-value" style="background:linear-gradient(135deg,var(--brand-success),var(--brand-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">${fmtFull(afterTax)}</div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Tax Breakdown</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Federal Tax</div><div class="mono" style="font-weight:700;">${fmtFull(fedTax)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Provincial Tax</div><div class="mono" style="font-weight:700;">${fmtFull(provTax)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">CPP Contributions</div><div class="mono" style="font-weight:700;">${fmtFull(cpp)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">EI Premiums</div><div class="mono" style="font-weight:700;">${fmtFull(ei)}</div></div>
          </div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Rates</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Average Tax Rate</div><div class="mono" style="font-weight:700;">${avgRate.toFixed(1)}%</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Marginal Tax Rate</div><div class="mono" style="font-weight:700;color:var(--brand-warning);">${margRate.toFixed(1)}%</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Taxable Income</div><div class="mono" style="font-weight:700;">${fmtFull(taxableIncome)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Deductions</div><div class="mono" style="font-weight:700;">${fmtFull(deductions)}</div></div>
          </div>
        </div>
      `;

      // Waterfall chart
      var steps = [
        { label: 'Gross Income', value: totalGross, color: 'var(--brand-primary)' },
        { label: 'Deductions', value: -deductions, color: 'var(--text-muted)' },
        { label: 'Taxable Income', value: taxableIncome, color: 'var(--brand-secondary)' },
        { label: 'Federal Tax', value: -fedTax, color: 'var(--brand-danger)' },
        { label: 'Provincial Tax', value: -provTax, color: 'var(--brand-warning)' },
        { label: 'CPP + EI', value: -(cpp + ei), color: 'var(--text-muted)' },
        { label: 'Net Income', value: afterTax, color: 'var(--brand-success)' }
      ];
      var maxStep = Math.max(...steps.map(s => Math.abs(s.value)));
      document.getElementById('tax-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Tax Breakdown Waterfall</div>
        ${steps.map(s => `
          <div style="margin-bottom: 0.75rem;">
            <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;">
              <span>${s.label}</span>
              <span class="mono" style="color:${s.value < 0 ? 'var(--brand-danger)' : 'var(--text-primary)'}">${s.value < 0 ? '-' : ''}${fmtFull(Math.abs(s.value))}</span>
            </div>
            <div class="chart-bar"><div class="chart-bar-fill" style="width:${(Math.abs(s.value)/maxStep*100).toFixed(1)}%;background:${s.color};"></div></div>
          </div>
        `).join('')}
      `;

      // Province Comparison
      const provCompare = document.getElementById('tax-province-compare');
      if (provCompare) {
        const allProvs = ['ON','BC','AB','QC','MB','SK','NS','NB','NL','PE'];
        const provNames = {ON:'Ontario',BC:'British Columbia',AB:'Alberta',QC:'Quebec',MB:'Manitoba',SK:'Saskatchewan',NS:'Nova Scotia',NB:'New Brunswick',NL:'Newfoundland',PE:'PEI'};
        let provTaxes = allProvs.map(pv => {
          const pb = getProvBrackets(pv);
          const pBasic = getProvBasic(pv);
          const pTax = Math.max(0, calcBracketTax(taxableIncome, pb) - pBasic * pb[0][1]);
          const dtcR = getProvDTCRate(pv);
          const pDTC = dividends * 1.38 * dtcR;
          const total = Math.max(0, fedTax + Math.max(0, pTax - pDTC) + cpp + ei);
          return { prov: pv, name: provNames[pv], tax: total, afterTax: totalGross - total };
        }).sort((a,b) => a.tax - b.tax);
        const maxTax = Math.max(...provTaxes.map(p => p.tax));
        provCompare.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üó∫Ô∏è Tax Across All Provinces</div>
          ${provTaxes.map(p => `
            <div style="margin-bottom: 0.5rem;">
              <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.2rem;">
                <span${p.prov === province ? ' style="font-weight:700;color:var(--brand-primary);"' : ''}>${p.prov === province ? '‚Üí ' : ''}${p.name}</span>
                <span class="mono">${fmtFull(p.tax)} (take-home: ${fmtFull(p.afterTax)})</span>
              </div>
              <div class="chart-bar" style="height:6px;"><div class="chart-bar-fill" style="width:${(p.tax/maxTax*100).toFixed(1)}%;background:${p.prov === province ? 'linear-gradient(90deg,var(--brand-primary),var(--brand-accent))' : 'var(--border-hover)'};"></div></div>
            </div>
          `).join('')}
        `;
      }
    }

    function calcBracketTax(income, brackets) {
      var tax = 0, remaining = income;
      for (var i = 0; i < brackets.length; i++) {
        var amt = Math.min(remaining, brackets[i][0]);
        tax += amt * brackets[i][1];
        remaining -= amt;
        if (remaining <= 0) break;
      }
      return tax;
    }

    function getMarginalRate(income, brackets) {
      var remaining = income;
      for (var i = 0; i < brackets.length; i++) {
        if (remaining <= brackets[i][0]) return brackets[i][1];
        remaining -= brackets[i][0];
      }
      return brackets[brackets.length - 1][1];
    }

    function getProvBrackets(prov) {
      var b = {
        'ON': [[52886,0.0505],[52889,0.0915],[44225,0.1116],[70000,0.1216],[Infinity,0.1316]],
        'BC': [[47937,0.0506],[47938,0.077],[14201,0.105],[23588,0.1229],[47568,0.147],[71520,0.168],[Infinity,0.205]],
        'AB': [[148269,0.10],[29653,0.12],[59308,0.13],[118615,0.14],[Infinity,0.15]],
        'QC': [[51780,0.14],[51765,0.19],[22455,0.24],[Infinity,0.2575]]
      };
      // Simplified flat-ish brackets for other provinces
      var simple = {
        'MB': [[47000,0.108],[53000,0.1275],[Infinity,0.174]],
        'SK': [[52057,0.105],[96677,0.125],[Infinity,0.145]],
        'NS': [[29590,0.0879],[29590,0.1495],[33820,0.1667],[57000,0.175],[Infinity,0.21]],
        'NB': [[49958,0.094],[49958,0.14],[85148,0.16],[64936,0.195],[Infinity,0.203]],
        'NL': [[43198,0.087],[43197,0.145],[67849,0.158],[61699,0.178],[59927,0.198],[Infinity,0.218]],
        'PE': [[32656,0.0965],[31657,0.1363],[40687,0.1665],[35000,0.18],[Infinity,0.1875]]
      };
      return b[prov] || simple[prov] || [[Infinity, 0.12]];
    }

    function getProvBasic(prov) {
      var basics = {'ON':11865,'BC':12580,'AB':21003,'QC':18056,'MB':15780,'SK':17661,'NS':8481,'NB':13044,'NL':10818,'PE':13500};
      return basics[prov] || 12000;
    }

    function getProvDTCRate(prov) {
      var rates = {'ON':0.10,'BC':0.12,'AB':0.0812,'QC':0.117,'MB':0.08,'SK':0.11,'NS':0.0885,'NB':0.14,'NL':0.063,'PE':0.105};
      return rates[prov] || 0.10;
    }

    // ‚îÄ‚îÄ Patch existing calculators to increment counter ‚îÄ‚îÄ
    (function patchCounters() {
      var fns = ['calculateDCF','calculateMultiples','calculateAsset','calculateMortgage',
        'calculateCAGR','calculateDCA','calculateRetirement','calculateCompound',
        'calculateMA','calculateRunway','calculateNetWorth','calculateSalary','calculateDebt',
        'calculateLeaseBuy','calculateTax'];
      fns.forEach(function(name) {
        var orig = window[name];
        if (typeof orig === 'function') {
          window[name] = function() {
            incrementCalcCounter();
            return orig.apply(this, arguments);
          };
        }
      });
    })();

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(function(){});
    }
  </script>
</body>
</html>