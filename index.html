<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CalcStack | The Financial Toolkit That Actually Gets It Done</title>
  <meta name="description" content="Free premium financial calculators â€” business valuation, M&A analysis, Canadian mortgage, investment returns, RRSP/TFSA optimizer, tax estimator. Smart money decisions start here." />
  <meta name="keywords" content="financial calculator, business valuation, DCF calculator, mortgage calculator Canada, M&A accretion dilution, RRSP TFSA, investment returns, compound interest" />
  <meta property="og:title" content="CalcStack | The Financial Toolkit That Actually Gets It Done" />
  <meta property="og:description" content="Free premium financial calculators â€” smart money decisions start here." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://rajkcho.github.io/CalcStack/" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="canonical" href="https://rajkcho.github.io/CalcStack/" />
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />
  
  <!-- Google Analytics (uncomment and replace G-XXXXXXXXXX with your Measurement ID) -->
  <!--
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  </script>
  -->

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#6366f1" />

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§®</text></svg>" />

  <!-- Structured Data: WebApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "CalcStack",
    "description": "Free premium financial calculators â€” business valuation, M&A analysis, mortgage calculator, investment returns, RRSP/TFSA optimizer, compound interest, startup runway, net worth tracker.",
    "url": "https://rajkcho.github.io/CalcStack/",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "CAD"
    }
  }
  </script>

  <!-- Structured Data: FAQPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is CalcStack free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, all financial calculators on CalcStack are 100% free with no sign-up required."
        }
      },
      {
        "@type": "Question",
        "name": "Is my financial data safe?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. All calculations run entirely in your browser. No data is sent to any server â€” your numbers never leave your device."
        }
      },
      {
        "@type": "Question",
        "name": "What calculators are available?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "CalcStack includes 8 professional-grade calculators: Business Valuation (DCF, Multiples, Asset-based), M&A Deal Analyzer, Canadian Mortgage Calculator, Investment Returns (CAGR & DCA), RRSP vs TFSA Optimizer, Compound Interest Visualizer, Startup Runway Calculator, and Net Worth Tracker."
        }
      },
      {
        "@type": "Question",
        "name": "How accurate are the mortgage calculations for Canada?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The mortgage calculator uses Canadian semi-annual compounding as required by law, includes CMHC insurance premiums, provincial land transfer taxes, and OSFI B-20 stress test calculations."
        }
      },
      {
        "@type": "Question",
        "name": "Should I choose RRSP or TFSA?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It depends on your current vs. expected retirement tax rate. Generally, RRSP is better if your current tax rate is higher than your expected retirement rate. Use our RRSP vs TFSA Optimizer to compare based on your specific situation."
        }
      }
    ]
  }
  </script>
  
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BABAGANOUSH â€” Premium Financial Tools
       Design System & Core Styles
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    :root {
      /* Brand Colors */
      --brand-primary: #6366f1;
      --brand-secondary: #8b5cf6;
      --brand-accent: #06b6d4;
      --brand-success: #10b981;
      --brand-warning: #f59e0b;
      --brand-danger: #ef4444;
      
      /* Dark Theme */
      --bg-primary: #0f1117;
      --bg-secondary: #161922;
      --bg-card: #1a1d28;
      --bg-card-hover: #222633;
      --bg-elevated: #1e2230;
      --border-primary: #262a3a;
      --border-hover: #363c52;
      --text-primary: #f4f4f8;
      --text-secondary: #a0a6b8;
      --text-muted: #6c7490;
      --glass-bg: rgba(26, 29, 40, 0.75);
      --glass-border: rgba(255, 255, 255, 0.08);
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Radius */
      --radius-sm: 0.5rem;
      --radius-md: 0.75rem;
      --radius-lg: 1rem;
      --radius-xl: 1.5rem;
      --radius-full: 9999px;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.5);
      --shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.6);
      --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.15);
      --shadow-glow-accent: 0 0 30px rgba(6, 182, 212, 0.15);
    }
    
    /* Light Theme */
    .light {
      --bg-primary: #f8f9fc;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --bg-card-hover: #f5f6fa;
      --bg-elevated: #f0f1f5;
      --border-primary: #e2e4ec;
      --border-hover: #c8ccd8;
      --text-primary: #1a1d2e;
      --text-secondary: #525872;
      --text-muted: #8b90a5;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(99, 102, 241, 0.08);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04);
      --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.08);
      --shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.1);
      --shadow-glow: 0 0 30px rgba(99, 102, 241, 0.06);
    }
    
    /* â”€â”€ Light Mode Polish â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    
    /* 1. Tool Card Shadows */
    .light .tool-card {
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    .light .tool-card:hover {
      box-shadow: 0 8px 24px rgba(99,102,241,0.08), var(--shadow-glow);
    }
    
    /* 2. Nav Bar */
    .light .nav-bar {
      background: rgba(255, 255, 255, 0.88);
      border-bottom: 1px solid rgba(0, 0, 0, 0.06);
    }
    .light .nav-bar.scrolled {
      box-shadow: 0 1px 8px rgba(0, 0, 0, 0.05);
    }
    
    /* 3. Hero Gradient Text */
    .light .gradient-text {
      background: linear-gradient(135deg, #4f46e5, #7c3aed, #0891b2);
      -webkit-background-clip: text;
      background-clip: text;
    }
    
    /* 4. Button Refinement */
    .light .btn-primary {
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.35);
    }
    .light .btn-primary:hover {
      box-shadow: 0 8px 28px rgba(99, 102, 241, 0.4);
    }
    .light .btn-secondary {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid var(--border-hover);
    }
    .light .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--brand-primary);
    }
    
    /* 5. Result Cards */
    .light .result-card {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.04), rgba(139, 92, 246, 0.02));
      border: 1px solid rgba(99, 102, 241, 0.12);
      border-left: 4px solid var(--brand-primary);
    }
    
    /* 6. Section Dividers */
    .light .section + .section::before {
      content: '';
      display: block;
      height: 1px;
      max-width: 800px;
      margin: 0 auto 3rem;
      background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.15), transparent);
    }
    
    /* 7. Footer Polish */
    .light .footer {
      border-top: 1px solid rgba(0, 0, 0, 0.06);
      background: rgba(248, 249, 252, 0.6);
    }
    .footer-made {
      margin-top: 1.5rem;
      padding-top: 1.25rem;
      border-top: 1px solid var(--border-primary);
      font-size: 0.75rem;
      color: var(--text-muted);
    }
    
    /* 8. Glass Card */
    .light .glass-card {
      background: rgba(238, 240, 255, 0.55);
      border: 1px solid rgba(99, 102, 241, 0.08);
    }
    .light .glass-card:hover {
      background: rgba(238, 240, 255, 0.7);
    }
    
    /* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    html {
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    
    /* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-hover); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--brand-primary); }
    
    /* â”€â”€ Typography â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 700;
      line-height: 1.2;
      letter-spacing: -0.02em;
    }
    
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .gradient-text {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary), var(--brand-accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* â”€â”€ Animations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.1); }
      50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.25); }
    }
    
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    @keyframes orbit {
      from { transform: rotate(0deg) translateX(60px) rotate(0deg); }
      to { transform: rotate(360deg) translateX(60px) rotate(-360deg); }
    }
    
    @keyframes counter-orbit {
      from { transform: rotate(0deg) translateX(40px) rotate(0deg); }
      to { transform: rotate(-360deg) translateX(40px) rotate(360deg); }
    }
    
    @keyframes morphBlob {
      0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
      25% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
      50% { border-radius: 50% 60% 30% 60% / 30% 70% 60% 40%; }
      75% { border-radius: 60% 30% 60% 40% / 60% 40% 30% 70%; }
    }
    
    @keyframes typewriter {
      from { width: 0; }
      to { width: 100%; }
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }
    
    @keyframes countUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes ripple {
      0% { transform: scale(0); opacity: 0.6; }
      100% { transform: scale(4); opacity: 0; }
    }
    
    @keyframes borderGlow {
      0%, 100% { border-color: rgba(99, 102, 241, 0.2); }
      50% { border-color: rgba(99, 102, 241, 0.5); }
    }
    
    @keyframes spin-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    
    .animate-fade-up { animation: fadeInUp 0.6s ease both; }
    .animate-fade-up-1 { animation: fadeInUp 0.6s ease 0.1s both; }
    .animate-fade-up-2 { animation: fadeInUp 0.6s ease 0.2s both; }
    .animate-fade-up-3 { animation: fadeInUp 0.6s ease 0.3s both; }
    .animate-fade-up-4 { animation: fadeInUp 0.6s ease 0.4s both; }
    .animate-fade-in { animation: fadeIn 0.6s ease both; }
    .animate-scale-in { animation: scaleIn 0.5s ease both; }
    .animate-slide-left { animation: slideInLeft 0.6s ease both; }
    .animate-slide-right { animation: slideInRight 0.6s ease both; }
    
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* â”€â”€ Glass Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .glass-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      transition: all 0.3s ease;
    }
    
    .glass-card:hover {
      border-color: var(--border-hover);
      box-shadow: var(--shadow-lg);
    }
    
    /* â”€â”€ Tool Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tool-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    
    .tool-card::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: var(--radius-lg);
      padding: 2px;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary), var(--brand-accent));
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }
    
    .tool-card:hover {
      transform: translateY(-6px) scale(1.02);
      border-color: transparent;
      box-shadow: var(--shadow-xl), 0 0 40px rgba(99, 102, 241, 0.15), 0 0 80px rgba(99, 102, 241, 0.05);
      background: var(--bg-card-hover);
    }
    
    .tool-card:hover::before { opacity: 1; }
    
    .tool-card .tool-icon {
      width: 64px;
      height: 64px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.75rem;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .tool-card:hover .tool-icon { 
      transform: scale(1.15) rotate(-5deg); 
      animation: iconBounce 0.5s ease;
    }
    
    @keyframes iconBounce {
      0% { transform: scale(1); }
      40% { transform: scale(1.2) rotate(-8deg); }
      60% { transform: scale(1.1) rotate(-3deg); }
      100% { transform: scale(1.15) rotate(-5deg); }
    }
    
    .tool-card .card-badge {
      position: absolute;
      top: 0.75rem;
      right: 0.75rem;
      font-size: 0.6rem;
      font-weight: 700;
      padding: 0.2rem 0.5rem;
      border-radius: var(--radius-full);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .card-badge-new { background: var(--brand-success); color: white; }
    .card-badge-popular { background: var(--brand-primary); color: white; }
    .card-badge-quick { background: var(--brand-accent); color: white; }
    
    /* â”€â”€ Button System â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.875rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      text-decoration: none;
    }
    
    .btn::after {
      content: '';
      position: absolute;
      inset: 0;
      background: white;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .btn:hover::after { opacity: 0.1; }
    .btn:active { transform: scale(0.97); }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      color: white;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
    }
    
    .btn-primary:hover {
      box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border-primary);
    }
    
    .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--border-hover);
    }
    
    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }
    
    .btn-ghost:hover { color: var(--text-primary); }
    
    .btn-lg { padding: 1rem 2rem; font-size: 1rem; border-radius: var(--radius-lg); }
    .btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; }
    
    /* â”€â”€ Input System â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
    }
    
    .input-group label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .input-group input, .input-group select {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-md);
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-size: 0.95rem;
      font-family: 'JetBrains Mono', monospace;
      transition: all 0.3s ease;
      width: 100%;
    }
    
    .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
    }
    
    .input-group input::placeholder { color: var(--text-muted); }
    
    .input-help {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 0.125rem;
    }
    
    /* â”€â”€ Range Slider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: var(--border-primary);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }
    
    /* â”€â”€ Result Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .result-card {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.05));
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      animation: scaleIn 0.4s ease both;
    }
    
    .result-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .result-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }
    
    /* â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid var(--glass-border);
      padding: 0.75rem 1.5rem;
      transition: all 0.3s ease;
      animation: fadeInDown 0.6s ease both;
    }
    
    .nav-bar.scrolled {
      box-shadow: var(--shadow-md);
    }
    
    .nav-inner {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .nav-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      font-weight: 800;
      font-size: 1.1rem;
      color: var(--text-primary);
    }
    
    .nav-logo-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      color: white;
      font-weight: 800;
    }
    
    .nav-links {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      list-style: none;
    }
    
    .nav-links a {
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-sm);
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    
    .nav-links a:hover, .nav-links a.active {
      color: var(--text-primary);
      background: rgba(99, 102, 241, 0.1);
    }
    
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-primary);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }
    
    .theme-toggle:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
      border-color: var(--border-hover);
    }
    
    /* Mobile nav */
    .mobile-menu-btn {
      display: none;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-primary);
      background: var(--bg-card);
      color: var(--text-primary);
      cursor: pointer;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    
    @media (max-width: 768px) {
      .nav-links { display: none; }
      .mobile-menu-btn { display: flex; }
      .nav-links.mobile-open {
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-primary);
        padding: 1rem;
        gap: 0.25rem;
      }
      .nav-links.mobile-open a {
        padding: 0.75rem 1rem;
        width: 100%;
      }
    }
    
    /* â”€â”€ Floating Particles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .particles-container {
      position: absolute;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 0;
    }
    .particle {
      position: absolute;
      border-radius: 50%;
      opacity: 0.15;
      animation: particleFloat linear infinite;
    }
    @keyframes particleFloat {
      0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
      10% { opacity: 0.15; }
      90% { opacity: 0.15; }
      100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
    }

    /* â”€â”€ Animated SVG Decorations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero-decoration {
      position: absolute;
      z-index: 0;
      opacity: 0.08;
      animation: float 6s ease-in-out infinite;
    }
    .hero-decoration:nth-child(2) { animation-delay: -2s; }
    .hero-decoration:nth-child(3) { animation-delay: -4s; }

    /* â”€â”€ Animated Section Backgrounds â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section-gradient-bg {
      position: relative;
      overflow: hidden;
    }
    .section-gradient-bg::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(99,102,241,0.03), rgba(139,92,246,0.02), rgba(6,182,212,0.03));
      background-size: 400% 400%;
      animation: gradient-shift 15s ease infinite;
      pointer-events: none;
    }

    /* â”€â”€ Hero Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      min-height: 60vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 5.5rem 2rem 2rem;
      position: relative;
      overflow: hidden;
    }
    
    .hero-bg {
      position: absolute;
      inset: 0;
      z-index: 0;
    }
    
    .hero-blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.12;
    }
    
    .light .hero-blob {
      opacity: 0.08;
      filter: blur(100px);
    }
    
    .hero-blob-1 {
      width: 600px;
      height: 600px;
      background: var(--brand-primary);
      top: -200px;
      right: -100px;
      animation: morphBlob 20s ease-in-out infinite;
    }
    
    .hero-blob-2 {
      width: 400px;
      height: 400px;
      background: var(--brand-accent);
      bottom: -100px;
      left: -50px;
      animation: morphBlob 15s ease-in-out infinite reverse;
    }
    
    .hero-blob-3 {
      width: 300px;
      height: 300px;
      background: var(--brand-secondary);
      top: 40%;
      left: 50%;
      animation: morphBlob 25s ease-in-out infinite 5s;
    }
    
    /* Grid pattern */
    .hero-grid {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
      background-size: 60px 60px;
      mask-image: radial-gradient(ellipse at center, black 30%, transparent 70%);
      -webkit-mask-image: radial-gradient(ellipse at center, black 30%, transparent 70%);
    }
    
    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
    }
    
    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--brand-primary);
      margin-bottom: 1.5rem;
      animation: fadeInUp 0.6s ease both;
    }
    
    .hero-badge .pulse-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--brand-success);
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    .hero h1 {
      font-size: clamp(2.2rem, 5vw, 3.5rem);
      font-weight: 900;
      letter-spacing: -0.03em;
      margin-bottom: 1rem;
      line-height: 1.05;
      animation: fadeInUp 0.6s ease 0.1s both;
    }
    
    .hero p {
      font-size: clamp(0.95rem, 1.8vw, 1.15rem);
      color: var(--text-secondary);
      max-width: 560px;
      margin: 0 auto 1.5rem;
      line-height: 1.6;
      animation: fadeInUp 0.6s ease 0.2s both;
    }
    
    .hero-cta {
      display: flex;
      align-items: center;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      animation: fadeInUp 0.6s ease 0.3s both;
    }
    
    .hero-stats {
      display: flex;
      gap: 2.5rem;
      margin-top: 2.5rem;
      animation: fadeInUp 0.6s ease 0.4s both;
    }
    
    .hero-stat {
      text-align: center;
    }
    
    .hero-stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-primary);
    }
    
    .hero-stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-top: 0.25rem;
    }
    
    @media (max-width: 640px) {
      .hero-stats { gap: 1.5rem; }
      .hero-stat-value { font-size: 1.25rem; }
    }
    
    /* â”€â”€ Sections â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .section {
      padding: 2.5rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .section-header {
      text-align: center;
      margin-bottom: 2.5rem;
    }
    
    .section-label {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--brand-primary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
    }
    
    .section-label .label-line {
      width: 24px;
      height: 2px;
      background: linear-gradient(90deg, var(--brand-primary), var(--brand-accent));
      border-radius: 1px;
    }
    
    .section-title {
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      letter-spacing: -0.03em;
      margin-bottom: 0.75rem;
    }
    
    .section-desc {
      font-size: 1.05rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* â”€â”€ Tools Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.25rem;
    }
    
    @media (max-width: 960px) {
      .tools-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 640px) {
      .tools-grid { grid-template-columns: 1fr; }
    }
    
    /* â”€â”€ Calculator Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .calc-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    
    .calc-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    .calc-back {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    
    .calc-back:hover { color: var(--text-primary); }
    
    .calc-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    
    .calc-inputs {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    .calc-results {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    @media (max-width: 768px) {
      .calc-grid { grid-template-columns: 1fr; }
    }
    
    /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .footer {
      border-top: 1px solid var(--border-primary);
      padding: 3rem 1.5rem;
      text-align: center;
    }
    
    .footer-content {
      max-width: 1280px;
      margin: 0 auto;
    }
    
    .footer-brand {
      font-weight: 800;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }
    
    .footer-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      max-width: 500px;
      margin: 0 auto 1.5rem;
      line-height: 1.7;
    }
    
    .footer-links {
      display: flex;
      gap: 1.5rem;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .footer-links a {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-decoration: none;
      transition: color 0.3s ease;
    }
    
    .footer-links a:hover { color: var(--text-primary); text-decoration: underline; }
    .light .footer-links a { color: var(--text-secondary); }
    
    /* â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
    
    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }
    
    /* â”€â”€ Tab System â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tabs {
      display: flex;
      gap: 0.25rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 0.25rem;
      border: 1px solid var(--border-primary);
    }
    
    .tab {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      text-align: center;
    }
    
    .tab:hover { color: var(--text-primary); }
    
    .tab.active {
      background: var(--brand-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }
    
    /* â”€â”€ Metric pill â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .metric-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }
    
    .metric-pill.positive {
      background: rgba(16, 185, 129, 0.1);
      color: var(--brand-success);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }
    
    .metric-pill.negative {
      background: rgba(239, 68, 68, 0.1);
      color: var(--brand-danger);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    .metric-pill.neutral {
      background: rgba(99, 102, 241, 0.1);
      color: var(--brand-primary);
      border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    /* â”€â”€ Divider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-primary), transparent);
      margin: 2rem 0;
    }
    
    /* â”€â”€ Tooltip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tooltip-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    
    .tooltip-icon {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--border-primary);
      color: var(--text-muted);
      font-size: 0.6rem;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: help;
    }
    
    .tooltip-wrapper:hover .tooltip-content {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }
    
    .tooltip-content {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%) translateY(5px);
      background: var(--bg-elevated);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-sm);
      padding: 0.5rem 0.75rem;
      font-size: 0.72rem;
      color: var(--text-secondary);
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      z-index: 10;
      box-shadow: var(--shadow-lg);
      max-width: 250px;
      white-space: normal;
    }
    
    /* â”€â”€ Chart Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chart-container {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin: 1rem 0;
    }
    
    .chart-bar {
      height: 8px;
      border-radius: 4px;
      background: var(--border-primary);
      overflow: hidden;
      margin: 0.5rem 0;
    }
    
    .chart-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(90deg, var(--brand-primary), var(--brand-accent));
    }
    
    /* â”€â”€ Sensitivity Table â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sensitivity-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
    }
    
    .sensitivity-table th {
      background: var(--bg-elevated);
      color: var(--text-secondary);
      font-weight: 600;
      padding: 0.625rem 0.75rem;
      text-align: center;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid var(--border-primary);
    }
    
    .sensitivity-table th:first-child {
      border-radius: var(--radius-sm) 0 0 0;
      text-align: left;
    }
    
    .sensitivity-table th:last-child {
      border-radius: 0 var(--radius-sm) 0 0;
    }
    
    .sensitivity-table td {
      padding: 0.5rem 0.75rem;
      text-align: center;
      border-bottom: 1px solid var(--border-primary);
      transition: background 0.2s ease;
    }
    
    .sensitivity-table td:first-child {
      text-align: left;
      font-weight: 600;
      color: var(--text-secondary);
    }
    
    .sensitivity-table tr:hover td {
      background: rgba(99, 102, 241, 0.05);
    }
    
    .sensitivity-table .highlight {
      background: rgba(99, 102, 241, 0.1);
      font-weight: 700;
      color: var(--brand-primary);
    }
    
    .sensitivity-table .positive-val { color: var(--brand-success); }
    .sensitivity-table .negative-val { color: var(--brand-danger); }
    
    /* â”€â”€ Notification Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      z-index: 200;
      background: var(--bg-elevated);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-md);
      padding: 1rem 1.5rem;
      box-shadow: var(--shadow-xl);
      animation: slideInRight 0.4s ease both;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.85rem;
    }
    
    .toast.hidden { display: none; }
    
    /* â”€â”€ Page transitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.4s ease both; }
    
    /* â”€â”€ Intersection Observer reveals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    /* â”€â”€ Noise overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .noise::before {
      content: '';
      position: fixed;
      inset: 0;
      opacity: 0.015;
      pointer-events: none;
      z-index: 1000;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
    }
    
    /* â”€â”€ Gradient border card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .gradient-border-card {
      position: relative;
      border-radius: var(--radius-xl);
      padding: 1px;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary), var(--brand-accent));
      background-size: 200% 200%;
      animation: gradient-shift 6s ease infinite;
    }
    
    .gradient-border-card-inner {
      background: var(--bg-card);
      border-radius: calc(var(--radius-xl) - 1px);
      padding: var(--space-xl);
    }
    
    /* â”€â”€ Accordion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .accordion-item {
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-md);
      margin-bottom: 0.5rem;
      overflow: hidden;
    }
    
    .accordion-header {
      padding: 1rem 1.25rem;
      background: var(--bg-card);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background 0.3s ease;
    }
    
    .accordion-header:hover { background: var(--bg-card-hover); }
    
    .accordion-arrow {
      transition: transform 0.3s ease;
      color: var(--text-muted);
    }
    
    .accordion-item.open .accordion-arrow {
      transform: rotate(180deg);
    }
    
    .accordion-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
    }
    
    .accordion-item.open .accordion-body {
      max-height: 2000px;
    }
    
    .accordion-body-inner {
      padding: 1rem 1.25rem;
      border-top: 1px solid var(--border-primary);
    }
    
    /* â”€â”€ How It Works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .how-it-works-steps {
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 0;
      position: relative;
      padding: 2rem 0;
    }
    .how-step {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      flex: 1;
      max-width: 260px;
      position: relative;
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .how-step.visible { opacity: 1; transform: translateY(0); }
    .how-step:nth-child(2) { transition-delay: 0.15s; }
    .how-step:nth-child(3) { transition-delay: 0.3s; }
    .how-step-num {
      width: 64px; height: 64px; border-radius: 50%;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      color: white; font-size: 1.5rem; font-weight: 800;
      display: flex; align-items: center; justify-content: center;
      position: relative; z-index: 2;
      box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
    }
    .how-step h3 { font-size: 1.05rem; margin: 1rem 0 0.5rem; }
    .how-step p { font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6; }
    .how-connector {
      position: absolute; top: 32px; left: calc(50% + 32px); right: calc(-50% + 32px);
      height: 2px;
      background: linear-gradient(90deg, var(--brand-primary), var(--brand-accent));
      opacity: 0.3; z-index: 1;
    }
    .how-step:last-child .how-connector { display: none; }
    @media (max-width: 640px) {
      .how-it-works-steps { flex-direction: column; align-items: center; gap: 2rem; }
      .how-connector { display: none; }
    }

    /* â”€â”€ Testimonials â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .testimonial-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }
    .testimonial-card {
      background: var(--glass-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      transition: all 0.3s ease;
    }
    .testimonial-card:hover {
      border-color: var(--border-hover);
      box-shadow: var(--shadow-lg), var(--shadow-glow);
      transform: translateY(-2px);
    }
    .testimonial-stars { color: #f59e0b; font-size: 0.9rem; margin-bottom: 0.75rem; }
    .testimonial-quote { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.7; margin-bottom: 1.25rem; font-style: italic; }
    .testimonial-author { display: flex; align-items: center; gap: 0.75rem; }
    .testimonial-avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      color: white; font-weight: 700; font-size: 0.8rem;
      display: flex; align-items: center; justify-content: center;
    }
    .testimonial-name { font-size: 0.85rem; font-weight: 600; }
    .testimonial-role { font-size: 0.72rem; color: var(--text-muted); }

    /* â”€â”€ Newsletter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .newsletter-section {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.05));
      border: 1px solid rgba(99, 102, 241, 0.15);
      border-radius: var(--radius-xl);
      padding: var(--space-3xl) var(--space-xl);
      text-align: center;
      max-width: 640px;
      margin: 0 auto;
    }
    .newsletter-form {
      display: flex; gap: 0.5rem; max-width: 420px; margin: 1.5rem auto 0;
    }
    .newsletter-form input {
      flex: 1; padding: 0.75rem 1rem; border-radius: var(--radius-md);
      border: 1px solid var(--border-primary); background: var(--bg-secondary);
      color: var(--text-primary); font-size: 0.9rem; font-family: inherit;
    }
    .newsletter-form input:focus { outline: none; border-color: var(--brand-primary); box-shadow: 0 0 0 3px rgba(99,102,241,0.15); }
    .newsletter-social-proof { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem; }
    @media (max-width: 480px) { .newsletter-form { flex-direction: column; } }

    /* â”€â”€ FAQ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .faq-list { max-width: 720px; margin: 0 auto; }

    /* â”€â”€ Cookie Banner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cookie-banner {
      position: fixed; bottom: 0; left: 0; right: 0; z-index: 300;
      background: var(--bg-elevated);
      border-top: 1px solid var(--border-primary);
      padding: 1rem 1.5rem;
      display: flex; align-items: center; justify-content: center; gap: 1rem;
      font-size: 0.85rem; color: var(--text-secondary);
      animation: fadeInUp 0.4s ease both;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
    }
    .cookie-banner.hidden { display: none; }
    .cookie-banner-btns { display: flex; gap: 0.5rem; }
    @media (max-width: 640px) {
      .cookie-banner { flex-direction: column; text-align: center; gap: 0.75rem; }
    }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast-success {
      position: fixed; bottom: 2rem; right: 2rem; z-index: 400;
      background: var(--bg-elevated); border: 1px solid rgba(16,185,129,0.3);
      border-radius: var(--radius-md); padding: 1rem 1.5rem;
      box-shadow: var(--shadow-xl); animation: slideInRight 0.4s ease both;
      font-size: 0.85rem; color: var(--brand-success); display: flex; align-items: center; gap: 0.5rem;
    }

    /* â”€â”€ SVG Donut Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .svg-donut-chart { position: relative; display: inline-block; }
    .svg-donut-chart svg { transform: rotate(-90deg); }
    .svg-donut-segment {
      fill: none;
      stroke-width: 32;
      transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1), stroke-width 0.2s ease, filter 0.2s ease;
      cursor: pointer;
    }
    .svg-donut-segment:hover {
      stroke-width: 38;
      filter: drop-shadow(0 0 6px rgba(99,102,241,0.4));
    }
    .svg-donut-segment.donut-init { stroke-dashoffset: var(--circumference) !important; }
    .svg-donut-center {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      text-align: center; pointer-events: none;
    }
    .svg-donut-center .donut-hover-label { font-size: 0.7rem; color: var(--text-muted); }
    .svg-donut-center .donut-hover-value { font-size: 0.85rem; font-weight: 700; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; }

    /* â”€â”€ SVG Area Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .svg-area-chart { width: 100%; overflow: visible; }
    .svg-area-path {
      opacity: 0;
      transition: opacity 0.8s ease, d 0.6s ease;
    }
    .svg-area-path.visible { opacity: 1; }
    .svg-area-gridline { stroke: var(--border-primary); stroke-width: 0.5; }
    .svg-area-label { font-size: 10px; fill: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

    /* â”€â”€ SVG Gauge Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .svg-gauge { display: inline-block; position: relative; }
    .svg-gauge svg { overflow: visible; }
    .svg-gauge-arc { fill: none; stroke-width: 14; stroke-linecap: round; }
    .svg-gauge-needle {
      fill: var(--text-primary);
      transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
      transform-origin: center center;
    }
    .svg-gauge-label {
      position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%);
      text-align: center; pointer-events: none;
    }
    .svg-gauge-label .gauge-value { font-size: 1.1rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--text-primary); }
    .svg-gauge-label .gauge-text { font-size: 0.65rem; color: var(--text-muted); }

    /* â”€â”€ Sparkline â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .sparkline-inline { display: inline-block; vertical-align: middle; margin-left: 0.5rem; }
    .sparkline-path {
      fill: none;
      stroke-width: 1.5;
      stroke-linecap: round;
      stroke-linejoin: round;
    }
    .sparkline-fill { opacity: 0.15; }

    /* â”€â”€ Chart Animation Classes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chart-animate-bar {
      transform: scaleY(0);
      transform-origin: bottom;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .chart-animate-bar.visible { transform: scaleY(1); }

    /* â”€â”€ Progress Ring â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-ring {
      transform: rotate(-90deg);
    }
    
    .progress-ring-bg {
      stroke: var(--border-primary);
      fill: none;
    }
    
    .progress-ring-fill {
      fill: none;
      stroke-linecap: round;
      transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* â”€â”€ Scroll Progress Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #scroll-progress {
      position: fixed;
      top: 0;
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, var(--brand-primary), var(--brand-secondary), var(--brand-accent));
      z-index: 9999;
      transition: width 0.1s linear;
      pointer-events: none;
    }

    /* â”€â”€ Input Ripple Effect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-group input,
    .input-group select {
      position: relative;
    }
    .input-group {
      position: relative;
    }
    .input-group .input-ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(99, 102, 241, 0.25);
      transform: scale(0);
      animation: ripple 0.6s ease-out forwards;
      pointer-events: none;
      z-index: 1;
    }

    /* â”€â”€ Page Fade Transitions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .page.fade-out {
      animation: pageFadeOut 0.15s ease forwards;
    }
    .page.fade-in {
      animation: pageFadeIn 0.25s ease forwards;
    }
    @keyframes pageFadeOut {
      from { opacity: 1; transform: translateY(0); }
      to { opacity: 0; transform: translateY(-8px); }
    }
    @keyframes pageFadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€ Loading Skeleton â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .skeleton-overlay {
      position: absolute;
      inset: 0;
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      z-index: 5;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      padding: var(--space-lg);
    }
    .skeleton-line {
      height: 16px;
      border-radius: 4px;
      background: linear-gradient(90deg, var(--border-primary) 25%, var(--bg-elevated) 50%, var(--border-primary) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s ease infinite;
    }
    .skeleton-line.short { width: 60%; }
    .skeleton-line.medium { width: 80%; }
    .skeleton-line.tall { height: 48px; width: 50%; }

    /* â”€â”€ Chart Bar Tooltips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chart-bar-tooltip {
      position: relative;
      cursor: pointer;
    }
    .chart-bar-tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: calc(100% + 6px);
      left: 50%;
      transform: translateX(-50%) scale(0.8);
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-sm);
      padding: 0.25rem 0.5rem;
      font-size: 0.65rem;
      font-family: 'JetBrains Mono', monospace;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: all 0.2s ease;
      box-shadow: var(--shadow-md);
      z-index: 10;
    }
    .chart-bar-tooltip:hover::after {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }

    /* â”€â”€ Confetti Easter Egg â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes confettiFall {
      0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    .confetti-container {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 10000;
      overflow: hidden;
    }
    .confetti-piece {
      position: absolute;
      width: 8px;
      height: 8px;
      top: -10px;
      animation: confettiFall 3s ease-in forwards;
    }

    /* Affiliate CTA banners */
    .affiliate-cta {
      margin-top: 1rem;
      padding: 0.75rem 1rem;
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-md);
      backdrop-filter: blur(12px);
      font-size: 0.8rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .affiliate-cta .ad-label {
      font-size: 0.6rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      border: 1px solid var(--border-primary);
      padding: 0.1rem 0.35rem;
      border-radius: 3px;
      flex-shrink: 0;
    }
    .affiliate-cta a {
      color: var(--brand-accent);
      text-decoration: none;
      font-weight: 500;
    }
    .affiliate-cta a:hover { text-decoration: underline; }

    /* â”€â”€ Print / PDF Export â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media print {
      body { background: white !important; color: black !important; font-size: 12pt; }
      .nav-bar, .cookie-banner, .no-print, .footer, .btn, .action-buttons,
      .theme-toggle, .mobile-menu-btn, .newsletter-section, .hero-cta { display: none !important; }
      * { box-shadow: none !important; text-shadow: none !important; }
      .page { display: block !important; }
      .glass-card, .result-card, .tool-card { background: white !important; border: 1px solid #ddd !important; break-inside: avoid; }
      .section, .calc-container { page-break-inside: avoid; }
      h1, h2, h3 { page-break-after: avoid; color: #1a1a2e !important; -webkit-text-fill-color: #1a1a2e !important; }
      .result-value { -webkit-text-fill-color: #333 !important; color: #333 !important; }
      a { text-decoration: underline; color: #333 !important; }
      @page { margin: 2cm; }
      .page.active::before {
        content: "CalcStack â€” The Financial Toolkit That Actually Gets It Done";
        display: block; text-align: center; font-size: 14pt; font-weight: 700;
        color: #6366f1; border-bottom: 2px solid #6366f1; padding-bottom: 0.5rem; margin-bottom: 1.5rem;
      }
    }
    .action-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
    .action-buttons .btn { font-size: 0.78rem; padding: 0.5rem 1rem; }

    /* â”€â”€ Accessibility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .skip-to-content {
      position: absolute;
      top: -100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--brand-primary);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 0 0 var(--radius-md) var(--radius-md);
      z-index: 10000;
      font-weight: 600;
      font-size: 0.9rem;
      text-decoration: none;
      transition: top 0.2s ease;
    }
    .skip-to-content:focus {
      top: 0;
    }

    /* Focus-visible outlines for all interactive elements */
    a:focus-visible,
    button:focus-visible,
    input:focus-visible,
    select:focus-visible,
    [tabindex]:focus-visible {
      outline: 2px solid var(--brand-primary);
      outline-offset: 2px;
    }

    /* â”€â”€ Mobile Optimization â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      .section { padding: 2rem 1rem; }
      .calc-container { padding: 1.5rem 1rem; }
      .glass-card { padding: var(--space-lg) !important; }
      .btn { width: 100%; }
      .hero-cta .btn { width: auto; min-width: 140px; }
      .action-buttons .btn { flex: 1; min-width: 120px; }
      .tools-grid { grid-template-columns: 1fr; }
      [style*="grid-template-columns: repeat(3"] { grid-template-columns: 1fr !important; }
      [style*="grid-template-columns: 1fr 1fr 1fr"] { grid-template-columns: 1fr !important; }
      .testimonial-grid { grid-template-columns: 1fr; }
      .result-value { font-size: 1.5rem; }
      #page-networth [style*="grid-template-columns: 1fr 1fr 1fr"] { grid-template-columns: 1fr !important; }
      #page-networth [style*="grid-template-columns: 1fr 1fr;"] { grid-template-columns: 1fr !important; }
    }

    /* Touch-friendly sliders (44px min touch target) */
    input[type="range"] {
      height: 8px;
      padding: 18px 0;
      margin: 0;
      box-sizing: content-box;
    }
    input[type="range"]::-webkit-slider-thumb {
      width: 28px;
      height: 28px;
    }
    input[type="range"]::-moz-range-thumb {
      width: 28px;
      height: 28px;
      border: none;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
      cursor: pointer;
    }

    /* â”€â”€ Performance: will-change on animated elements â”€â”€ */
    .hero-blob { will-change: transform; }
    .tool-card { will-change: transform; }
    .animate-fade-up, .animate-scale-in { will-change: transform, opacity; }

    /* â”€â”€ Keyboard Shortcuts Help Overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .shortcuts-overlay {
      position: fixed;
      inset: 0;
      z-index: 10000;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.2s ease;
    }
    .shortcuts-overlay.hidden { display: none; }
    .shortcuts-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      padding: 2rem;
      max-width: 420px;
      width: 90%;
      box-shadow: var(--shadow-xl);
    }
    .shortcuts-card h2 { font-size: 1.25rem; margin-bottom: 1.25rem; }
    .shortcut-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border-primary);
      font-size: 0.85rem;
    }
    .shortcut-row:last-child { border-bottom: none; }
    .shortcut-key {
      display: inline-block;
      background: var(--bg-elevated);
      border: 1px solid var(--border-primary);
      border-radius: 4px;
      padding: 0.15rem 0.5rem;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      font-weight: 600;
      min-width: 28px;
      text-align: center;
    }
    /* â•â• Showcase Carousel â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .showcase-scroll {
      overflow-x: auto;
      overflow-y: visible;
      padding: 1rem 0 1.5rem;
      margin: 0 -1.5rem;
      padding-left: 1.5rem;
      scrollbar-width: none;
      -ms-overflow-style: none;
      scroll-snap-type: x proximity;
    }
    .showcase-scroll::-webkit-scrollbar { display: none; }
    .showcase-track {
      display: flex;
      gap: 1.25rem;
      padding-right: 1.5rem;
    }
    .showcase-card {
      flex: 0 0 260px;
      perspective: 800px;
      cursor: pointer;
      scroll-snap-align: start;
    }
    .showcase-card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid var(--border-primary);
      background: var(--bg-card);
      transition: transform 0.4s cubic-bezier(0.4,0,0.2,1), box-shadow 0.4s ease, border-color 0.4s ease;
      transform-style: preserve-3d;
    }
    .showcase-card:hover .showcase-card-inner {
      transform: scale(1.05) rotateY(-3deg) rotateX(2deg);
      box-shadow: var(--shadow-xl), 0 0 40px rgba(99,102,241,0.12);
      border-color: rgba(99,102,241,0.3);
    }
    .sc-overlay {
      position: absolute;
      inset: 0;
      background: rgba(15,17,23,0.85);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: var(--radius-lg);
    }
    .light .sc-overlay { background: rgba(255,255,255,0.85); }
    .showcase-card:hover .sc-overlay { opacity: 1; }
    .sc-overlay span {
      font-weight: 700;
      font-size: 1rem;
      color: white;
      background: linear-gradient(135deg, var(--brand-primary), var(--brand-secondary));
      padding: 0.6rem 1.5rem;
      border-radius: var(--radius-md);
    }
    .light .sc-overlay span { color: white; }
    .sc-mini-ui { height: 100%; display: flex; flex-direction: column; }
    .sc-mini-header {
      padding: 0.65rem 0.85rem;
      font-size: 0.75rem;
      font-weight: 700;
      color: white;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .sc-mini-body {
      padding: 0.75rem 0.85rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }
    .sc-mini-field {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.68rem;
    }
    .sc-label { color: var(--text-muted); }
    .sc-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--text-primary); font-size: 0.7rem; }
    .sc-mini-result {
      margin-top: auto;
      padding-top: 0.5rem;
      border-top: 1px solid var(--border-primary);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .sc-result-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 600; }
    .sc-result-num { font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; font-weight: 800; color: var(--text-primary); }
    .sc-mini-bar {
      height: 4px;
      background: var(--border-primary);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 0.4rem;
    }
    .sc-bar-fill { height: 100%; border-radius: 2px; transition: width 1s ease; }

    /* Feature grid responsive */
    @media (max-width: 768px) {
      [style*="grid-template-columns:repeat(4"] { grid-template-columns: repeat(2, 1fr) !important; }
    }
    @media (max-width: 480px) {
      [style*="grid-template-columns:repeat(4"] { grid-template-columns: 1fr !important; }
      .showcase-card { flex: 0 0 220px; }
    }

    /* Nav logo SVG */
    .nav-logo-svg { flex-shrink: 0; }
  </style>
</head>
<body class="noise">
  <!-- Skip to Content (Accessibility) -->
  <a href="#main-content" class="skip-to-content">Skip to main content</a>

  <!-- Keyboard Shortcuts Overlay -->
  <div class="shortcuts-overlay hidden" id="shortcuts-overlay" role="dialog" aria-label="Keyboard shortcuts" onclick="if(event.target===this)this.classList.add('hidden')">
    <div class="shortcuts-card">
      <h2>âŒ¨ï¸ Keyboard Shortcuts</h2>
      <div class="shortcut-row"><span>Show this help</span><span class="shortcut-key">?</span></div>
      <div class="shortcut-row"><span>Business Valuation</span><span class="shortcut-key">1</span></div>
      <div class="shortcut-row"><span>M&A Analyzer</span><span class="shortcut-key">2</span></div>
      <div class="shortcut-row"><span>Mortgage Calculator</span><span class="shortcut-key">3</span></div>
      <div class="shortcut-row"><span>Investment Returns</span><span class="shortcut-key">4</span></div>
      <div class="shortcut-row"><span>RRSP vs TFSA</span><span class="shortcut-key">5</span></div>
      <div class="shortcut-row"><span>Compound Interest</span><span class="shortcut-key">6</span></div>
      <div class="shortcut-row"><span>Startup Runway</span><span class="shortcut-key">7</span></div>
      <div class="shortcut-row"><span>Net Worth Tracker</span><span class="shortcut-key">8</span></div>
      <div class="shortcut-row"><span>Lease vs Buy</span><span class="shortcut-key">9</span></div>
      <div class="shortcut-row"><span>Tax Estimator</span><span class="shortcut-key">0</span></div>
      <div class="shortcut-row"><span>Back to Home</span><span class="shortcut-key">Esc</span></div>
      <div class="shortcut-row"><span>Toggle Dark/Light</span><span class="shortcut-key">D</span></div>
    </div>
  </div>

  <!-- Scroll Progress Bar -->
  <div id="scroll-progress"></div>

  <!-- Navigation -->
  <nav class="nav-bar" id="navbar">
    <div class="nav-inner">
      <a href="#" class="nav-logo" onclick="showPage('home'); return false;">
        <svg class="nav-logo-svg" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="logoGrad" x1="0" y1="0" x2="36" y2="36">
              <stop offset="0%" stop-color="#6366f1"/>
              <stop offset="100%" stop-color="#06b6d4"/>
            </linearGradient>
          </defs>
          <rect x="4" y="18" width="28" height="16" rx="3" fill="url(#logoGrad)" opacity="0.3"/>
          <rect x="4" y="10" width="28" height="16" rx="3" fill="url(#logoGrad)" opacity="0.55"/>
          <rect x="4" y="2" width="28" height="16" rx="3" fill="url(#logoGrad)"/>
          <rect x="10" y="6" width="4" height="3" rx="0.5" fill="white" opacity="0.9"/>
          <rect x="16" y="6" width="4" height="3" rx="0.5" fill="white" opacity="0.9"/>
          <rect x="22" y="6" width="4" height="3" rx="0.5" fill="white" opacity="0.9"/>
          <rect x="10" y="11" width="4" height="3" rx="0.5" fill="white" opacity="0.6"/>
          <rect x="16" y="11" width="4" height="3" rx="0.5" fill="white" opacity="0.6"/>
          <rect x="22" y="11" width="4" height="3" rx="0.5" fill="white" opacity="0.6"/>
        </svg>
        <span>CalcStack</span>
      </a>
      
      <ul class="nav-links" id="nav-links">
        <li><a href="#tools" onclick="showPage('home')">Tools</a></li>
        <li><a href="#" onclick="showPage('valuation'); return false;">Valuation</a></li>
        <li><a href="#" onclick="showPage('mortgage'); return false;">Mortgage</a></li>
        <li><a href="#" onclick="showPage('investment'); return false;">Investment</a></li>
        <li><a href="#" onclick="showPage('retirement'); return false;">Retirement</a></li>
        <li><a href="#" onclick="showPage('compound'); return false;">Compound</a></li>
        <li><a href="#" onclick="showPage('salary'); return false;">Salary</a></li>
        <li><a href="#" onclick="showPage('debt'); return false;">Debt</a></li>
        <li><a href="#" onclick="showPage('compare'); return false;">Compare</a></li>
        <li><a href="#" onclick="showPage('currency'); return false;">Currency</a></li>
        <li><a href="#" onclick="showPage('lease'); return false;">Lease vs Buy</a></li>
        <li><a href="#" onclick="showPage('tax'); return false;">Tax</a></li>
      </ul>
      
      <div class="nav-actions">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">ğŸŒ™</button>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">â˜°</button>
      </div>
    </div>
  </nav>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HOME PAGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <main id="main-content">
  <div class="page active" id="page-home">

    <!-- â•â• HERO â•â• -->
    <section class="hero" id="hero" style="min-height:50vh;max-height:50vh;padding-top:5rem;padding-bottom:2rem;">
      <div class="hero-bg">
        <div class="hero-blob hero-blob-1"></div>
        <div class="hero-blob hero-blob-2"></div>
        <div class="hero-blob hero-blob-3"></div>
        <div class="hero-grid"></div>
      </div>
      <!-- Floating geometric shapes -->
      <svg class="hero-decoration" style="top:12%;left:6%;width:70px;height:70px;opacity:0.06;" viewBox="0 0 70 70"><polygon points="35,5 65,60 5,60" fill="none" stroke="var(--brand-primary)" stroke-width="2"><animateTransform attributeName="transform" type="rotate" values="0 35 35;360 35 35" dur="30s" repeatCount="indefinite"/></polygon></svg>
      <svg class="hero-decoration" style="top:25%;right:8%;width:50px;height:50px;opacity:0.06;" viewBox="0 0 50 50"><circle cx="25" cy="25" r="20" fill="none" stroke="var(--brand-accent)" stroke-width="2" stroke-dasharray="6 4"><animateTransform attributeName="transform" type="rotate" values="0 25 25;-360 25 25" dur="25s" repeatCount="indefinite"/></circle></svg>
      <svg class="hero-decoration" style="bottom:15%;left:15%;width:60px;height:60px;opacity:0.06;" viewBox="0 0 60 60"><polygon points="30,3 57,18 57,48 30,63 3,48 3,18" fill="none" stroke="var(--brand-secondary)" stroke-width="1.5"><animateTransform attributeName="transform" type="rotate" values="0 30 33;360 30 33" dur="40s" repeatCount="indefinite"/></polygon></svg>
      <svg class="hero-decoration" style="bottom:20%;right:12%;width:40px;height:40px;opacity:0.05;" viewBox="0 0 40 40"><polygon points="20,2 38,32 2,32" fill="none" stroke="var(--brand-accent)" stroke-width="1.5"><animateTransform attributeName="transform" type="rotate" values="360 20 20;0 20 20" dur="35s" repeatCount="indefinite"/></polygon></svg>

      <div class="hero-content" style="max-width:700px;">
        <div style="display:flex;align-items:center;justify-content:center;gap:0.75rem;margin-bottom:1rem;animation:fadeInUp 0.6s ease both;">
          <svg width="56" height="56" viewBox="0 0 36 36" fill="none">
            <defs><linearGradient id="heroLogoGrad" x1="0" y1="0" x2="36" y2="36"><stop offset="0%" stop-color="#6366f1"/><stop offset="100%" stop-color="#06b6d4"/></linearGradient></defs>
            <rect x="4" y="18" width="28" height="16" rx="3" fill="url(#heroLogoGrad)" opacity="0.3"/>
            <rect x="4" y="10" width="28" height="16" rx="3" fill="url(#heroLogoGrad)" opacity="0.55"/>
            <rect x="4" y="2" width="28" height="16" rx="3" fill="url(#heroLogoGrad)"/>
            <rect x="10" y="6" width="4" height="3" rx="0.5" fill="white" opacity="0.9"/>
            <rect x="16" y="6" width="4" height="3" rx="0.5" fill="white" opacity="0.9"/>
            <rect x="22" y="6" width="4" height="3" rx="0.5" fill="white" opacity="0.9"/>
            <rect x="10" y="11" width="4" height="3" rx="0.5" fill="white" opacity="0.6"/>
            <rect x="16" y="11" width="4" height="3" rx="0.5" fill="white" opacity="0.6"/>
            <rect x="22" y="11" width="4" height="3" rx="0.5" fill="white" opacity="0.6"/>
          </svg>
        </div>
        <h1 style="font-size:clamp(2.5rem,6vw,4.5rem);font-weight:900;letter-spacing:-0.04em;margin-bottom:0.5rem;animation:fadeInUp 0.6s ease 0.1s both;">
          <span class="gradient-text">CalcStack</span>
        </h1>
        <p style="font-size:clamp(1rem,2vw,1.3rem);color:var(--text-secondary);font-weight:300;margin-bottom:2rem;animation:fadeInUp 0.6s ease 0.2s both;">
          Smart money decisions start here
        </p>
        <div style="animation:fadeInUp 0.6s ease 0.3s both;">
          <a href="#showcase" class="btn btn-primary btn-lg" style="padding:1rem 2.5rem;font-size:1.05rem;border-radius:var(--radius-xl);">
            Explore Tools â†’
          </a>
        </div>
      </div>
    </section>

    <!-- â•â• CALCULATOR SHOWCASE â•â• -->
    <section class="section" id="showcase" style="padding-top:3rem;padding-bottom:2rem;">
      <div class="section-header reveal">
        <div class="section-label"><span class="label-line"></span>Calculator Suite<span class="label-line"></span></div>
        <h2 class="section-title" style="font-size:clamp(1.75rem,4vw,2.5rem);">The toolkit, <span class="gradient-text">at a glance</span></h2>
      </div>

      <!-- Category: Business & M&A -->
      <div style="margin-bottom:2.5rem;">
        <p style="font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.12em;color:var(--text-muted);margin-bottom:1rem;" class="reveal">Business & M&A</p>
        <div class="showcase-scroll reveal" id="carousel-business">
          <div class="showcase-track">
            <!-- Business Valuation -->
            <div class="showcase-card" style="height:280px;" onclick="showPage('valuation')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#6366f1,#8b5cf6);">
                    <span>ğŸ¢</span> Business Valuation
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Free Cash Flow</span><span class="sc-value">$1,000,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Growth Rate</span><span class="sc-value">10%</span></div>
                    <div class="sc-mini-field"><span class="sc-label">WACC</span><span class="sc-value">12%</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Enterprise Value</span><span class="sc-result-num">$8.2M</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:72%;background:linear-gradient(90deg,#6366f1,#8b5cf6);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- M&A Analyzer -->
            <div class="showcase-card" style="height:260px;" onclick="showPage('merger')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#8b5cf6,#a78bfa);">
                    <span>ğŸ¤</span> M&A Deal Analyzer
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Deal Value</span><span class="sc-value">$50M</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Synergies</span><span class="sc-value">$3.2M</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">EPS Impact</span><span class="sc-result-num" style="color:#10b981;">+12.4%</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:62%;background:linear-gradient(90deg,#8b5cf6,#a78bfa);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Startup Runway -->
            <div class="showcase-card" style="height:250px;" onclick="showPage('runway')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#a855f7,#c084fc);">
                    <span>ğŸš€</span> Startup Runway
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Monthly Burn</span><span class="sc-value">$85K</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Cash Balance</span><span class="sc-value">$1.2M</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Runway</span><span class="sc-result-num">14.1 mo</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:55%;background:linear-gradient(90deg,#a855f7,#c084fc);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Category: Personal Finance -->
      <div style="margin-bottom:2.5rem;">
        <p style="font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.12em;color:var(--text-muted);margin-bottom:1rem;" class="reveal">Personal Finance</p>
        <div class="showcase-scroll reveal" id="carousel-personal">
          <div class="showcase-track">
            <!-- Mortgage -->
            <div class="showcase-card" style="height:280px;" onclick="showPage('mortgage')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#06b6d4,#22d3ee);">
                    <span>ğŸ </span> Canadian Mortgage
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Home Price</span><span class="sc-value">$750,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Down Payment</span><span class="sc-value">20%</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Rate</span><span class="sc-value">5.24%</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Monthly</span><span class="sc-result-num">$3,584</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:80%;background:linear-gradient(90deg,#06b6d4,#22d3ee);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Investment Returns -->
            <div class="showcase-card" style="height:260px;" onclick="showPage('investment')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#10b981,#34d399);">
                    <span>ğŸ“ˆ</span> Investment Returns
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Initial</span><span class="sc-value">$50,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Monthly Add</span><span class="sc-value">$500</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">10yr Value</span><span class="sc-result-num">$198K</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:68%;background:linear-gradient(90deg,#10b981,#34d399);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Compound Interest -->
            <div class="showcase-card" style="height:270px;" onclick="showPage('compound')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#ec4899,#f472b6);">
                    <span>ğŸ“Š</span> Compound Interest
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Principal</span><span class="sc-value">$10,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Rate</span><span class="sc-value">7%</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Years</span><span class="sc-value">20</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Future Value</span><span class="sc-result-num">$38,697</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:75%;background:linear-gradient(90deg,#ec4899,#f472b6);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Net Worth -->
            <div class="showcase-card" style="height:250px;" onclick="showPage('networth')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#22c55e,#4ade80);">
                    <span>ğŸ’°</span> Net Worth Tracker
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Assets</span><span class="sc-value" style="color:#10b981;">$485K</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Liabilities</span><span class="sc-value" style="color:#ef4444;">$210K</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Net Worth</span><span class="sc-result-num">$275K</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:57%;background:linear-gradient(90deg,#22c55e,#4ade80);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Salary -->
            <div class="showcase-card" style="height:265px;" onclick="showPage('salary')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#14b8a6,#2dd4bf);">
                    <span>ğŸ’¼</span> Salary & Comp
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Base Salary</span><span class="sc-value">$95,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Bonus</span><span class="sc-value">15%</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Take-Home</span><span class="sc-result-num">$6,820/mo</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:64%;background:linear-gradient(90deg,#14b8a6,#2dd4bf);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Debt -->
            <div class="showcase-card" style="height:255px;" onclick="showPage('debt')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#ef4444,#f87171);">
                    <span>ğŸ’³</span> Debt Payoff
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Total Debt</span><span class="sc-value">$24,500</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Monthly Payment</span><span class="sc-value">$800</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Debt-Free In</span><span class="sc-result-num">34 mo</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:48%;background:linear-gradient(90deg,#ef4444,#f87171);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Category: Tax & Planning -->
      <div style="margin-bottom:1rem;">
        <p style="font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.12em;color:var(--text-muted);margin-bottom:1rem;" class="reveal">Tax & Planning</p>
        <div class="showcase-scroll reveal" id="carousel-tax">
          <div class="showcase-track">
            <!-- RRSP vs TFSA -->
            <div class="showcase-card" style="height:270px;" onclick="showPage('retirement')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#f59e0b,#fbbf24);">
                    <span>ğŸ¦</span> RRSP vs TFSA
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Annual Contribution</span><span class="sc-value">$6,500</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Tax Bracket</span><span class="sc-value">33%</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Best Option</span><span class="sc-result-num" style="color:#10b981;">RRSP âœ“</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:70%;background:linear-gradient(90deg,#f59e0b,#fbbf24);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Tax Estimator -->
            <div class="showcase-card" style="height:280px;" onclick="showPage('tax')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#ef4444,#f87171);">
                    <span>ğŸ§¾</span> Canadian Tax Estimator
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Income</span><span class="sc-value">$120,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Province</span><span class="sc-value">Ontario</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Federal Tax</span><span class="sc-value">$18,270</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Effective Rate</span><span class="sc-result-num">28.7%</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:60%;background:linear-gradient(90deg,#ef4444,#f87171);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Lease vs Buy -->
            <div class="showcase-card" style="height:260px;" onclick="showPage('lease')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#f59e0b,#fbbf24);">
                    <span>ğŸš—</span> Lease vs Buy
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Vehicle Price</span><span class="sc-value">$45,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Lease Term</span><span class="sc-value">48 mo</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Better Option</span><span class="sc-result-num" style="color:#10b981;">Buy âœ“</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:52%;background:linear-gradient(90deg,#f59e0b,#fbbf24);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Currency -->
            <div class="showcase-card" style="height:245px;" onclick="showPage('currency')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#14b8a6,#2dd4bf);">
                    <span>ğŸ’±</span> Currency Converter
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">CAD Amount</span><span class="sc-value">$1,000</span></div>
                    <div class="sc-mini-field"><span class="sc-label">To USD</span><span class="sc-value">$735.20</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Rate</span><span class="sc-result-num">0.7352</span></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
            <!-- Compare -->
            <div class="showcase-card" style="height:255px;" onclick="showPage('compare')">
              <div class="showcase-card-inner">
                <div class="sc-mini-ui">
                  <div class="sc-mini-header" style="background:linear-gradient(135deg,#a855f7,#c084fc);">
                    <span>âš–ï¸</span> Side-by-Side Compare
                  </div>
                  <div class="sc-mini-body">
                    <div class="sc-mini-field"><span class="sc-label">Option A</span><span class="sc-value">$3,200/mo</span></div>
                    <div class="sc-mini-field"><span class="sc-label">Option B</span><span class="sc-value">$2,980/mo</span></div>
                    <div class="sc-mini-result"><span class="sc-result-label">Savings</span><span class="sc-result-num" style="color:#10b981;">$26K</span></div>
                    <div class="sc-mini-bar"><div class="sc-bar-fill" style="width:45%;background:linear-gradient(90deg,#a855f7,#c084fc);"></div></div>
                  </div>
                </div>
                <div class="sc-overlay"><span>Try it â†’</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- â•â• SOCIAL PROOF â•â• -->
    <section class="section" style="padding-top:1rem;padding-bottom:2rem;">
      <div style="display:flex;justify-content:center;gap:3rem;flex-wrap:wrap;margin-bottom:2.5rem;" class="reveal">
        <div style="text-align:center;">
          <div class="mono" style="font-size:2rem;font-weight:800;color:var(--text-primary);" data-count-up="10000" data-suffix="+">0</div>
          <div style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-top:0.25rem;">Calculations</div>
        </div>
        <div style="text-align:center;">
          <div class="mono" style="font-size:2rem;font-weight:800;color:var(--brand-warning);" data-count-up="4.9" data-decimals="1">0</div>
          <div style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-top:0.25rem;">â˜… Rating</div>
        </div>
        <div style="text-align:center;">
          <div class="mono" style="font-size:2rem;font-weight:800;color:var(--brand-success);">100%</div>
          <div style="font-size:0.75rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-top:0.25rem;">Free</div>
        </div>
      </div>

      <div class="testimonial-grid" style="max-width:960px;margin:0 auto;">
        <div class="testimonial-card reveal">
          <div class="testimonial-stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p class="testimonial-quote">"Replaced a $2,000/yr Bloomberg terminal for my small M&A practice. The DCF model is surprisingly robust."</p>
          <div class="testimonial-author">
            <div class="testimonial-avatar">JM</div>
            <div><div class="testimonial-name">James M.</div><div class="testimonial-role">M&A Advisor, Toronto</div></div>
          </div>
        </div>
        <div class="testimonial-card reveal">
          <div class="testimonial-stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p class="testimonial-quote">"The mortgage calculator with stress test saved me hours. Finally one that actually does Canadian semi-annual compounding right."</p>
          <div class="testimonial-author">
            <div class="testimonial-avatar">SP</div>
            <div><div class="testimonial-name">Sarah P.</div><div class="testimonial-role">Mortgage Broker, Vancouver</div></div>
          </div>
        </div>
        <div class="testimonial-card reveal">
          <div class="testimonial-stars">â˜…â˜…â˜…â˜…â˜…</div>
          <p class="testimonial-quote">"I use the RRSP vs TFSA tool with every client meeting. Clean, fast, and the visuals actually help explain things."</p>
          <div class="testimonial-author">
            <div class="testimonial-avatar">DK</div>
            <div><div class="testimonial-name">David K.</div><div class="testimonial-role">Financial Planner, Calgary</div></div>
          </div>
        </div>
      </div>
    </section>

    <!-- â•â• HOW IT WORKS â•â• -->
    <section class="section" style="padding-top:1rem;padding-bottom:2rem;">
      <div class="section-header reveal">
        <div class="section-label"><span class="label-line"></span>How It Works<span class="label-line"></span></div>
        <h2 class="section-title">Three steps to <span class="gradient-text">smarter decisions</span></h2>
      </div>
      <div class="how-it-works-steps">
        <div class="how-step reveal">
          <div class="how-connector"></div>
          <div class="how-step-num">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          </div>
          <h3>Choose a calculator</h3>
          <p>Pick from 14 professional-grade tools covering valuation, tax, mortgage, and more.</p>
        </div>
        <div class="how-step reveal">
          <div class="how-connector"></div>
          <div class="how-step-num">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M6 8h.01M10 8h.01M14 8h.01M18 8h.01M6 12h.01M10 12h.01M14 12h.01M18 12h.01M6 16h12"/></svg>
          </div>
          <h3>Enter your numbers</h3>
          <p>Smart defaults get you started instantly. Adjust inputs and watch results update live.</p>
        </div>
        <div class="how-step reveal">
          <div class="how-step-num">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
          </div>
          <h3>Get instant results</h3>
          <p>Visual breakdowns, sensitivity tables, and exportable reports â€” all in your browser.</p>
        </div>
      </div>
    </section>

    <!-- â•â• FEATURE HIGHLIGHTS â•â• -->
    <section class="section" style="padding-top:1rem;padding-bottom:2rem;" id="about">
      <div class="section-header reveal">
        <div class="section-label"><span class="label-line"></span>Why CalcStack<span class="label-line"></span></div>
        <h2 class="section-title">Built <span class="gradient-text">different</span></h2>
      </div>
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:1.25rem;max-width:1000px;margin:0 auto;">
        <div class="glass-card reveal" style="padding:var(--space-xl);text-align:center;">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" style="margin:0 auto 1rem;">
            <rect width="48" height="48" rx="12" fill="url(#logoGrad)" opacity="0.1"/>
            <text x="24" y="32" text-anchor="middle" font-size="24">ğŸ‡¨ğŸ‡¦</text>
          </svg>
          <h3 style="font-size:0.95rem;margin-bottom:0.4rem;">Canadian-First</h3>
          <p style="font-size:0.8rem;color:var(--text-secondary);line-height:1.5;">Built for Canadian tax, mortgage, RRSP rules</p>
        </div>
        <div class="glass-card reveal" style="padding:var(--space-xl);text-align:center;">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" style="margin:0 auto 1rem;">
            <rect width="48" height="48" rx="12" fill="rgba(16,185,129,0.1)"/>
            <text x="24" y="32" text-anchor="middle" font-size="24">ğŸ”“</text>
          </svg>
          <h3 style="font-size:0.95rem;margin-bottom:0.4rem;">No Sign-Up Required</h3>
          <p style="font-size:0.8rem;color:var(--text-secondary);line-height:1.5;">All tools free, no account needed</p>
        </div>
        <div class="glass-card reveal" style="padding:var(--space-xl);text-align:center;">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" style="margin:0 auto 1rem;">
            <rect width="48" height="48" rx="12" fill="rgba(99,102,241,0.1)"/>
            <text x="24" y="32" text-anchor="middle" font-size="24">ğŸ”’</text>
          </svg>
          <h3 style="font-size:0.95rem;margin-bottom:0.4rem;">Privacy-First</h3>
          <p style="font-size:0.8rem;color:var(--text-secondary);line-height:1.5;">All calculations run locally, nothing stored</p>
        </div>
        <div class="glass-card reveal" style="padding:var(--space-xl);text-align:center;">
          <svg width="48" height="48" viewBox="0 0 48 48" fill="none" style="margin:0 auto 1rem;">
            <rect width="48" height="48" rx="12" fill="rgba(6,182,212,0.1)"/>
            <text x="24" y="32" text-anchor="middle" font-size="24">ğŸ“„</text>
          </svg>
          <h3 style="font-size:0.95rem;margin-bottom:0.4rem;">Export & Share</h3>
          <p style="font-size:0.8rem;color:var(--text-secondary);line-height:1.5;">PDF exports for professional use</p>
        </div>
      </div>
    </section>

    <!-- â•â• FOOTER â•â• -->
    <footer class="footer" style="padding:2rem 1.5rem;">
      <div class="footer-content">
        <div style="display:flex;align-items:center;justify-content:center;gap:0.5rem;margin-bottom:0.75rem;">
          <svg width="24" height="24" viewBox="0 0 36 36" fill="none">
            <defs><linearGradient id="footLogoGrad" x1="0" y1="0" x2="36" y2="36"><stop offset="0%" stop-color="#6366f1"/><stop offset="100%" stop-color="#06b6d4"/></linearGradient></defs>
            <rect x="4" y="18" width="28" height="16" rx="3" fill="url(#footLogoGrad)" opacity="0.3"/>
            <rect x="4" y="10" width="28" height="16" rx="3" fill="url(#footLogoGrad)" opacity="0.55"/>
            <rect x="4" y="2" width="28" height="16" rx="3" fill="url(#footLogoGrad)"/>
          </svg>
          <span class="footer-brand gradient-text" style="margin-bottom:0;">CalcStack</span>
        </div>
        <p class="footer-text" style="margin-bottom:1rem;">
          The financial toolkit that actually gets it done. All calculations for educational purposes only.
        </p>
        <div class="footer-links" style="margin-bottom:1rem;">
          <a href="#" onclick="document.querySelector('#carousel-business').scrollIntoView({behavior:'smooth'});return false;">Business & M&A</a>
          <a href="#" onclick="document.querySelector('#carousel-personal').scrollIntoView({behavior:'smooth'});return false;">Personal Finance</a>
          <a href="#" onclick="document.querySelector('#carousel-tax').scrollIntoView({behavior:'smooth'});return false;">Tax & Planning</a>
          <a href="https://github.com/rajkcho/Babaganoush" target="_blank">GitHub</a>
        </div>
        <div style="display:inline-flex;align-items:center;gap:0.375rem;background:rgba(99,102,241,0.08);border:1px solid rgba(99,102,241,0.15);border-radius:var(--radius-full);padding:0.3rem 0.75rem;font-size:0.72rem;color:var(--text-muted);font-weight:600;">
          Built in Canada ğŸ‡¨ğŸ‡¦
        </div>
        <p class="footer-made">Â© 2026 CalcStack</p>
      </div>
    </footer>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BUSINESS VALUATION PAGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-valuation" role="region" aria-label="Business Valuation Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ¢</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Business Valuation Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Estimate business value using DCF, comparable multiples, and asset-based approaches.</p>
      </div>
      
      <!-- Method Tabs -->
      <div class="tabs" style="max-width: 400px; margin: 2rem auto;" id="val-tabs">
        <button class="tab active" onclick="switchValTab('dcf')">DCF</button>
        <button class="tab" onclick="switchValTab('multiples')">Multiples</button>
        <button class="tab" onclick="switchValTab('asset')">Asset-Based</button>
      </div>
      
      <!-- Action Buttons -->
      <div class="action-buttons" style="justify-content: center; margin-bottom: 1rem;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport(document.getElementById('val-dcf').style.display!=='none'?'Business Valuation (DCF)':document.getElementById('val-multiples').style.display!=='none'?'Business Valuation (Multiples)':'Business Valuation (Asset-Based)')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults(document.getElementById('val-dcf').style.display!=='none'?'Business Valuation (DCF)':document.getElementById('val-multiples').style.display!=='none'?'Business Valuation (Multiples)':'Business Valuation (Asset-Based)')">ğŸ“‹ Copy Results</button>
      </div>

      <!-- Compare All Methods -->
      <div id="val-compare" class="chart-container" style="margin-bottom: 2rem; display: none;">
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ğŸ“Š Compare All Methods (Football Field)</div>
        <div id="val-compare-chart"></div>
      </div>

      <!-- DCF Method -->
      <div id="val-dcf" class="animate-fade-up" style="margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Assumptions</h3>
            
            <div class="input-group">
              <label>
                Annual Free Cash Flow (FCF)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Net cash generated by the business after all operating expenses and capital expenditures</span>
                </span>
              </label>
              <input type="number" id="dcf-fcf" value="1000000" placeholder="1,000,000" oninput="calculateDCF()" />
              <span class="input-help">Current annual free cash flow ($)</span>
            </div>
            
            <div class="input-group">
              <label>
                Growth Rate (Year 1-5)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Expected annual growth rate for the projection period</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-growth" min="0" max="30" value="10" step="0.5" oninput="calculateDCF(); document.getElementById('dcf-growth-val').textContent = this.value + '%'" />
                <span id="dcf-growth-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-primary);">10%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>
                Terminal Growth Rate
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Long-term sustainable growth rate (typically 2-3%, matching GDP growth)</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-terminal" min="0" max="5" value="2.5" step="0.25" oninput="calculateDCF(); document.getElementById('dcf-terminal-val').textContent = this.value + '%'" />
                <span id="dcf-terminal-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-accent);">2.5%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>
                Discount Rate (WACC)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Weighted Average Cost of Capital â€” the required rate of return for investors</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-wacc" min="5" max="25" value="12" step="0.5" oninput="calculateDCF(); document.getElementById('dcf-wacc-val').textContent = this.value + '%'" />
                <span id="dcf-wacc-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">12%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>Projection Years</label>
              <select id="dcf-years" onchange="calculateDCF()">
                <option value="5" selected>5 Years</option>
                <option value="7">7 Years</option>
                <option value="10">10 Years</option>
              </select>
            </div>
            
            <div class="input-group">
              <label>Net Debt</label>
              <input type="number" id="dcf-debt" value="0" placeholder="0" oninput="calculateDCF()" />
              <span class="input-help">Total debt minus cash (negative = net cash position)</span>
            </div>
          </div>
          
          <div class="calc-results" id="dcf-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
        
        <!-- DCF Sensitivity Table -->
        <div class="chart-container" style="margin-top: 2rem;" id="dcf-sensitivity">
          <!-- Populated by JS -->
        </div>
        
        <!-- FCF Projection Chart -->
        <div class="chart-container" style="margin-top: 1rem;" id="dcf-chart">
          <!-- Populated by JS -->
        </div>
      </div>
      
      <!-- Multiples Method -->
      <div id="val-multiples" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Company Metrics</h3>
            
            <div class="input-group">
              <label>Annual Revenue</label>
              <input type="number" id="mult-revenue" value="5000000" oninput="calculateMultiples()" />
            </div>
            
            <div class="input-group">
              <label>EBITDA</label>
              <input type="number" id="mult-ebitda" value="1200000" oninput="calculateMultiples()" />
            </div>
            
            <div class="input-group">
              <label>Net Income</label>
              <input type="number" id="mult-income" value="800000" oninput="calculateMultiples()" />
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Industry Presets</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 0.375rem; margin-bottom: 1rem;">
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('saas')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">SaaS</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('manufacturing')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Manufacturing</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('retail')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Retail</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('healthcare')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Healthcare</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('professional')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Prof Services</button>
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 0.5rem 0 1rem;">Industry Multiples</h3>
            
            <div class="input-group">
              <label>EV/Revenue Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-ev-rev" min="0.5" max="15" value="3" step="0.25" oninput="calculateMultiples(); document.getElementById('mult-ev-rev-val').textContent = this.value + 'x'" />
                <span id="mult-ev-rev-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">3x</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>EV/EBITDA Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-ev-ebitda" min="3" max="25" value="10" step="0.5" oninput="calculateMultiples(); document.getElementById('mult-ev-ebitda-val').textContent = this.value + 'x'" />
                <span id="mult-ev-ebitda-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">10x</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>P/E Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-pe" min="5" max="40" value="15" step="0.5" oninput="calculateMultiples(); document.getElementById('mult-pe-val').textContent = this.value + 'x'" />
                <span id="mult-pe-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">15x</span>
              </div>
            </div>
          </div>
          
          <div class="calc-results" id="multiples-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
      </div>
      
      <!-- Asset-Based Method -->
      <div id="val-asset" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Assets</h3>
            
            <div class="input-group">
              <label>Cash & Equivalents</label>
              <input type="number" id="asset-cash" value="500000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Accounts Receivable</label>
              <input type="number" id="asset-ar" value="300000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Inventory</label>
              <input type="number" id="asset-inv" value="200000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Property & Equipment</label>
              <input type="number" id="asset-ppe" value="1000000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Other Assets</label>
              <input type="number" id="asset-other" value="150000" oninput="calculateAsset()" />
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Liabilities</h3>
            
            <div class="input-group">
              <label>Accounts Payable</label>
              <input type="number" id="asset-ap" value="200000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Loans & Debt</label>
              <input type="number" id="asset-debt" value="400000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Other Liabilities</label>
              <input type="number" id="asset-otherliab" value="100000" oninput="calculateAsset()" />
            </div>
          </div>
          
          <div class="calc-results" id="asset-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MORTGAGE CALCULATOR PAGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-mortgage" role="region" aria-label="Canadian Mortgage Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ </div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Canadian Mortgage Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Calculate payments with OSFI stress test, land transfer tax, and complete amortization schedule.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Canadian Mortgage Calculator')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Canadian Mortgage Calculator')">ğŸ“‹ Copy Results</button>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Mortgage Details</h3>
          
          <div class="input-group">
            <label>Home Price</label>
            <input type="number" id="mort-price" value="800000" oninput="calculateMortgage()" />
          </div>
          
          <div class="input-group">
            <label>Down Payment (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="mort-down" min="5" max="50" value="20" step="1" oninput="calculateMortgage(); document.getElementById('mort-down-val').textContent = this.value + '%'" />
              <span id="mort-down-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">20%</span>
            </div>
            <span class="input-help" id="mort-down-help">Down payment: $160,000</span>
          </div>
          
          <div class="input-group">
            <label>Interest Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="mort-rate" min="1" max="10" value="5.5" step="0.05" oninput="calculateMortgage(); document.getElementById('mort-rate-val').textContent = this.value + '%'" />
              <span id="mort-rate-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">5.5%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Amortization Period</label>
            <select id="mort-amort" onchange="calculateMortgage()">
              <option value="25" selected>25 Years</option>
              <option value="30">30 Years</option>
              <option value="20">20 Years</option>
              <option value="15">15 Years</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Payment Frequency</label>
            <select id="mort-freq" onchange="calculateMortgage()">
              <option value="12" selected>Monthly</option>
              <option value="26">Bi-Weekly</option>
              <option value="52">Weekly</option>
              <option value="24">Semi-Monthly</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Province</label>
            <select id="mort-province" onchange="calculateMortgage()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland</option>
              <option value="PE">PEI</option>
            </select>
          </div>
        </div>
        
        <div class="calc-results" id="mortgage-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <!-- Stress Test -->
      <div class="chart-container" style="margin-top: 2rem;" id="mortgage-stress">
        <!-- Populated by JS -->
      </div>

      <!-- Rate Increase Stress Test -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-rate-stress">
        <!-- Populated by JS -->
      </div>

      <!-- Payment Breakdown Donut -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-breakdown">
        <!-- Populated by JS -->
      </div>
      
      <!-- Amortization Schedule -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-amort">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INVESTMENT RETURNS PAGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-investment" role="region" aria-label="Investment Returns Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ“ˆ</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Investment Returns Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Calculate CAGR, simulate dollar-cost averaging, and project portfolio growth over time.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport(document.getElementById('inv-cagr').style.display!=='none'?'Investment Returns (CAGR)':'Investment Returns (DCA)')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults(document.getElementById('inv-cagr').style.display!=='none'?'Investment Returns (CAGR)':'Investment Returns (DCA)')">ğŸ“‹ Copy Results</button>
      </div>

      <div class="tabs" style="max-width: 300px; margin: 2rem auto;" id="inv-tabs">
        <button class="tab active" onclick="switchInvTab('cagr')">CAGR</button>
        <button class="tab" onclick="switchInvTab('dca')">DCA Sim</button>
      </div>
      
      <!-- CAGR Calculator -->
      <div id="inv-cagr" style="margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Investment Details</h3>
            
            <div class="input-group">
              <label>Initial Investment</label>
              <input type="number" id="cagr-initial" value="10000" oninput="calculateCAGR()" />
            </div>
            <div class="input-group">
              <label>Final Value</label>
              <input type="number" id="cagr-final" value="25000" oninput="calculateCAGR()" />
            </div>
            <div class="input-group">
              <label>Time Period (Years)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="cagr-years" min="1" max="30" value="5" step="1" oninput="calculateCAGR(); document.getElementById('cagr-years-val').textContent = this.value + ' yrs'" />
                <span id="cagr-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">5 yrs</span>
              </div>
            </div>
          </div>
          
          <div class="calc-results" id="cagr-results" aria-live="polite"></div>
        </div>
      </div>
      
      <!-- DCA Simulator -->
      <div id="inv-dca" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">DCA Parameters</h3>
            
            <div class="input-group">
              <label>Monthly Investment</label>
              <input type="number" id="dca-monthly" value="500" oninput="calculateDCA()" />
            </div>
            <div class="input-group">
              <label>Expected Annual Return (%)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-return" min="1" max="20" value="8" step="0.5" oninput="calculateDCA(); document.getElementById('dca-return-val').textContent = this.value + '%'" />
                <span id="dca-return-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">8%</span>
              </div>
            </div>
            <div class="input-group">
              <label>Investment Period (Years)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-years" min="1" max="40" value="20" step="1" oninput="calculateDCA(); document.getElementById('dca-years-val').textContent = this.value + ' yrs'" />
                <span id="dca-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">20 yrs</span>
              </div>
            </div>
            <div class="input-group">
              <label>Initial Lump Sum (optional)</label>
              <input type="number" id="dca-initial" value="0" oninput="calculateDCA()" />
            </div>
            <div class="input-group">
              <label>Dividend Yield (%)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-dividend" min="0" max="8" value="0" step="0.25" oninput="calculateDCA(); document.getElementById('dca-dividend-val').textContent = this.value + '%'" />
                <span id="dca-dividend-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-success);">0%</span>
              </div>
              <span class="input-help">Dividends reinvested (DRIP) â€” added to return</span>
            </div>
            <div class="input-group">
              <label>Inflation Rate (%) â€” optional</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-inflation" min="0" max="5" value="2.5" step="0.1" oninput="calculateDCA(); document.getElementById('dca-inflation-val').textContent = this.value + '%'" />
                <span id="dca-inflation-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">2.5%</span>
              </div>
              <span class="input-help">Shows real (inflation-adjusted) values alongside nominal</span>
            </div>
          </div>
          
          <div class="calc-results" id="dca-results" aria-live="polite"></div>
        </div>
        
        <div class="chart-container" style="margin-top: 2rem;" id="dca-chart"></div>
        <div class="chart-container" style="margin-top: 1rem;" id="dca-table"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RRSP vs TFSA PAGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-retirement" role="region" aria-label="RRSP vs TFSA Optimizer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ¦</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">RRSP vs TFSA Optimizer</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Compare tax-sheltered strategies and find your optimal Canadian retirement plan.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('RRSP vs TFSA Optimizer')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('RRSP vs TFSA Optimizer')">ğŸ“‹ Copy Results</button>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Your Situation</h3>
          
          <div class="input-group">
            <label>Annual Income</label>
            <input type="number" id="ret-income" value="120000" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Annual Contribution</label>
            <input type="number" id="ret-contribution" value="20000" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Current Age</label>
            <input type="number" id="ret-age" value="35" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Retirement Age</label>
            <input type="number" id="ret-retire-age" value="60" oninput="calculateRetirement()" />
          </div>
          <div class="input-group">
            <label>Expected Annual Return (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ret-return" min="3" max="12" value="7" step="0.5" oninput="calculateRetirement(); document.getElementById('ret-return-val').textContent = this.value + '%'" />
              <span id="ret-return-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">7%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Expected Retirement Income</label>
            <input type="number" id="ret-retire-income" value="60000" oninput="calculateRetirement()" />
            <span class="input-help">Annual income in retirement (for tax bracket comparison)</span>
          </div>
          <div class="input-group">
            <label>Province</label>
            <select id="ret-province" onchange="calculateRetirement()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
            </select>
          </div>
        </div>
        
        <div class="calc-results" id="retirement-results" aria-live="polite"></div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="retirement-chart"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COMPOUND INTEREST PAGE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-compound" role="region" aria-label="Compound Interest Visualizer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ“Š</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Compound Interest Visualizer</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">See the magic of compound growth. Small contributions today become extraordinary wealth tomorrow.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Compound Interest')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Compound Interest')">ğŸ“‹ Copy Results</button>
      </div>

      <!-- Rule of 72 Quick Calculator -->
      <div class="glass-card animate-fade-up" style="padding: var(--space-xl); margin-top: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">âš¡ Rule of 72 â€” Quick Doubling Calculator</div>
        <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">Enter an interest rate to see how long it takes to double, or enter a target doubling time to find the required rate.</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="input-group">
            <label>Annual Rate (%)</label>
            <input type="number" id="r72-rate" value="7" step="0.1" min="0.1" oninput="calcRule72('rate')" />
            <span class="input-help" id="r72-rate-result" style="font-weight:600; color: var(--brand-primary);">â‰ˆ 10.3 years to double</span>
          </div>
          <div class="input-group">
            <label>Doubling Time (Years)</label>
            <input type="number" id="r72-years" value="10" step="0.5" min="0.5" oninput="calcRule72('years')" />
            <span class="input-help" id="r72-years-result" style="font-weight:600; color: var(--brand-primary);">â‰ˆ 7.2% rate needed</span>
          </div>
        </div>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Initial Amount</label>
            <input type="number" id="comp-initial" value="10000" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Monthly Contribution</label>
            <input type="number" id="comp-monthly" value="300" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Annual Interest Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="comp-rate" min="1" max="15" value="7" step="0.25" oninput="calculateCompound(); document.getElementById('comp-rate-val').textContent = this.value + '%'" />
              <span id="comp-rate-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">7%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Time Period (Years)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="comp-years" min="1" max="50" value="25" step="1" oninput="calculateCompound(); document.getElementById('comp-years-val').textContent = this.value + ' yrs'" />
              <span id="comp-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">25 yrs</span>
            </div>
          </div>
          <div class="input-group">
            <label>Compounding Frequency</label>
            <select id="comp-freq" onchange="calculateCompound()">
              <option value="12" selected>Monthly</option>
              <option value="4">Quarterly</option>
              <option value="1">Annually</option>
              <option value="365">Daily</option>
            </select>
          </div>
          
          <div class="divider"></div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">ğŸ“Š Compare Scenario B</h3>
          <div class="input-group">
            <label>Rate B (%)</label>
            <input type="number" id="comp-rate-b" value="5" step="0.25" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Monthly Contribution B</label>
            <input type="number" id="comp-monthly-b" value="500" oninput="calculateCompound()" />
          </div>
        </div>
        
        <div class="calc-results" id="compound-results" aria-live="polite"></div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="compound-chart"></div>
      <div class="chart-container" style="margin-top: 1rem;" id="compound-comparison"></div>
    </div>
  </div>

  <!-- Placeholder pages for remaining tools -->
  <div class="page" id="page-merger" role="region" aria-label="M&A Deal Analyzer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ¤</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">M&A Deal Analyzer</h1>
        <p style="color: var(--text-secondary);">Accretion/dilution analysis, synergy modeling, and deal structuring.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('M&A Deal Analyzer')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('M&A Deal Analyzer')">ğŸ“‹ Copy Results</button>
      </div>

      <div class="calc-grid animate-fade-up" style="margin-top: 2rem;">
        <!-- Inputs -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Acquirer</h3>

          <div class="input-group">
            <label>Earnings Per Share (EPS)
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Acquirer's current diluted EPS</span></span>
            </label>
            <input type="number" id="ma-acq-eps" value="5.00" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Share Price ($)</label>
            <input type="number" id="ma-acq-price" value="100" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Shares Outstanding (M)</label>
            <input type="number" id="ma-acq-shares" value="500" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>P/E Multiple
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Acquirer's current price-to-earnings ratio</span></span>
            </label>
            <input type="number" id="ma-acq-pe" value="20" step="0.1" oninput="calculateMA()" />
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Target</h3>

          <div class="input-group">
            <label>Earnings Per Share (EPS)</label>
            <input type="number" id="ma-tgt-eps" value="2.50" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Share Price ($)</label>
            <input type="number" id="ma-tgt-price" value="40" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Shares Outstanding (M)</label>
            <input type="number" id="ma-tgt-shares" value="200" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Offer Premium</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-premium" min="10" max="50" value="25" step="1" oninput="calculateMA(); document.getElementById('ma-premium-val').textContent = this.value + '%'" />
              <span id="ma-premium-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-primary);">25%</span>
            </div>
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Deal Structure</h3>

          <div class="input-group">
            <label>Cash Portion</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-cash-pct" min="0" max="100" value="50" step="5" oninput="calculateMA(); document.getElementById('ma-cash-val').textContent = this.value + '% Cash / ' + (100 - this.value) + '% Stock'" />
              <span id="ma-cash-val" class="mono" style="font-size: 0.85rem; min-width: 10rem; text-align: right; color: var(--brand-accent);">50% Cash / 50% Stock</span>
            </div>
          </div>
          <div class="input-group">
            <label>Cost of Debt (for Cash Financing)
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Pre-tax interest rate on new debt raised to fund the cash portion</span></span>
            </label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-debt-cost" min="1" max="12" value="5" step="0.25" oninput="calculateMA(); document.getElementById('ma-debt-cost-val').textContent = this.value + '%'" />
              <span id="ma-debt-cost-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">5%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Tax Rate</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-tax" min="0" max="40" value="25" step="1" oninput="calculateMA(); document.getElementById('ma-tax-val').textContent = this.value + '%'" />
              <span id="ma-tax-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-danger);">25%</span>
            </div>
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Synergies</h3>

          <div class="input-group">
            <label>Expected Revenue Synergies ($M)</label>
            <input type="number" id="ma-rev-syn" value="0" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Expected Cost Synergies ($M)</label>
            <input type="number" id="ma-cost-syn" value="50" step="1" oninput="calculateMA()" />
          </div>
        </div>

        <!-- Results -->
        <div class="calc-results" id="ma-results" aria-live="polite">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Sensitivity Table -->
      <div class="chart-container animate-fade-up" style="margin-top: 2rem;" id="ma-sensitivity">
        <!-- Populated by JS -->
      </div>

      <!-- Sources & Uses -->
      <div class="chart-container animate-fade-up" style="margin-top: 1rem;" id="ma-sources-uses">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STARTUP RUNWAY CALCULATOR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-runway" role="region" aria-label="Startup Runway Calculator">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸš€</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Startup Runway Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Calculate your burn rate, runway, and break-even point. Plan with multiple scenarios.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Startup Runway')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Startup Runway')">ğŸ“‹ Copy Results</button>
      </div>

      <!-- Scenario Tabs -->
      <div class="tabs" id="runway-tabs" style="max-width: 420px; margin: 0 auto 2rem;">
        <button class="tab" onclick="switchRunwayTab('conservative')" id="runway-tab-conservative">Conservative</button>
        <button class="tab active" onclick="switchRunwayTab('base')" id="runway-tab-base">Base Case</button>
        <button class="tab" onclick="switchRunwayTab('aggressive')" id="runway-tab-aggressive">Aggressive</button>
      </div>

      <div class="calc-grid">
        <!-- Inputs -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ğŸ“¥ Financial Inputs</h3>

          <div class="input-group">
            <label>Cash in Bank ($)</label>
            <input type="number" id="rw-cash" value="500000" oninput="calculateRunway()" placeholder="500000" />
          </div>

          <div class="input-group">
            <label>Monthly Revenue ($)</label>
            <input type="number" id="rw-revenue" value="20000" oninput="calculateRunway()" placeholder="20000" />
          </div>

          <div class="input-group">
            <label>Monthly Revenue Growth Rate: <span id="rw-growth-val" class="mono" style="color:var(--brand-primary);">5%</span></label>
            <input type="range" id="rw-growth" min="0" max="30" step="0.5" value="5" oninput="document.getElementById('rw-growth-val').textContent=this.value+'%'; calculateRunway();" />
            <div class="input-help">0% â€” 30% monthly growth</div>
          </div>

          <div class="input-group">
            <label>Monthly Fixed Costs ($)</label>
            <input type="number" id="rw-fixed" value="45000" oninput="calculateRunway()" placeholder="Rent, salaries, tools" />
            <div class="input-help">Rent, salaries, tools, subscriptions</div>
          </div>

          <div class="input-group">
            <label>Monthly Variable Costs ($)</label>
            <input type="number" id="rw-variable" value="8000" oninput="calculateRunway()" placeholder="8000" />
          </div>

          <div class="input-group">
            <label>One-Time Upcoming Expenses ($)</label>
            <input type="number" id="rw-onetime" value="0" oninput="calculateRunway()" placeholder="0" />
          </div>

          <div class="input-group">
            <label>Monthly Hiring Cost Increases ($)</label>
            <input type="number" id="rw-hiring" value="2000" oninput="calculateRunway()" placeholder="Planned monthly increase" />
            <div class="input-help">Added to costs each month cumulatively</div>
          </div>
          
          <div class="divider"></div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">ğŸ‘¥ Hiring Plan</h3>
          <div id="rw-hiring-plan" style="font-size: 0.8rem;">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 0.375rem; margin-bottom: 0.5rem; align-items: end;">
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Role</label><input type="text" value="Engineer" class="rw-hire-role" oninput="calculateRunway()" /></div>
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Salary/mo</label><input type="number" value="8000" class="rw-hire-salary" oninput="calculateRunway()" /></div>
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Start Month</label><input type="number" value="3" class="rw-hire-month" min="1" oninput="calculateRunway()" /></div>
              <button class="btn btn-secondary btn-sm" onclick="this.closest('[style]').remove();calculateRunway();" style="padding:0.2rem 0.4rem;margin-bottom:2px;font-size:0.7rem;">âœ•</button>
            </div>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="addHireRow()" style="font-size:0.7rem;">+ Add Hire</button>
        </div>

        <!-- Results -->
        <div class="calc-results">
          <div class="result-card" style="text-align: center;">
            <div class="result-label">Monthly Burn Rate</div>
            <div class="result-value" id="rw-burn">$0</div>
            <div class="input-help">Current costs âˆ’ revenue</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Runway (No Growth)</div>
            <div class="result-value" id="rw-runway-flat" style="font-size: 1.5rem;">0 months</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Runway (With Growth)</div>
            <div class="result-value" id="rw-runway-growth" style="font-size: 1.5rem;">0 months</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Cash Zero Date</div>
            <div class="result-value" id="rw-zero-date" style="font-size: 1.25rem;">â€”</div>
          </div>

          <div id="rw-safe-zone" class="result-card" style="text-align: center;">
            <div class="result-label">Safety Zone</div>
            <div class="result-value" id="rw-safe-text" style="font-size: 1.5rem;">â€”</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Break-Even Month</div>
            <div class="result-value" id="rw-breakeven" style="font-size: 1.25rem;">â€”</div>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-container" style="margin-top: 2rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ğŸ“Š Monthly Cash Balance Projection</h3>
        <div id="rw-scenario-label" style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">Base Case Scenario</div>
        <div id="rw-chart" style="display: flex; align-items: flex-end; gap: 3px; height: 220px; position: relative; padding-bottom: 24px;">
          <!-- bars injected by JS -->
        </div>
        <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.75rem; font-size: 0.72rem; color: var(--text-muted);">
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:linear-gradient(135deg,var(--brand-primary),var(--brand-accent));display:inline-block;"></span> Positive Balance</span>
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:var(--brand-danger);display:inline-block;"></span> Negative / Danger</span>
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:var(--brand-success);display:inline-block;"></span> Break-Even Reached</span>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NET WORTH TRACKER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-networth" role="region" aria-label="Net Worth Tracker">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ’°</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Net Worth Tracker</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Track your complete financial picture. Save snapshots to monitor progress over time.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Net Worth Tracker')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Net Worth Tracker')">ğŸ“‹ Copy Results</button>
      </div>

      <div class="calc-grid">
        <!-- Assets Column -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--brand-success);">ğŸ“ˆ Assets</h3>

          <div class="input-group">
            <label>Cash & Savings ($)</label>
            <input type="number" id="nw-cash" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>TFSA ($)</label>
            <input type="number" id="nw-tfsa" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>RRSP ($)</label>
            <input type="number" id="nw-rrsp" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Non-Registered Investments ($)</label>
            <input type="number" id="nw-nonreg" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Real Estate ($)</label>
            <input type="number" id="nw-realestate" value="0" oninput="calculateNetWorth()" />
            <div class="input-help">Primary residence market value</div>
          </div>
          <div class="input-group">
            <label>Vehicles ($)</label>
            <input type="number" id="nw-vehicles" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Other Assets ($)</label>
            <input type="number" id="nw-other-assets" value="0" oninput="calculateNetWorth()" />
            <div class="input-help">Business equity, crypto, collectibles</div>
          </div>
        </div>

        <!-- Liabilities Column -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--brand-danger);">ğŸ“‰ Liabilities</h3>

          <div class="input-group">
            <label>Mortgage Balance ($)</label>
            <input type="number" id="nw-mortgage" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Car Loans ($)</label>
            <input type="number" id="nw-carloans" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Student Loans ($)</label>
            <input type="number" id="nw-student" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Credit Card Debt ($)</label>
            <input type="number" id="nw-cc" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Line of Credit ($)</label>
            <input type="number" id="nw-loc" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Other Debt ($)</label>
            <input type="number" id="nw-other-debt" value="0" oninput="calculateNetWorth()" />
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Assets</div>
          <div class="result-value" id="nw-total-assets" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Liabilities</div>
          <div class="result-value" id="nw-total-liabilities" style="font-size: 1.5rem; color: var(--brand-danger); -webkit-text-fill-color: var(--brand-danger);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Liquid Net Worth</div>
          <div class="result-value" id="nw-liquid" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Excludes real estate & vehicles</div>
        </div>
      </div>

      <!-- Big Net Worth Card -->
      <div class="result-card" style="text-align: center; margin-top: 1.5rem; padding: var(--space-2xl);">
        <div class="result-label" style="font-size: 0.9rem;">Net Worth</div>
        <div class="result-value" id="nw-networth" style="font-size: 3rem;">$0</div>
        <div id="nw-dta" style="margin-top: 0.75rem;"></div>
      </div>

      <!-- Pie Chart + Snapshot -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
        <!-- Asset Allocation Pie -->
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ğŸ¥§ Asset Allocation</h3>
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div id="nw-pie" style="width: 150px; height: 150px; border-radius: 50%; flex-shrink: 0; background: var(--border-primary);"></div>
            <div id="nw-pie-legend" style="font-size: 0.75rem; display: flex; flex-direction: column; gap: 0.375rem;"></div>
          </div>
        </div>

        <!-- Snapshots -->
        <div class="chart-container">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
            <h3 style="font-size: 0.95rem;">ğŸ“¸ Snapshots</h3>
            <button class="btn btn-primary btn-sm" onclick="saveNetWorthSnapshot()">Save Snapshot</button>
          </div>
          <div id="nw-snapshots" style="max-height: 250px; overflow-y: auto; font-size: 0.8rem;"></div>
        </div>
      </div>

      <!-- Net Worth Trend Chart -->
      <div class="chart-container" style="margin-top: 1.5rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ğŸ“ˆ Net Worth Over Time</h3>
        <div id="nw-trend-chart"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEASE VS BUY CALCULATOR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-lease" role="region" aria-label="Lease vs Buy Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸš—</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Lease vs Buy Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Compare the total cost of leasing versus buying a vehicle over the same period.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Lease vs Buy')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Lease vs Buy')">ğŸ“‹ Copy Results</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Vehicle & Lease</h3>
          <div class="input-group">
            <label>Vehicle Price ($)</label>
            <input type="number" id="lb-price" value="45000" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Lease Payment / Month ($)</label>
            <input type="number" id="lb-lease-payment" value="450" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Lease Term (Months)</label>
            <input type="number" id="lb-lease-term" value="48" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Residual Value ($)</label>
            <input type="number" id="lb-residual" value="18000" oninput="calculateLeaseBuy()" />
            <span class="input-help">Value at end of lease / what you'd sell for</span>
          </div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Buy Financing</h3>
          <div class="input-group">
            <label>Buy Loan Rate (%)</label>
            <input type="number" id="lb-buy-rate" value="5.5" step="0.1" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Buy Loan Term (Months)</label>
            <input type="number" id="lb-buy-term" value="60" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Down Payment ($)</label>
            <input type="number" id="lb-down" value="5000" oninput="calculateLeaseBuy()" />
          </div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Running Costs Difference</h3>
          <div class="input-group">
            <label>Insurance Difference / Month ($)</label>
            <input type="number" id="lb-insurance-diff" value="50" oninput="calculateLeaseBuy()" />
            <span class="input-help">How much MORE buying costs for insurance (can be negative)</span>
          </div>
          <div class="input-group">
            <label>Maintenance Difference / Month ($)</label>
            <input type="number" id="lb-maint-diff" value="30" oninput="calculateLeaseBuy()" />
            <span class="input-help">How much MORE buying costs for maintenance (can be negative)</span>
          </div>
        </div>
        <div class="calc-results" id="lease-buy-results" aria-live="polite"></div>
      </div>
      <div class="chart-container" style="margin-top: 2rem;" id="lease-buy-chart"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CANADIAN TAX ESTIMATOR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-tax" role="region" aria-label="Canadian Tax Estimator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ§¾</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Canadian Tax Estimator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Estimate your 2025 federal and provincial income tax across all 10 Canadian provinces.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Canadian Tax Estimator')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Canadian Tax Estimator')">ğŸ“‹ Copy Results</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Province</label>
            <select id="tax-province" onchange="calculateTax()">
              <option value="ON">Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="PE">Prince Edward Island</option>
            </select>
          </div>
          <div class="input-group">
            <label>Employment Income ($)</label>
            <input type="number" id="tax-employment" value="85000" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Self-Employment Income ($)</label>
            <input type="number" id="tax-self" value="0" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Capital Gains ($)</label>
            <input type="number" id="tax-capgains" value="0" oninput="calculateTax()" />
            <span class="input-help">Only 50% is taxable</span>
          </div>
          <div class="input-group">
            <label>Eligible Dividends ($)</label>
            <input type="number" id="tax-dividends" value="0" oninput="calculateTax()" />
            <span class="input-help">Grossed up by 38% for tax, then dividend tax credit applied</span>
          </div>
          <div class="input-group">
            <label>RRSP Deduction ($)</label>
            <input type="number" id="tax-rrsp" value="0" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Other Deductions ($)</label>
            <input type="number" id="tax-other-ded" value="0" oninput="calculateTax()" />
          </div>
        </div>
        <div class="calc-results" id="tax-results" aria-live="polite"></div>
      </div>
      <div class="chart-container" style="margin-top: 2rem;" id="tax-chart"></div>
      <div class="chart-container" style="margin-top: 1rem;" id="tax-province-compare"></div>
    </div>
  </div>

  </main>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SALARY & COMPENSATION ANALYZER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-salary">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ’¼</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Salary & Compensation Analyzer</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Analyze your total compensation package including base, bonus, equity, and benefits with Canadian tax estimates.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Salary & Compensation Analyzer')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Salary & Compensation Analyzer')">ğŸ“‹ Copy Results</button>
      </div>

      <div class="calc-grid">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: #14b8a6;">ğŸ’° Cash Compensation</h3>
          <div class="input-group">
            <label>Annual Base Salary ($)</label>
            <input type="number" id="sal-base" value="85000" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Bonus (%)</label>
            <input type="number" id="sal-bonus-pct" value="10" step="1" oninput="calculateSalary()" />
            <div class="input-help">Annual bonus as % of base salary</div>
          </div>

          <h3 style="font-size: 0.95rem; margin: 1.5rem 0 1rem; color: #14b8a6;">ğŸ“Š Stock Options / Equity</h3>
          <div class="input-group">
            <label>Number of Shares</label>
            <input type="number" id="sal-shares" value="1000" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Strike Price ($)</label>
            <input type="number" id="sal-strike" value="10" step="0.01" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Current Share Price ($)</label>
            <input type="number" id="sal-current-price" value="25" step="0.01" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Vesting Period (years)</label>
            <input type="number" id="sal-vesting" value="4" min="1" oninput="calculateSalary()" />
          </div>
        </div>

        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: #14b8a6;">ğŸ¥ Benefits</h3>
          <div class="input-group">
            <label>Health Benefits Value ($/yr)</label>
            <input type="number" id="sal-health" value="5000" oninput="calculateSalary()" />
            <div class="input-help">Employer-paid health, dental, vision</div>
          </div>
          <div class="input-group">
            <label>Pension / RRSP Match ($/yr)</label>
            <input type="number" id="sal-pension" value="4000" oninput="calculateSalary()" />
          </div>

          <h3 style="font-size: 0.95rem; margin: 1.5rem 0 1rem; color: #14b8a6;">ğŸ Tax Province</h3>
          <div class="input-group">
            <label>Province</label>
            <select id="sal-province" onchange="calculateSalary()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="PE">Prince Edward Island</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Compensation</div>
          <div class="result-value" id="sal-total-comp" style="font-size: 1.5rem;">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">After-Tax Take-Home</div>
          <div class="result-value" id="sal-take-home" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Effective Tax Rate</div>
          <div class="result-value" id="sal-eff-tax" style="font-size: 1.5rem;">0%</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Hourly Rate Equivalent</div>
          <div class="result-value" id="sal-hourly" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Based on 2,080 hrs/yr</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Stock Option Value</div>
          <div class="result-value" id="sal-equity-val" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Intrinsic value (annualized)</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Annual Bonus</div>
          <div class="result-value" id="sal-bonus-val" style="font-size: 1.5rem;">$0</div>
        </div>
      </div>

      <!-- Comparison + Pie -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1.5rem;">
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ğŸ¥§ Compensation Breakdown</h3>
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div id="sal-pie" style="width: 150px; height: 150px; border-radius: 50%; flex-shrink: 0; background: var(--border-primary);"></div>
            <div id="sal-pie-legend" style="font-size: 0.75rem; display: flex; flex-direction: column; gap: 0.375rem;"></div>
          </div>
        </div>
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ğŸ“Š How You Compare</h3>
          <div id="sal-comparison" style="font-size: 0.85rem;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DEBT PAYOFF CALCULATOR
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-debt">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ’³</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Debt Payoff Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Compare Avalanche vs Snowball strategies. See your debt-free date and how extra payments save you money.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Debt Payoff Calculator')">ğŸ“„ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Debt Payoff Calculator')">ğŸ“‹ Copy Results</button>
      </div>

      <div class="calc-inputs glass-card" style="padding: var(--space-xl); margin-top: 1.5rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
          <h3 style="font-size: 0.95rem; color: #ef4444;">ğŸ“‹ Your Debts</h3>
          <button class="btn btn-primary btn-sm" onclick="addDebtRow()">+ Add Debt</button>
        </div>
        <div id="debt-rows">
          <div class="debt-row" style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 1.5fr auto; gap: 0.5rem; align-items: end; margin-bottom: 0.5rem;">
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="Credit Card" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="8000" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="19.99" step="0.01" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="200" oninput="calculateDebt()" /></div>
            <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">âœ•</button>
          </div>
          <div class="debt-row" style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 1.5fr auto; gap: 0.5rem; align-items: end; margin-bottom: 0.5rem;">
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="Car Loan" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="15000" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="6.5" step="0.01" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="350" oninput="calculateDebt()" /></div>
            <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">âœ•</button>
          </div>
        </div>
      </div>

      <div class="calc-inputs glass-card" style="padding: var(--space-xl); margin-top: 1rem;">
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
          <div>
            <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem;">âš”ï¸ Strategy</h3>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn-primary btn-sm" id="debt-btn-avalanche" onclick="setDebtStrategy('avalanche')">ğŸ”ï¸ Avalanche</button>
              <button class="btn btn-secondary btn-sm" id="debt-btn-snowball" onclick="setDebtStrategy('snowball')">â›„ Snowball</button>
            </div>
            <div class="input-help" style="margin-top:0.25rem" id="debt-strategy-help">Highest interest rate first â€” saves the most money</div>
          </div>
          <div style="flex:1; min-width: 200px;">
            <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem;">ğŸ’ª Extra Monthly Payment</h3>
            <input type="range" id="debt-extra" min="0" max="2000" step="25" value="200" oninput="document.getElementById('debt-extra-val').textContent='$'+this.value; calculateDebt();" style="width:100%;" />
            <div style="display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-secondary)"><span>$0</span><span id="debt-extra-val">$200</span><span>$2,000</span></div>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Interest Paid</div>
          <div class="result-value" id="debt-total-interest" style="font-size: 1.5rem; color: var(--brand-danger); -webkit-text-fill-color: var(--brand-danger);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Debt-Free Date</div>
          <div class="result-value" id="debt-free-date" style="font-size: 1.3rem;">â€”</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Months to Debt-Free</div>
          <div class="result-value" id="debt-months" style="font-size: 1.5rem;">0</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Savings vs Minimum Only</div>
          <div class="result-value" id="debt-savings" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
        </div>
        <div class="result-card" style="text-align: center; padding: var(--space-xl);">
          <div class="result-label" style="font-size: 1rem;">ğŸ¯ Debt-Free Countdown</div>
          <div class="result-value" id="debt-countdown" style="font-size: 2rem;">â€”</div>
        </div>
      </div>

      <!-- Timeline Chart -->
      <div class="chart-container" style="margin-top: 1.5rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ğŸ“ˆ Payoff Timeline</h3>
        <div id="debt-timeline-chart" style="height: 250px; position: relative;"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SIDE-BY-SIDE COMPARISON
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-compare" role="region" aria-label="Side-by-Side Comparison">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1100px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">âš–ï¸</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Side-by-Side Comparison</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Compare two mortgage scenarios to see which option saves you more money.</p>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
        <!-- Scenario A -->
        <div class="glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--brand-primary);">ğŸ…°ï¸ Scenario A</h3>
          <div class="input-group"><label>Home Price ($)</label><input type="number" id="cmp-a-price" value="600000" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Interest Rate (%)</label><input type="number" id="cmp-a-rate" value="5.5" step="0.01" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Amortization (years)</label><input type="number" id="cmp-a-amort" value="25" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Down Payment (%)</label><input type="number" id="cmp-a-down" value="20" oninput="calculateComparison()" /></div>
        </div>
        <!-- Scenario B -->
        <div class="glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--brand-accent);">ğŸ…±ï¸ Scenario B</h3>
          <div class="input-group"><label>Home Price ($)</label><input type="number" id="cmp-b-price" value="550000" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Interest Rate (%)</label><input type="number" id="cmp-b-rate" value="4.8" step="0.01" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Amortization (years)</label><input type="number" id="cmp-b-amort" value="30" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Down Payment (%)</label><input type="number" id="cmp-b-down" value="20" oninput="calculateComparison()" /></div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">ğŸ…°ï¸ Monthly Payment</div>
          <div class="result-value" id="cmp-a-payment" style="font-size: 1.5rem;">$0</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Total Interest: <span id="cmp-a-interest">$0</span></div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Cost: <span id="cmp-a-total">$0</span></div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">ğŸ…±ï¸ Monthly Payment</div>
          <div class="result-value" id="cmp-b-payment" style="font-size: 1.5rem;">$0</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Total Interest: <span id="cmp-b-interest">$0</span></div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Cost: <span id="cmp-b-total">$0</span></div>
        </div>
      </div>

      <!-- Verdict -->
      <div class="result-card" style="margin-top: 1.5rem; text-align: center; padding: var(--space-xl);">
        <div class="result-label" style="font-size: 1.1rem;">ğŸ† Verdict</div>
        <div class="result-value" id="cmp-verdict" style="font-size: 1.2rem; line-height: 1.6;">Enter values to compare</div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CURRENCY CONVERTER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="page" id="page-currency" role="region" aria-label="Currency Converter">
    <div class="calc-container" style="padding-top: 6rem; max-width: 700px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">â† Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ğŸ’±</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Currency Converter</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Convert Canadian Dollars to major world currencies. Rates are approximate.</p>
      </div>

      <div class="glass-card" style="padding: var(--space-xl); margin-top: 2rem;">
        <div class="input-group">
          <label>Amount in CAD ($)</label>
          <input type="number" id="currency-amount" value="1000" oninput="convertCurrency()" style="font-size: 1.2rem; text-align: center;" />
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1.5rem;" id="currency-results">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">ğŸ‡ºğŸ‡¸ US Dollar (USD)</div>
          <div class="result-value" id="cur-usd" style="font-size: 1.4rem;">$0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.7353 USD</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">ğŸ‡ªğŸ‡º Euro (EUR)</div>
          <div class="result-value" id="cur-eur" style="font-size: 1.4rem;">â‚¬0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.6803 EUR</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">ğŸ‡¬ğŸ‡§ British Pound (GBP)</div>
          <div class="result-value" id="cur-gbp" style="font-size: 1.4rem;">Â£0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.5814 GBP</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">ğŸ‡®ğŸ‡³ Indian Rupee (INR)</div>
          <div class="result-value" id="cur-inr" style="font-size: 1.4rem;">â‚¹0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 62.50 INR</div>
        </div>
        <div class="result-card" style="text-align: center; grid-column: 1 / -1;">
          <div class="result-label">ğŸ‡¯ğŸ‡µ Japanese Yen (JPY)</div>
          <div class="result-value" id="cur-jpy" style="font-size: 1.4rem;">Â¥0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 111.11 JPY</div>
        </div>
      </div>

      <p style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-top: 1.5rem;">âš ï¸ Rates are approximate and for reference only. Based on: USD 1.36, EUR 1.47, GBP 1.72, INR 0.016, JPY 0.009 per CAD.</p>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       JAVASCRIPT ENGINE
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    console.log('CalcStack v3.0 loaded â€” run runTests() in console to verify');

    // â”€â”€ Floating Particles Generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    (function initParticles() {
      const container = document.getElementById('hero-particles');
      if (!container) return;
      const colors = ['var(--brand-primary)', 'var(--brand-secondary)', 'var(--brand-accent)', 'var(--brand-success)'];
      for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const size = 2 + Math.random() * 6;
        p.style.width = size + 'px';
        p.style.height = size + 'px';
        p.style.left = Math.random() * 100 + '%';
        p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        p.style.animationDuration = (15 + Math.random() * 25) + 's';
        p.style.animationDelay = (-Math.random() * 30) + 's';
        container.appendChild(p);
      }
    })();

    // â”€â”€ Featured Calculator Demo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateFeaturedDemo() {
      const fcf = parseFloat(document.getElementById('featured-fcf').value) || 0;
      const growth = (parseFloat(document.getElementById('featured-growth').value) || 0) / 100;
      const wacc = 0.12, terminal = 0.025, years = 5;
      if (wacc <= terminal || fcf <= 0) { document.getElementById('featured-result').textContent = '$0'; return; }
      let pv = 0;
      for (let i = 1; i <= years; i++) pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
      const ff = fcf * Math.pow(1 + growth, years) * (1 + terminal);
      pv += (ff / (wacc - terminal)) / Math.pow(1 + wacc, years);
      document.getElementById('featured-result').textContent = fmt(pv);
    }
    setTimeout(updateFeaturedDemo, 100);

    // â”€â”€ Industry Multiplier Presets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setIndustryPreset(industry) {
      const presets = {
        saas: { evRev: 8, evEbitda: 25, pe: 35 },
        manufacturing: { evRev: 1.5, evEbitda: 8, pe: 14 },
        retail: { evRev: 0.75, evEbitda: 7, pe: 12 },
        healthcare: { evRev: 3, evEbitda: 14, pe: 22 },
        professional: { evRev: 2, evEbitda: 10, pe: 18 }
      };
      const p = presets[industry];
      if (!p) return;
      document.getElementById('mult-ev-rev').value = p.evRev;
      document.getElementById('mult-ev-rev-val').textContent = p.evRev + 'x';
      document.getElementById('mult-ev-ebitda').value = p.evEbitda;
      document.getElementById('mult-ev-ebitda-val').textContent = p.evEbitda + 'x';
      document.getElementById('mult-pe').value = p.pe;
      document.getElementById('mult-pe-val').textContent = p.pe + 'x';
      calculateMultiples();
    }

    // â”€â”€ Hiring Plan Row â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addHireRow() {
      const plan = document.getElementById('rw-hiring-plan');
      const row = document.createElement('div');
      row.style.cssText = 'display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:0.375rem;margin-bottom:0.5rem;align-items:end;';
      row.innerHTML = '<div class="input-group" style="margin:0"><label style="font-size:0.65rem">Role</label><input type="text" value="New Hire" class="rw-hire-role" oninput="calculateRunway()" /></div><div class="input-group" style="margin:0"><label style="font-size:0.65rem">Salary/mo</label><input type="number" value="6000" class="rw-hire-salary" oninput="calculateRunway()" /></div><div class="input-group" style="margin:0"><label style="font-size:0.65rem">Start Month</label><input type="number" value="6" class="rw-hire-month" min="1" oninput="calculateRunway()" /></div><button class="btn btn-secondary btn-sm" onclick="this.closest(\'[style]\').remove();calculateRunway();" style="padding:0.2rem 0.4rem;margin-bottom:2px;font-size:0.7rem;">âœ•</button>';
      plan.appendChild(row);
    }

    // â”€â”€ Utility Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const fmt = (n, decimals = 0) => {
      if (n === undefined || n === null || isNaN(n)) return '$0';
      const abs = Math.abs(n);
      if (abs >= 1e9) return (n < 0 ? '-' : '') + '$' + (abs / 1e9).toFixed(1) + 'B';
      if (abs >= 1e6) return (n < 0 ? '-' : '') + '$' + (abs / 1e6).toFixed(1) + 'M';
      if (abs >= 1e3) return (n < 0 ? '-' : '') + '$' + (abs / 1e3).toFixed(decimals > 0 ? decimals : 0) + 'K';
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: decimals }).format(n);
    };
    
    const fmtFull = (n) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'CAD', maximumFractionDigits: 0 }).format(n || 0);
    
    const fmtPct = (n, decimals = 1) => (n || 0).toFixed(decimals) + '%';
    
    const fmtNum = (n) => new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(n || 0);
    
    // â”€â”€ Page Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const target = document.getElementById('page-' + pageId);
      if (target) {
        target.classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      
      // Close mobile menu
      document.getElementById('nav-links').classList.remove('mobile-open');
      
      // Initialize calculators
      if (pageId === 'valuation') calculateDCF();
      if (pageId === 'mortgage') calculateMortgage();
      if (pageId === 'investment') calculateCAGR();
      if (pageId === 'retirement') calculateRetirement();
      if (pageId === 'compound') calculateCompound();
      if (pageId === 'runway') calculateRunway();
      if (pageId === 'networth') { calculateNetWorth(); loadNetWorthSnapshots(); }
      if (pageId === 'salary') calculateSalary();
      if (pageId === 'debt') calculateDebt();
      if (pageId === 'compare') calculateComparison();
      if (pageId === 'currency') convertCurrency();
      if (pageId === 'lease') calculateLeaseBuy();
      if (pageId === 'tax') calculateTax();
    }
    
    // â”€â”€ Theme Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let isDark = localStorage.getItem('theme') === 'dark';
    
    function toggleTheme() {
      isDark = !isDark;
      document.documentElement.classList.toggle('light', !isDark);
      document.querySelector('.theme-toggle').textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    }
    
    // Initialize theme
    if (!isDark) {
      document.documentElement.classList.add('light');
      document.querySelector('.theme-toggle').textContent = 'â˜€ï¸';
    }
    
    // â”€â”€ Mobile Menu â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleMobileMenu() {
      document.getElementById('nav-links').classList.toggle('mobile-open');
    }
    
    // â”€â”€ Navbar Scroll Effect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('scroll', () => {
      document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
    });
    
    // â”€â”€ Intersection Observer for Reveals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    
    // â”€â”€ Hero Counter Animation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function animateCounters() {
      document.querySelectorAll('[data-count]').forEach(el => {
        const target = parseInt(el.dataset.count) || 0;
        const suffix = el.dataset.suffix || (target > 10 ? '+' : '');
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(timer);
          }
          const val = Math.floor(current);
          el.textContent = (val >= 1000 ? (val / 1000).toFixed(val >= 10000 ? 0 : 1) + 'K' : val) + suffix;
        }, 35);
      });
    }
    
    // Use IntersectionObserver for hero stats
    const heroStatsObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounters();
          heroStatsObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });
    const heroStats = document.querySelector('.hero-stats');
    if (heroStats) heroStatsObserver.observe(heroStats);

    // â”€â”€ Count-up animation for social proof numbers â”€â”€â”€â”€â”€â”€
    const countUpObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const el = entry.target;
          const target = parseFloat(el.getAttribute('data-count-up'));
          const suffix = el.getAttribute('data-suffix') || '';
          const decimals = parseInt(el.getAttribute('data-decimals') || '0');
          const duration = 2000;
          const start = performance.now();
          function tick(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            const eased = 1 - Math.pow(1 - progress, 3);
            const current = eased * target;
            el.textContent = (decimals > 0 ? current.toFixed(decimals) : Math.floor(current).toLocaleString()) + suffix;
            if (progress < 1) requestAnimationFrame(tick);
          }
          requestAnimationFrame(tick);
          countUpObserver.unobserve(el);
        }
      });
    }, { threshold: 0.5 });
    document.querySelectorAll('[data-count-up]').forEach(el => countUpObserver.observe(el));
    
    // â”€â”€ Valuation Tab Switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchValTab(tab) {
      document.querySelectorAll('#val-tabs .tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('val-dcf').style.display = tab === 'dcf' ? 'block' : 'none';
      document.getElementById('val-multiples').style.display = tab === 'multiples' ? 'block' : 'none';
      document.getElementById('val-asset').style.display = tab === 'asset' ? 'block' : 'none';
      
      if (tab === 'dcf') calculateDCF();
      if (tab === 'multiples') calculateMultiples();
      if (tab === 'asset') calculateAsset();
      updateValuationComparison();
    }
    
    // â”€â”€ Investment Tab Switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function switchInvTab(tab) {
      document.querySelectorAll('#inv-tabs .tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('inv-cagr').style.display = tab === 'cagr' ? 'block' : 'none';
      document.getElementById('inv-dca').style.display = tab === 'dca' ? 'block' : 'none';
      
      if (tab === 'cagr') calculateCAGR();
      if (tab === 'dca') calculateDCA();
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DCF CALCULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateDCF() {
      const fcf = parseFloat(document.getElementById('dcf-fcf').value) || 0;
      const growth = (parseFloat(document.getElementById('dcf-growth').value) || 0) / 100;
      const terminal = (parseFloat(document.getElementById('dcf-terminal').value) || 0) / 100;
      const wacc = (parseFloat(document.getElementById('dcf-wacc').value) || 0) / 100;
      const years = parseInt(document.getElementById('dcf-years').value) || 5;
      const debt = parseFloat(document.getElementById('dcf-debt').value) || 0;
      
      if (wacc <= terminal) {
        document.getElementById('dcf-results').innerHTML = `
          <div class="result-card" style="border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
            <p style="color: var(--brand-danger); font-weight: 600;">âš ï¸ Discount rate must be higher than terminal growth rate</p>
          </div>`;
        return;
      }
      
      // Project FCFs
      let projections = [];
      let pvSum = 0;
      
      for (let i = 1; i <= years; i++) {
        const projFCF = fcf * Math.pow(1 + growth, i);
        const pvFactor = Math.pow(1 + wacc, i);
        const pvFCF = projFCF / pvFactor;
        pvSum += pvFCF;
        projections.push({ year: i, fcf: projFCF, pv: pvFCF });
      }
      
      // Terminal value (Gordon Growth Model)
      const finalFCF = fcf * Math.pow(1 + growth, years);
      const terminalFCF = finalFCF * (1 + terminal);
      const terminalValue = terminalFCF / (wacc - terminal);
      const pvTerminal = terminalValue / Math.pow(1 + wacc, years);
      
      const enterpriseValue = pvSum + pvTerminal;
      const equityValue = enterpriseValue - debt;
      const tvPct = (pvTerminal / enterpriseValue * 100);
      
      // Results
      document.getElementById('dcf-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Enterprise Value</div>
          <div class="result-value">${fmt(enterpriseValue)}</div>
          <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">PV of FCFs: ${fmt(pvSum)}</span>
            <span class="metric-pill neutral">PV Terminal: ${fmt(pvTerminal)}</span>
          </div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Equity Value</div>
          <div class="result-value" style="${equityValue < 0 ? 'background: linear-gradient(135deg, var(--brand-danger), #f97316); -webkit-background-clip: text;' : ''}">${fmt(equityValue)}</div>
          ${debt !== 0 ? `<div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">After ${debt > 0 ? 'subtracting' : 'adding'} ${fmtFull(Math.abs(debt))} net debt</div>` : ''}
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Key Metrics</div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Terminal Value %</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700; color: ${tvPct > 75 ? 'var(--brand-warning)' : 'var(--text-primary)'};">${tvPct.toFixed(1)}%</div>
              ${tvPct > 75 ? '<div style="font-size: 0.65rem; color: var(--brand-warning);">âš ï¸ High TV reliance</div>' : ''}
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Implied Multiple</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${(enterpriseValue / fcf).toFixed(1)}x FCF</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Year ${years} FCF</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${fmt(finalFCF)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Terminal Value</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${fmt(terminalValue)}</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">FCF Projections</div>
          ${projections.map(p => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
              <span style="font-size: 0.8rem; color: var(--text-muted);">Year ${p.year}</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(p.fcf)}</span>
              <span class="mono" style="font-size: 0.75rem; color: var(--text-muted);">PV: ${fmt(p.pv)}</span>
            </div>
          `).join('')}
        </div>
      `;
      
      // Sensitivity table
      const waccRange = [-2, -1, 0, 1, 2].map(d => wacc * 100 + d);
      const growthRange = [-1, -0.5, 0, 0.5, 1].map(d => terminal * 100 + d).filter(g => g >= 0);
      
      let tableHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Sensitivity Analysis: Enterprise Value</div>
        <div style="overflow-x: auto;">
        <table class="sensitivity-table">
          <tr>
            <th>WACC \\ Terminal G</th>
            ${growthRange.map(g => `<th>${g.toFixed(1)}%</th>`).join('')}
          </tr>
      `;
      
      waccRange.forEach(w => {
        tableHTML += `<tr><td>${w.toFixed(1)}%</td>`;
        growthRange.forEach(g => {
          if (w / 100 <= g / 100) {
            tableHTML += '<td style="color: var(--text-muted);">N/A</td>';
            return;
          }
          let pv = 0;
          for (let i = 1; i <= years; i++) {
            pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + w / 100, i);
          }
          const tFCF = fcf * Math.pow(1 + growth, years) * (1 + g / 100);
          const tv = tFCF / (w / 100 - g / 100);
          const pvTV = tv / Math.pow(1 + w / 100, years);
          const ev = pv + pvTV;
          const isBase = Math.abs(w - wacc * 100) < 0.01 && Math.abs(g - terminal * 100) < 0.01;
          tableHTML += `<td class="${isBase ? 'highlight' : ''}">${fmt(ev)}</td>`;
        });
        tableHTML += '</tr>';
      });
      
      tableHTML += '</table></div>';
      document.getElementById('dcf-sensitivity').innerHTML = tableHTML;
      updateValuationComparison();
      
      // Bar chart
      const maxFCF = Math.max(...projections.map(p => p.fcf));
      document.getElementById('dcf-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Projected Free Cash Flow</div>
        <div style="display: flex; align-items: flex-end; gap: 0.5rem; height: 200px; padding: 0 0.5rem;">
          ${projections.map(p => `
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <span class="mono" style="font-size: 0.65rem; color: var(--text-muted);">${fmt(p.fcf)}</span>
              <div style="width: 100%; height: ${(p.fcf / maxFCF * 150)}px; background: linear-gradient(180deg, var(--brand-primary), var(--brand-accent)); border-radius: 4px 4px 0 0; transition: height 1s ease; min-height: 4px;"></div>
              <span style="font-size: 0.7rem; color: var(--text-muted);">Y${p.year}</span>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MULTIPLES CALCULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateMultiples() {
      const revenue = parseFloat(document.getElementById('mult-revenue').value) || 0;
      const ebitda = parseFloat(document.getElementById('mult-ebitda').value) || 0;
      const income = parseFloat(document.getElementById('mult-income').value) || 0;
      const evRev = parseFloat(document.getElementById('mult-ev-rev').value) || 0;
      const evEbitda = parseFloat(document.getElementById('mult-ev-ebitda').value) || 0;
      const pe = parseFloat(document.getElementById('mult-pe').value) || 0;
      
      const valRevenue = revenue * evRev;
      const valEbitda = ebitda * evEbitda;
      const valEarnings = income * pe;
      const average = (valRevenue + valEbitda + valEarnings) / 3;
      const median = [valRevenue, valEbitda, valEarnings].sort((a, b) => a - b)[1];
      const low = Math.min(valRevenue, valEbitda, valEarnings);
      const high = Math.max(valRevenue, valEbitda, valEarnings);
      
      // Football field chart
      const maxVal = high * 1.1;
      const barWidth = (v) => (v / maxVal * 100).toFixed(1);
      
      document.getElementById('multiples-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Blended Valuation</div>
          <div class="result-value">${fmt(average)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Average of three methodologies</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Median Valuation</div>
          <div class="result-value">${fmt(median)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Valuation Range (Football Field)</div>
          
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">EV/Revenue (${evRev}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valRevenue)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valRevenue)}%; background: linear-gradient(90deg, #6366f1, #818cf8);"></div>
            </div>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">EV/EBITDA (${evEbitda}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valEbitda)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valEbitda)}%; background: linear-gradient(90deg, #8b5cf6, #a78bfa);"></div>
            </div>
          </div>
          
          <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">P/E (${pe}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valEarnings)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valEarnings)}%; background: linear-gradient(90deg, #06b6d4, #22d3ee);"></div>
            </div>
          </div>
          
          <div class="divider"></div>
          <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
            <span style="color: var(--text-muted);">Range: ${fmt(low)} â€” ${fmt(high)}</span>
            <span style="color: var(--text-muted);">Spread: ${((high - low) / average * 100).toFixed(0)}%</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Implied Metrics</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">EBITDA Margin</div>
              <div class="mono" style="font-weight: 700;">${revenue > 0 ? (ebitda / revenue * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Net Margin</div>
              <div class="mono" style="font-weight: 700;">${revenue > 0 ? (income / revenue * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MULTIPLES - hook comparison
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // (comparison updated via tab switch)

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ASSET-BASED CALCULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateAsset() {
      const cash = parseFloat(document.getElementById('asset-cash').value) || 0;
      const ar = parseFloat(document.getElementById('asset-ar').value) || 0;
      const inv = parseFloat(document.getElementById('asset-inv').value) || 0;
      const ppe = parseFloat(document.getElementById('asset-ppe').value) || 0;
      const other = parseFloat(document.getElementById('asset-other').value) || 0;
      const ap = parseFloat(document.getElementById('asset-ap').value) || 0;
      const debt = parseFloat(document.getElementById('asset-debt').value) || 0;
      const otherLiab = parseFloat(document.getElementById('asset-otherliab').value) || 0;
      
      const totalAssets = cash + ar + inv + ppe + other;
      const totalLiab = ap + debt + otherLiab;
      const nav = totalAssets - totalLiab;
      const currentRatio = (ap + otherLiab) > 0 ? (cash + ar + inv) / (ap + otherLiab) : 0;
      
      document.getElementById('asset-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Net Asset Value (NAV)</div>
          <div class="result-value">${fmtFull(nav)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Balance Sheet</div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem; color: var(--brand-success);">Total Assets</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(totalAssets)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem; color: var(--brand-danger);">Total Liabilities</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(totalLiab)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; font-weight: 700;">
            <span style="font-size: 0.85rem;">Net Asset Value</span>
            <span class="mono" style="font-size: 0.85rem; color: ${nav >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)'};">${fmtFull(nav)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Ratios</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Current Ratio</div>
              <div class="mono" style="font-weight: 700; color: ${currentRatio >= 1.5 ? 'var(--brand-success)' : currentRatio >= 1 ? 'var(--brand-warning)' : 'var(--brand-danger)'};">${currentRatio.toFixed(2)}x</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Debt Ratio</div>
              <div class="mono" style="font-weight: 700;">${totalAssets > 0 ? (totalLiab / totalAssets * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // MORTGAGE CALCULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateMortgage() {
      const price = parseFloat(document.getElementById('mort-price').value) || 0;
      const downPct = (parseFloat(document.getElementById('mort-down').value) || 0) / 100;
      const rate = (parseFloat(document.getElementById('mort-rate').value) || 0) / 100;
      const amort = parseInt(document.getElementById('mort-amort').value) || 25;
      const freq = parseInt(document.getElementById('mort-freq').value) || 12;
      const province = document.getElementById('mort-province').value;
      
      const downPayment = price * downPct;
      const principal = price - downPayment;
      
      // Update down payment help
      document.getElementById('mort-down-help').textContent = `Down payment: ${fmtFull(downPayment)}`;
      
      // CMHC Insurance (if down < 20%)
      let cmhcPremium = 0;
      if (downPct < 0.20) {
        if (downPct >= 0.15) cmhcPremium = principal * 0.028;
        else if (downPct >= 0.10) cmhcPremium = principal * 0.031;
        else cmhcPremium = principal * 0.04;
      }
      
      const totalMortgage = principal + cmhcPremium;
      
      // Canadian mortgage: semi-annual compounding
      const semiAnnualRate = Math.pow(1 + rate / 2, 2) - 1;
      const periodicRate = Math.pow(1 + semiAnnualRate, 1 / freq) - 1;
      const totalPayments = amort * freq;
      
      // Payment calculation
      const payment = totalMortgage * (periodicRate * Math.pow(1 + periodicRate, totalPayments)) / (Math.pow(1 + periodicRate, totalPayments) - 1);
      const monthlyEquiv = payment * freq / 12;
      const totalCost = payment * totalPayments;
      const totalInterest = totalCost - totalMortgage;
      
      // OSFI Stress Test
      const stressRate = Math.max(rate + 0.02, 0.0525);
      const stressSemiAnnual = Math.pow(1 + stressRate / 2, 2) - 1;
      const stressPeriodic = Math.pow(1 + stressSemiAnnual, 1 / 12) - 1;
      const stressPayment = totalMortgage * (stressPeriodic * Math.pow(1 + stressPeriodic, amort * 12)) / (Math.pow(1 + stressPeriodic, amort * 12) - 1);
      
      // Land Transfer Tax
      let ltt = 0;
      if (province === 'ON') {
        // Ontario LTT
        if (price <= 55000) ltt = price * 0.005;
        else if (price <= 250000) ltt = 275 + (price - 55000) * 0.01;
        else if (price <= 400000) ltt = 2225 + (price - 250000) * 0.015;
        else if (price <= 2000000) ltt = 4475 + (price - 400000) * 0.02;
        else ltt = 36475 + (price - 2000000) * 0.025;
      } else if (province === 'BC') {
        if (price <= 200000) ltt = price * 0.01;
        else if (price <= 2000000) ltt = 2000 + (price - 200000) * 0.02;
        else ltt = 38000 + (price - 2000000) * 0.03;
      }
      
      const freqLabel = { 12: 'Monthly', 26: 'Bi-Weekly', 52: 'Weekly', 24: 'Semi-Monthly' }[freq];
      
      document.getElementById('mortgage-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">${freqLabel} Payment</div>
          <div class="result-value">${fmtFull(payment)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Monthly equivalent: ${fmtFull(monthlyEquiv)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Total Cost of Mortgage</div>
          <div class="result-value">${fmt(totalCost)}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">Principal: ${fmt(totalMortgage)}</span>
            <span class="metric-pill negative">Interest: ${fmt(totalInterest)}</span>
          </div>
        </div>
        
        ${cmhcPremium > 0 ? `
        <div class="glass-card" style="padding: var(--space-lg); border-color: rgba(245, 158, 11, 0.3);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--brand-warning); margin-bottom: 0.375rem;">âš ï¸ CMHC INSURANCE REQUIRED</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary);">Down payment is less than 20%. CMHC premium of <span class="mono" style="font-weight: 700;">${fmtFull(cmhcPremium)}</span> added to mortgage.</div>
        </div>
        ` : ''}
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Closing Costs</div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Down Payment</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(downPayment)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Land Transfer Tax</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(ltt)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Legal Fees (est.)</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(2000)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; font-weight: 700;">
            <span style="font-size: 0.85rem;">Total Cash Needed</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(downPayment + ltt + 2000)}</span>
          </div>
        </div>
        <div class="affiliate-cta">
          <span class="ad-label">Sponsored</span>
          Looking for the best mortgage rates? <a href="#">Compare rates at [Partner Name]</a>
        </div>
      `;
      
      // Stress test
      document.getElementById('mortgage-stress').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ğŸ›ï¸ OSFI Stress Test (B-20)</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
            <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Your Rate</div>
            <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--brand-success);">${(rate * 100).toFixed(2)}%</div>
            <div class="mono" style="font-size: 1rem; margin-top: 0.375rem;">${fmtFull(monthlyEquiv)}/mo</div>
          </div>
          <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
            <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Stress Test Rate</div>
            <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--brand-warning);">${(stressRate * 100).toFixed(2)}%</div>
            <div class="mono" style="font-size: 1rem; margin-top: 0.375rem;">${fmtFull(stressPayment)}/mo</div>
          </div>
        </div>
        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 1rem; text-align: center;">
          You must qualify at the stress test rate (contract rate + 2% or 5.25%, whichever is higher). Monthly payment increases by ${fmtFull(stressPayment - monthlyEquiv)}.
        </div>
      `;
      
      // Rate Increase Stress Test
      const rateStressEl = document.getElementById('mortgage-rate-stress');
      if (rateStressEl) {
        const calcPaymentAtRate = (r) => {
          const sr = Math.pow(1 + r / 2, 2) - 1;
          const mr = Math.pow(1 + sr, 1 / 12) - 1;
          return totalMortgage * (mr * Math.pow(1 + mr, amort * 12)) / (Math.pow(1 + mr, amort * 12) - 1);
        };
        const p0 = monthlyEquiv;
        const p1 = calcPaymentAtRate(rate + 0.01);
        const p2 = calcPaymentAtRate(rate + 0.02);
        rateStressEl.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ğŸ“ˆ Rate Increase Impact</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">Current Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-success);">${(rate * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p0)}/mo</div>
            </div>
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">+1% Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-warning);">${((rate + 0.01) * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p1)}/mo</div>
              <div style="font-size: 0.72rem; color: var(--brand-danger); margin-top: 0.25rem;">+${fmtFull(p1 - p0)}/mo</div>
            </div>
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">+2% Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-danger);">${((rate + 0.02) * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p2)}/mo</div>
              <div style="font-size: 0.72rem; color: var(--brand-danger); margin-top: 0.25rem;">+${fmtFull(p2 - p0)}/mo</div>
            </div>
          </div>
        `;
      }

      // Payment Breakdown Donut
      const breakdownEl = document.getElementById('mortgage-breakdown');
      if (breakdownEl) {
        breakdownEl.innerHTML = '<div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ğŸ¥§ Total Payment Breakdown</div><div style="display:flex;align-items:center;gap:1.5rem;"><div id="mort-donut" style="width:160px;height:160px;"></div><div id="mort-donut-legend" style="font-size:0.8rem;"></div></div>';
        const donutSegs = [
          { label: 'Principal', value: totalMortgage, color: '#6366f1' },
          { label: 'Interest', value: totalInterest, color: '#ef4444' }
        ];
        if (cmhcPremium > 0) donutSegs.push({ label: 'CMHC', value: cmhcPremium, color: '#f59e0b' });
        renderDonutChart('mort-donut', donutSegs, 160);
        document.getElementById('mort-donut-legend').innerHTML = donutSegs.map(s => 
          `<div style="display:flex;align-items:center;gap:6px;margin-bottom:0.375rem;"><span style="width:10px;height:10px;border-radius:2px;background:${s.color};"></span>${s.label}: ${fmtFull(s.value)}</div>`
        ).join('');
      }

      // Simple amortization visualization
      let balance = totalMortgage;
      const monthlyRate = Math.pow(1 + semiAnnualRate, 1 / 12) - 1;
      const monthlyPmt = totalMortgage * (monthlyRate * Math.pow(1 + monthlyRate, amort * 12)) / (Math.pow(1 + monthlyRate, amort * 12) - 1);
      let yearlyData = [];
      
      for (let year = 1; year <= amort; year++) {
        let yearInterest = 0;
        let yearPrincipal = 0;
        for (let m = 0; m < 12; m++) {
          const interestPmt = balance * monthlyRate;
          const principalPmt = monthlyPmt - interestPmt;
          yearInterest += interestPmt;
          yearPrincipal += principalPmt;
          balance -= principalPmt;
          if (balance < 0) balance = 0;
        }
        yearlyData.push({ year, balance, interest: yearInterest, principal: yearPrincipal });
      }
      
      let amortTableRows = yearlyData.map(d => `
          <tr>
            <td>${d.year}</td>
            <td>${fmtFull(d.year === 1 ? totalMortgage : yearlyData[d.year-2].balance)}</td>
            <td>${fmtFull(monthlyPmt * 12)}</td>
            <td>${fmtFull(d.principal)}</td>
            <td>${fmtFull(d.interest)}</td>
            <td>${fmtFull(d.balance)}</td>
          </tr>`).join('');

      document.getElementById('mortgage-amort').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Amortization â€” Balance Over Time</div>
        <div style="display: flex; align-items: flex-end; gap: 2px; height: 200px; padding: 0;">
          ${yearlyData.map(d => `
            <div style="flex: 1; height: ${(d.balance / totalMortgage * 190)}px; background: linear-gradient(180deg, var(--brand-primary), var(--brand-accent)); border-radius: 2px 2px 0 0; min-height: 2px; position: relative;" title="Year ${d.year}: ${fmtFull(d.balance)} remaining"></div>
          `).join('')}
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">
          <span>Year 1</span>
          <span>Year ${Math.floor(amort / 2)}</span>
          <span>Year ${amort}</span>
        </div>
        <div class="accordion-item" style="margin-top: 1.5rem;">
          <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
            <span>ğŸ“‹ View Full Amortization Schedule</span>
            <span class="accordion-arrow">â–¼</span>
          </div>
          <div class="accordion-body">
            <div class="accordion-body-inner" style="overflow-x: auto; padding: 0.5rem;">
              <table class="sensitivity-table">
                <thead>
                  <tr>
                    <th>Year</th>
                    <th>Opening Balance</th>
                    <th>Annual Payment</th>
                    <th>Principal</th>
                    <th>Interest</th>
                    <th>Closing Balance</th>
                  </tr>
                </thead>
                <tbody>${amortTableRows}</tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CAGR CALCULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateCAGR() {
      const initial = parseFloat(document.getElementById('cagr-initial').value) || 0;
      const final_ = parseFloat(document.getElementById('cagr-final').value) || 0;
      const years = parseFloat(document.getElementById('cagr-years').value) || 1;
      
      if (initial <= 0) {
        document.getElementById('cagr-results').innerHTML = `<div class="result-card"><p style="color: var(--text-muted);">Enter a positive initial investment.</p></div>`;
        return;
      }
      
      const cagr = (Math.pow(final_ / initial, 1 / years) - 1) * 100;
      const totalReturn = ((final_ - initial) / initial) * 100;
      const gain = final_ - initial;
      
      document.getElementById('cagr-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">CAGR</div>
          <div class="result-value">${cagr.toFixed(2)}%</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Compound Annual Growth Rate</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Total Return</div>
          <div class="result-value" style="${totalReturn >= 0 ? '' : 'background: linear-gradient(135deg, var(--brand-danger), #f97316); -webkit-background-clip: text;'}">${totalReturn.toFixed(1)}%</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <span class="metric-pill ${gain >= 0 ? 'positive' : 'negative'}">${gain >= 0 ? '+' : ''}${fmtFull(gain)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Rule of 72</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary);">
            At ${cagr.toFixed(1)}% CAGR, your money doubles every <strong style="color: var(--text-primary);">${cagr > 0 ? (72 / cagr).toFixed(1) : 'âˆ'} years</strong>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Benchmarks</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); display: flex; flex-direction: column; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between;">
              <span>S&P 500 (30yr avg)</span>
              <span class="mono" style="color: ${cagr > 10.7 ? 'var(--brand-success)' : 'var(--text-muted)'};">~10.7%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Warren Buffett</span>
              <span class="mono" style="color: ${cagr > 20 ? 'var(--brand-success)' : 'var(--text-muted)'};">~20%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>GIC (Canada)</span>
              <span class="mono">~4-5%</span>
            </div>
          </div>
        </div>
      `;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SVG CHART COMPONENTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /**
     * Animated SVG Donut Chart
     * @param {string} containerId - ID of the container element
     * @param {Array} segments - [{label, value, color}]
     * @param {number} size - diameter in px (default 150)
     */
    function renderDonutChart(containerId, segments, size) {
      size = size || 150;
      const container = document.getElementById(containerId);
      if (!container) return;
      const total = segments.reduce(function(s, seg) { return s + seg.value; }, 0);
      if (total <= 0) {
        container.innerHTML = '<div style="width:'+size+'px;height:'+size+'px;border-radius:50%;background:var(--border-primary);"></div>';
        return;
      }
      const r = 50, cx = 60, cy = 60;
      const circumference = 2 * Math.PI * r;
      let cumOffset = 0;
      let svgSegments = '';
      segments.forEach(function(seg, i) {
        const pct = seg.value / total;
        const dashLen = pct * circumference;
        const dashGap = circumference - dashLen;
        const offset = -cumOffset * circumference;
        svgSegments += '<circle class="svg-donut-segment donut-init" cx="'+cx+'" cy="'+cy+'" r="'+r+'" ' +
          'stroke="'+seg.color+'" ' +
          'stroke-dasharray="'+dashLen+' '+dashGap+'" ' +
          'stroke-dashoffset="'+offset+'" ' +
          'style="--circumference:'+circumference+'" ' +
          'data-label="'+seg.label+'" data-value="'+seg.value+'" data-pct="'+(pct*100).toFixed(1)+'" />';
        cumOffset += pct;
      });
      container.innerHTML = '<div class="svg-donut-chart" style="width:'+size+'px;height:'+size+'px;">' +
        '<svg viewBox="0 0 120 120" width="'+size+'" height="'+size+'">' + svgSegments + '</svg>' +
        '<div class="svg-donut-center"><div class="donut-hover-label">Total</div><div class="donut-hover-value">' + fmtFull(total) + '</div></div></div>';

      // Animate in
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          container.querySelectorAll('.donut-init').forEach(function(c) { c.classList.remove('donut-init'); });
        });
      });

      // Hover interactivity
      var centerLabel = container.querySelector('.donut-hover-label');
      var centerValue = container.querySelector('.donut-hover-value');
      container.querySelectorAll('.svg-donut-segment').forEach(function(seg) {
        seg.addEventListener('mouseenter', function() {
          centerLabel.textContent = seg.getAttribute('data-label');
          centerValue.textContent = fmtFull(parseFloat(seg.getAttribute('data-value'))) + ' (' + seg.getAttribute('data-pct') + '%)';
        });
        seg.addEventListener('mouseleave', function() {
          centerLabel.textContent = 'Total';
          centerValue.textContent = fmtFull(total);
        });
      });
    }

    /**
     * SVG Gauge Chart (half-circle)
     * @param {string} containerId
     * @param {number} value - current value (0-100 scale)
     * @param {Array} zones - [{from, to, color}] in 0-100 range
     * @param {string} label - text label
     * @param {number} width - width in px
     */
    function renderGauge(containerId, value, zones, label, width) {
      width = width || 180;
      var container = document.getElementById(containerId);
      if (!container) return;
      value = Math.max(0, Math.min(100, value));
      var cx = 100, cy = 90, r = 70;
      // Arc from 180deg to 0deg (left to right)
      var arcSvg = '';
      zones.forEach(function(z) {
        var startAngle = Math.PI - (z.from / 100) * Math.PI;
        var endAngle = Math.PI - (z.to / 100) * Math.PI;
        var x1 = cx + r * Math.cos(startAngle);
        var y1 = cy - r * Math.sin(startAngle);
        var x2 = cx + r * Math.cos(endAngle);
        var y2 = cy - r * Math.sin(endAngle);
        var largeArc = (z.to - z.from) > 50 ? 1 : 0;
        arcSvg += '<path class="svg-gauge-arc" d="M '+x1+' '+y1+' A '+r+' '+r+' 0 '+largeArc+' 1 '+x2+' '+y2+'" stroke="'+z.color+'" />';
      });
      // Needle
      var needleAngle = Math.PI - (value / 100) * Math.PI;
      var needleLen = r - 10;
      var nx = cx + needleLen * Math.cos(needleAngle);
      var ny = cy - needleLen * Math.sin(needleAngle);
      // Start with needle at 0 position (left), animate to target
      var startAngle = 180; // pointing left
      var targetAngle = 180 - (value / 100) * 180;

      container.innerHTML = '<div class="svg-gauge" style="width:'+width+'px;">' +
        '<svg viewBox="0 0 200 110" width="'+width+'">' +
        arcSvg +
        '<circle cx="'+cx+'" cy="'+cy+'" r="4" fill="var(--text-primary)" />' +
        '<line id="'+containerId+'-needle" x1="'+cx+'" y1="'+cy+'" x2="'+(cx-needleLen)+'" y2="'+cy+'" stroke="var(--text-primary)" stroke-width="2.5" stroke-linecap="round" style="transform-origin:'+cx+'px '+cy+'px;transform:rotate(0deg);transition:transform 1.2s cubic-bezier(0.4,0,0.2,1);" />' +
        '</svg>' +
        '<div class="svg-gauge-label"><div class="gauge-value">'+(label || value.toFixed(0)+'%')+'</div></div></div>';

      // Animate needle
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          var needle = document.getElementById(containerId + '-needle');
          if (needle) {
            var rot = -(value / 100) * 180;
            needle.style.transform = 'rotate(' + rot + 'deg)';
          }
        });
      });
    }

    /**
     * Sparkline SVG inline component
     * @param {Array} data - array of numbers
     * @param {number} width
     * @param {number} height
     * @param {string} color
     * @returns {string} HTML string
     */
    function sparkline(data, width, height, color) {
      if (!data || data.length < 2) return '';
      width = width || 80;
      height = height || 24;
      color = color || 'var(--brand-primary)';
      var min = Math.min.apply(null, data);
      var max = Math.max.apply(null, data);
      var range = max - min || 1;
      var step = width / (data.length - 1);
      var points = data.map(function(v, i) {
        return { x: i * step, y: height - ((v - min) / range) * (height - 2) - 1 };
      });
      // Build smooth path with quadratic bezier
      var d = 'M ' + points[0].x + ' ' + points[0].y;
      for (var i = 1; i < points.length; i++) {
        var cpx = (points[i-1].x + points[i].x) / 2;
        d += ' Q ' + cpx + ' ' + points[i-1].y + ' ' + points[i].x + ' ' + points[i].y;
      }
      // Fill area
      var fillD = d + ' L ' + points[points.length-1].x + ' ' + height + ' L 0 ' + height + ' Z';
      return '<span class="sparkline-inline"><svg width="'+width+'" height="'+height+'" viewBox="0 0 '+width+' '+height+'">' +
        '<path class="sparkline-fill" d="'+fillD+'" fill="'+color+'" />' +
        '<path class="sparkline-path" d="'+d+'" stroke="'+color+'" />' +
        '</svg></span>';
    }

    /**
     * SVG Stacked Area Chart
     * @param {string} containerId
     * @param {Array} data - [{label, bottom, top}] where bottom=contributions, top=total
     * @param {object} opts - {bottomColor, topColor, bottomLabel, topLabel, xLabels, yPrefix}
     */
    function renderAreaChart(containerId, data, opts) {
      var container = document.getElementById(containerId);
      if (!container || !data || data.length === 0) return;
      opts = opts || {};
      var bColor = opts.bottomColor || 'var(--brand-primary)';
      var tColor = opts.topColor || 'var(--brand-success)';
      var bLabel = opts.bottomLabel || 'Contributions';
      var tLabel = opts.topLabel || 'Earnings';
      var yPrefix = opts.yPrefix || '$';

      var maxVal = 0;
      data.forEach(function(d) { if (d.top > maxVal) maxVal = d.top; });
      if (maxVal === 0) maxVal = 1;

      var W = 600, H = 260, padL = 55, padR = 15, padT = 15, padB = 35;
      var chartW = W - padL - padR, chartH = H - padT - padB;
      var n = data.length;
      var stepX = chartW / Math.max(n - 1, 1);

      // Gridlines + Y labels
      var gridCount = 5;
      var gridSvg = '';
      for (var g = 0; g <= gridCount; g++) {
        var gy = padT + (g / gridCount) * chartH;
        var gVal = maxVal * (1 - g / gridCount);
        gridSvg += '<line class="svg-area-gridline" x1="'+padL+'" y1="'+gy+'" x2="'+(W-padR)+'" y2="'+gy+'" />';
        var yLabel = gVal >= 1e6 ? (gVal/1e6).toFixed(1)+'M' : gVal >= 1e3 ? (gVal/1e3).toFixed(0)+'K' : gVal.toFixed(0);
        gridSvg += '<text class="svg-area-label" x="'+(padL-5)+'" y="'+(gy+3)+'" text-anchor="end">'+yPrefix+yLabel+'</text>';
      }

      // X labels
      var xLabelSvg = '';
      var labelInterval = Math.max(1, Math.ceil(n / 10));
      data.forEach(function(d, i) {
        if (i % labelInterval === 0 || i === n - 1) {
          var lx = padL + i * stepX;
          xLabelSvg += '<text class="svg-area-label" x="'+lx+'" y="'+(H - 5)+'" text-anchor="middle">'+(d.label || 'Y'+(i+1))+'</text>';
        }
      });

      // Build paths
      function toY(v) { return padT + chartH - (v / maxVal) * chartH; }
      function toX(i) { return padL + i * stepX; }

      // Bottom area (contributions)
      var bottomPts = data.map(function(d, i) { return { x: toX(i), y: toY(d.bottom) }; });
      // Top area (total)
      var topPts = data.map(function(d, i) { return { x: toX(i), y: toY(d.top) }; });

      function smoothPath(pts) {
        if (pts.length < 2) return 'M ' + pts[0].x + ' ' + pts[0].y;
        var d = 'M ' + pts[0].x + ' ' + pts[0].y;
        for (var i = 1; i < pts.length; i++) {
          var cpx = (pts[i-1].x + pts[i].x) / 2;
          d += ' Q ' + cpx + ' ' + pts[i-1].y + ' ' + pts[i].x + ' ' + pts[i].y;
        }
        return d;
      }

      var baseLine = padT + chartH;
      // Earnings fill (between top line and bottom line)
      var earningsFill = smoothPath(topPts);
      for (var i = bottomPts.length - 1; i >= 0; i--) {
        var cpx2 = i > 0 ? (bottomPts[i].x + bottomPts[i-1].x) / 2 : bottomPts[i].x;
        earningsFill += ' L ' + bottomPts[i].x + ' ' + bottomPts[i].y;
      }
      earningsFill += ' Z';

      // Contributions fill (bottom to baseline)
      var contribFill = smoothPath(bottomPts) + ' L ' + bottomPts[bottomPts.length-1].x + ' ' + baseLine + ' L ' + bottomPts[0].x + ' ' + baseLine + ' Z';

      container.innerHTML = '<div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Portfolio Growth Over Time</div>' +
        '<svg class="svg-area-chart" viewBox="0 0 '+W+' '+H+'">' +
        gridSvg + xLabelSvg +
        '<path class="svg-area-path" d="'+contribFill+'" fill="'+bColor+'" opacity="0.35" />' +
        '<path class="svg-area-path" d="'+earningsFill+'" fill="'+tColor+'" opacity="0.35" />' +
        '<path class="svg-area-path" d="'+smoothPath(bottomPts)+'" fill="none" stroke="'+bColor+'" stroke-width="2" />' +
        '<path class="svg-area-path" d="'+smoothPath(topPts)+'" fill="none" stroke="'+tColor+'" stroke-width="2" />' +
        '</svg>' +
        '<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 0.75rem; font-size: 0.75rem;">' +
        '<div style="display: flex; align-items: center; gap: 0.375rem;"><div style="width: 12px; height: 12px; border-radius: 2px; background: '+bColor+';"></div> '+bLabel+'</div>' +
        '<div style="display: flex; align-items: center; gap: 0.375rem;"><div style="width: 12px; height: 12px; border-radius: 2px; background: '+tColor+';"></div> '+tLabel+'</div></div>';

      // Animate paths in
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          container.querySelectorAll('.svg-area-path').forEach(function(p) { p.classList.add('visible'); });
        });
      });
    }

    // DCA SIMULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateDCA() {
      const monthly = parseFloat(document.getElementById('dca-monthly').value) || 0;
      const annualReturn = (parseFloat(document.getElementById('dca-return').value) || 0) / 100;
      const dividendYield = (parseFloat(document.getElementById('dca-dividend').value) || 0) / 100;
      const totalReturn = annualReturn + dividendYield;
      const years = parseInt(document.getElementById('dca-years').value) || 1;
      const initial = parseFloat(document.getElementById('dca-initial').value) || 0;
      
      const monthlyRate = Math.pow(1 + totalReturn, 1 / 12) - 1;
      const totalMonths = years * 12;
      
      let balance = initial;
      let totalContributed = initial;
      let yearlyData = [];
      
      for (let m = 1; m <= totalMonths; m++) {
        balance = balance * (1 + monthlyRate) + monthly;
        totalContributed += monthly;
        if (m % 12 === 0) {
          yearlyData.push({ year: m / 12, balance, contributed: totalContributed, earnings: balance - totalContributed });
        }
      }
      
      const totalEarnings = balance - totalContributed;
      const inflationRate = (parseFloat(document.getElementById('dca-inflation').value) || 0) / 100;
      const realValue = balance / Math.pow(1 + inflationRate, years);
      
      document.getElementById('dca-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Final Portfolio Value (Nominal)</div>
          <div class="result-value">${fmtFull(balance)}</div>
        </div>
        
        <div class="result-card" style="border-color: rgba(245, 158, 11, 0.3); background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.03));">
          <div class="result-label">Real Value (Inflation-Adjusted)</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-warning), #f97316); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(realValue)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">In today's dollars at ${(inflationRate*100).toFixed(1)}% inflation</div>
          <div style="font-size: 0.75rem; color: var(--text-muted);">Purchasing power erosion: ${fmtFull(balance - realValue)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Investment Earnings</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-success), #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(totalEarnings)}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">Contributed: ${fmtFull(totalContributed)}</span>
            <span class="metric-pill positive">Earned: ${fmtFull(totalEarnings)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Breakdown</div>
          <div style="margin-bottom: 0.75rem;">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
              <span>Contributions</span>
              <span class="mono">${(totalContributed / balance * 100).toFixed(0)}%</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${(totalContributed / balance * 100)}%; background: var(--brand-primary);"></div>
            </div>
          </div>
          <div>
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
              <span>Earnings (Compound Growth)</span>
              <span class="mono">${(totalEarnings / balance * 100).toFixed(0)}%</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${(totalEarnings / balance * 100)}%; background: linear-gradient(90deg, var(--brand-success), var(--brand-accent));"></div>
            </div>
          </div>
        </div>
      `;
      
      // Growth chart â€” SVG area chart + sparkline for YoY growth
      if (yearlyData.length > 0) {
        var areaData = yearlyData.map(function(d) {
          return { label: 'Y' + d.year, bottom: d.contributed, top: d.balance };
        });
        renderAreaChart('dca-chart', areaData, {
          bottomColor: '#6366f1', topColor: '#10b981',
          bottomLabel: 'Contributions', topLabel: 'Total Value'
        });

        // Sparkline: year-over-year growth rates
        if (yearlyData.length > 1) {
          var yoyGrowth = [];
          for (var si = 1; si < yearlyData.length; si++) {
            yoyGrowth.push(yearlyData[si].balance / yearlyData[si-1].balance - 1);
          }
          var sparkHtml = '<div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.75rem;">YoY Growth ' + sparkline(yoyGrowth, 100, 20, '#10b981') + '</div>';
          var dcaChart = document.getElementById('dca-chart');
          if (dcaChart) dcaChart.innerHTML += sparkHtml;
        }
      }

      // Year-by-year table
      if (yearlyData.length > 0) {
        const tableEl = document.getElementById('dca-table');
        if (tableEl) {
          let rows = yearlyData.map(d => `<tr><td>Year ${d.year}</td><td>${fmtFull(d.contributed)}</td><td>${fmtFull(d.earnings)}</td><td style="font-weight:700;">${fmtFull(d.balance)}</td></tr>`).join('');
          tableEl.innerHTML = `
            <div class="accordion-item">
              <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
                <span>ğŸ“‹ Year-by-Year Breakdown</span>
                <span class="accordion-arrow">â–¼</span>
              </div>
              <div class="accordion-body">
                <div class="accordion-body-inner" style="overflow-x:auto;padding:0.5rem;">
                  <table class="sensitivity-table">
                    <thead><tr><th>Year</th><th>Contributed</th><th>Earnings</th><th>Balance</th></tr></thead>
                    <tbody>${rows}</tbody>
                  </table>
                </div>
              </div>
            </div>`;
        }
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RETIREMENT (RRSP vs TFSA)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateRetirement() {
      const income = parseFloat(document.getElementById('ret-income').value) || 0;
      const contribution = parseFloat(document.getElementById('ret-contribution').value) || 0;
      const age = parseInt(document.getElementById('ret-age').value) || 30;
      const retireAge = parseInt(document.getElementById('ret-retire-age').value) || 65;
      const annualReturn = (parseFloat(document.getElementById('ret-return').value) || 0) / 100;
      const retireIncome = parseFloat(document.getElementById('ret-retire-income').value) || 0;
      const province = document.getElementById('ret-province').value;
      
      const years = retireAge - age;
      if (years <= 0) {
        document.getElementById('retirement-results').innerHTML = '<div class="result-card"><p style="color: var(--text-muted);">Retirement age must be greater than current age.</p></div>';
        return;
      }
      
      // Canadian federal tax brackets (2025)
      const fedTax = (inc) => {
        if (inc <= 0) return 0;
        let tax = 0;
        const brackets = [
          [55867, 0.15], [55867, 0.205], [61942, 0.26], [70000, 0.29], [Infinity, 0.33]
        ];
        let remaining = inc;
        for (const [limit, rate] of brackets) {
          const taxable = Math.min(remaining, limit);
          tax += taxable * rate;
          remaining -= taxable;
          if (remaining <= 0) break;
        }
        return tax;
      };
      
      // Provincial tax (simplified â€” Ontario)
      const provTax = (inc) => {
        if (province !== 'ON' || inc <= 0) return inc * 0.05; // Simplified for non-ON
        let tax = 0;
        const brackets = [
          [51446, 0.0505], [51446, 0.0915], [47046, 0.1116], [100000, 0.1216], [Infinity, 0.1316]
        ];
        let remaining = inc;
        for (const [limit, rate] of brackets) {
          const taxable = Math.min(remaining, limit);
          tax += taxable * rate;
          remaining -= taxable;
          if (remaining <= 0) break;
        }
        return tax;
      };
      
      const marginalRate = (inc) => {
        const tax1 = fedTax(inc) + provTax(inc);
        const tax2 = fedTax(inc + 1) + provTax(inc + 1);
        return tax2 - tax1;
      };
      
      const currentMarginal = marginalRate(income);
      const retireMarginal = marginalRate(retireIncome);
      
      // RRSP: Tax deduction now, taxed on withdrawal
      const rrspTaxSavings = contribution * currentMarginal;
      const rrspGross = contribution; // Full amount invested
      let rrspBalance = 0;
      for (let y = 0; y < years; y++) {
        rrspBalance = (rrspBalance + rrspGross) * (1 + annualReturn);
      }
      const rrspAfterTax = rrspBalance * (1 - retireMarginal);
      
      // TFSA: No deduction, tax-free growth and withdrawal
      const tfsaNet = contribution; // Same contribution amount
      let tfsaBalance = 0;
      for (let y = 0; y < years; y++) {
        tfsaBalance = (tfsaBalance + tfsaNet) * (1 + annualReturn);
      }
      
      // RRSP with reinvested refund
      const rrspWithRefund = contribution + rrspTaxSavings;
      let rrspRefundBalance = 0;
      for (let y = 0; y < years; y++) {
        rrspRefundBalance = (rrspRefundBalance + rrspWithRefund) * (1 + annualReturn);
      }
      const rrspRefundAfterTax = rrspRefundBalance * (1 - retireMarginal);
      
      const winner = rrspRefundAfterTax > tfsaBalance ? 'RRSP' : 'TFSA';
      const advantage = Math.abs(rrspRefundAfterTax - tfsaBalance);
      
      document.getElementById('retirement-results').innerHTML = `
        <div class="gradient-border-card">
          <div class="gradient-border-card-inner" style="text-align: center;">
            <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem;">Recommendation</div>
            <div style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.25rem;">${winner} Wins</div>
            <div style="font-size: 0.85rem; color: var(--text-secondary);">by ${fmtFull(advantage)} over ${years} years</div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div style="text-align: center; padding: 1rem; border-radius: var(--radius-md); background: ${winner === 'RRSP' ? 'rgba(99, 102, 241, 0.1)' : 'transparent'};">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">RRSP (After Tax)</div>
              <div class="mono" style="font-size: 1.25rem; font-weight: 700; color: var(--brand-primary);">${fmtFull(rrspRefundAfterTax)}</div>
              <div style="font-size: 0.72rem; color: var(--text-muted); margin-top: 0.25rem;">Pre-tax: ${fmtFull(rrspRefundBalance)}</div>
            </div>
            <div style="text-align: center; padding: 1rem; border-radius: var(--radius-md); background: ${winner === 'TFSA' ? 'rgba(6, 182, 212, 0.1)' : 'transparent'};">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">TFSA (Tax-Free)</div>
              <div class="mono" style="font-size: 1.25rem; font-weight: 700; color: var(--brand-accent);">${fmtFull(tfsaBalance)}</div>
              <div style="font-size: 0.72rem; color: var(--text-muted); margin-top: 0.25rem;">100% tax-free</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Tax Analysis</div>
          <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.85rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Current Marginal Rate</span>
              <span class="mono" style="font-weight: 700;">${(currentMarginal * 100).toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Retirement Marginal Rate</span>
              <span class="mono" style="font-weight: 700;">${(retireMarginal * 100).toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">RRSP Tax Refund (Annual)</span>
              <span class="mono" style="font-weight: 700; color: var(--brand-success);">${fmtFull(rrspTaxSavings)}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Tax Rate Arbitrage</span>
              <span class="mono" style="font-weight: 700; color: ${currentMarginal > retireMarginal ? 'var(--brand-success)' : 'var(--brand-danger)'};">${((currentMarginal - retireMarginal) * 100).toFixed(1)}%</span>
            </div>
          </div>
          <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 1rem; padding: 0.75rem; background: rgba(99,102,241,0.05); border-radius: var(--radius-sm);">
            ğŸ’¡ <strong>Rule of thumb:</strong> RRSP wins when your current tax rate is higher than your expected retirement tax rate. TFSA wins when rates are the same or lower now.
          </div>
        </div>
        <div class="affiliate-cta">
          <span class="ad-label">Ad</span>
          Open a TFSA with <a href="#">Canada's top-rated platforms</a>
        </div>
      `;
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // COMPOUND INTEREST
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateCompound() {
      const initial = parseFloat(document.getElementById('comp-initial').value) || 0;
      const monthly = parseFloat(document.getElementById('comp-monthly').value) || 0;
      const rate = (parseFloat(document.getElementById('comp-rate').value) || 0) / 100;
      const years = parseInt(document.getElementById('comp-years').value) || 1;
      const freq = parseInt(document.getElementById('comp-freq').value) || 1;
      
      const periodicRate = rate / freq;
      const totalPeriods = years * freq;
      const monthlyPeriods = freq / 12;
      
      // Calculate with contributions
      let balance = initial;
      let totalContributed = initial;
      let yearlyData = [];
      
      for (let month = 1; month <= years * 12; month++) {
        // Apply interest for the month
        const monthlyRate = Math.pow(1 + rate, 1 / 12) - 1;
        balance = balance * (1 + monthlyRate) + monthly;
        totalContributed += monthly;
        
        if (month % 12 === 0) {
          yearlyData.push({
            year: month / 12,
            balance,
            contributed: totalContributed,
            interest: balance - totalContributed
          });
        }
      }
      
      // Without contributions (initial only)
      const withoutContrib = initial * Math.pow(1 + rate, years);
      
      const totalInterest = balance - totalContributed;
      const effectiveRate = (Math.pow(balance / totalContributed, 1 / years) - 1) * 100;
      
      document.getElementById('compound-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Future Value</div>
          <div class="result-value">${fmtFull(balance)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Interest Earned</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-success), var(--brand-accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(totalInterest)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Summary</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Total Contributed</div>
              <div class="mono" style="font-weight: 700;">${fmtFull(totalContributed)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Growth Multiple</div>
              <div class="mono" style="font-weight: 700;">${(balance / totalContributed).toFixed(2)}x</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Without Contributions</div>
              <div class="mono" style="font-weight: 700;">${fmtFull(withoutContrib)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Contribution Impact</div>
              <div class="mono" style="font-weight: 700; color: var(--brand-success);">+${fmtFull(balance - withoutContrib)}</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">The Power of Compound Interest</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.7;">
            Your ${fmtFull(monthly)}/month contributions turn into <strong style="color: var(--text-primary);">${fmtFull(balance)}</strong> over ${years} years.
            That's <strong style="color: var(--brand-success);">${fmtFull(totalInterest)}</strong> in pure compound growth â€” money your money earned for you.
          </div>
        </div>
        <div class="affiliate-cta">
          <span class="ad-label">Sponsored</span>
          Start investing with <a href="#">$0 commissions</a>
        </div>
      `;
      
      // Growth chart â€” SVG area chart with sparkline trajectory preview
      if (yearlyData.length > 0) {
        var compAreaData = yearlyData.map(function(d) {
          return { label: 'Y' + d.year, bottom: d.contributed, top: d.balance };
        });
        renderAreaChart('compound-chart', compAreaData, {
          bottomColor: '#6366f1', topColor: '#10b981',
          bottomLabel: 'Contributions', topLabel: 'Total (with Interest)'
        });

        // Sparkline: balance trajectory preview
        var balTrajectory = yearlyData.map(function(d) { return d.balance; });
        var compChart = document.getElementById('compound-chart');
        if (compChart) {
          compChart.innerHTML += '<div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.75rem;">Growth Trajectory ' + sparkline(balTrajectory, 100, 20, '#06b6d4') + '</div>';
        }
      }

      // Comparison mode (Scenario B)
      const rateB = (parseFloat(document.getElementById('comp-rate-b').value) || 0) / 100;
      const monthlyB = parseFloat(document.getElementById('comp-monthly-b').value) || 0;
      const compCompare = document.getElementById('compound-comparison');
      if (compCompare && (rateB > 0 || monthlyB > 0)) {
        let balB = initial, contribB = initial;
        let yearlyB = [];
        for (let m = 1; m <= years * 12; m++) {
          const mr = Math.pow(1 + rateB, 1/12) - 1;
          balB = balB * (1 + mr) + monthlyB;
          contribB += monthlyB;
          if (m % 12 === 0) yearlyB.push({ year: m/12, balance: balB, contributed: contribB });
        }
        const diff = balance - balB;
        compCompare.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ğŸ“Š Scenario Comparison</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
            <div class="glass-card" style="padding:var(--space-lg);text-align:center;">
              <div style="font-size:0.72rem;color:var(--text-muted);text-transform:uppercase;">Scenario A</div>
              <div style="font-size:0.8rem;color:var(--text-secondary);">${(rate*100).toFixed(1)}% Â· ${fmtFull(monthly)}/mo</div>
              <div class="mono" style="font-size:1.5rem;font-weight:700;color:var(--brand-primary);margin-top:0.5rem;">${fmtFull(balance)}</div>
            </div>
            <div class="glass-card" style="padding:var(--space-lg);text-align:center;">
              <div style="font-size:0.72rem;color:var(--text-muted);text-transform:uppercase;">Scenario B</div>
              <div style="font-size:0.8rem;color:var(--text-secondary);">${(rateB*100).toFixed(1)}% Â· ${fmtFull(monthlyB)}/mo</div>
              <div class="mono" style="font-size:1.5rem;font-weight:700;color:var(--brand-accent);margin-top:0.5rem;">${fmtFull(balB)}</div>
            </div>
          </div>
          <div style="text-align:center;margin-top:1rem;font-size:0.9rem;color:var(--text-secondary);">
            Scenario ${diff > 0 ? 'A' : 'B'} wins by <strong style="color:var(--brand-success);">${fmtFull(Math.abs(diff))}</strong>
          </div>
        `;
      } else if (compCompare) {
        compCompare.innerHTML = '';
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TEST SUITE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function runTests() {
      const results = [];
      let passed = 0;
      let failed = 0;
      
      function assert(name, condition, detail) {
        if (condition) {
          passed++;
          results.push({ name, status: 'PASS', detail });
        } else {
          failed++;
          results.push({ name, status: 'FAIL', detail });
        }
      }
      
      // â”€â”€ Formatting Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      assert('fmt: millions', fmt(5000000) === '$5.0M', fmt(5000000));
      assert('fmt: billions', fmt(2500000000) === '$2.5B', fmt(2500000000));
      assert('fmt: thousands', fmt(50000) === '$50.0K', fmt(50000));
      assert('fmt: zero', fmt(0) === '$0.00', fmt(0));
      assert('fmt: negative', fmt(-3000000).includes('-'), fmt(-3000000));
      assert('fmt: NaN guard', fmt(NaN) === '$0', fmt(NaN));
      assert('fmt: undefined guard', fmt(undefined) === '$0', fmt(undefined));
      assert('fmtPct: basic', fmtPct(12.345) === '12.3%', fmtPct(12.345));
      assert('fmtFull: formats number', fmtFull(1234).length > 0, fmtFull(1234));
      
      // â”€â”€ DCF Calculation Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const fcf = 1000000;
      const growth = 0.10;
      const terminal = 0.025;
      const wacc = 0.12;
      const years = 5;
      
      let pvSum = 0;
      for (let i = 1; i <= years; i++) {
        pvSum += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
      }
      const finalFCF = fcf * Math.pow(1 + growth, years);
      const tv = finalFCF * (1 + terminal) / (wacc - terminal);
      const pvTV = tv / Math.pow(1 + wacc, years);
      const ev = pvSum + pvTV;
      
      assert('DCF: PV of FCFs > 0', pvSum > 0, `PV sum = ${pvSum.toFixed(0)}`);
      assert('DCF: Terminal value > 0', tv > 0, `TV = ${tv.toFixed(0)}`);
      assert('DCF: EV > initial FCF', ev > fcf, `EV = ${ev.toFixed(0)}`);
      assert('DCF: EV reasonable range', ev > 5000000 && ev < 50000000, `EV = ${fmt(ev)}`);
      
      // â”€â”€ M&A Accretion/Dilution Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const acqEPS = 5.00, acqShares = 100, acqPrice = 50;
      const tgtEPS = 2.00, tgtShares = 50, tgtPrice = 20;
      const maPremium = 0.25, maCashPct = 0.50, maDebtCost = 0.05, maTaxRate = 0.25;
      const maOfferPrice = tgtPrice * (1 + maPremium);
      const maDealValue = maOfferPrice * tgtShares;
      const maCashPortion = maDealValue * maCashPct;
      const maStockPortion = maDealValue * (1 - maCashPct);
      const maNewShares = maStockPortion / acqPrice;
      const maProFormaShares = acqShares + maNewShares;
      const maAcqNI = acqEPS * acqShares;
      const maTgtNI = tgtEPS * tgtShares;
      const maInterest = maCashPortion * maDebtCost * (1 - maTaxRate);
      const maProFormaNI = maAcqNI + maTgtNI - maInterest;
      const maProFormaEPS = maProFormaNI / maProFormaShares;
      const maAccDil = ((maProFormaEPS - acqEPS) / acqEPS) * 100;
      assert('M&A: offer price includes premium', maOfferPrice === 25, `Offer = ${maOfferPrice}`);
      assert('M&A: deal value correct', maDealValue === 1250, `Deal = ${maDealValue}`);
      assert('M&A: accretive deal detected', maAccDil > 0, `Accretion = ${maAccDil.toFixed(2)}%`);
      // Dilutive scenario: high premium
      const dilOfferPrice = tgtPrice * 3;
      const dilDealValue = dilOfferPrice * tgtShares;
      const dilNewShares = dilDealValue / acqPrice;
      const dilProFormaShares = acqShares + dilNewShares;
      const dilProFormaEPS = (maAcqNI + maTgtNI) / dilProFormaShares;
      const dilAccDil = ((dilProFormaEPS - acqEPS) / acqEPS) * 100;
      assert('M&A: dilutive with high premium', dilAccDil < 0, `Dilution = ${dilAccDil.toFixed(2)}%`);
      
      // â”€â”€ Mortgage Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const price = 800000;
      const mortDownPct = 0.20;
      const rate = 0.055;
      const principal = price * (1 - mortDownPct);
      const semiRate = Math.pow(1 + rate / 2, 2) - 1;
      const mRate = Math.pow(1 + semiRate, 1 / 12) - 1;
      const mPayment = principal * (mRate * Math.pow(1 + mRate, 300)) / (Math.pow(1 + mRate, 300) - 1);
      
      assert('Mortgage: payment > 0', mPayment > 0, `Payment = ${mPayment.toFixed(2)}`);
      assert('Mortgage: payment reasonable', mPayment > 2000 && mPayment < 6000, `Payment = ${fmtFull(mPayment)}`);
      assert('Mortgage: semi-annual compounding', semiRate > rate, `Effective = ${(semiRate * 100).toFixed(3)}%`);
      
      // â”€â”€ CMHC Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      assert('CMHC: not required at 20% down', mortDownPct >= 0.20, 'Down 20% = no CMHC');
      const cmhc10Down = 0.10;
      const cmhc10Principal = price * (1 - cmhc10Down);
      const cmhc10Premium = cmhc10Principal * 0.031;
      assert('CMHC: premium applies at 10% down', cmhc10Premium > 0, `CMHC = ${cmhc10Premium.toFixed(0)}`);
      assert('CMHC: 10% down premium > 0', cmhc10Down < 0.20 && cmhc10Premium > 20000, `Premium = ${cmhc10Premium.toFixed(0)}`);
      assert('CMHC: no premium at 20%+', mortDownPct >= 0.20, '20% down = exempt');
      
      // â”€â”€ CAGR Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const cagr = (Math.pow(25000 / 10000, 1 / 5) - 1) * 100;
      assert('CAGR: basic calc', Math.abs(cagr - 20.11) < 0.1, `CAGR = ${cagr.toFixed(2)}%`);
      
      // â”€â”€ Compound Interest Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let balance = 10000;
      for (let m = 0; m < 12; m++) {
        balance *= (1 + 0.07 / 12);
      }
      assert('Compound: 1yr @7%', Math.abs(balance - 10722.9) < 5, `Balance = ${balance.toFixed(2)}`);
      
      // â”€â”€ DCA Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      let dcaBalance = 0;
      const dcaMonthly = 500;
      const dcaRate = Math.pow(1.08, 1 / 12) - 1;
      for (let m = 0; m < 240; m++) {
        dcaBalance = dcaBalance * (1 + dcaRate) + dcaMonthly;
      }
      const dcaTotalContributed = 500 * 240;
      assert('DCA: 20yr result > contributions', dcaBalance > dcaTotalContributed, `Balance = ${dcaBalance.toFixed(0)} > ${dcaTotalContributed}`);
      
      // â”€â”€ DCA with Inflation Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const dcaInflation = 0.03;
      const dcaNominal = dcaBalance;
      const dcaReal = dcaNominal / Math.pow(1 + dcaInflation, 20);
      assert('DCA inflation: real < nominal', dcaReal < dcaNominal, `Real = ${dcaReal.toFixed(0)} < Nominal = ${dcaNominal.toFixed(0)}`);
      assert('DCA inflation: real still positive', dcaReal > 0, `Real = ${dcaReal.toFixed(0)}`);
      
      // â”€â”€ Startup Runway Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const rwCosts = 50000;
      const rwRevenue = 20000;
      const rwBurnRate = rwCosts - rwRevenue;
      assert('Runway: burn rate = costs - revenue', rwBurnRate === 30000, `Burn = ${rwBurnRate}`);
      const rwCash = 300000;
      const rwMonths = rwCash / rwBurnRate;
      assert('Runway: months = cash / burn', rwMonths === 10, `Months = ${rwMonths}`);
      assert('Runway: zero burn when revenue >= costs', (50000 - 50000) === 0, 'Break-even');
      
      // â”€â”€ Net Worth Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const nwAssets = 500000;
      const nwLiabilities = 200000;
      const nwNetWorth = nwAssets - nwLiabilities;
      assert('Net worth: assets - liabilities', nwNetWorth === 300000, `NW = ${nwNetWorth}`);
      assert('Net worth: negative when liabilities > assets', (100000 - 300000) < 0, 'Negative NW');
      
      // â”€â”€ Tax Bracket Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const fedTaxResult = fedTax(120000);
      assert('Fed tax: positive for 120K', fedTaxResult > 0, `Tax = ${fedTaxResult.toFixed(0)}`);
      assert('Fed tax: reasonable', fedTaxResult > 15000 && fedTaxResult < 35000, `Tax = ${fedTaxResult.toFixed(0)}`);
      
      // â”€â”€ Page Navigation Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const allPages = ['home', 'valuation', 'mortgage', 'investment', 'retirement', 'compound', 'merger', 'runway', 'networth', 'salary', 'debt'];
      allPages.forEach(p => {
        assert(`Nav: page-${p} exists`, !!document.getElementById('page-' + p), '');
      });
      
      // â”€â”€ Theme Tests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      const wasDark = isDark;
      const wasCls = document.documentElement.classList.contains('light');
      toggleTheme();
      assert('Theme: toggles isDark', isDark !== wasDark, `isDark changed to ${isDark}`);
      assert('Theme: light class toggles', document.documentElement.classList.contains('light') !== wasCls, '');
      const themeStored = localStorage.getItem('calcstack-theme');
      assert('Theme: persists to localStorage', themeStored !== null, `Stored: ${themeStored}`);
      toggleTheme(); // Reset
      const themeReset = localStorage.getItem('calcstack-theme');
      assert('Theme: localStorage updates on re-toggle', themeReset !== themeStored, `Now: ${themeReset}`);
      
      // Print results
      console.log(`\nğŸ§ª BABAGANOUSH TEST SUITE`);
      console.log(`${'â•'.repeat(50)}`);
      results.forEach(r => {
        console.log(`${r.status === 'PASS' ? 'âœ…' : 'âŒ'} ${r.name} ${r.detail ? `(${r.detail})` : ''}`);
      });
      console.log(`${'â•'.repeat(50)}`);
      console.log(`Results: ${passed} passed, ${failed} failed, ${passed + failed} total`);
      console.log(failed === 0 ? 'ğŸ‰ ALL TESTS PASSED!' : `âš ï¸ ${failed} TEST(S) FAILED`);
      
      return { passed, failed, total: passed + failed, results };
    }
    
    // Run tests on load (dev mode)
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1' || location.search.includes('test=true')) {
      window.addEventListener('load', () => {
        setTimeout(runTests, 500);
      });
    }
    
    // Expose for manual testing
    window.runTests = runTests;

    // â”€â”€ M&A Deal Analyzer â”€â”€
    function calculateMA() {
      const v = id => parseFloat(document.getElementById(id).value) || 0;
      const fmt = (n, d=1) => n.toLocaleString('en-US', {minimumFractionDigits:d, maximumFractionDigits:d});
      const fmtM = n => '$' + fmt(n, 1) + 'M';
      const fmtD = n => '$' + fmt(n, 2);

      // Inputs
      const acqEPS = v('ma-acq-eps'), acqPrice = v('ma-acq-price'), acqShares = v('ma-acq-shares'), acqPE = v('ma-acq-pe');
      const tgtEPS = v('ma-tgt-eps'), tgtPrice = v('ma-tgt-price'), tgtShares = v('ma-tgt-shares');
      const premium = v('ma-premium') / 100;
      const cashPct = v('ma-cash-pct') / 100, stockPct = 1 - cashPct;
      const debtCost = v('ma-debt-cost') / 100, taxRate = v('ma-tax') / 100;
      const revSyn = v('ma-rev-syn'), costSyn = v('ma-cost-syn');

      // Core calcs
      const offerPrice = tgtPrice * (1 + premium);
      const dealValue = offerPrice * tgtShares; // in $M
      const cashPortion = dealValue * cashPct;
      const stockPortion = dealValue * stockPct;
      const newSharesIssued = acqPrice > 0 ? stockPortion / acqPrice : 0;
      const proFormaShares = acqShares + newSharesIssued;

      // Earnings
      const acqNetIncome = acqEPS * acqShares;
      const tgtNetIncome = tgtEPS * tgtShares;
      const synergies = (revSyn + costSyn) * (1 - taxRate);
      const interestExpense = cashPortion * debtCost * (1 - taxRate);
      const proFormaNetIncome = acqNetIncome + tgtNetIncome + synergies - interestExpense;
      const proFormaEPS = proFormaShares > 0 ? proFormaNetIncome / proFormaShares : 0;
      const accretionDilution = acqEPS !== 0 ? ((proFormaEPS - acqEPS) / acqEPS) * 100 : 0;

      // Goodwill
      const tgtBookValue = tgtShares * tgtPrice; // simplified: book â‰ˆ market pre-premium
      const goodwill = dealValue - tgtBookValue;

      // Combined P/E
      const combinedPE = proFormaEPS > 0 ? acqPrice / proFormaEPS : 0;

      // Break-even synergies: find synergies needed so accretion = 0
      // proFormaEPS = acqEPS when synergies = S_be
      // (acqNI + tgtNI + S_be*(1-t) - interest) / proFormaShares = acqEPS
      const beNumerator = acqEPS * proFormaShares - acqNetIncome - tgtNetIncome + interestExpense;
      const breakEvenSyn = (1 - taxRate) > 0 ? beNumerator / (1 - taxRate) : 0;

      // Transaction fees
      const txnFees = dealValue * 0.02;

      const adColor = accretionDilution >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)';
      const adLabel = accretionDilution >= 0 ? 'Accretive' : 'Dilutive';

      // Results
      document.getElementById('ma-results').innerHTML = `
        <div class="result-card glass-card" style="padding: var(--space-lg);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Deal Summary</h3>
          <div style="display: grid; gap: 1rem;">
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Offer Price / Share</span><div class="mono" style="font-size: 1.3rem; color: var(--brand-primary);">${fmtD(offerPrice)}</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Total Deal Value</span><div class="mono" style="font-size: 1.3rem; color: var(--brand-primary);">${fmtM(dealValue)}</div></div>
            <div style="border-top: 1px solid rgba(255,255,255,0.06); padding-top: 1rem;">
              <span style="color: var(--text-secondary); font-size: 0.85rem;">Pro Forma EPS</span>
              <div class="mono" style="font-size: 1.3rem; color: var(--brand-accent);">${fmtD(proFormaEPS)}</div>
              <span style="font-size: 0.75rem; color: var(--text-muted);">vs. standalone ${fmtD(acqEPS)}</span>
            </div>
            <div style="background: rgba(${accretionDilution >= 0 ? '46,204,113' : '231,76,60'},0.1); border-radius: 0.75rem; padding: 1rem; text-align: center;">
              <span style="color: var(--text-secondary); font-size: 0.85rem;">${adLabel}</span>
              <div class="mono" style="font-size: 1.8rem; font-weight: 700; color: ${adColor};">${accretionDilution >= 0 ? '+' : ''}${fmt(accretionDilution,2)}%</div>
            </div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Goodwill Created</span><div class="mono" style="font-size: 1.1rem;">${fmtM(goodwill)}</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Combined P/E</span><div class="mono" style="font-size: 1.1rem;">${fmt(combinedPE,1)}x</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Break-even Synergies Needed</span><div class="mono" style="font-size: 1.1rem; color: ${breakEvenSyn > 0 ? 'var(--brand-warning)' : 'var(--brand-success)'};">${fmtM(breakEvenSyn)}</div></div>
          </div>
        </div>
      `;

      // Sensitivity table
      const premiums = [10, 20, 30, 40];
      const cashMixes = [0, 25, 50, 75, 100];
      let tbl = '<h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Sensitivity: Accretion / Dilution %</h3>';
      tbl += '<table class="sensitivity-table"><thead><tr><th>Premium \\ Cash%</th>';
      cashMixes.forEach(c => tbl += `<th>${c}%</th>`);
      tbl += '</tr></thead><tbody>';
      premiums.forEach(p => {
        tbl += `<tr><td style="font-weight:600;">${p}%</td>`;
        cashMixes.forEach(c => {
          const op = tgtPrice * (1 + p/100);
          const dv = op * tgtShares;
          const cp = dv * c/100, sp = dv * (1 - c/100);
          const ns = acqPrice > 0 ? sp / acqPrice : 0;
          const pfs = acqShares + ns;
          const ie = cp * debtCost * (1 - taxRate);
          const pfni = acqNetIncome + tgtNetIncome + synergies - ie;
          const pfeps = pfs > 0 ? pfni / pfs : 0;
          const ad = acqEPS !== 0 ? ((pfeps - acqEPS) / acqEPS) * 100 : 0;
          const cls = ad >= 0 ? 'positive-val' : 'negative-val';
          const hl = (p === v('ma-premium') && c === v('ma-cash-pct')) ? ' highlight' : '';
          tbl += `<td class="${cls}${hl}">${ad >= 0 ? '+' : ''}${ad.toFixed(1)}%</td>`;
        });
        tbl += '</tr>';
      });
      tbl += '</tbody></table>';
      document.getElementById('ma-sensitivity').innerHTML = tbl;

      // Sources & Uses
      const cashOnHand = 0; // simplified
      const newDebt = cashPortion;
      const stockIssued = stockPortion;
      let su = '<h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Sources & Uses ($M)</h3>';
      su += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">';
      su += '<div><table class="sensitivity-table"><thead><tr><th colspan="2">Sources</th></tr></thead><tbody>';
      su += `<tr><td>New Debt</td><td class="mono">${fmtM(newDebt)}</td></tr>`;
      su += `<tr><td>Stock Issued</td><td class="mono">${fmtM(stockIssued)}</td></tr>`;
      su += `<tr><td>Cash on Hand</td><td class="mono">${fmtM(cashOnHand)}</td></tr>`;
      su += `<tr style="border-top:2px solid rgba(255,255,255,0.1);"><td style="font-weight:700;">Total Sources</td><td class="mono" style="font-weight:700;">${fmtM(newDebt + stockIssued + cashOnHand)}</td></tr>`;
      su += '</tbody></table></div>';
      su += '<div><table class="sensitivity-table"><thead><tr><th colspan="2">Uses</th></tr></thead><tbody>';
      su += `<tr><td>Purchase Price</td><td class="mono">${fmtM(dealValue)}</td></tr>`;
      su += `<tr><td>Transaction Fees (2%)</td><td class="mono">${fmtM(txnFees)}</td></tr>`;
      su += `<tr><td>Refinancing</td><td class="mono">${fmtM(0)}</td></tr>`;
      su += `<tr style="border-top:2px solid rgba(255,255,255,0.1);"><td style="font-weight:700;">Total Uses</td><td class="mono" style="font-weight:700;">${fmtM(dealValue + txnFees)}</td></tr>`;
      su += '</tbody></table></div></div>';
      document.getElementById('ma-sources-uses').innerHTML = su;
    }

    // Initialize M&A on page load
    document.addEventListener('DOMContentLoaded', function() { if(document.getElementById('ma-acq-eps')) calculateMA(); });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  STARTUP RUNWAY CALCULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let runwayScenario = 'base';

    function switchRunwayTab(tab) {
      runwayScenario = tab;
      document.querySelectorAll('#runway-tabs .tab').forEach(t => t.classList.remove('active'));
      document.getElementById('runway-tab-' + tab).classList.add('active');
      calculateRunway();
    }

    function getHiringPlan() {
      const roles = document.querySelectorAll('.rw-hire-role');
      const salaries = document.querySelectorAll('.rw-hire-salary');
      const months = document.querySelectorAll('.rw-hire-month');
      const plan = [];
      for (let i = 0; i < roles.length; i++) {
        plan.push({
          role: roles[i].value,
          salary: parseFloat(salaries[i].value) || 0,
          startMonth: parseInt(months[i].value) || 1
        });
      }
      return plan;
    }

    function calculateRunway() {
      const cash = parseFloat(document.getElementById('rw-cash').value) || 0;
      const revenue = parseFloat(document.getElementById('rw-revenue').value) || 0;
      let growthPct = parseFloat(document.getElementById('rw-growth').value) || 0;
      const fixed = parseFloat(document.getElementById('rw-fixed').value) || 0;
      const variable = parseFloat(document.getElementById('rw-variable').value) || 0;
      const onetime = parseFloat(document.getElementById('rw-onetime').value) || 0;
      const hiring = parseFloat(document.getElementById('rw-hiring').value) || 0;
      const hiringPlan = getHiringPlan();

      let scenarioLabel = 'Base Case Scenario';
      let effectiveGrowth = growthPct;
      if (runwayScenario === 'conservative') { effectiveGrowth = 0; scenarioLabel = 'Conservative Scenario (No Growth)'; }
      if (runwayScenario === 'aggressive') { effectiveGrowth = growthPct * 2; scenarioLabel = 'Aggressive Scenario (' + (growthPct * 2) + '% Growth)'; }

      document.getElementById('rw-scenario-label').textContent = scenarioLabel;

      const totalCosts = fixed + variable;
      const burnRate = totalCosts - revenue;
      document.getElementById('rw-burn').textContent = fmtFull(burnRate);

      const maxMonths = 60;
      let balances = [];
      let flatRunway = 0;
      let growthRunway = 0;
      let breakEvenMonth = null;
      let hitZeroGrowth = false;

      // Flat runway (no growth)
      let flatBal = cash - onetime;
      for (let m = 1; m <= maxMonths; m++) {
        let flatCosts = totalCosts + (hiring * m);
        flatBal -= (flatCosts - revenue);
        if (flatBal <= 0) { flatRunway = m; break; }
        if (m === maxMonths) flatRunway = maxMonths;
      }

      // Growth runway
      let bal = cash - onetime;
      let rev = revenue;
      for (let m = 1; m <= maxMonths; m++) {
        rev = rev * (1 + effectiveGrowth / 100);
        let hiringCost = 0;
        hiringPlan.forEach(h => { if (m >= h.startMonth) hiringCost += h.salary; });
        let costs = totalCosts + (hiring * m) + hiringCost;
        bal -= (costs - rev);
        balances.push({ month: m, balance: bal, revenue: rev, costs: costs });
        if (!breakEvenMonth && rev >= costs) breakEvenMonth = m;
        if (!hitZeroGrowth && bal <= 0) { growthRunway = m; hitZeroGrowth = true; }
      }
      if (!hitZeroGrowth) growthRunway = maxMonths;

      document.getElementById('rw-runway-flat').textContent = flatRunway >= maxMonths ? '60+ months' : flatRunway + ' months';
      document.getElementById('rw-runway-growth').textContent = growthRunway >= maxMonths ? '60+ months' : growthRunway + ' months';

      const now = new Date();
      if (growthRunway < maxMonths) {
        const zeroDate = new Date(now.getFullYear(), now.getMonth() + growthRunway, 1);
        document.getElementById('rw-zero-date').textContent = zeroDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      } else {
        document.getElementById('rw-zero-date').textContent = 'N/A (sustainable)';
      }

      const rw = growthRunway;
      const safeEl = document.getElementById('rw-safe-zone');
      const safeText = document.getElementById('rw-safe-text');
      var safeLabel;
      if (rw > 12 || rw >= maxMonths) {
        safeLabel = '\u{1F7E2} Safe Zone';
        safeEl.style.borderColor = 'rgba(16, 185, 129, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.03))';
      } else if (rw >= 6) {
        safeLabel = '\u{1F7E1} Caution';
        safeEl.style.borderColor = 'rgba(245, 158, 11, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.03))';
      } else {
        safeLabel = '\u{1F534} Danger';
        safeEl.style.borderColor = 'rgba(239, 68, 68, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.03))';
      }
      // Render gauge for safety zone (0-24 months mapped to 0-100)
      var gaugeVal = Math.min(rw, 24) / 24 * 100;
      safeText.innerHTML = safeLabel + '<div id="rw-gauge" style="margin-top:0.5rem;display:flex;justify-content:center;"></div>';
      renderGauge('rw-gauge', gaugeVal, [
        { from: 0, to: 25, color: '#ef4444' },
        { from: 25, to: 50, color: '#f59e0b' },
        { from: 50, to: 100, color: '#10b981' }
      ], rw >= maxMonths ? '60+ mo' : rw + ' mo', 140);

      document.getElementById('rw-breakeven').textContent = breakEvenMonth ? 'Month ' + breakEvenMonth : 'Not within 60 months';

      // Chart
      const chart = document.getElementById('rw-chart');
      const maxBal = Math.max(...balances.map(b => Math.abs(b.balance)), 1);
      const months = Math.min(balances.length, 36);
      let html = '';
      for (let i = 0; i < months; i++) {
        const b = balances[i];
        const pct = Math.min(Math.abs(b.balance) / maxBal * 100, 100);
        const isNeg = b.balance < 0;
        const isBE = breakEvenMonth && i + 1 === breakEvenMonth;
        let color = isNeg ? 'var(--brand-danger)' : (isBE ? 'var(--brand-success)' : 'linear-gradient(to top, var(--brand-primary), var(--brand-accent))');
        const title = 'Month ' + (i + 1) + ': ' + fmtFull(b.balance);
        html += '<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%;position:relative;" title="' + title + '">';
        html += '<div style="width:100%;height:' + Math.max(pct, 2) + '%;background:' + color + ';border-radius:3px 3px 0 0;min-height:2px;transition:height 0.5s ease;"></div>';
        if (i % 6 === 0 || i === months - 1) html += '<span style="font-size:0.55rem;color:var(--text-muted);position:absolute;bottom:-18px;">M' + (i + 1) + '</span>';
        html += '</div>';
      }
      chart.innerHTML = html;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  NET WORTH TRACKER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function nwVal(id) { return parseFloat(document.getElementById(id).value) || 0; }

    function calculateNetWorth() {
      const assets = {
        'Cash & Savings': nwVal('nw-cash'),
        'TFSA': nwVal('nw-tfsa'),
        'RRSP': nwVal('nw-rrsp'),
        'Non-Registered': nwVal('nw-nonreg'),
        'Real Estate': nwVal('nw-realestate'),
        'Vehicles': nwVal('nw-vehicles'),
        'Other Assets': nwVal('nw-other-assets'),
      };
      const liabilities = {
        'Mortgage': nwVal('nw-mortgage'),
        'Car Loans': nwVal('nw-carloans'),
        'Student Loans': nwVal('nw-student'),
        'Credit Cards': nwVal('nw-cc'),
        'Line of Credit': nwVal('nw-loc'),
        'Other Debt': nwVal('nw-other-debt'),
      };

      const totalAssets = Object.values(assets).reduce((a, b) => a + b, 0);
      const totalLiabilities = Object.values(liabilities).reduce((a, b) => a + b, 0);
      const netWorth = totalAssets - totalLiabilities;
      const liquidNW = totalAssets - assets['Real Estate'] - assets['Vehicles'] - totalLiabilities;

      document.getElementById('nw-total-assets').textContent = fmtFull(totalAssets);
      document.getElementById('nw-total-liabilities').textContent = fmtFull(totalLiabilities);
      document.getElementById('nw-networth').textContent = fmtFull(netWorth);
      document.getElementById('nw-liquid').textContent = fmtFull(liquidNW);

      // Debt-to-asset ratio
      const dtaEl = document.getElementById('nw-dta');
      if (totalAssets > 0) {
        const dta = (totalLiabilities / totalAssets * 100);
        let pillClass = dta > 80 ? 'negative' : dta > 50 ? 'neutral' : 'positive';
        let icon = dta > 80 ? '\u{1F534}' : dta > 50 ? '\u{1F7E1}' : '\u{1F7E2}';
        dtaEl.innerHTML = '<span class="metric-pill ' + pillClass + '">' + icon + ' Debt-to-Asset: ' + dta.toFixed(1) + '%</span>';
      } else {
        dtaEl.innerHTML = '';
      }

      // SVG Donut Chart for asset allocation
      const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];
      const assetEntries = Object.entries(assets).filter(function(e) { return e[1] > 0; });
      if (totalAssets > 0 && assetEntries.length > 0) {
        var donutSegments = assetEntries.map(function(entry, i) {
          return { label: entry[0], value: entry[1], color: colors[i % colors.length] };
        });
        renderDonutChart('nw-pie', donutSegments, 150);
        document.getElementById('nw-pie-legend').innerHTML = assetEntries.map(function(entry, i) {
          var pct = (entry[1] / totalAssets * 100).toFixed(0);
          return '<div style="display:flex;align-items:center;gap:6px;"><span style="width:10px;height:10px;border-radius:2px;background:' + colors[i % colors.length] + ';flex-shrink:0;"></span>' + entry[0] + ' <span class="mono" style="color:var(--text-muted);">' + pct + '%</span></div>';
        }).join('');
      } else {
        document.getElementById('nw-pie').innerHTML = '<div style="width:150px;height:150px;border-radius:50%;background:var(--border-primary);"></div>';
        document.getElementById('nw-pie-legend').innerHTML = '<span style="color:var(--text-muted);">Enter assets to see allocation</span>';
      }

      // Gauge for Debt-to-Asset ratio
      if (totalAssets > 0) {
        var dtaVal = totalLiabilities / totalAssets * 100;
        var dtaContainer = document.getElementById('nw-dta');
        dtaContainer.innerHTML = '<div id="nw-dta-gauge"></div>';
        renderGauge('nw-dta-gauge', Math.min(dtaVal, 100), [
          { from: 0, to: 33, color: '#10b981' },
          { from: 33, to: 66, color: '#f59e0b' },
          { from: 66, to: 100, color: '#ef4444' }
        ], 'D/A: ' + dtaVal.toFixed(1) + '%', 160);
      }
    }

    function saveNetWorthSnapshot() {
      const snap = {
        date: new Date().toISOString(),
        assets: nwVal('nw-cash') + nwVal('nw-tfsa') + nwVal('nw-rrsp') + nwVal('nw-nonreg') + nwVal('nw-realestate') + nwVal('nw-vehicles') + nwVal('nw-other-assets'),
        liabilities: nwVal('nw-mortgage') + nwVal('nw-carloans') + nwVal('nw-student') + nwVal('nw-cc') + nwVal('nw-loc') + nwVal('nw-other-debt'),
      };
      snap.netWorth = snap.assets - snap.liabilities;
      const snaps = JSON.parse(localStorage.getItem('nw-snapshots') || '[]');
      snaps.push(snap);
      localStorage.setItem('nw-snapshots', JSON.stringify(snaps));
      loadNetWorthSnapshots();
    }

    function loadNetWorthSnapshots() {
      const snaps = JSON.parse(localStorage.getItem('nw-snapshots') || '[]');
      const el = document.getElementById('nw-snapshots');
      if (snaps.length === 0) {
        el.innerHTML = '<p style="color:var(--text-muted);font-size:0.8rem;">No snapshots yet. Save one to start tracking.</p>';
        return;
      }
      let html = '<div style="display:flex;flex-direction:column;gap:0.5rem;">';
      snaps.slice().reverse().forEach(function(s) {
        const d = new Date(s.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        const nwColor = s.netWorth >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)';
        html += '<div style="display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0.75rem;background:var(--bg-secondary);border-radius:var(--radius-sm);border:1px solid var(--border-primary);">';
        html += '<span style="color:var(--text-secondary);">' + d + '</span>';
        html += '<span class="mono" style="font-weight:600;color:' + nwColor + ';">' + fmtFull(s.netWorth) + '</span>';
        html += '</div>';
      });
      html += '</div>';
      html += '<button class="btn btn-ghost btn-sm" style="margin-top:0.75rem;color:var(--brand-danger);font-size:0.72rem;" onclick="if(confirm(\'Clear all snapshots?\')){localStorage.removeItem(\'nw-snapshots\');loadNetWorthSnapshots();}">Clear All Snapshots</button>';
      el.innerHTML = html;

      // Trend chart
      const trendEl = document.getElementById('nw-trend-chart');
      if (trendEl && snaps.length >= 2) {
        const trendData = snaps.map(s => ({
          label: new Date(s.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
          bottom: 0,
          top: s.netWorth
        }));
        const maxNW = Math.max(...snaps.map(s => Math.abs(s.netWorth)), 1);
        trendEl.innerHTML = '<div style="display:flex;align-items:flex-end;gap:4px;height:150px;">' +
          snaps.map(s => {
            const h = Math.max(2, Math.abs(s.netWorth) / maxNW * 140);
            const color = s.netWorth >= 0 ? 'linear-gradient(to top,var(--brand-primary),var(--brand-accent))' : 'var(--brand-danger)';
            return '<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%;"><div style="font-size:0.55rem;color:var(--text-muted);margin-bottom:2px;">' + fmtFull(s.netWorth) + '</div><div style="width:100%;height:' + h + 'px;background:' + color + ';border-radius:3px 3px 0 0;"></div></div>';
          }).join('') + '</div>' +
          '<div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text-muted);margin-top:0.25rem;">' +
          '<span>' + new Date(snaps[0].date).toLocaleDateString('en-US',{month:'short',day:'numeric'}) + '</span>' +
          '<span>' + new Date(snaps[snaps.length-1].date).toLocaleDateString('en-US',{month:'short',day:'numeric'}) + '</span></div>';
      } else if (trendEl) {
        trendEl.innerHTML = '<p style="color:var(--text-muted);font-size:0.8rem;">Save 2+ snapshots to see trend</p>';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  NEWSLETTER SIGNUP
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function subscribeNewsletter() {
      const input = document.getElementById('newsletter-email');
      const email = input.value.trim();
      if (!email || !email.includes('@') || !email.includes('.')) {
        input.style.borderColor = 'var(--brand-danger)';
        setTimeout(function() { input.style.borderColor = ''; }, 2000);
        return;
      }
      const subs = JSON.parse(localStorage.getItem('bb-newsletter') || '[]');
      if (!subs.includes(email)) { subs.push(email); localStorage.setItem('bb-newsletter', JSON.stringify(subs)); }
      input.value = '';
      // Show toast
      const toast = document.createElement('div');
      toast.className = 'toast-success';
      toast.innerHTML = 'âœ… You\'re subscribed! Welcome aboard.';
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 3500);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  COOKIE CONSENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    (function() {
      if (localStorage.getItem('bb-cookie-consent')) return;
      var banner = document.createElement('div');
      banner.className = 'cookie-banner';
      banner.innerHTML = '<span>ğŸª We use cookies to improve your experience.</span><div class="cookie-banner-btns"><button class="btn btn-primary btn-sm" onclick="acceptCookies(true)">Accept</button><button class="btn btn-secondary btn-sm" onclick="acceptCookies(false)">Decline</button></div>';
      document.body.appendChild(banner);
    })();
    function acceptCookies(accepted) {
      localStorage.setItem('bb-cookie-consent', accepted ? 'accepted' : 'declined');
      var b = document.querySelector('.cookie-banner');
      if (b) b.remove();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  MICRO-INTERACTIONS v1.6
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // 1. Smooth Number Animations
    function animateValue(element, start, end, duration) {
      if (!element || duration <= 0) { element.textContent = end; return; }
      const startTime = performance.now();
      const isFormatted = typeof end === 'string';
      const endNum = isFormatted ? parseFloat(end.replace(/[^0-9.\-]/g, '')) : end;
      const startNum = isFormatted ? parseFloat(start.toString().replace(/[^0-9.\-]/g, '')) || 0 : (start || 0);
      if (isNaN(endNum)) { element.textContent = end; return; }
      const prefix = isFormatted ? (end.match(/^[^0-9.\-]*/)||[''])[0] : '';
      const suffix = isFormatted ? (end.match(/[^0-9.\-]*$/)||[''])[0] : '';
      const hasDecimal = isFormatted && end.includes('.');
      const decimals = hasDecimal ? (end.split('.')[1] || '').replace(/[^0-9]/g, '').length : 0;

      function tick(now) {
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
        const current = startNum + (endNum - startNum) * eased;
        if (isFormatted) {
          element.textContent = prefix + current.toLocaleString('en-US', {minimumFractionDigits: decimals, maximumFractionDigits: decimals}) + suffix;
        } else {
          element.textContent = Math.round(current);
        }
        if (progress < 1) requestAnimationFrame(tick);
        else element.textContent = end; // ensure exact final value
      }
      requestAnimationFrame(tick);
    }

    // Observe .result-value changes and animate them
    (function() {
      const resultObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(m) {
          if (m.type === 'childList' || m.type === 'characterData') {
            const el = m.target.nodeType === 1 ? m.target : m.target.parentElement;
            if (!el || !el.classList || !el.classList.contains('result-value')) return;
            const newVal = el.textContent;
            const oldVal = el.getAttribute('data-prev') || '0';
            if (newVal !== oldVal && !el._animating) {
              el._animating = true;
              el.setAttribute('data-prev', newVal);
              animateValue(el, oldVal, newVal, 600);
              setTimeout(function() { el._animating = false; }, 650);
            }
          }
        });
      });
      // Observe the whole body for result-value text changes
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.result-value').forEach(function(el) {
          el.setAttribute('data-prev', el.textContent);
        });
      });
      // Use a simpler approach: patch innerHTML setters on result containers
      const origShowPage = window.showPage;
      // We'll hook into calculator functions instead via a post-render observer
      setInterval(function() {
        document.querySelectorAll('.result-value').forEach(function(el) {
          if (!el.hasAttribute('data-prev')) el.setAttribute('data-prev', el.textContent);
        });
      }, 200);
    })();

    // 2. Input Ripple Effect
    document.addEventListener('click', function(e) {
      const input = e.target.closest('.input-group input, .input-group select');
      if (!input) return;
      const group = input.closest('.input-group');
      if (!group) return;
      const ripple = document.createElement('div');
      ripple.className = 'input-ripple';
      const rect = input.getBoundingClientRect();
      const grect = group.getBoundingClientRect();
      const size = 30;
      ripple.style.width = size + 'px';
      ripple.style.height = size + 'px';
      ripple.style.left = (e.clientX - grect.left - size/2) + 'px';
      ripple.style.top = (e.clientY - grect.top - size/2) + 'px';
      group.appendChild(ripple);
      setTimeout(function() { ripple.remove(); }, 600);
    });

    // 3. Page Transition (fade-out / fade-in)
    (function() {
      const origShowPage = window.showPage;
      window.showPage = function(pageId) {
        const currentPage = document.querySelector('.page.active');
        const targetPage = document.getElementById('page-' + pageId);
        if (!targetPage || currentPage === targetPage) {
          origShowPage(pageId);
          return;
        }
        if (currentPage) {
          currentPage.classList.add('fade-out');
          setTimeout(function() {
            currentPage.classList.remove('active', 'fade-out');
            targetPage.classList.add('active', 'fade-in');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            setTimeout(function() { targetPage.classList.remove('fade-in'); }, 250);
            // Close mobile menu & init calculators
            document.getElementById('nav-links').classList.remove('mobile-open');
            if (pageId === 'valuation') calculateDCF();
            if (pageId === 'mortgage') calculateMortgage();
            if (pageId === 'investment') calculateCAGR();
            if (pageId === 'retirement') calculateRetirement();
            if (pageId === 'compound') calculateCompound();
            if (pageId === 'runway') calculateRunway();
            if (pageId === 'networth') { calculateNetWorth(); loadNetWorthSnapshots(); }
          }, 150);
        } else {
          origShowPage(pageId);
        }
      };
    })();

    // 4. Parallax Hero Blobs
    (function() {
      let ticking = false;
      const blobs = document.querySelectorAll('.hero-blob');
      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            const scrollY = window.scrollY;
            blobs.forEach(function(blob, i) {
              const speed = (i + 1) * 0.05;
              blob.style.transform = 'translateY(' + (scrollY * speed * -1) + 'px)';
            });
            ticking = false;
          });
          ticking = true;
        }
      });
    })();

    // 5. Chart Bar Tooltips â€” handled via CSS class .chart-bar-tooltip + data-tooltip attr
    // The chart rendering functions already use title attrs; we enhance them with CSS tooltips
    // by adding a MutationObserver that converts title attrs on chart bars to our tooltip class
    (function() {
      function enhanceChartBars() {
        document.querySelectorAll('[title]').forEach(function(el) {
          if (el.closest('.chart-container, #rw-chart, #dca-chart, #compound-chart, #dcf-chart')) {
            if (!el.classList.contains('chart-bar-tooltip')) {
              el.classList.add('chart-bar-tooltip');
              el.setAttribute('data-tooltip', el.getAttribute('title'));
              el.removeAttribute('title');
            }
          }
        });
      }
      setInterval(enhanceChartBars, 500);
    })();

    // 6. Loading Skeleton
    (function() {
      const origShowPage2 = window.showPage;
      window.showPage = (function(prev) {
        return function(pageId) {
          prev(pageId);
          if (pageId === 'home') return;
          const page = document.getElementById('page-' + pageId);
          if (!page) return;
          const results = page.querySelectorAll('.calc-results');
          results.forEach(function(r) {
            if (r._skeletonShown) return;
            r._skeletonShown = true;
            r.style.position = 'relative';
            const skel = document.createElement('div');
            skel.className = 'skeleton-overlay';
            skel.innerHTML = '<div class="skeleton-line tall"></div><div class="skeleton-line medium"></div><div class="skeleton-line"></div><div class="skeleton-line short"></div>';
            r.appendChild(skel);
            setTimeout(function() {
              skel.style.transition = 'opacity 0.2s ease';
              skel.style.opacity = '0';
              setTimeout(function() { skel.remove(); r._skeletonShown = false; }, 200);
            }, 300);
          });
        };
      })(window.showPage);
    })();

    // 7. Scroll Progress Bar
    (function() {
      const bar = document.getElementById('scroll-progress');
      let ticking = false;
      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const pct = scrollHeight > 0 ? (scrollTop / scrollHeight * 100) : 0;
            bar.style.width = pct + '%';
            ticking = false;
          });
          ticking = true;
        }
      });
    })();

    // 8. Easter Egg â€” type "calcstack" anywhere
    (function() {
      let buffer = '';
      const secret = 'calcstack';
      document.addEventListener('keypress', function(e) {
        buffer += e.key.toLowerCase();
        if (buffer.length > secret.length) buffer = buffer.slice(-secret.length);
        if (buffer === secret) {
          buffer = '';
          triggerConfetti();
        }
      });

      function triggerConfetti() {
        const container = document.createElement('div');
        container.className = 'confetti-container';
        document.body.appendChild(container);
        const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#f97316'];
        for (let i = 0; i < 80; i++) {
          const piece = document.createElement('div');
          piece.className = 'confetti-piece';
          piece.style.left = Math.random() * 100 + 'vw';
          piece.style.background = colors[Math.floor(Math.random() * colors.length)];
          piece.style.animationDelay = (Math.random() * 1.5) + 's';
          piece.style.animationDuration = (2 + Math.random() * 2) + 's';
          piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
          piece.style.width = (5 + Math.random() * 8) + 'px';
          piece.style.height = (5 + Math.random() * 8) + 'px';
          container.appendChild(piece);
        }
        setTimeout(function() { container.remove(); }, 5000);
      }
    })();


    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  SALARY & COMPENSATION ANALYZER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function calculateSalary() {
      const base = parseFloat(document.getElementById('sal-base').value) || 0;
      const bonusPct = parseFloat(document.getElementById('sal-bonus-pct').value) || 0;
      const shares = parseFloat(document.getElementById('sal-shares').value) || 0;
      const strike = parseFloat(document.getElementById('sal-strike').value) || 0;
      const currentPrice = parseFloat(document.getElementById('sal-current-price').value) || 0;
      const vesting = parseFloat(document.getElementById('sal-vesting').value) || 4;
      const health = parseFloat(document.getElementById('sal-health').value) || 0;
      const pension = parseFloat(document.getElementById('sal-pension').value) || 0;
      const province = document.getElementById('sal-province').value;

      const bonus = base * (bonusPct / 100);
      const intrinsicPerShare = Math.max(0, currentPrice - strike);
      const totalEquity = shares * intrinsicPerShare;
      const annualEquity = totalEquity / vesting;
      const benefits = health + pension;
      const totalComp = base + bonus + annualEquity + benefits;

      // Simplified Canadian marginal tax rates (combined federal + provincial, 2024 approx)
      const taxRates = {
        ON: [[ 55867, 0.2005], [111733, 0.2965], [154906, 0.3148], [220000, 0.3389], [Infinity, 0.5353]],
        BC: [[ 45654, 0.2006], [ 91310, 0.2272], [104835, 0.2950], [127299, 0.3148], [172602, 0.3267], [240716, 0.4070], [Infinity, 0.5350]],
        AB: [[ 55867, 0.2500], [111733, 0.3050], [154906, 0.3600], [208000, 0.4200], [Infinity, 0.4800]],
        QC: [[ 49275, 0.2753], [ 55867, 0.3253], [ 98540, 0.3802], [111733, 0.4397], [154906, 0.4797], [Infinity, 0.5331]],
        MB: [[ 36842, 0.2580], [ 55867, 0.2775], [ 79625, 0.3340], [111733, 0.3783], [154906, 0.4340], [Infinity, 0.5040]],
        SK: [[ 49720, 0.2550], [ 55867, 0.2775], [111733, 0.3577], [142058, 0.3577], [Infinity, 0.4477]],
        NS: [[ 29590, 0.2379], [ 55867, 0.2995], [ 59180, 0.3495], [ 93000, 0.3695], [111733, 0.4295], [150000, 0.4595], [Infinity, 0.5400]],
        NB: [[ 47715, 0.2440], [ 55867, 0.2682], [ 95524, 0.3182], [111733, 0.3552], [154906, 0.3952], [176756, 0.4352], [Infinity, 0.5302]],
        NL: [[ 41457, 0.2350], [ 55867, 0.2850], [ 82913, 0.3150], [111733, 0.3350], [148027, 0.3850], [154906, 0.4350], [207239, 0.4580], [Infinity, 0.5180]],
        PE: [[ 31984, 0.2480], [ 55867, 0.2880], [ 63969, 0.3330], [111733, 0.3530], [140000, 0.3730], [154906, 0.4430], [Infinity, 0.5130]]
      };

      const brackets = taxRates[province] || taxRates['ON'];
      const taxableIncome = base + bonus; // equity/benefits not directly taxed this way
      let tax = 0, prev = 0;
      for (const [limit, rate] of brackets) {
        if (taxableIncome <= prev) break;
        const taxable = Math.min(taxableIncome, limit) - prev;
        tax += taxable * rate;
        prev = limit;
      }
      const takeHome = taxableIncome - tax + annualEquity + benefits; // simplified
      const effTaxRate = taxableIncome > 0 ? (tax / taxableIncome) * 100 : 0;
      const hourly = totalComp / 2080;

      document.getElementById('sal-total-comp').textContent = fmtFull(totalComp);
      document.getElementById('sal-take-home').textContent = fmtFull(takeHome);
      document.getElementById('sal-eff-tax').textContent = fmtPct(effTaxRate);
      document.getElementById('sal-hourly').textContent = fmtFull(hourly);
      document.getElementById('sal-equity-val').textContent = fmtFull(annualEquity);
      document.getElementById('sal-bonus-val').textContent = fmtFull(bonus);

      // Pie chart
      const parts = [
        { label: 'Base Salary', value: base, color: '#14b8a6' },
        { label: 'Bonus', value: bonus, color: '#f59e0b' },
        { label: 'Equity', value: annualEquity, color: '#8b5cf6' },
        { label: 'Benefits', value: benefits, color: '#3b82f6' }
      ].filter(p => p.value > 0);

      const total = parts.reduce((s, p) => s + p.value, 0);
      let gradParts = [], cumPct = 0;
      parts.forEach(p => {
        const pct = (p.value / total) * 100;
        gradParts.push(`${p.color} ${cumPct}% ${cumPct + pct}%`);
        cumPct += pct;
      });
      // SVG Donut Chart for salary breakdown
      if (total > 0) {
        var salDonutSegs = parts.map(function(p) { return { label: p.label, value: p.value, color: p.color }; });
        renderDonutChart('sal-pie', salDonutSegs, 150);
      } else {
        document.getElementById('sal-pie').innerHTML = '<div style="width:150px;height:150px;border-radius:50%;background:var(--border-primary);"></div>';
      }
      document.getElementById('sal-pie-legend').innerHTML = parts.map(p =>
        `<div style="display:flex;align-items:center;gap:0.5rem;"><span style="width:10px;height:10px;border-radius:50%;background:${p.color};display:inline-block;"></span>${p.label}: ${fmtFull(p.value)} (${((p.value/total)*100).toFixed(0)}%)</div>`
      ).join('');

      // Comparison
      const canadianMedian = 55000;
      const techMedian = 95000;
      const compEl = document.getElementById('sal-comparison');
      const bar = (label, val, max) => {
        const pct = Math.min(100, (val / max) * 100);
        return `<div style="margin-bottom:0.75rem;">
          <div style="display:flex;justify-content:space-between;margin-bottom:0.25rem;"><span>${label}</span><span>${fmtFull(val)}</span></div>
          <div style="height:8px;background:var(--border-primary);border-radius:4px;overflow:hidden;">
            <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#14b8a6,#0d9488);border-radius:4px;transition:width 0.5s;"></div>
          </div>
        </div>`;
      };
      const maxVal = Math.max(totalComp, canadianMedian, techMedian) * 1.1;
      compEl.innerHTML = bar('Your Total Comp', totalComp, maxVal)
        + bar('Canadian Median', canadianMedian, maxVal)
        + bar('Tech Median', techMedian, maxVal)
        + `<div style="margin-top:0.5rem;font-size:0.8rem;color:var(--text-secondary);">You earn <strong>${totalComp > canadianMedian ? ((totalComp/canadianMedian - 1)*100).toFixed(0) + '% more' : ((1 - totalComp/canadianMedian)*100).toFixed(0) + '% less'}</strong> than the Canadian median</div>`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  DEBT PAYOFF CALCULATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let debtStrategy = 'avalanche';

    function setDebtStrategy(s) {
      debtStrategy = s;
      document.getElementById('debt-btn-avalanche').className = s === 'avalanche' ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm';
      document.getElementById('debt-btn-snowball').className = s === 'snowball' ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm';
      document.getElementById('debt-strategy-help').textContent = s === 'avalanche'
        ? 'Highest interest rate first â€” saves the most money'
        : 'Lowest balance first â€” quick wins for motivation';
      calculateDebt();
    }

    function addDebtRow() {
      const container = document.getElementById('debt-rows');
      const row = document.createElement('div');
      row.className = 'debt-row';
      row.style.cssText = 'display:grid;grid-template-columns:2fr 1.5fr 1fr 1.5fr auto;gap:0.5rem;align-items:end;margin-bottom:0.5rem;';
      row.innerHTML = `
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="New Debt" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="5000" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="12" step="0.01" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="150" oninput="calculateDebt()" /></div>
        <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">âœ•</button>`;
      container.appendChild(row);
      calculateDebt();
    }

    function removeDebtRow(btn) {
      const rows = document.querySelectorAll('#debt-rows .debt-row');
      if (rows.length <= 1) return;
      btn.closest('.debt-row').remove();
      calculateDebt();
    }

    function getDebts() {
      const rows = document.querySelectorAll('#debt-rows .debt-row');
      return Array.from(rows).map(row => {
        const inputs = row.querySelectorAll('input');
        return {
          name: inputs[0].value || 'Debt',
          balance: parseFloat(inputs[1].value) || 0,
          rate: parseFloat(inputs[2].value) || 0,
          minPayment: parseFloat(inputs[3].value) || 0
        };
      }).filter(d => d.balance > 0);
    }

    function simulatePayoff(debts, extraMonthly, strategy) {
      let balances = debts.map(d => ({ ...d }));
      let totalInterest = 0;
      let months = 0;
      const maxMonths = 600; // 50 year cap
      const timeline = [{ month: 0, total: balances.reduce((s, d) => s + d.balance, 0) }];

      while (balances.some(d => d.balance > 0.01) && months < maxMonths) {
        months++;
        let extraLeft = extraMonthly;

        // Apply interest
        balances.forEach(d => {
          if (d.balance > 0) {
            const interest = d.balance * (d.rate / 100 / 12);
            d.balance += interest;
            totalInterest += interest;
          }
        });

        // Make minimum payments
        balances.forEach(d => {
          if (d.balance > 0) {
            const payment = Math.min(d.balance, d.minPayment);
            d.balance -= payment;
          }
        });

        // Sort for strategy and apply extra payment
        const sorted = balances.filter(d => d.balance > 0.01);
        if (strategy === 'avalanche') sorted.sort((a, b) => b.rate - a.rate);
        else sorted.sort((a, b) => a.balance - b.balance);

        for (const d of sorted) {
          if (extraLeft <= 0) break;
          const payment = Math.min(d.balance, extraLeft);
          d.balance -= payment;
          extraLeft -= payment;
        }

        timeline.push({ month: months, total: balances.reduce((s, d) => s + Math.max(0, d.balance), 0) });
      }

      return { totalInterest, months, timeline };
    }

    function calculateDebt() {
      const debts = getDebts();
      if (debts.length === 0) return;

      const extra = parseFloat(document.getElementById('debt-extra').value) || 0;
      const result = simulatePayoff(debts, extra, debtStrategy);
      const minOnly = simulatePayoff(debts, 0, debtStrategy);

      document.getElementById('debt-total-interest').textContent = fmtFull(result.totalInterest);
      document.getElementById('debt-months').textContent = result.months;

      const now = new Date();
      const freeDate = new Date(now.getFullYear(), now.getMonth() + result.months, 1);
      document.getElementById('debt-free-date').textContent = freeDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });

      const savings = minOnly.totalInterest - result.totalInterest;
      document.getElementById('debt-savings').textContent = fmtFull(Math.max(0, savings));

      const yrs = Math.floor(result.months / 12);
      const mos = result.months % 12;
      document.getElementById('debt-countdown').textContent = yrs > 0 ? `${yrs}y ${mos}m` : `${mos} months`;

      // Timeline chart (simple bar chart)
      const chart = document.getElementById('debt-timeline-chart');
      const tl = result.timeline;
      const maxBalance = tl[0].total || 1;
      const step = Math.max(1, Math.floor(tl.length / 30));
      const sampled = tl.filter((_, i) => i % step === 0 || i === tl.length - 1);

      chart.innerHTML = `
        <div style="display:flex;align-items:flex-end;gap:2px;height:200px;">
          ${sampled.map(p => {
            const h = Math.max(1, (p.total / maxBalance) * 100);
            return `<div title="Month ${p.month}: ${fmtFull(p.total)}" style="flex:1;height:${h}%;background:linear-gradient(to top,#ef4444,#f97316);border-radius:2px 2px 0 0;min-width:3px;transition:height 0.3s;cursor:pointer;"></div>`;
          }).join('')}
        </div>
        <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:var(--text-secondary);margin-top:0.5rem;">
          <span>Month 0</span><span>Month ${result.months}</span>
        </div>`;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  PDF EXPORT & COPY RESULTS (All Calculators)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function generatePDFReport(calcName) {
      const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      let assumptions = '';
      let resultsText = '';
      const gv = (id) => { const el = document.getElementById(id); return el ? (el.value || el.textContent || '') : ''; };
      const gvf = (id) => fmtFull(parseFloat(gv(id)) || 0);

      const calcMap = {
        'Business Valuation (DCF)': () => {
          assumptions = `<tr><td>Annual FCF</td><td>${gvf('dcf-fcf')}</td></tr><tr><td>Growth Rate</td><td>${gv('dcf-growth')}%</td></tr><tr><td>Terminal Growth</td><td>${gv('dcf-terminal')}%</td></tr><tr><td>WACC</td><td>${gv('dcf-wacc')}%</td></tr><tr><td>Years</td><td>${gv('dcf-years')}</td></tr><tr><td>Net Debt</td><td>${gvf('dcf-debt')}</td></tr>`;
          resultsText = (document.getElementById('dcf-results') || {}).innerText || '';
        },
        'Business Valuation (Multiples)': () => {
          assumptions = `<tr><td>Revenue</td><td>${gvf('mult-revenue')}</td></tr><tr><td>EBITDA</td><td>${gvf('mult-ebitda')}</td></tr><tr><td>Net Income</td><td>${gvf('mult-income')}</td></tr><tr><td>EV/Revenue</td><td>${gv('mult-ev-rev')}x</td></tr><tr><td>EV/EBITDA</td><td>${gv('mult-ev-ebitda')}x</td></tr><tr><td>P/E</td><td>${gv('mult-pe')}x</td></tr>`;
          resultsText = (document.getElementById('multiples-results') || {}).innerText || '';
        },
        'Business Valuation (Asset-Based)': () => {
          assumptions = `<tr><td>Cash</td><td>${gvf('asset-cash')}</td></tr><tr><td>A/R</td><td>${gvf('asset-ar')}</td></tr><tr><td>Inventory</td><td>${gvf('asset-inv')}</td></tr><tr><td>PP&E</td><td>${gvf('asset-ppe')}</td></tr><tr><td>A/P</td><td>${gvf('asset-ap')}</td></tr><tr><td>Debt</td><td>${gvf('asset-debt')}</td></tr>`;
          resultsText = (document.getElementById('asset-results') || {}).innerText || '';
        },
        'Canadian Mortgage Calculator': () => {
          assumptions = `<tr><td>Home Price</td><td>${gvf('mort-price')}</td></tr><tr><td>Down Payment</td><td>${gv('mort-down')}%</td></tr><tr><td>Rate</td><td>${gv('mort-rate')}%</td></tr><tr><td>Amortization</td><td>${gv('mort-amort')} yrs</td></tr>`;
          resultsText = (document.getElementById('mortgage-results') || {}).innerText || '';
        },
        'Investment Returns (CAGR)': () => {
          assumptions = `<tr><td>Initial</td><td>${gvf('cagr-initial')}</td></tr><tr><td>Final</td><td>${gvf('cagr-final')}</td></tr><tr><td>Period</td><td>${gv('cagr-years')} yrs</td></tr>`;
          resultsText = (document.getElementById('cagr-results') || {}).innerText || '';
        },
        'Investment Returns (DCA)': () => {
          assumptions = `<tr><td>Monthly</td><td>${gvf('dca-monthly')}</td></tr><tr><td>Return</td><td>${gv('dca-return')}%</td></tr><tr><td>Years</td><td>${gv('dca-years')}</td></tr><tr><td>Initial</td><td>${gvf('dca-initial')}</td></tr><tr><td>Inflation</td><td>${gv('dca-inflation')}%</td></tr>`;
          resultsText = (document.getElementById('dca-results') || {}).innerText || '';
        },
        'RRSP vs TFSA Optimizer': () => {
          assumptions = `<tr><td>Income</td><td>${gvf('ret-income')}</td></tr><tr><td>Contribution</td><td>${gvf('ret-contribution')}</td></tr><tr><td>Age</td><td>${gv('ret-age')}</td></tr><tr><td>Retire Age</td><td>${gv('ret-retire-age')}</td></tr><tr><td>Return</td><td>${gv('ret-return')}%</td></tr>`;
          resultsText = (document.getElementById('retirement-results') || {}).innerText || '';
        },
        'Compound Interest': () => {
          assumptions = `<tr><td>Initial</td><td>${gvf('comp-initial')}</td></tr><tr><td>Monthly</td><td>${gvf('comp-monthly')}</td></tr><tr><td>Rate</td><td>${gv('comp-rate')}%</td></tr><tr><td>Years</td><td>${gv('comp-years')}</td></tr>`;
          resultsText = (document.getElementById('compound-results') || {}).innerText || '';
        },
        'M&A Deal Analyzer': () => {
          assumptions = `<tr><td>Acquirer EPS</td><td>$${gv('ma-acq-eps')}</td></tr><tr><td>Target EPS</td><td>$${gv('ma-tgt-eps')}</td></tr><tr><td>Premium</td><td>${gv('ma-premium')}%</td></tr>`;
          resultsText = (document.getElementById('ma-results') || {}).innerText || '';
        },
        'Startup Runway': () => {
          assumptions = `<tr><td>Cash</td><td>${gvf('rw-cash')}</td></tr><tr><td>Revenue</td><td>${gvf('rw-revenue')}</td></tr><tr><td>Growth</td><td>${gv('rw-growth')}%</td></tr><tr><td>Fixed Costs</td><td>${gvf('rw-fixed')}</td></tr>`;
          resultsText = 'Burn Rate: ' + gv('rw-burn') + '\nRunway: ' + gv('rw-runway-growth') + '\nCash Zero: ' + gv('rw-zero-date');
        },
        'Net Worth Tracker': () => {
          assumptions = `<tr><td>Assets</td><td>${gv('nw-total-assets')}</td></tr><tr><td>Liabilities</td><td>${gv('nw-total-liabilities')}</td></tr>`;
          resultsText = 'Net Worth: ' + gv('nw-networth') + '\nLiquid: ' + gv('nw-liquid');
        }
      };

      if (calcMap[calcName]) calcMap[calcName]();

      const html = '<!DOCTYPE html><html><head><title>CalcStack - ' + calcName + '</title><style>@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact}.no-print{display:none!important}}body{font-family:Segoe UI,Arial,sans-serif;max-width:700px;margin:0 auto;padding:2rem;color:#1a1a2e}.header{text-align:center;border-bottom:3px solid #6366f1;padding-bottom:1rem;margin-bottom:2rem}.header h1{color:#6366f1;margin:0;font-size:1.8rem}.header .brand{font-size:.9rem;color:#888;margin-top:.25rem}.header .date{font-size:.8rem;color:#999;margin-top:.5rem}h2{color:#333;font-size:1.1rem;border-bottom:1px solid #eee;padding-bottom:.5rem}table{width:100%;border-collapse:collapse;margin:1rem 0}td{padding:.5rem .75rem;border-bottom:1px solid #eee;font-size:.9rem}td:first-child{color:#666;width:50%}td:last-child{font-weight:600;text-align:right}.results{background:#f8f8ff;border-radius:8px;padding:1.5rem;margin:1.5rem 0;white-space:pre-line;font-size:.9rem;line-height:1.8}.disclaimer{margin-top:2rem;padding-top:1rem;border-top:1px solid #ddd;font-size:.72rem;color:#999;text-align:center}.print-btn{display:block;margin:1rem auto;padding:.75rem 2rem;background:#6366f1;color:white;border:none;border-radius:8px;font-size:1rem;cursor:pointer}</style></head><body><div class="header"><h1>\ud83e\uddee ' + calcName + '</h1><div class="brand">CalcStack \u2014 Smart Financial Tools</div><div class="date">Generated: ' + date + '</div></div><h2>\ud83d\udccb Input Assumptions</h2><table>' + assumptions + '</table><h2>\ud83d\udcca Results</h2><div class="results">' + resultsText.replace(/\n/g, '<br>') + '</div><div class="disclaimer"><p><strong>Disclaimer:</strong> This report is for informational and educational purposes only. It does not constitute financial, investment, tax, or legal advice. Consult a qualified professional before making financial decisions.</p><p>\u00a9 ' + new Date().getFullYear() + ' CalcStack \u00b7 calcstack.ca</p></div><button class="print-btn no-print" onclick="window.print()">\ud83d\udda8\ufe0f Print / Save as PDF</button></body></html>';

      const w = window.open('', '_blank');
      w.document.write(html);
      w.document.close();
    }

    function copyResults(calcName) {
      let text = '\ud83d\udcca ' + calcName + ' \u2014 CalcStack Report\n' + '\u2500'.repeat(40) + '\n';
      const resultIds = {
        'Business Valuation (DCF)': 'dcf-results',
        'Business Valuation (Multiples)': 'multiples-results',
        'Business Valuation (Asset-Based)': 'asset-results',
        'Canadian Mortgage Calculator': 'mortgage-results',
        'Investment Returns (CAGR)': 'cagr-results',
        'Investment Returns (DCA)': 'dca-results',
        'RRSP vs TFSA Optimizer': 'retirement-results',
        'Compound Interest': 'compound-results',
        'M&A Deal Analyzer': 'ma-results'
      };
      if (resultIds[calcName]) {
        const el = document.getElementById(resultIds[calcName]);
        if (el) text += el.innerText;
      } else if (calcName === 'Startup Runway') {
        text += 'Burn Rate: ' + document.getElementById('rw-burn').textContent + '\n';
        text += 'Runway: ' + document.getElementById('rw-runway-growth').textContent + '\n';
        text += 'Cash Zero: ' + document.getElementById('rw-zero-date').textContent + '\n';
      } else if (calcName === 'Net Worth Tracker') {
        text += 'Assets: ' + document.getElementById('nw-total-assets').textContent + '\n';
        text += 'Liabilities: ' + document.getElementById('nw-total-liabilities').textContent + '\n';
        text += 'Net Worth: ' + document.getElementById('nw-networth').textContent + '\n';
      }
      text += '\n' + '\u2500'.repeat(40) + '\nGenerated by CalcStack \u00b7 calcstack.ca';
      navigator.clipboard.writeText(text).then(showCopyToast).catch(function() {
        const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showCopyToast();
      });
    }

    function showCopyToast() {
      const existing = document.querySelector('.copy-toast');
      if (existing) existing.remove();
      const toast = document.createElement('div');
      toast.className = 'toast-success copy-toast';
      toast.innerHTML = '\ud83d\udccb Results copied!';
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 2500);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  VALUATION COMPARISON CHART
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateValuationComparison() {
      const compare = document.getElementById('val-compare');
      const chart = document.getElementById('val-compare-chart');
      if (!compare || !chart) return;

      let values = [];

      // DCF value
      try {
        const fcf = parseFloat(document.getElementById('dcf-fcf').value) || 0;
        const growth = (parseFloat(document.getElementById('dcf-growth').value) || 0) / 100;
        const terminal = (parseFloat(document.getElementById('dcf-terminal').value) || 0) / 100;
        const wacc = (parseFloat(document.getElementById('dcf-wacc').value) || 0) / 100;
        const years = parseInt(document.getElementById('dcf-years').value) || 5;
        const debt = parseFloat(document.getElementById('dcf-debt').value) || 0;
        if (wacc > terminal && fcf > 0) {
          let pv = 0;
          for (let i = 1; i <= years; i++) pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
          const ff = fcf * Math.pow(1 + growth, years) * (1 + terminal);
          const tv = ff / (wacc - terminal);
          pv += tv / Math.pow(1 + wacc, years);
          values.push({ label: 'DCF', value: pv - debt, color: '#6366f1' });
        }
      } catch(e) {}

      // Multiples
      try {
        const rev = parseFloat(document.getElementById('mult-revenue').value) || 0;
        const ebitda = parseFloat(document.getElementById('mult-ebitda').value) || 0;
        const income = parseFloat(document.getElementById('mult-income').value) || 0;
        const evRev = parseFloat(document.getElementById('mult-ev-rev').value) || 0;
        const evEb = parseFloat(document.getElementById('mult-ev-ebitda').value) || 0;
        const pe = parseFloat(document.getElementById('mult-pe').value) || 0;
        const avg = (rev * evRev + ebitda * evEb + income * pe) / 3;
        if (avg > 0) values.push({ label: 'Multiples (Avg)', value: avg, color: '#8b5cf6' });
      } catch(e) {}

      // Asset
      try {
        const totalA = ['asset-cash','asset-ar','asset-inv','asset-ppe','asset-other'].reduce((s,id) => s + (parseFloat(document.getElementById(id).value)||0), 0);
        const totalL = ['asset-ap','asset-debt','asset-otherliab'].reduce((s,id) => s + (parseFloat(document.getElementById(id).value)||0), 0);
        const nav = totalA - totalL;
        if (nav !== 0) values.push({ label: 'Asset-Based (NAV)', value: nav, color: '#06b6d4' });
      } catch(e) {}

      if (values.length < 2) { compare.style.display = 'none'; return; }
      compare.style.display = 'block';

      const maxVal = Math.max(...values.map(v => Math.abs(v.value)));
      let html = '';
      values.forEach(v => {
        const pct = Math.abs(v.value) / maxVal * 100;
        html += '<div style="margin-bottom: 1rem;"><div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;"><span style="font-size: 0.85rem; font-weight: 600;">' + v.label + '</span><span class="mono" style="font-size: 0.85rem;">' + fmt(v.value) + '</span></div><div class="chart-bar"><div class="chart-bar-fill" style="width: ' + pct.toFixed(1) + '%; background: ' + v.color + ';"></div></div></div>';
      });

      const vals = values.map(v => v.value);
      const low = Math.min(...vals);
      const high = Math.max(...vals);
      const avg = vals.reduce((a,b) => a+b, 0) / vals.length;
      html += '<div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); border-top: 1px solid var(--border-primary); padding-top: 0.75rem; margin-top: 0.5rem;"><span>Low: ' + fmt(low) + '</span><span>Average: ' + fmt(avg) + '</span><span>High: ' + fmt(high) + '</span></div>';

      chart.innerHTML = html;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  DEBOUNCE UTILITY (Performance)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function debounce(fn, ms) {
      let timer;
      return function() {
        const args = arguments, ctx = this;
        clearTimeout(timer);
        timer = setTimeout(function() { fn.apply(ctx, args); }, ms);
      };
    }

    // Debounce all slider inputs (50ms)
    (function() {
      const debouncedHandlers = new WeakMap();
      document.querySelectorAll('input[type="range"]').forEach(function(slider) {
        const origHandler = slider.getAttribute('oninput');
        if (origHandler) {
          const debouncedFn = debounce(function() {
            new Function(origHandler).call(slider);
          }, 50);
          // Keep display updates instant, debounce calculations
          slider.removeAttribute('oninput');
          slider.addEventListener('input', function() {
            // Update display value instantly (the span next to slider)
            const displayPart = origHandler.match(/document\.getElementById\([^)]+\)\.textContent\s*=\s*[^;]+/);
            if (displayPart) { try { new Function(displayPart[0]).call(slider); } catch(e){} }
            debouncedFn();
          });
        }
      });
    })();

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  KEYBOARD SHORTCUTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    (function() {
      const toolMap = {
        '1': 'valuation',
        '2': 'merger',
        '3': 'mortgage',
        '4': 'investment',
        '5': 'retirement',
        '6': 'compound',
        '7': 'runway',
        '8': 'networth',
        '9': 'lease',
        '0': 'tax'
      };

      document.addEventListener('keydown', function(e) {
        // Don't trigger when typing in inputs
        const tag = (e.target.tagName || '').toLowerCase();
        if (tag === 'input' || tag === 'textarea' || tag === 'select') return;

        const overlay = document.getElementById('shortcuts-overlay');

        if (e.key === '?') {
          e.preventDefault();
          overlay.classList.toggle('hidden');
          return;
        }

        if (e.key === 'Escape') {
          if (!overlay.classList.contains('hidden')) {
            overlay.classList.add('hidden');
          } else {
            showPage('home');
          }
          return;
        }

        if ((e.key === 'd' || e.key === 'D') && !e.ctrlKey && !e.metaKey) {
          toggleTheme();
          return;
        }

        if (toolMap[e.key]) {
          e.preventDefault();
          showPage(toolMap[e.key]);
        }
      });
    })();

    // â”€â”€ Global Calculation Counter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function incrementCalcCounter() {
      var count = parseInt(localStorage.getItem('calcstack-calc-count') || '0', 10) + 1;
      localStorage.setItem('calcstack-calc-count', count.toString());
      var el = document.getElementById('global-calc-counter');
      if (el) el.textContent = count.toLocaleString();
    }
    (function initCounter() {
      var count = parseInt(localStorage.getItem('calcstack-calc-count') || '0', 10);
      var el = document.getElementById('global-calc-counter');
      if (el) el.textContent = count > 0 ? count.toLocaleString() : '0';
    })();

    // â”€â”€ Side-by-Side Comparison â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function calcMortgagePayment(principal, annualRate, amortYears) {
      // Canadian semi-annual compounding
      var semiRate = annualRate / 100 / 2;
      var monthlyRate = Math.pow(1 + semiRate, 1/6) - 1;
      var n = amortYears * 12;
      if (monthlyRate === 0) return { payment: principal / n, totalInterest: 0, totalCost: principal };
      var payment = principal * monthlyRate * Math.pow(1 + monthlyRate, n) / (Math.pow(1 + monthlyRate, n) - 1);
      var totalCost = payment * n;
      return { payment: payment, totalInterest: totalCost - principal, totalCost: totalCost };
    }

    function calculateComparison() {
      incrementCalcCounter();
      var aPrice = parseFloat(document.getElementById('cmp-a-price').value) || 0;
      var aRate = parseFloat(document.getElementById('cmp-a-rate').value) || 0;
      var aAmort = parseInt(document.getElementById('cmp-a-amort').value) || 25;
      var aDown = parseFloat(document.getElementById('cmp-a-down').value) || 0;
      var bPrice = parseFloat(document.getElementById('cmp-b-price').value) || 0;
      var bRate = parseFloat(document.getElementById('cmp-b-rate').value) || 0;
      var bAmort = parseInt(document.getElementById('cmp-b-amort').value) || 25;
      var bDown = parseFloat(document.getElementById('cmp-b-down').value) || 0;

      var aPrincipal = aPrice * (1 - aDown / 100);
      var bPrincipal = bPrice * (1 - bDown / 100);
      var a = calcMortgagePayment(aPrincipal, aRate, aAmort);
      var b = calcMortgagePayment(bPrincipal, bRate, bAmort);

      document.getElementById('cmp-a-payment').textContent = fmtFull(a.payment);
      document.getElementById('cmp-b-payment').textContent = fmtFull(b.payment);
      document.getElementById('cmp-a-interest').textContent = fmtFull(a.totalInterest);
      document.getElementById('cmp-b-interest').textContent = fmtFull(b.totalInterest);
      document.getElementById('cmp-a-total').textContent = fmtFull(a.totalCost);
      document.getElementById('cmp-b-total').textContent = fmtFull(b.totalCost);

      var diff = Math.abs(a.totalCost - b.totalCost);
      var verdict = '';
      if (a.totalCost < b.totalCost) {
        verdict = 'ğŸ…°ï¸ Scenario A saves you ' + fmtFull(diff) + ' in total cost over its term!';
      } else if (b.totalCost < a.totalCost) {
        verdict = 'ğŸ…±ï¸ Scenario B saves you ' + fmtFull(diff) + ' in total cost over its term!';
      } else {
        verdict = 'Both scenarios have the same total cost.';
      }
      var pmtDiff = Math.abs(a.payment - b.payment);
      verdict += '\nMonthly payment difference: ' + fmtFull(pmtDiff);
      document.getElementById('cmp-verdict').innerHTML = verdict.replace(/\n/g, '<br>');
    }

    // â”€â”€ Currency Converter â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function convertCurrency() {
      incrementCalcCounter();
      var cad = parseFloat(document.getElementById('currency-amount').value) || 0;
      // Rates: how many foreign units per 1 CAD (derived from "how many CAD per 1 foreign")
      var usd = cad / 1.36;
      var eur = cad / 1.47;
      var gbp = cad / 1.72;
      var inr = cad / 0.016;
      var jpy = cad / 0.009;
      document.getElementById('cur-usd').textContent = '$' + usd.toFixed(2);
      document.getElementById('cur-eur').textContent = 'â‚¬' + eur.toFixed(2);
      document.getElementById('cur-gbp').textContent = 'Â£' + gbp.toFixed(2);
      document.getElementById('cur-inr').textContent = 'â‚¹' + Math.round(inr).toLocaleString();
      document.getElementById('cur-jpy').textContent = 'Â¥' + Math.round(jpy).toLocaleString();
    }

    // â”€â”€ Rule of 72 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function calcRule72(source) {
      if (source === 'rate') {
        var rate = parseFloat(document.getElementById('r72-rate').value) || 0;
        if (rate > 0) {
          var years = 72 / rate;
          document.getElementById('r72-rate-result').textContent = 'â‰ˆ ' + years.toFixed(1) + ' years to double';
          document.getElementById('r72-years').value = years.toFixed(1);
          document.getElementById('r72-years-result').textContent = 'â‰ˆ ' + rate.toFixed(1) + '% rate needed';
        }
      } else {
        var years = parseFloat(document.getElementById('r72-years').value) || 0;
        if (years > 0) {
          var rate = 72 / years;
          document.getElementById('r72-years-result').textContent = 'â‰ˆ ' + rate.toFixed(1) + '% rate needed';
          document.getElementById('r72-rate').value = rate.toFixed(1);
          document.getElementById('r72-rate-result').textContent = 'â‰ˆ ' + years.toFixed(1) + ' years to double';
        }
      }
    }

    // â”€â”€ Lease vs Buy Calculator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function calculateLeaseBuy() {
      var price = parseFloat(document.getElementById('lb-price').value) || 0;
      var leasePayment = parseFloat(document.getElementById('lb-lease-payment').value) || 0;
      var leaseTerm = parseInt(document.getElementById('lb-lease-term').value) || 48;
      var residual = parseFloat(document.getElementById('lb-residual').value) || 0;
      var buyRate = (parseFloat(document.getElementById('lb-buy-rate').value) || 0) / 100 / 12;
      var buyTerm = parseInt(document.getElementById('lb-buy-term').value) || 60;
      var down = parseFloat(document.getElementById('lb-down').value) || 0;
      var insDiff = parseFloat(document.getElementById('lb-insurance-diff').value) || 0;
      var maintDiff = parseFloat(document.getElementById('lb-maint-diff').value) || 0;

      // Total lease cost
      var totalLease = leasePayment * leaseTerm;

      // Buy: monthly loan payment
      var loanAmt = price - down;
      var buyMonthly = buyRate > 0
        ? loanAmt * buyRate * Math.pow(1 + buyRate, buyTerm) / (Math.pow(1 + buyRate, buyTerm) - 1)
        : loanAmt / buyTerm;
      var totalLoanPayments = buyMonthly * buyTerm;
      var totalBuyInterest = totalLoanPayments - loanAmt;

      // Depreciation calculation (buy scenario)
      var annualDepreciation = (price - residual) / (leaseTerm / 12);
      var totalDepreciation = price - residual;

      // Compare over lease term period
      var compMonths = leaseTerm;
      var leaseCostOverPeriod = leasePayment * compMonths;
      // Buy cost over same period: payments made + down - residual value + running cost diffs
      var buyPaymentsInPeriod = buyMonthly * Math.min(compMonths, buyTerm);
      var buyCostOverPeriod = down + buyPaymentsInPeriod - residual + (insDiff + maintDiff) * compMonths;
      var costDiff = leaseCostOverPeriod - buyCostOverPeriod;

      // Break-even: find month where cumulative lease = cumulative buy
      var cumLease = 0, cumBuy = down;
      var breakEven = null;
      for (var m = 1; m <= Math.max(leaseTerm, buyTerm) + 12; m++) {
        cumLease += leasePayment;
        if (m <= buyTerm) cumBuy += buyMonthly;
        cumBuy += (insDiff + maintDiff);
        // After lease term, lessee has nothing; buyer has residual
        if (m === leaseTerm && cumLease <= cumBuy - residual && !breakEven) {
          breakEven = m;
        }
        if (!breakEven && cumBuy - residual <= cumLease) {
          breakEven = m;
        }
      }

      var verdict = buyCostOverPeriod < leaseCostOverPeriod ? 'Buying is cheaper' : 'Leasing is cheaper';
      var verdictColor = buyCostOverPeriod < leaseCostOverPeriod ? 'var(--brand-success)' : 'var(--brand-primary)';
      var savings = Math.abs(costDiff);

      document.getElementById('lease-buy-results').innerHTML = `
        <div class="result-card" style="border-left: 4px solid var(--brand-primary);">
          <div class="result-label">Total Lease Cost (${compMonths} mo)</div>
          <div class="result-value">${fmtFull(leaseCostOverPeriod)}</div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.25rem;">${fmtFull(leasePayment)}/mo Â· No ownership at end</div>
        </div>
        <div class="result-card" style="border-left: 4px solid var(--brand-success);">
          <div class="result-label">Total Buy Cost (${compMonths} mo, net of residual)</div>
          <div class="result-value" style="background:linear-gradient(135deg,var(--brand-success),var(--brand-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">${fmtFull(buyCostOverPeriod)}</div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.25rem;">${fmtFull(buyMonthly)}/mo loan Â· ${fmtFull(residual)} residual value</div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${buyCostOverPeriod < leaseCostOverPeriod ? 'ğŸ†' : 'ğŸ†'}</div>
          <div style="font-size: 1.1rem; font-weight: 700; color: ${verdictColor};">${verdict}</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">You save <strong>${fmtFull(savings)}</strong> over ${compMonths} months</div>
          ${breakEven ? `<div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.5rem;">Break-even point: ~${breakEven} months</div>` : ''}
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Details</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Down Payment</div><div class="mono" style="font-weight:700;">${fmtFull(down)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Loan Interest</div><div class="mono" style="font-weight:700;">${fmtFull(totalBuyInterest)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Monthly Buy Payment</div><div class="mono" style="font-weight:700;">${fmtFull(buyMonthly)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Running Cost Diff/mo</div><div class="mono" style="font-weight:700;">${fmtFull(insDiff + maintDiff)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Total Depreciation</div><div class="mono" style="font-weight:700;color:var(--brand-danger);">${fmtFull(totalDepreciation)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Annual Depreciation</div><div class="mono" style="font-weight:700;">${fmtFull(annualDepreciation)}/yr</div></div>
          </div>
        </div>
      `;

      // Bar chart comparison
      var maxCost = Math.max(leaseCostOverPeriod, buyCostOverPeriod);
      document.getElementById('lease-buy-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Cost Comparison Over ${compMonths} Months</div>
        <div style="margin-bottom: 1rem;">
          <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;"><span>Lease</span><span class="mono">${fmtFull(leaseCostOverPeriod)}</span></div>
          <div class="chart-bar"><div class="chart-bar-fill" style="width:${(leaseCostOverPeriod/maxCost*100).toFixed(1)}%;background:linear-gradient(90deg,var(--brand-primary),var(--brand-secondary));"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;"><span>Buy (net of residual)</span><span class="mono">${fmtFull(buyCostOverPeriod)}</span></div>
          <div class="chart-bar"><div class="chart-bar-fill" style="width:${(buyCostOverPeriod/maxCost*100).toFixed(1)}%;background:linear-gradient(90deg,var(--brand-success),var(--brand-accent));"></div></div>
        </div>
        <div style="margin-top:1rem;font-size:0.8rem;color:var(--text-muted);text-align:center;">
          Difference: <strong style="color:${verdictColor}">${fmtFull(savings)}</strong> in favour of ${buyCostOverPeriod < leaseCostOverPeriod ? 'buying' : 'leasing'}
        </div>
      `;
    }

    // â”€â”€ Canadian Tax Estimator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function calculateTax() {
      var province = document.getElementById('tax-province').value;
      var employment = parseFloat(document.getElementById('tax-employment').value) || 0;
      var selfEmp = parseFloat(document.getElementById('tax-self').value) || 0;
      var capGains = parseFloat(document.getElementById('tax-capgains').value) || 0;
      var dividends = parseFloat(document.getElementById('tax-dividends').value) || 0;
      var rrsp = parseFloat(document.getElementById('tax-rrsp').value) || 0;
      var otherDed = parseFloat(document.getElementById('tax-other-ded').value) || 0;

      // Gross income
      var grossIncome = employment + selfEmp + capGains * 0.5 + dividends * 1.38; // gross-up dividends
      var deductions = rrsp + otherDed;
      var taxableIncome = Math.max(0, grossIncome - deductions);

      // 2025 Federal brackets
      var fedBrackets = [
        [57375, 0.15], [57375, 0.205], [63088, 0.26], [75368, 0.29], [Infinity, 0.33]
      ];
      var fedBasic = 16129; // basic personal amount
      var fedTax = calcBracketTax(taxableIncome, fedBrackets) - fedBasic * 0.15;
      // Dividend tax credit (federal): 15.0198% of grossed-up amount
      var fedDTC = dividends * 1.38 * 0.150198;
      fedTax = Math.max(0, fedTax - fedDTC);

      // Provincial brackets
      var provBrackets = getProvBrackets(province);
      var provBasic = getProvBasic(province);
      var provRate1 = provBrackets[0][1];
      var provTax = calcBracketTax(taxableIncome, provBrackets) - provBasic * provRate1;
      // Provincial dividend tax credit
      var provDTCRate = getProvDTCRate(province);
      var provDTC = dividends * 1.38 * provDTCRate;
      provTax = Math.max(0, provTax - provDTC);

      // CPP (2025): max pensionable earnings $71,300, basic exemption $3,500, rate 5.95%
      var cppEarnings = Math.min(employment + selfEmp, 71300) - 3500;
      var cppEmployee = Math.max(0, cppEarnings * 0.0595);
      var cppSelf = selfEmp > 0 ? cppEmployee * 2 * (selfEmp / (employment + selfEmp)) : 0;
      var cpp = employment > 0 ? cppEmployee : 0;
      cpp += cppSelf;
      // CPP2: earnings between $71,300 and $81,200 at 4%
      var cpp2Earnings = Math.min(employment + selfEmp, 81200) - 71300;
      if (cpp2Earnings > 0) cpp += cpp2Earnings * 0.04;

      // EI (2025): max insurable $65,700, rate 1.64%
      var eiEarnings = Math.min(employment, 65700);
      var ei = eiEarnings * 0.0164;

      var totalTax = fedTax + provTax + cpp + ei;
      var afterTax = employment + selfEmp + capGains + dividends - totalTax;
      var avgRate = grossIncome > 0 ? (totalTax / (employment + selfEmp + capGains + dividends)) * 100 : 0;

      // Marginal rate: federal + provincial top bracket
      var margFed = getMarginalRate(taxableIncome, fedBrackets);
      var margProv = getMarginalRate(taxableIncome, provBrackets);
      var margRate = (margFed + margProv) * 100;

      var totalGross = employment + selfEmp + capGains + dividends;

      document.getElementById('tax-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Total Tax</div>
          <div class="result-value">${fmtFull(totalTax)}</div>
        </div>
        <div class="result-card" style="border-left: 4px solid var(--brand-success);">
          <div class="result-label">After-Tax Income</div>
          <div class="result-value" style="background:linear-gradient(135deg,var(--brand-success),var(--brand-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">${fmtFull(afterTax)}</div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Tax Breakdown</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Federal Tax</div><div class="mono" style="font-weight:700;">${fmtFull(fedTax)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Provincial Tax</div><div class="mono" style="font-weight:700;">${fmtFull(provTax)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">CPP Contributions</div><div class="mono" style="font-weight:700;">${fmtFull(cpp)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">EI Premiums</div><div class="mono" style="font-weight:700;">${fmtFull(ei)}</div></div>
          </div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Rates</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Average Tax Rate</div><div class="mono" style="font-weight:700;">${avgRate.toFixed(1)}%</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Marginal Tax Rate</div><div class="mono" style="font-weight:700;color:var(--brand-warning);">${margRate.toFixed(1)}%</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Taxable Income</div><div class="mono" style="font-weight:700;">${fmtFull(taxableIncome)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Deductions</div><div class="mono" style="font-weight:700;">${fmtFull(deductions)}</div></div>
          </div>
        </div>
      `;

      // Waterfall chart
      var steps = [
        { label: 'Gross Income', value: totalGross, color: 'var(--brand-primary)' },
        { label: 'Deductions', value: -deductions, color: 'var(--text-muted)' },
        { label: 'Taxable Income', value: taxableIncome, color: 'var(--brand-secondary)' },
        { label: 'Federal Tax', value: -fedTax, color: 'var(--brand-danger)' },
        { label: 'Provincial Tax', value: -provTax, color: 'var(--brand-warning)' },
        { label: 'CPP + EI', value: -(cpp + ei), color: 'var(--text-muted)' },
        { label: 'Net Income', value: afterTax, color: 'var(--brand-success)' }
      ];
      var maxStep = Math.max(...steps.map(s => Math.abs(s.value)));
      document.getElementById('tax-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Tax Breakdown Waterfall</div>
        ${steps.map(s => `
          <div style="margin-bottom: 0.75rem;">
            <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;">
              <span>${s.label}</span>
              <span class="mono" style="color:${s.value < 0 ? 'var(--brand-danger)' : 'var(--text-primary)'}">${s.value < 0 ? '-' : ''}${fmtFull(Math.abs(s.value))}</span>
            </div>
            <div class="chart-bar"><div class="chart-bar-fill" style="width:${(Math.abs(s.value)/maxStep*100).toFixed(1)}%;background:${s.color};"></div></div>
          </div>
        `).join('')}
      `;

      // Province Comparison
      const provCompare = document.getElementById('tax-province-compare');
      if (provCompare) {
        const allProvs = ['ON','BC','AB','QC','MB','SK','NS','NB','NL','PE'];
        const provNames = {ON:'Ontario',BC:'British Columbia',AB:'Alberta',QC:'Quebec',MB:'Manitoba',SK:'Saskatchewan',NS:'Nova Scotia',NB:'New Brunswick',NL:'Newfoundland',PE:'PEI'};
        let provTaxes = allProvs.map(pv => {
          const pb = getProvBrackets(pv);
          const pBasic = getProvBasic(pv);
          const pTax = Math.max(0, calcBracketTax(taxableIncome, pb) - pBasic * pb[0][1]);
          const dtcR = getProvDTCRate(pv);
          const pDTC = dividends * 1.38 * dtcR;
          const total = Math.max(0, fedTax + Math.max(0, pTax - pDTC) + cpp + ei);
          return { prov: pv, name: provNames[pv], tax: total, afterTax: totalGross - total };
        }).sort((a,b) => a.tax - b.tax);
        const maxTax = Math.max(...provTaxes.map(p => p.tax));
        provCompare.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ğŸ—ºï¸ Tax Across All Provinces</div>
          ${provTaxes.map(p => `
            <div style="margin-bottom: 0.5rem;">
              <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.2rem;">
                <span${p.prov === province ? ' style="font-weight:700;color:var(--brand-primary);"' : ''}>${p.prov === province ? 'â†’ ' : ''}${p.name}</span>
                <span class="mono">${fmtFull(p.tax)} (take-home: ${fmtFull(p.afterTax)})</span>
              </div>
              <div class="chart-bar" style="height:6px;"><div class="chart-bar-fill" style="width:${(p.tax/maxTax*100).toFixed(1)}%;background:${p.prov === province ? 'linear-gradient(90deg,var(--brand-primary),var(--brand-accent))' : 'var(--border-hover)'};"></div></div>
            </div>
          `).join('')}
        `;
      }
    }

    function calcBracketTax(income, brackets) {
      var tax = 0, remaining = income;
      for (var i = 0; i < brackets.length; i++) {
        var amt = Math.min(remaining, brackets[i][0]);
        tax += amt * brackets[i][1];
        remaining -= amt;
        if (remaining <= 0) break;
      }
      return tax;
    }

    function getMarginalRate(income, brackets) {
      var remaining = income;
      for (var i = 0; i < brackets.length; i++) {
        if (remaining <= brackets[i][0]) return brackets[i][1];
        remaining -= brackets[i][0];
      }
      return brackets[brackets.length - 1][1];
    }

    function getProvBrackets(prov) {
      var b = {
        'ON': [[52886,0.0505],[52878,0.0915],[150000-52886-52878,0.1116],[70000,0.1216],[Infinity,0.1316]],
        'BC': [[47937,0.0506],[47937,0.077],[13622,0.105],[23144,0.1229],[48889,0.147],[67969,0.168],[Infinity,0.205]],
        'AB': [[148269,0.10],[27631,0.12],[55263,0.13],[105263,0.14],[Infinity,0.15]],
        'QC': [[51780,0.14],[51780,0.19],[22440,0.24],[Infinity,0.2575]]
      };
      // Simplified flat-ish brackets for other provinces
      var simple = {
        'MB': [[47000,0.108],[47000,0.1275],[Infinity,0.174]],
        'SK': [[52057,0.105],[96569-52057,0.125],[Infinity,0.145]],
        'NS': [[29590,0.0879],[29590,0.1495],[33820,0.1667],[57000,0.175],[Infinity,0.21]],
        'NB': [[49958,0.094],[49958,0.14],[31802,0.16],[44088,0.195],[Infinity,0.203]],
        'NL': [[43198,0.087],[43198,0.145],[68134-43198,0.158],[86254-68134,0.178],[Infinity,0.218]],
        'PE': [[32656,0.098],[32656,0.138],[Infinity,0.167]]
      };
      return b[prov] || simple[prov] || [[Infinity, 0.12]];
    }

    function getProvBasic(prov) {
      var basics = {'ON':11865,'BC':12580,'AB':21003,'QC':18056,'MB':15780,'SK':17661,'NS':8481,'NB':13044,'NL':10818,'PE':13500};
      return basics[prov] || 12000;
    }

    function getProvDTCRate(prov) {
      var rates = {'ON':0.10,'BC':0.12,'AB':0.0812,'QC':0.117,'MB':0.08,'SK':0.11,'NS':0.0885,'NB':0.14,'NL':0.063,'PE':0.105};
      return rates[prov] || 0.10;
    }

    // â”€â”€ Patch existing calculators to increment counter â”€â”€
    (function patchCounters() {
      var fns = ['calculateDCF','calculateMultiples','calculateAsset','calculateMortgage',
        'calculateCAGR','calculateDCA','calculateRetirement','calculateCompound',
        'calculateMA','calculateRunway','calculateNetWorth','calculateSalary','calculateDebt',
        'calculateLeaseBuy','calculateTax'];
      fns.forEach(function(name) {
        var orig = window[name];
        if (typeof orig === 'function') {
          window[name] = function() {
            incrementCalcCounter();
            return orig.apply(this, arguments);
          };
        }
      });
    })();

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(function(){});
    }
  </script>
</body>
</html>