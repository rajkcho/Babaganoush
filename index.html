<!DOCTYPE html>
<html lang="en-CA" class="scroll-smooth">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3447886014314572"
     crossorigin="anonymous"></script>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QHP0GVPV8Q"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-QHP0GVPV8Q');
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FiggyBank ‚Äî Free Canadian Financial Calculators</title>
  <meta name="description" content="20+ free Canadian financial calculators ‚Äî mortgage, FHSA, RESP, tax, business valuation, RRSP vs TFSA, rent vs buy, GIC ladder, CPP, capital gains & more. No sign-up required. Try now!" />
  <meta name="keywords" content="free Canadian financial calculator, Canadian mortgage calculator, FHSA calculator, RESP calculator Canada, rent vs buy calculator Canada, GIC ladder calculator, CPP calculator, OAS calculator, capital gains tax calculator Canada, business valuation calculator, M&A calculator, Canadian tax calculator 2026, RRSP vs TFSA calculator, compound interest calculator Canada, debt payoff calculator, net worth calculator Canada, startup runway calculator" />
  <!-- Google Site Verification: Add your verification code here -->
  <!-- <meta name="google-site-verification" content="your-verification-code-here" /> -->
  <meta name="robots" content="index, follow" />
  <meta name="author" content="FiggyBank" />
  <meta name="geo.region" content="CA" />
  <meta name="geo.placename" content="Canada" />
  <meta http-equiv="content-language" content="en-CA" />
  <meta property="og:title" content="FiggyBank ‚Äî Free Canadian Financial Calculators" />
  <meta property="og:description" content="20+ free calculators for Canadians: mortgage, FHSA, RESP, tax, business valuation, RRSP vs TFSA, rent vs buy, capital gains, M&A & more. 100% private ‚Äî runs in your browser." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://figgybank.ca/" />
  <meta property="og:site_name" content="FiggyBank" />
  <meta property="og:locale" content="en_CA" />
  <meta property="og:image" content="https://figgybank.ca/og-image.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="FiggyBank ‚Äî Free Canadian Financial Calculators" />
  <meta name="twitter:description" content="20+ free calculators for Canadians: mortgage, FHSA, RESP, tax, rent vs buy, capital gains & more. No sign-up. 100% private." />
  <link rel="canonical" href="https://figgybank.ca/" />
  <link rel="alternate" hreflang="en-ca" href="https://figgybank.ca/" />
  
  <!-- Preconnect & DNS Prefetch -->
  <link rel="preconnect" href="https://www.googletagmanager.com" />
  <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
  <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
  <link rel="dns-prefetch" href="https://fonts.gstatic.com" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet" />

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2C087D" />

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üê∑</text></svg>" />

  <!-- Structured Data: Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "FiggyBank",
    "url": "https://figgybank.ca/",
    "logo": "https://figgybank.ca/og-image.png",
    "description": "Free Canadian financial calculators ‚Äî smart money moves made simple.",
    "areaServed": "CA"
  }
  </script>

  <!-- Structured Data: BreadcrumbList -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://figgybank.ca/"},
      {"@type": "ListItem", "position": 2, "name": "Canadian Mortgage Calculator", "item": "https://figgybank.ca/#mortgage"},
      {"@type": "ListItem", "position": 3, "name": "Business Valuation Calculator", "item": "https://figgybank.ca/#valuation"},
      {"@type": "ListItem", "position": 4, "name": "Canadian Tax Estimator", "item": "https://figgybank.ca/#tax"},
      {"@type": "ListItem", "position": 5, "name": "M&A Deal Analyzer", "item": "https://figgybank.ca/#merger"},
      {"@type": "ListItem", "position": 6, "name": "RRSP vs TFSA Optimizer", "item": "https://figgybank.ca/#retirement"}
    ]
  }
  </script>

  <!-- Structured Data: WebApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "FiggyBank",
    "description": "20+ free Canadian financial calculators ‚Äî mortgage, FHSA, RESP, tax, business valuation, M&A analysis, RRSP/TFSA optimizer, rent vs buy, GIC ladder, CPP/OAS, capital gains, compound interest, debt payoff, net worth tracker & more.",
    "url": "https://figgybank.ca/",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "CAD"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "ratingCount": "150"
    }
  }
  </script>
  
  <!-- Structured Data: SoftwareApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "FiggyBank - Canadian Financial Calculator Suite",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Web Browser",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "CAD"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "bestRating": "5",
      "ratingCount": "150"
    },
    "description": "Comprehensive suite of 20+ free Canadian financial calculators including mortgage, FHSA, RESP, tax planning, business valuation, and retirement tools.",
    "screenshot": "https://figgybank.ca/og-image.png",
    "featureList": [
      "Canadian mortgage calculator with CMHC insurance",
      "FHSA (First Home Savings Account) calculator",
      "RESP (Registered Education Savings Plan) calculator",
      "Rent vs Buy comparison tool",
      "GIC ladder calculator",
      "CPP and OAS retirement planning",
      "Capital gains tax calculator",
      "RRSP vs TFSA optimizer",
      "Business valuation (DCF, multiples, asset-based)",
      "M&A deal analyzer",
      "Canadian tax estimator (all provinces)",
      "Privacy-first: all calculations in-browser"
    ]
  }
  </script>

  <!-- Structured Data: WebApplication - Mortgage Calculator -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Canadian Mortgage Calculator",
    "description": "Free Canadian mortgage calculator with semi-annual compounding, CMHC insurance, land transfer tax, and OSFI B-20 stress test.",
    "url": "https://figgybank.ca/#mortgage",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - Business Valuation -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Business Valuation Calculator",
    "description": "Free business valuation calculator using DCF, comparable multiples, and asset-based approaches for Canadian businesses.",
    "url": "https://figgybank.ca/#valuation",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - Tax Estimator -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Canadian Tax Calculator 2025",
    "description": "Free Canadian tax estimator with 2025 federal and provincial brackets, CPP/EI, and RRSP deductions for all provinces and territories.",
    "url": "https://figgybank.ca/#tax",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - M&A Analyzer -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "M&A Deal Analyzer",
    "description": "Free M&A calculator for accretion/dilution analysis, synergy modeling, and deal structure evaluation.",
    "url": "https://figgybank.ca/#merger",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - RRSP vs TFSA -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "RRSP vs TFSA Calculator",
    "description": "Free RRSP vs TFSA optimizer ‚Äî compare tax-sheltered growth side-by-side based on your Canadian tax bracket and retirement plans.",
    "url": "https://figgybank.ca/#retirement",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - FHSA Calculator -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "FHSA Calculator Canada",
    "description": "Free First Home Savings Account (FHSA) calculator ‚Äî plan your tax-free savings for your first home purchase. Calculate contributions, growth, and withdrawals for Canada's newest savings vehicle.",
    "url": "https://figgybank.ca/#fhsa",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - RESP Calculator -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "RESP Calculator Canada",
    "description": "Free Registered Education Savings Plan (RESP) calculator with CESG grants and bond calculations. Plan your child's education savings with government contributions.",
    "url": "https://figgybank.ca/#resp",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - Rent vs Buy -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Rent vs Buy Calculator Canada",
    "description": "Free rent vs buy calculator for Canadians ‚Äî compare the true cost of renting vs buying a home including mortgage, maintenance, opportunity cost, and investment returns.",
    "url": "https://figgybank.ca/#rentbuy",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - GIC Ladder Calculator -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "GIC Ladder Calculator",
    "description": "Free GIC ladder calculator ‚Äî optimize your Guaranteed Investment Certificate strategy with staggered maturity dates for maximum returns and liquidity.",
    "url": "https://figgybank.ca/#gic",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - CPP/OAS Calculator -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "CPP and OAS Calculator Canada",
    "description": "Free CPP and OAS calculator ‚Äî estimate your Canada Pension Plan and Old Age Security benefits. Compare early vs delayed retirement to maximize your government pension income.",
    "url": "https://figgybank.ca/#cpp",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: WebApplication - Capital Gains Tax Calculator -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Capital Gains Tax Calculator Canada",
    "description": "Free Canadian capital gains tax calculator ‚Äî calculate taxes on stocks, real estate, and investment property sales. Includes principal residence exemption and 2026 inclusion rates.",
    "url": "https://figgybank.ca/#capitalgains",
    "applicationCategory": "FinanceApplication",
    "operatingSystem": "Any",
    "offers": {"@type": "Offer", "price": "0", "priceCurrency": "CAD"}
  }
  </script>

  <!-- Structured Data: FAQPage -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is FiggyBank free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, all 20+ financial calculators on FiggyBank are 100% free with no sign-up required. Use our Canadian mortgage calculator, FHSA calculator, RESP calculator, business valuation tools, tax estimator, RRSP vs TFSA optimizer, rent vs buy calculator, and more at no cost."
        }
      },
      {
        "@type": "Question",
        "name": "Is my financial data safe?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Absolutely. All calculations run entirely in your browser. No data is sent to any server ‚Äî your numbers never leave your device."
        }
      },
      {
        "@type": "Question",
        "name": "What calculators are available?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "FiggyBank includes 20+ professional-grade free Canadian financial calculators: Canadian Mortgage Calculator with CMHC insurance, FHSA Calculator (First Home Savings Account), RESP Calculator with CESG grants, Rent vs Buy Calculator, GIC Ladder Calculator, CPP and OAS Calculator, Capital Gains Tax Calculator, Business Valuation (DCF, Multiples, Asset-based), M&A Deal Analyzer, Investment Returns, RRSP vs TFSA Optimizer, Compound Interest Calculator, Startup Runway Calculator, Net Worth Tracker, Salary Calculator, Debt Payoff Calculator, Lease vs Buy, Canadian Tax Calculator 2026, Currency Converter, and Side-by-Side Comparison."
        }
      },
      {
        "@type": "Question",
        "name": "How accurate are the mortgage calculations for Canada?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The mortgage calculator uses Canadian semi-annual compounding as required by law, includes CMHC insurance premiums, provincial land transfer taxes, and OSFI B-20 stress test calculations."
        }
      },
      {
        "@type": "Question",
        "name": "Should I choose RRSP or TFSA?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "It depends on your current vs. expected retirement tax rate. Generally, RRSP is better if your current tax rate is higher than your expected retirement rate. Use our RRSP vs TFSA Optimizer to compare based on your specific situation."
        }
      },
      {
        "@type": "Question",
        "name": "What is the FHSA and how does it work?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The First Home Savings Account (FHSA) is a Canadian tax-advantaged account that lets you save up to $40,000 tax-free for your first home. Contributions are tax-deductible like an RRSP, and withdrawals for a first home purchase are tax-free like a TFSA. Use our FHSA Calculator to plan your contributions and growth."
        }
      },
      {
        "@type": "Question",
        "name": "Should I rent or buy a home in Canada?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The decision depends on many factors including local housing prices, mortgage rates, expected home appreciation, your down payment, and how long you plan to stay. Our Rent vs Buy Calculator compares the total cost of both options over time, including opportunity cost of your down payment invested elsewhere."
        }
      },
      {
        "@type": "Question",
        "name": "How is capital gains tax calculated in Canada?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "In Canada, 50% of capital gains are included in your taxable income and taxed at your marginal rate. However, your principal residence is exempt from capital gains tax. The 2026 inclusion rate applies to investment properties, stocks, and other assets. Use our Capital Gains Tax Calculator to estimate taxes on your investments."
        }
      }
    ]
  }
  </script>

  <!-- Structured Data: ItemList - Calculator Directory -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "FiggyBank Financial Calculators",
    "description": "Complete list of free Canadian financial calculators available on FiggyBank",
    "numberOfItems": 20,
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Canadian Mortgage Calculator", "url": "https://figgybank.ca/#mortgage"},
      {"@type": "ListItem", "position": 2, "name": "FHSA Calculator", "url": "https://figgybank.ca/#fhsa"},
      {"@type": "ListItem", "position": 3, "name": "RESP Calculator", "url": "https://figgybank.ca/#resp"},
      {"@type": "ListItem", "position": 4, "name": "Rent vs Buy Calculator", "url": "https://figgybank.ca/#rentbuy"},
      {"@type": "ListItem", "position": 5, "name": "Canadian Tax Calculator", "url": "https://figgybank.ca/#tax"},
      {"@type": "ListItem", "position": 6, "name": "Capital Gains Tax Calculator", "url": "https://figgybank.ca/#capitalgains"},
      {"@type": "ListItem", "position": 7, "name": "RRSP vs TFSA Calculator", "url": "https://figgybank.ca/#retirement"},
      {"@type": "ListItem", "position": 8, "name": "CPP and OAS Calculator", "url": "https://figgybank.ca/#cpp"},
      {"@type": "ListItem", "position": 9, "name": "GIC Ladder Calculator", "url": "https://figgybank.ca/#gic"},
      {"@type": "ListItem", "position": 10, "name": "Business Valuation Calculator", "url": "https://figgybank.ca/#valuation"},
      {"@type": "ListItem", "position": 11, "name": "M&A Deal Analyzer", "url": "https://figgybank.ca/#merger"},
      {"@type": "ListItem", "position": 12, "name": "Investment Returns Calculator", "url": "https://figgybank.ca/#investment"},
      {"@type": "ListItem", "position": 13, "name": "Compound Interest Calculator", "url": "https://figgybank.ca/#compound"},
      {"@type": "ListItem", "position": 14, "name": "Debt Payoff Calculator", "url": "https://figgybank.ca/#debt"},
      {"@type": "ListItem", "position": 15, "name": "Net Worth Tracker", "url": "https://figgybank.ca/#networth"},
      {"@type": "ListItem", "position": 16, "name": "Startup Runway Calculator", "url": "https://figgybank.ca/#runway"},
      {"@type": "ListItem", "position": 17, "name": "Salary Calculator", "url": "https://figgybank.ca/#salary"},
      {"@type": "ListItem", "position": 18, "name": "Lease vs Buy Calculator", "url": "https://figgybank.ca/#lease"},
      {"@type": "ListItem", "position": 19, "name": "Currency Converter", "url": "https://figgybank.ca/#currency"},
      {"@type": "ListItem", "position": 20, "name": "Side-by-Side Compare", "url": "https://figgybank.ca/#compare"}
    ]
  }
  </script>

  <!-- Structured Data: HowTo - Capital Gains Tax Calculation -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to Calculate Capital Gains Tax in Canada",
    "description": "Step-by-step guide to calculating capital gains tax on investments and property sales in Canada",
    "totalTime": "PT5M",
    "tool": [
      {"@type": "HowToTool", "name": "FiggyBank Capital Gains Tax Calculator"}
    ],
    "step": [
      {
        "@type": "HowToStep",
        "name": "Determine Your Proceeds",
        "text": "Calculate the total amount you received from selling your investment or property.",
        "position": 1
      },
      {
        "@type": "HowToStep",
        "name": "Calculate Adjusted Cost Base (ACB)",
        "text": "Add your original purchase price plus any eligible expenses like commissions and improvement costs.",
        "position": 2
      },
      {
        "@type": "HowToStep",
        "name": "Calculate Capital Gain",
        "text": "Subtract your adjusted cost base from the proceeds of disposition to get your capital gain.",
        "position": 3
      },
      {
        "@type": "HowToStep",
        "name": "Apply Inclusion Rate",
        "text": "Multiply your capital gain by 50% (the 2026 Canadian inclusion rate) to determine the taxable portion.",
        "position": 4
      },
      {
        "@type": "HowToStep",
        "name": "Calculate Tax Owing",
        "text": "Multiply the taxable capital gain by your marginal tax rate to determine the tax you owe.",
        "position": 5
      }
    ]
  }
  </script>

  <!-- Structured Data: HowTo - FHSA Contribution Planning -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": "How to Plan FHSA Contributions for Your First Home",
    "description": "Step-by-step guide to maximizing your First Home Savings Account (FHSA) for Canadian first-time home buyers",
    "totalTime": "PT10M",
    "tool": [
      {"@type": "HowToTool", "name": "FiggyBank FHSA Calculator"}
    ],
    "step": [
      {
        "@type": "HowToStep",
        "name": "Understand FHSA Limits",
        "text": "You can contribute up to $8,000 per year with a lifetime maximum of $40,000 to your First Home Savings Account.",
        "position": 1
      },
      {
        "@type": "HowToStep",
        "name": "Calculate Your Timeline",
        "text": "Determine when you plan to purchase your first home. The FHSA has a 15-year limit from opening.",
        "position": 2
      },
      {
        "@type": "HowToStep",
        "name": "Maximize Tax Deductions",
        "text": "FHSA contributions are tax-deductible. Calculate how much you'll save on your tax return each year.",
        "position": 3
      },
      {
        "@type": "HowToStep",
        "name": "Plan Investment Strategy",
        "text": "Decide how to invest your FHSA funds based on your home purchase timeline. Shorter timelines call for safer investments.",
        "position": 4
      },
      {
        "@type": "HowToStep",
        "name": "Project Your Savings",
        "text": "Use the FHSA calculator to estimate your total savings including tax refunds and investment growth.",
        "position": 5
      }
    ]
  }
  </script>
  
  <style>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       FIGGYBANK ‚Äî Smart Money Moves Made Simple
       CreditGenie-Inspired Design System
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    
    :root {
      /* Brand Colors ‚Äî CreditGenie-inspired */
      --fg-purple: #2C087D;
      --fg-purple-light: #4A1CA0;
      --fg-coral: #FF6B6B;
      --fg-gold: #F5A623;
      --fg-cream: #FCFAF4;
      --fg-green: #10b981;

      --brand-primary: #2C087D;
      --brand-secondary: #4A1CA0;
      --brand-accent: #FF6B6B;
      --brand-success: #10b981;
      --brand-warning: #f59e0b;
      --brand-danger: #ef4444;
      
      /* Light Theme (default ‚Äî CreditGenie is light-first) */
      --bg-primary: #FCFAF4;
      --bg-secondary: #ffffff;
      --bg-card: #ffffff;
      --bg-card-hover: #f9f8f5;
      --bg-elevated: #f5f3ee;
      --border-primary: #e8e4dc;
      --border-hover: #d4cfc5;
      --text-primary: #2C087D;
      --text-secondary: #5a4d7a;
      --text-muted: #9b8fb5;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(44, 8, 125, 0.08);
      --shadow-sm: 0 1px 3px rgba(44, 8, 125, 0.04);
      --shadow-md: 0 4px 16px rgba(44, 8, 125, 0.06);
      --shadow-lg: 0 8px 32px rgba(44, 8, 125, 0.08);
      --shadow-xl: 0 20px 60px rgba(44, 8, 125, 0.1);
      --shadow-glow: 0 0 30px rgba(44, 8, 125, 0.06);
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Radius */
      --radius-sm: 0.5rem;
      --radius-md: 0.75rem;
      --radius-lg: 1rem;
      --radius-xl: 1.5rem;
      --radius-full: 9999px;
    }
    
    /* Dark Theme */
    .dark {
      --bg-primary: #0f0a1a;
      --bg-secondary: #16102a;
      --bg-card: #1a1330;
      --bg-card-hover: #221a3d;
      --bg-elevated: #1e1635;
      --border-primary: #2d2450;
      --border-hover: #3d3466;
      --text-primary: #f4f0ff;
      --text-secondary: #b0a3cc;
      --text-muted: #7a6b9e;
      --glass-bg: rgba(26, 19, 48, 0.75);
      --glass-border: rgba(255, 255, 255, 0.08);
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 8px 30px rgba(0, 0, 0, 0.5);
      --shadow-xl: 0 20px 60px rgba(0, 0, 0, 0.6);
      --shadow-glow: 0 0 30px rgba(44, 8, 125, 0.15);
    }
    
    /* ‚îÄ‚îÄ Reset & Base ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    html {
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      transition: background-color 0.4s ease, color 0.4s ease;
    }
    
    /* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-secondary); }
    ::-webkit-scrollbar-thumb { background: var(--border-hover); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--brand-primary); }
    
    /* ‚îÄ‚îÄ Typography ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 700;
      line-height: 1.2;
      letter-spacing: -0.02em;
      color: var(--fg-purple);
    }
    .dark h1, .dark h2, .dark h3, .dark h4, .dark h5, .dark h6 { color: var(--text-primary); }
    
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .gradient-text {
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       ANIMATION SYSTEM ‚Äî CreditGenie-style
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    
    /* Scroll-triggered fade up */
    .js-show {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    .js-show.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    .js-show-up-10 { transition-delay: 0.1s; }
    .js-show-up-20 { transition-delay: 0.2s; }
    .js-show-up-30 { transition-delay: 0.3s; }
    .js-show-up-40 { transition-delay: 0.4s; }
    .js-show-up-50 { transition-delay: 0.5s; }
    
    /* Button hover ‚Äî text slide */
    .btn-animated {
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-animated { overflow: hidden; position: relative; }
    .btn-animated .btn-text-wrap {
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
    }
    .btn-animated:hover .btn-text-wrap {
      transform: translateY(-50%);
    }
    .btn-animated .btn-initial,
    .btn-animated .btn-hover {
      display: block;
      line-height: 1;
      padding: 0.25em 0;
    }
    
    /* Parallax floating elements */
    .float-element { animation: figgyFloat 6s ease-in-out infinite; }
    .float-element-slow { animation: figgyFloat 8s ease-in-out infinite; }
    .float-element-fast { animation: figgyFloat 4s ease-in-out infinite; }
    @keyframes figgyFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    
    /* Rotating hero words */
    .hero-word-rotator {
      display: inline-block;
      position: relative;
      vertical-align: bottom;
      height: 1.2em;
    }
    .hero-word-rotator span {
      display: block;
      position: absolute;
      left: 0;
      top: 0;
      white-space: nowrap;
      opacity: 0;
      transform: translateY(50%);
      animation: wordFadeIn 10s infinite;
    }
    .hero-word-rotator span:nth-child(1) { animation-delay: 0s; }
    .hero-word-rotator span:nth-child(2) { animation-delay: 2.5s; }
    .hero-word-rotator span:nth-child(3) { animation-delay: 5s; }
    .hero-word-rotator span:nth-child(4) { animation-delay: 7.5s; }
    .hero-word-rotator span:nth-child(5) { display: none; }
    @keyframes wordFadeIn {
      0% { opacity: 0; transform: translateY(50%); }
      5% { opacity: 1; transform: translateY(0); }
      20% { opacity: 1; transform: translateY(0); }
      25% { opacity: 0; transform: translateY(-50%); }
      100% { opacity: 0; transform: translateY(-50%); }
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes slideInRight {
      from { opacity: 0; transform: translateX(30px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes scaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(44, 8, 125, 0.1); }
      50% { box-shadow: 0 0 40px rgba(44, 8, 125, 0.25); }
    }
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    @keyframes morphBlob {
      0%, 100% { border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
      25% { border-radius: 30% 60% 70% 40% / 50% 60% 30% 60%; }
      50% { border-radius: 50% 60% 30% 60% / 30% 70% 60% 40%; }
      75% { border-radius: 60% 30% 60% 40% / 60% 40% 30% 70%; }
    }
    @keyframes ripple {
      0% { transform: scale(0); opacity: 0.6; }
      100% { transform: scale(4); opacity: 0; }
    }
    @keyframes spin-slow {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @keyframes coinBounce {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(10deg); }
    }
    
    .animate-fade-up { animation: fadeInUp 0.6s ease both; }
    .animate-fade-up-1 { animation: fadeInUp 0.6s ease 0.1s both; }
    .animate-fade-up-2 { animation: fadeInUp 0.6s ease 0.2s both; }
    .animate-fade-up-3 { animation: fadeInUp 0.6s ease 0.3s both; }
    .animate-fade-up-4 { animation: fadeInUp 0.6s ease 0.4s both; }
    .animate-fade-in { animation: fadeIn 0.6s ease both; }
    .animate-scale-in { animation: scaleIn 0.5s ease both; }
    
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    /* ‚îÄ‚îÄ Glass Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .glass-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      transition: all 0.3s ease;
    }
    .glass-card:hover {
      border-color: var(--border-hover);
      box-shadow: var(--shadow-lg);
    }

    /* ‚îÄ‚îÄ Tool Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .tool-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      padding: 1.75rem;
      transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    .tool-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: rgba(44, 8, 125, 0.2);
    }
    .tool-card .tool-icon {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      margin-bottom: 1rem;
      transition: transform 0.3s ease;
    }
    .tool-card:hover .tool-icon { transform: scale(1.1); }
    .tool-card .card-arrow {
      position: absolute;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
      color: var(--text-muted);
      transition: transform 0.3s ease, color 0.3s ease;
    }
    .tool-card:hover .card-arrow { transform: translateY(-50%) translateX(4px); color: var(--fg-purple); }
    
    /* ‚îÄ‚îÄ Button System ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.75rem;
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 0.9rem;
      border: none;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      text-decoration: none;
    }
    .btn:active { transform: scale(0.97); }
    
    .btn-primary {
      background: var(--fg-purple);
      color: white;
      box-shadow: 0 4px 15px rgba(44, 8, 125, 0.25);
    }
    .btn-primary:hover {
      box-shadow: 0 6px 25px rgba(44, 8, 125, 0.35);
      transform: translateY(-2px);
      background: var(--fg-purple-light);
    }
    
    .btn-secondary {
      background: var(--bg-card);
      color: var(--text-primary);
      border: 1px solid var(--border-primary);
    }
    .btn-secondary:hover {
      background: var(--bg-card-hover);
      border-color: var(--brand-primary);
    }
    
    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }
    .btn-ghost:hover { color: var(--text-primary); }
    
    .btn-lg { padding: 1rem 2.25rem; font-size: 1rem; }
    .btn-sm { padding: 0.5rem 1rem; font-size: 0.8rem; }
    
    /* ‚îÄ‚îÄ Input System ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
    }
    .input-group label {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .input-group input, .input-group select {
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-md);
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-size: 0.95rem;
      font-family: 'JetBrains Mono', monospace;
      transition: all 0.3s ease;
      width: 100%;
    }
    .input-group input:focus, .input-group select:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 3px rgba(44, 8, 125, 0.15);
    }
    .input-group input::placeholder { color: var(--text-muted); }
    .input-help {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 0.125rem;
    }
    
    /* ‚îÄ‚îÄ Range Slider ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: var(--border-primary);
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--fg-purple);
      box-shadow: 0 2px 8px rgba(44, 8, 125, 0.4);
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }
    
    /* ‚îÄ‚îÄ Result Card ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .result-card {
      background: linear-gradient(135deg, rgba(44, 8, 125, 0.06), rgba(74, 28, 160, 0.03));
      border: 1px solid rgba(44, 8, 125, 0.15);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      animation: scaleIn 0.4s ease both;
    }
    .result-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 2rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .result-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
    }
    
    /* ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .nav-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: rgba(252, 250, 244, 0.92);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(44, 8, 125, 0.06);
      padding: 0.75rem 1.5rem;
      transition: all 0.3s ease;
      animation: fadeInDown 0.6s ease both;
    }
    .dark .nav-bar {
      background: rgba(15, 10, 26, 0.92);
      border-bottom-color: rgba(255,255,255,0.06);
    }
    .nav-bar.scrolled {
      box-shadow: 0 1px 12px rgba(44, 8, 125, 0.06);
    }
    .nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .nav-logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      text-decoration: none;
      font-weight: 800;
      font-size: 1.1rem;
      color: var(--fg-purple);
    }
    .dark .nav-logo { color: var(--text-primary); }
    .nav-links {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      list-style: none;
    }
    .nav-links a {
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-full);
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .nav-links a:hover, .nav-links a.active {
      color: var(--fg-purple);
      background: rgba(44, 8, 125, 0.06);
    }
    /* Dropdown Menu */
    .nav-dropdown { position: relative; }
    .nav-dropdown-trigger { cursor: pointer; }
    .nav-dropdown-menu {
      display: none;
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-secondary);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      padding: 1.25rem;
      padding-top: 1.5rem;
      min-width: 580px;
      z-index: 100;
      animation: fadeInUp 0.2s ease both;
    }
    .nav-dropdown:hover .nav-dropdown-menu,
    .nav-dropdown-menu:hover { display: block; }
    .nav-dropdown-menu::before {
      content: '';
      position: absolute;
      top: -8px;
      left: 0;
      right: 0;
      height: 16px;
      background: transparent;
    }
    .nav-dropdown-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }
    .nav-dropdown-group { display: flex; flex-direction: column; gap: 2px; }
    .nav-dropdown-label {
      font-size: 0.7rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      padding: 0.25rem 0.5rem;
      margin-bottom: 4px;
    }
    .nav-dropdown-menu a {
      padding: 0.4rem 0.5rem !important;
      border-radius: 6px !important;
      font-size: 0.82rem !important;
      color: var(--text-secondary) !important;
      white-space: nowrap;
    }
    .nav-dropdown-menu a:hover {
      background: rgba(44, 8, 125, 0.06) !important;
      color: var(--fg-purple) !important;
    }
    @media (max-width: 768px) {
      .nav-dropdown-menu {
        position: static;
        transform: none;
        min-width: auto;
        box-shadow: none;
        border: none;
        padding: 0.5rem 0;
        background: transparent;
        display: none;
      }
      .nav-dropdown-menu::before { display: none; }
      .nav-dropdown-grid { grid-template-columns: 1fr 1fr; }
      .nav-links.mobile-open .nav-dropdown-menu { display: none; }
      .nav-links.mobile-open .nav-dropdown.open .nav-dropdown-menu { display: block; }
    }
    .nav-actions {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-primary);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }
    .theme-toggle:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
      border-color: var(--border-hover);
    }
    .mobile-menu-btn {
      display: none;
      width: 40px;
      height: 40px;
      border-radius: var(--radius-full);
      border: 1px solid var(--border-primary);
      background: var(--bg-card);
      color: var(--text-primary);
      cursor: pointer;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    @media (max-width: 768px) {
      .nav-links { display: none; }
      .mobile-menu-btn { display: flex; }
      .nav-links.mobile-open {
        display: flex;
        flex-direction: column;
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-primary);
        padding: 1rem;
        gap: 0.25rem;
      }
      .nav-links.mobile-open a {
        padding: 0.75rem 1rem;
        width: 100%;
      }
    }

    /* ‚ïê‚ïê HOME PAGE SECTIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    
    /* Hero */
    .figgy-hero {
      min-height: 90vh;
      display: flex;
      align-items: center;
      padding: 7rem 2rem 4rem;
      position: relative;
      overflow: hidden;
      background: var(--bg-primary);
    }
    .figgy-hero-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
      position: relative;
      z-index: 2;
    }
    @media (max-width: 900px) {
      .figgy-hero { min-height: auto; padding: 6rem 1.5rem 3rem; }
      .figgy-hero-inner { grid-template-columns: 1fr; text-align: center; gap: 2rem; }
      .figgy-hero-right { display: none; }
    }
    .figgy-hero h1 {
      font-size: clamp(2.5rem, 5vw, 3.75rem);
      font-weight: 900;
      letter-spacing: -0.03em;
      line-height: 1.1;
      margin-bottom: 1.25rem;
      color: var(--fg-purple);
    }
    .figgy-hero p {
      font-size: 1.15rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
      line-height: 1.7;
    }
    
    /* Decorative floaters */
    .hero-floater {
      position: absolute;
      z-index: 1;
      pointer-events: none;
    }
    
    /* Calculator mockup */
    .calc-mockup {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      overflow: hidden;
      box-shadow: var(--shadow-xl);
      position: relative;
    }
    .mockup-header {
      padding: 0.75rem 1rem;
      background: var(--bg-elevated);
      display: flex;
      align-items: center;
      gap: 0.5rem;
      border-bottom: 1px solid var(--border-primary);
    }
    .mockup-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .mockup-body {
      padding: 1.5rem;
    }
    
    /* Section alternating backgrounds */
    .section-cream { background: var(--bg-primary); }
    .section-white { background: var(--bg-secondary); }
    
    .section {
      padding: 5rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    .section-full {
      padding: 5rem 2rem;
    }
    .section-full .section-inner {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .section-header {
      text-align: center;
      margin-bottom: 3.5rem;
    }
    .section-label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--fg-coral);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 1rem;
    }
    .section-title {
      font-size: clamp(2rem, 4vw, 3rem);
      letter-spacing: -0.03em;
      margin-bottom: 1rem;
      color: var(--fg-purple);
    }
    .dark .section-title { color: var(--text-primary); }
    .section-desc {
      font-size: 1.1rem;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* Featured calculator sections ‚Äî alternating */
    .feature-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4rem;
      align-items: center;
      padding: 3rem 0;
    }
    .feature-row.reverse { direction: rtl; }
    .feature-row.reverse > * { direction: ltr; }
    .feature-row h3 {
      font-size: 1.75rem;
      margin-bottom: 0.75rem;
      color: var(--fg-purple);
    }
    .dark .feature-row h3 { color: var(--text-primary); }
    .feature-row p {
      color: var(--text-secondary);
      font-size: 1rem;
      line-height: 1.7;
      margin-bottom: 1rem;
    }
    .feature-bullets {
      list-style: none;
      padding: 0;
    }
    .feature-bullets li {
      padding: 0.4rem 0;
      font-size: 0.95rem;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .feature-bullets li::before {
      content: '‚úì';
      color: var(--fg-green);
      font-weight: 700;
    }
    @media (max-width: 900px) {
      .feature-row { grid-template-columns: 1fr; gap: 2rem; }
      .feature-row.reverse { direction: ltr; }
    }
    
    /* Tools grid */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.25rem;
    }
    .tools-category-label {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--fg-coral);
      margin-bottom: 1rem;
      margin-top: 2.5rem;
    }
    .tools-category-label:first-child { margin-top: 0; }
    @media (max-width: 960px) { .tools-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px) { .tools-grid { grid-template-columns: 1fr; } }
    
    /* How it works */
    .hiw-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 3rem;
      position: relative;
    }
    .hiw-step {
      text-align: center;
      position: relative;
    }
    .hiw-number {
      font-size: 4rem;
      font-weight: 900;
      color: rgba(44, 8, 125, 0.08);
      line-height: 1;
      margin-bottom: 0.5rem;
    }
    .dark .hiw-number { color: rgba(255,255,255,0.06); }
    .hiw-step h3 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }
    .hiw-step p {
      font-size: 0.95rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    @media (max-width: 768px) {
      .hiw-grid { grid-template-columns: 1fr; gap: 2rem; }
    }
    
    /* Trust cards */
    .trust-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
    }
    .trust-card {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-xl);
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
    }
    .trust-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    .trust-card-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
    }
    .trust-card h4 {
      font-size: 1.05rem;
      margin-bottom: 0.5rem;
    }
    .trust-card p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    @media (max-width: 960px) { .trust-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 480px) { .trust-grid { grid-template-columns: 1fr; } }
    
    /* FAQ Accordion */
    .faq-list { max-width: 720px; margin: 0 auto; }
    .accordion-item {
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      margin-bottom: 0.75rem;
      overflow: hidden;
      background: var(--bg-card);
    }
    .accordion-header {
      padding: 1.25rem 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 600;
      font-size: 0.95rem;
      transition: background 0.3s ease;
      color: var(--text-primary);
    }
    .accordion-header:hover { background: var(--bg-card-hover); }
    .accordion-arrow {
      transition: transform 0.3s ease;
      color: var(--text-muted);
      font-size: 1.2rem;
    }
    .accordion-item.open .accordion-arrow { transform: rotate(180deg); }
    .accordion-body {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
    }
    .accordion-item.open .accordion-body { max-height: 2000px; }
    .accordion-body-inner {
      padding: 0 1.5rem 1.25rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.7;
    }
    
    /* Blog Cards */
    .blog-cards-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
      max-width: 1200px;
      margin: 0 auto;
    }
    @media (max-width: 960px) {
      .blog-cards-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 640px) {
      .blog-cards-grid { grid-template-columns: 1fr; }
    }
    .blog-card {
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      padding: 1.75rem;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      height: 100%;
      text-decoration: none;
      color: inherit;
    }
    .blog-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--border-hover);
      background: rgba(255, 255, 255, 0.75);
    }
    .blog-card-category {
      display: inline-block;
      background: rgba(44, 8, 125, 0.1);
      color: var(--brand-primary);
      padding: 0.25rem 0.625rem;
      border-radius: 0.375rem;
      font-weight: 600;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
      width: fit-content;
    }
    .blog-card-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: var(--text-primary);
      line-height: 1.3;
    }
    .blog-card-excerpt {
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.6;
      margin-bottom: 1.25rem;
      flex-grow: 1;
    }
    .blog-card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 1rem;
      border-top: 1px solid var(--border-primary);
      font-size: 0.8rem;
    }
    .blog-card-author {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .blog-card-author-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--bg-secondary);
      border: 2px solid var(--border-primary);
    }
    .blog-card-author-name {
      font-weight: 600;
      color: var(--text-primary);
    }
    .blog-card-meta {
      color: var(--text-muted);
    }
    .blog-card-readmore {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--brand-primary);
      font-weight: 600;
      font-size: 0.85rem;
      margin-top: 0.75rem;
      transition: gap 0.3s ease;
    }
    .blog-card:hover .blog-card-readmore {
      gap: 0.75rem;
    }
    .view-all-blog {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--brand-primary);
      font-weight: 600;
      text-decoration: none;
      font-size: 1rem;
      margin-top: 2rem;
      transition: gap 0.3s ease;
    }
    .view-all-blog:hover {
      gap: 0.75rem;
    }
    
    /* Footer */
    .figgy-footer {
      background: var(--fg-purple);
      color: rgba(255,255,255,0.9);
      padding: 4rem 2rem 2rem;
      text-align: center;
    }
    .figgy-footer h2 {
      color: white;
      font-size: clamp(1.5rem, 3vw, 2.25rem);
      margin-bottom: 1.5rem;
    }
    .figgy-footer-links {
      display: flex;
      gap: 2rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    .figgy-footer-links a {
      color: rgba(255,255,255,0.7);
      text-decoration: none;
      font-size: 0.85rem;
      transition: color 0.3s;
    }
    .figgy-footer-links a:hover { color: white; }
    .figgy-footer-bottom {
      border-top: 1px solid rgba(255,255,255,0.15);
      padding-top: 1.5rem;
      margin-top: 1rem;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.5);
    }

    /* ‚îÄ‚îÄ Calculator Layout (for sub-pages) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .calc-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    .calc-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .calc-back {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .calc-back:hover { color: var(--text-primary); }
    .calc-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }
    .calc-inputs {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .calc-results {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    @media (max-width: 768px) {
      .calc-grid { grid-template-columns: 1fr; }
    }
    
    /* ‚îÄ‚îÄ Chart containers, tables, etc (from original) ‚îÄ‚îÄ */
    .chart-container {
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin: 1rem 0;
    }
    .chart-bar {
      height: 8px;
      border-radius: 4px;
      background: var(--border-primary);
      overflow: hidden;
      margin: 0.5rem 0;
    }
    .chart-bar-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral));
    }
    .sensitivity-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
    }
    .sensitivity-table th {
      background: var(--bg-elevated);
      color: var(--text-secondary);
      font-weight: 600;
      padding: 0.625rem 0.75rem;
      text-align: center;
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid var(--border-primary);
    }
    .sensitivity-table th:first-child { border-radius: var(--radius-sm) 0 0 0; text-align: left; }
    .sensitivity-table th:last-child { border-radius: 0 var(--radius-sm) 0 0; }
    .sensitivity-table td {
      padding: 0.5rem 0.75rem;
      text-align: center;
      border-bottom: 1px solid var(--border-primary);
      transition: background 0.2s ease;
    }
    .sensitivity-table td:first-child { text-align: left; font-weight: 600; color: var(--text-secondary); }
    .sensitivity-table tr:hover td { background: rgba(44, 8, 125, 0.05); }
    .sensitivity-table .highlight { background: rgba(44, 8, 125, 0.1); font-weight: 700; color: var(--fg-purple); }
    .sensitivity-table .positive-val { color: var(--brand-success); }
    .sensitivity-table .negative-val { color: var(--brand-danger); }
    
    /* Tabs */
    .tabs {
      display: flex;
      gap: 0.25rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 0.25rem;
      border: 1px solid var(--border-primary);
    }
    .tab {
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-secondary);
      background: transparent;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      flex: 1;
      text-align: center;
    }
    .tab:hover { color: var(--text-primary); }
    .tab.active {
      background: var(--fg-purple);
      color: white;
      box-shadow: 0 2px 8px rgba(44, 8, 125, 0.3);
    }
    
    /* Metric pill */
    .metric-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      border-radius: var(--radius-full);
      font-size: 0.75rem;
      font-weight: 600;
      font-family: 'JetBrains Mono', monospace;
    }
    .metric-pill.positive { background: rgba(16, 185, 129, 0.1); color: var(--brand-success); border: 1px solid rgba(16, 185, 129, 0.2); }
    .metric-pill.negative { background: rgba(239, 68, 68, 0.1); color: var(--brand-danger); border: 1px solid rgba(239, 68, 68, 0.2); }
    .metric-pill.neutral { background: rgba(44, 8, 125, 0.1); color: var(--fg-purple); border: 1px solid rgba(44, 8, 125, 0.2); }
    
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-primary), transparent);
      margin: 2rem 0;
    }
    
    /* Tooltip */
    .tooltip-wrapper { position: relative; display: inline-flex; align-items: center; gap: 0.25rem; }
    .tooltip-icon {
      width: 16px; height: 16px; border-radius: 50%;
      background: var(--border-primary); color: var(--text-muted);
      font-size: 0.6rem; font-weight: 700;
      display: inline-flex; align-items: center; justify-content: center; cursor: help;
    }
    .tooltip-wrapper:hover .tooltip-content { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }
    .tooltip-content {
      position: absolute; bottom: calc(100% + 8px); left: 50%;
      transform: translateX(-50%) translateY(5px);
      background: var(--bg-elevated); border: 1px solid var(--border-primary);
      border-radius: var(--radius-sm); padding: 0.5rem 0.75rem;
      font-size: 0.72rem; color: var(--text-secondary);
      opacity: 0; visibility: hidden; transition: all 0.2s ease; z-index: 10;
      box-shadow: var(--shadow-lg); max-width: 250px; white-space: normal;
    }

    /* SVG Charts */
    .svg-donut-chart { position: relative; display: inline-block; }
    .svg-donut-chart svg { transform: rotate(-90deg); }
    .svg-donut-segment { fill: none; stroke-width: 32; transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1), stroke-width 0.2s ease, filter 0.2s ease; cursor: pointer; }
    .svg-donut-segment:hover { stroke-width: 38; filter: drop-shadow(0 0 6px rgba(44,8,125,0.4)); }
    .svg-donut-segment.donut-init { stroke-dashoffset: var(--circumference) !important; }
    .svg-donut-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; pointer-events: none; }
    .svg-donut-center .donut-hover-label { font-size: 0.7rem; color: var(--text-muted); }
    .svg-donut-center .donut-hover-value { font-size: 0.85rem; font-weight: 700; color: var(--text-primary); font-family: 'JetBrains Mono', monospace; }
    .svg-area-chart { width: 100%; overflow: visible; }
    .svg-area-path { opacity: 0; transition: opacity 0.8s ease, d 0.6s ease; }
    .svg-area-path.visible { opacity: 1; }
    .svg-area-gridline { stroke: var(--border-primary); stroke-width: 0.5; }
    .svg-area-label { font-size: 10px; fill: var(--text-muted); font-family: 'JetBrains Mono', monospace; }
    .svg-gauge { display: inline-block; position: relative; }
    .svg-gauge svg { overflow: visible; }
    .svg-gauge-arc { fill: none; stroke-width: 14; stroke-linecap: round; }
    .svg-gauge-needle { fill: var(--text-primary); transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1); transform-origin: center center; }
    .svg-gauge-label { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); text-align: center; pointer-events: none; }
    .svg-gauge-label .gauge-value { font-size: 1.1rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: var(--text-primary); }
    .svg-gauge-label .gauge-text { font-size: 0.65rem; color: var(--text-muted); }
    .sparkline-inline { display: inline-block; vertical-align: middle; margin-left: 0.5rem; }
    .sparkline-path { fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
    .sparkline-fill { opacity: 0.15; }
    .chart-animate-bar { transform: scaleY(0); transform-origin: bottom; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
    .chart-animate-bar.visible { transform: scaleY(1); }
    .progress-ring { transform: rotate(-90deg); }
    .progress-ring-bg { stroke: var(--border-primary); fill: none; }
    .progress-ring-fill { fill: none; stroke-linecap: round; transition: stroke-dashoffset 1.5s cubic-bezier(0.4, 0, 0.2, 1); }

    /* Scroll progress */
    #scroll-progress {
      position: fixed; top: 0; left: 0; width: 0%; height: 3px;
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral));
      z-index: 9999; transition: width 0.1s linear; pointer-events: none;
    }

    /* Page transitions */
    .page { display: none; }
    .page.active { display: block; animation: fadeIn 0.4s ease both; }
    .page.fade-out { animation: pageFadeOut 0.15s ease forwards; }
    .page.fade-in { animation: pageFadeIn 0.25s ease forwards; }
    @keyframes pageFadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-8px); } }
    @keyframes pageFadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    /* Reveal */
    .reveal { opacity: 0; transform: translateY(30px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .reveal.visible { opacity: 1; transform: translateY(0); }

    /* Accessibility */
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    .skip-to-content { position: absolute; top: -100%; left: 50%; transform: translateX(-50%); background: var(--fg-purple); color: white; padding: 0.75rem 1.5rem; border-radius: 0 0 var(--radius-md) var(--radius-md); z-index: 10000; font-weight: 600; text-decoration: none; transition: top 0.2s ease; }
    .skip-to-content:focus { top: 0; }
    a:focus-visible, button:focus-visible, input:focus-visible, select:focus-visible, [tabindex]:focus-visible {
      outline: 2px solid var(--fg-purple);
      outline-offset: 2px;
    }

    /* Shortcuts overlay */
    .shortcuts-overlay { position: fixed; inset: 0; z-index: 10000; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; animation: fadeIn 0.2s ease; }
    .shortcuts-overlay.hidden { display: none; }
    .shortcuts-card { background: var(--bg-card); border: 1px solid var(--border-primary); border-radius: var(--radius-xl); padding: 2rem; max-width: 420px; width: 90%; box-shadow: var(--shadow-xl); }
    .shortcuts-card h2 { font-size: 1.25rem; margin-bottom: 1.25rem; }
    .shortcut-row { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary); font-size: 0.85rem; }
    .shortcut-row:last-child { border-bottom: none; }
    .shortcut-key { display: inline-block; background: var(--bg-elevated); border: 1px solid var(--border-primary); border-radius: 4px; padding: 0.15rem 0.5rem; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; font-weight: 600; min-width: 28px; text-align: center; }

    /* Toast */
    .toast { position: fixed; bottom: 2rem; right: 2rem; z-index: 200; background: var(--bg-elevated); border: 1px solid var(--border-primary); border-radius: var(--radius-md); padding: 1rem 1.5rem; box-shadow: var(--shadow-xl); animation: slideInRight 0.4s ease both; display: flex; align-items: center; gap: 0.75rem; font-size: 0.85rem; }
    .toast.hidden { display: none; }
    .toast-success { position: fixed; bottom: 2rem; right: 2rem; z-index: 400; background: var(--bg-elevated); border: 1px solid rgba(16,185,129,0.3); border-radius: var(--radius-md); padding: 1rem 1.5rem; box-shadow: var(--shadow-xl); animation: slideInRight 0.4s ease both; font-size: 0.85rem; color: var(--brand-success); display: flex; align-items: center; gap: 0.5rem; }

    /* Action buttons */
    .action-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }
    .action-buttons .btn { font-size: 0.78rem; padding: 0.5rem 1rem; }

    /* Affiliate CTA */
    .affiliate-cta { margin-top: 1rem; padding: 0.75rem 1rem; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: var(--radius-md); font-size: 0.8rem; color: var(--text-secondary); display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
    .affiliate-cta .ad-label { font-size: 0.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--text-muted); border: 1px solid var(--border-primary); padding: 0.1rem 0.35rem; border-radius: 3px; flex-shrink: 0; }
    .affiliate-cta a { color: var(--fg-coral); text-decoration: none; font-weight: 500; }
    .affiliate-cta a:hover { text-decoration: underline; }

    /* Confetti */
    @keyframes confettiFall { 0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    .confetti-container { position: fixed; inset: 0; pointer-events: none; z-index: 10000; overflow: hidden; }
    .confetti-piece { position: absolute; width: 8px; height: 8px; top: -10px; animation: confettiFall 3s ease-in forwards; }

    /* Chart bar tooltip */
    .chart-bar-tooltip { position: relative; cursor: pointer; }
    .chart-bar-tooltip::after { content: attr(data-tooltip); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%) scale(0.8); background: var(--bg-elevated); color: var(--text-primary); border: 1px solid var(--border-primary); border-radius: var(--radius-sm); padding: 0.25rem 0.5rem; font-size: 0.65rem; font-family: 'JetBrains Mono', monospace; white-space: nowrap; opacity: 0; pointer-events: none; transition: all 0.2s ease; box-shadow: var(--shadow-md); z-index: 10; }
    .chart-bar-tooltip:hover::after { opacity: 1; transform: translateX(-50%) scale(1); }

    /* Showcase cards (kept for compatibility) */
    .showcase-scroll { overflow-x: auto; overflow-y: visible; padding: 1rem 0 1.5rem; margin: 0 -1.5rem; padding-left: 1.5rem; scrollbar-width: none; -ms-overflow-style: none; scroll-snap-type: x proximity; }
    .showcase-scroll::-webkit-scrollbar { display: none; }
    .showcase-track { display: flex; gap: 1.25rem; padding-right: 1.5rem; }
    .showcase-card { flex: 0 0 260px; cursor: pointer; scroll-snap-align: start; }
    .showcase-card-inner { position: relative; width: 100%; height: 100%; border-radius: var(--radius-lg); overflow: hidden; border: 1px solid var(--border-primary); background: var(--bg-card); transition: transform 0.4s cubic-bezier(0.4,0,0.2,1), box-shadow 0.4s ease, border-color 0.4s ease; }
    .showcase-card:hover .showcase-card-inner { transform: scale(1.03); box-shadow: var(--shadow-lg); border-color: rgba(44,8,125,0.2); }
    .sc-overlay { position: absolute; inset: 0; background: rgba(252,250,244,0.9); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s ease; border-radius: var(--radius-lg); }
    .dark .sc-overlay { background: rgba(15,10,26,0.85); }
    .showcase-card:hover .sc-overlay { opacity: 1; }
    .sc-overlay span { font-weight: 700; font-size: 1rem; color: white; background: var(--fg-purple); padding: 0.6rem 1.5rem; border-radius: var(--radius-full); }
    .sc-mini-ui { height: 100%; display: flex; flex-direction: column; }
    .sc-mini-header { padding: 0.65rem 0.85rem; font-size: 0.75rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.4rem; }
    .sc-mini-body { padding: 0.75rem 0.85rem; flex: 1; display: flex; flex-direction: column; gap: 0.4rem; }
    .sc-mini-field { display: flex; justify-content: space-between; align-items: center; font-size: 0.68rem; }
    .sc-label { color: var(--text-muted); }
    .sc-value { font-family: 'JetBrains Mono', monospace; font-weight: 600; color: var(--text-primary); font-size: 0.7rem; }
    .sc-mini-result { margin-top: auto; padding-top: 0.5rem; border-top: 1px solid var(--border-primary); display: flex; justify-content: space-between; align-items: center; }
    .sc-result-label { font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 600; }
    .sc-result-num { font-family: 'JetBrains Mono', monospace; font-size: 1.1rem; font-weight: 800; color: var(--text-primary); }
    .sc-mini-bar { height: 4px; background: var(--border-primary); border-radius: 2px; overflow: hidden; margin-top: 0.4rem; }
    .sc-bar-fill { height: 100%; border-radius: 2px; transition: width 1s ease; }

    /* Cookie banner */
    .cookie-banner { position: fixed; bottom: 0; left: 0; right: 0; z-index: 300; background: var(--bg-elevated); border-top: 1px solid var(--border-primary); padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: center; gap: 1rem; font-size: 0.85rem; color: var(--text-secondary); animation: fadeInUp 0.4s ease both; box-shadow: 0 -4px 20px rgba(0,0,0,0.1); }
    .cookie-banner.hidden { display: none; }
    .cookie-banner-btns { display: flex; gap: 0.5rem; }
    @media (max-width: 640px) { .cookie-banner { flex-direction: column; text-align: center; gap: 0.75rem; } }

    /* Print */
    @media print {
      body { background: white !important; color: black !important; font-size: 12pt; }
      .nav-bar, .cookie-banner, .no-print, .figgy-footer, .btn, .action-buttons, .theme-toggle, .mobile-menu-btn { display: none !important; }
      * { box-shadow: none !important; text-shadow: none !important; }
      .page { display: block !important; }
      .glass-card, .result-card, .tool-card { background: white !important; border: 1px solid #ddd !important; break-inside: avoid; }
      h1, h2, h3 { page-break-after: avoid; color: #1a1a2e !important; -webkit-text-fill-color: #1a1a2e !important; }
      .result-value { -webkit-text-fill-color: #333 !important; color: #333 !important; }
      @page { margin: 2cm; }
      .page.active::before {
        content: "FiggyBank ‚Äî Smart Money Moves Made Simple";
        display: block; text-align: center; font-size: 14pt; font-weight: 700;
        color: #2C087D; border-bottom: 2px solid #2C087D; padding-bottom: 0.5rem; margin-bottom: 1.5rem;
      }
    }

    /* Mobile */
    @media (max-width: 768px) {
      .section { padding: 3rem 1rem; }
      .section-full { padding: 3rem 1rem; }
      .calc-container { padding: 1.5rem 1rem; }
      .glass-card { padding: var(--space-lg) !important; }
      .btn { width: 100%; }
      .figgy-hero .btn { width: auto; min-width: 140px; }
      .action-buttons .btn { flex: 1; min-width: 120px; }
      .result-value { font-size: 1.5rem; }
      [style*="grid-template-columns: repeat(3"] { grid-template-columns: 1fr !important; }
      [style*="grid-template-columns: 1fr 1fr 1fr"] { grid-template-columns: 1fr !important; }
      [style*="grid-template-columns:repeat(4"] { grid-template-columns: repeat(2, 1fr) !important; }
    }
    @media (max-width: 480px) {
      [style*="grid-template-columns:repeat(4"] { grid-template-columns: 1fr !important; }
    }
    input[type="range"] { height: 8px; padding: 18px 0; margin: 0; box-sizing: content-box; }
    input[type="range"]::-webkit-slider-thumb { width: 28px; height: 28px; }
    input[type="range"]::-moz-range-thumb { width: 28px; height: 28px; border: none; border-radius: 50%; background: var(--fg-purple); box-shadow: 0 2px 8px rgba(44, 8, 125, 0.4); cursor: pointer; }
    .hero-blob { will-change: transform; }
    .tool-card { will-change: transform; }
    .nav-logo-svg { flex-shrink: 0; }

    /* Skeleton */
    .skeleton-overlay { position: absolute; inset: 0; background: var(--bg-card); border-radius: var(--radius-lg); z-index: 5; display: flex; flex-direction: column; gap: 0.75rem; padding: var(--space-lg); }
    .skeleton-line { height: 16px; border-radius: 4px; background: linear-gradient(90deg, var(--border-primary) 25%, var(--bg-elevated) 50%, var(--border-primary) 75%); background-size: 200% 100%; animation: shimmer 1.5s ease infinite; }
    .skeleton-line.short { width: 60%; }
    .skeleton-line.medium { width: 80%; }
    .skeleton-line.tall { height: 48px; width: 50%; }

    /* Input ripple */
    .input-group { position: relative; }
    .input-group .input-ripple { position: absolute; border-radius: 50%; background: rgba(44, 8, 125, 0.25); transform: scale(0); animation: ripple 0.6s ease-out forwards; pointer-events: none; z-index: 1; }

    /* Loading skeleton */
    .skeleton-overlay { position: absolute; inset: 0; background: var(--bg-card); border-radius: var(--radius-lg); z-index: 5; display: flex; flex-direction: column; gap: 0.75rem; padding: var(--space-lg); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       V6.0 ‚Äî DRAMATIC HOMEPAGE ENHANCEMENTS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* Scroll progress bar */
    #scroll-progress {
      position: fixed; top: 0; left: 0; width: 0%; height: 3px;
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral), var(--fg-gold));
      z-index: 9999; transition: width 0.1s linear; pointer-events: none;
    }

    /* Animated gradient text */
    .gradient-text-animated {
      background: linear-gradient(270deg, #2C087D, #FF6B6B, #F5A623, #2C087D);
      background-size: 400% 400%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientShift 4s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Hero animated mesh background */
    .hero-mesh-bg {
      position: absolute; inset: 0; z-index: 0; overflow: hidden;
      background: linear-gradient(135deg, rgba(44,8,125,0.03), rgba(255,107,107,0.03), rgba(245,166,35,0.02));
    }
    .hero-mesh-bg::before {
      content: ''; position: absolute; inset: -50%;
      background: radial-gradient(ellipse at 20% 50%, rgba(44,8,125,0.08) 0%, transparent 50%),
                  radial-gradient(ellipse at 80% 20%, rgba(255,107,107,0.06) 0%, transparent 50%),
                  radial-gradient(ellipse at 50% 80%, rgba(245,166,35,0.05) 0%, transparent 50%);
      animation: meshShift 12s ease-in-out infinite;
    }
    @keyframes meshShift {
      0%, 100% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(5%, -3%) scale(1.05); }
      66% { transform: translate(-3%, 5%) scale(0.98); }
    }

    /* Sparkle effect */
    .sparkle-container { position: absolute; inset: 0; pointer-events: none; z-index: 1; overflow: hidden; }
    .sparkle {
      position: absolute; width: 4px; height: 4px; border-radius: 50%;
      background: var(--fg-gold);
      animation: sparkle 3s ease-in-out infinite;
    }
    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 0.8; transform: scale(1) rotate(180deg); }
    }

    /* Hero huge typography */
    .figgy-hero h1.hero-huge {
      font-size: clamp(3rem, 8vw, 6rem) !important;
      font-weight: 900 !important;
      line-height: 1.05 !important;
      letter-spacing: -0.04em !important;
    }

    /* Pulse CTA */
    .btn-pulse {
      animation: btnPulse 2.5s ease-in-out infinite;
      font-size: 1.15rem !important;
      padding: 1.25rem 3rem !important;
    }
    @keyframes btnPulse {
      0%, 100% { box-shadow: 0 4px 15px rgba(44,8,125,0.25); }
      50% { box-shadow: 0 8px 40px rgba(44,8,125,0.45), 0 0 60px rgba(44,8,125,0.15); }
    }

    /* Animated piggy bank SVG scene */
    .hero-scene { position: relative; width: 100%; max-width: 420px; margin: 0 auto; }
    .hero-scene svg { width: 100%; height: auto; }
    .piggy-bounce { animation: piggyBounce 3s ease-in-out infinite; transform-origin: center bottom; }
    @keyframes piggyBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }
    .coin-float { animation: coinFloat 4s ease-in-out infinite; }
    @keyframes coinFloat {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.7; }
      50% { transform: translateY(-25px) rotate(15deg); opacity: 1; }
    }
    .coin-float-2 { animation: coinFloat2 5s ease-in-out infinite 0.5s; }
    @keyframes coinFloat2 {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.5; }
      50% { transform: translateY(-30px) rotate(-20deg); opacity: 1; }
    }
    .coin-float-3 { animation: coinFloat3 3.5s ease-in-out infinite 1s; }
    @keyframes coinFloat3 {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.6; }
      50% { transform: translateY(-20px) rotate(25deg); opacity: 1; }
    }
    .chart-draw { stroke-dasharray: 200; stroke-dashoffset: 200; animation: drawLine 3s ease forwards 0.5s; }
    @keyframes drawLine { to { stroke-dashoffset: 0; } }
    .dollar-fade { animation: dollarFade 4s ease-in-out infinite; }
    @keyframes dollarFade {
      0%, 100% { opacity: 0; transform: translateY(5px); }
      30%, 70% { opacity: 0.6; transform: translateY(-5px); }
    }
    .dollar-fade-2 { animation: dollarFade 4s ease-in-out infinite 1.5s; }
    .dollar-fade-3 { animation: dollarFade 4s ease-in-out infinite 2.5s; }

    /* Interactive showcase tabs */
    .showcase-tabs { display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 2rem; flex-wrap: wrap; }
    .showcase-tab {
      padding: 0.75rem 1.5rem; border-radius: var(--radius-full); border: 2px solid var(--border-primary);
      background: var(--bg-card); color: var(--text-secondary); cursor: pointer; font-weight: 600;
      font-size: 0.85rem; transition: all 0.3s ease;
    }
    .showcase-tab:hover { border-color: var(--fg-purple); color: var(--fg-purple); }
    .showcase-tab.active {
      background: var(--fg-purple); color: white; border-color: var(--fg-purple);
      box-shadow: 0 4px 20px rgba(44,8,125,0.3);
    }
    .showcase-panel { display: none; animation: showcaseFadeIn 0.5s ease both; }
    .showcase-panel.active { display: block; }
    @media (max-width: 768px) {
      .showcase-panel > div { grid-template-columns: 1fr !important; gap: 1.5rem !important; }
      .hiw-timeline { grid-template-columns: 1fr !important; }
    }
    @keyframes showcaseFadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    /* Glassmorphism card */
    .glass-showcase {
      background: rgba(255,255,255,0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.3); border-radius: var(--radius-xl);
      box-shadow: 0 8px 32px rgba(44,8,125,0.1); padding: 2.5rem; position: relative; overflow: hidden;
    }
    .dark .glass-showcase {
      background: rgba(26,19,48,0.6); border-color: rgba(255,255,255,0.08);
    }

    /* Floating 3D shapes */
    .floating-shape {
      position: absolute; pointer-events: none; z-index: 0;
    }
    .shape-cube {
      width: 40px; height: 40px; transform-style: preserve-3d;
      animation: rotateCube 8s linear infinite;
    }
    @keyframes rotateCube {
      from { transform: rotateX(0deg) rotateY(0deg); }
      to { transform: rotateX(360deg) rotateY(360deg); }
    }
    .shape-sphere {
      width: 30px; height: 30px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,107,107,0.3), rgba(44,8,125,0.1));
      animation: float3D 6s ease-in-out infinite;
    }
    @keyframes float3D {
      0%, 100% { transform: translateY(0) rotateX(0) rotateY(0); }
      25% { transform: translateY(-10px) rotateX(5deg) rotateY(-5deg); }
      50% { transform: translateY(-20px) rotateX(-3deg) rotateY(8deg); }
      75% { transform: translateY(-8px) rotateX(4deg) rotateY(-3deg); }
    }

    /* Tool card 3D tilt and unique hover gradients */
    .tool-card { perspective: 800px; }
    .tool-card.tilt-active { transition: transform 0.1s ease-out, box-shadow 0.3s ease; }
    .tool-card:nth-child(1):hover { background: linear-gradient(135deg, rgba(44,8,125,0.04), rgba(99,102,241,0.06)); }
    .tool-card:nth-child(2):hover { background: linear-gradient(135deg, rgba(139,92,246,0.04), rgba(168,85,247,0.06)); }
    .tool-card:nth-child(3):hover { background: linear-gradient(135deg, rgba(236,72,153,0.04), rgba(244,63,94,0.06)); }
    .tool-card:nth-child(4):hover { background: linear-gradient(135deg, rgba(6,182,212,0.04), rgba(20,184,166,0.06)); }
    .tool-card:nth-child(5):hover { background: linear-gradient(135deg, rgba(16,185,129,0.04), rgba(34,197,94,0.06)); }
    .tool-card:nth-child(6):hover { background: linear-gradient(135deg, rgba(245,158,11,0.04), rgba(249,115,22,0.06)); }
    .tool-card:hover .tool-icon { animation: iconBounce 0.5s ease; }
    @keyframes iconBounce {
      0%, 100% { transform: scale(1.1) rotate(0deg); }
      25% { transform: scale(1.2) rotate(-5deg); }
      75% { transform: scale(1.15) rotate(5deg); }
    }

    /* Staggered scroll entrance */
    .stagger-item { opacity: 0; transform: translateY(40px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
    .stagger-item.is-visible { opacity: 1; transform: translateY(0); }

    /* Animated timeline for How It Works */
    .hiw-timeline { position: relative; }
    .hiw-timeline::before {
      content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 2px;
      background: var(--border-primary); z-index: 0;
    }
    .hiw-timeline-line {
      position: absolute; top: 50%; left: 0; height: 2px; width: 0;
      background: linear-gradient(90deg, var(--fg-purple), var(--fg-coral));
      z-index: 1; transition: width 1.5s ease;
    }
    .hiw-timeline-line.drawn { width: 100%; }
    @media (max-width: 768px) {
      .hiw-timeline::before { top: 0; left: 50%; width: 2px; height: 100%; }
      .hiw-timeline-line { top: 0; left: 50%; width: 2px !important; height: 0; transition: height 1.5s ease; }
      .hiw-timeline-line.drawn { height: 100%; width: 2px !important; }
    }

    /* HIW step enhanced */
    .hiw-step-enhanced {
      position: relative; z-index: 2; text-align: center;
      background: var(--bg-card); border-radius: var(--radius-xl); padding: 2rem;
      border: 1px solid var(--border-primary); transition: all 0.3s ease;
    }
    .hiw-step-enhanced:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .hiw-step-icon {
      width: 80px; height: 80px; margin: 0 auto 1rem; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; font-size: 2rem;
      background: linear-gradient(135deg, rgba(44,8,125,0.08), rgba(255,107,107,0.08));
    }

    /* Trust cards glassmorphism */
    .trust-card-v6 {
      background: rgba(255,255,255,0.5); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border: 2px solid transparent; border-radius: var(--radius-xl); padding: 2rem; text-align: center;
      transition: all 0.4s ease; position: relative; overflow: hidden;
    }
    .dark .trust-card-v6 { background: rgba(26,19,48,0.5); }
    .trust-card-v6::before {
      content: ''; position: absolute; inset: -2px; border-radius: var(--radius-xl);
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral), var(--fg-gold), var(--fg-purple));
      background-size: 300% 300%; animation: gradientBorder 6s ease infinite; z-index: -1;
    }
    .trust-card-v6::after {
      content: ''; position: absolute; inset: 2px; border-radius: calc(var(--radius-xl) - 2px);
      background: var(--bg-card); z-index: -1;
    }
    @keyframes gradientBorder {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .trust-card-v6:hover { transform: translateY(-6px); box-shadow: 0 12px 40px rgba(44,8,125,0.15); }
    .trust-card-v6 .trust-svg-icon { width: 80px; height: 80px; margin: 0 auto 1rem; }

    /* Animated trust SVG icons */
    .flag-wave { animation: flagWave 3s ease-in-out infinite; transform-origin: left center; }
    @keyframes flagWave {
      0%, 100% { transform: skewY(0deg); }
      25% { transform: skewY(2deg); }
      75% { transform: skewY(-2deg); }
    }
    .lock-click { animation: lockClick 3s ease infinite; }
    @keyframes lockClick {
      0%, 70%, 100% { transform: translateY(0); }
      80% { transform: translateY(-3px); }
      90% { transform: translateY(0); }
    }
    .coins-stack { animation: coinsStack 3s ease-in-out infinite; }
    @keyframes coinsStack {
      0%, 100% { transform: translateY(0); opacity: 0.6; }
      50% { transform: translateY(-5px); opacity: 1; }
    }
    .page-turn { animation: pageTurn 4s ease-in-out infinite; transform-origin: left center; }
    @keyframes pageTurn {
      0%, 100% { transform: rotateY(0deg); }
      50% { transform: rotateY(-15deg); }
    }

    /* Numbers Don't Lie section */
    .stats-grid {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 2rem;
    }
    @media (max-width: 960px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 480px) { .stats-grid { grid-template-columns: 1fr; } }
    .stat-card {
      text-align: center; padding: 2.5rem 1.5rem; position: relative; overflow: hidden;
      border-radius: var(--radius-xl); background: var(--bg-card);
      border: 1px solid var(--border-primary); transition: all 0.3s ease;
    }
    .stat-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-lg); }
    .stat-number {
      font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; line-height: 1;
      font-family: 'JetBrains Mono', monospace; margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .stat-label { font-size: 1rem; color: var(--text-secondary); font-weight: 600; }
    .stat-bg-element {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      font-size: 6rem; opacity: 0.04; pointer-events: none;
    }

    /* CTA Banner */
    .cta-banner {
      background: linear-gradient(135deg, var(--fg-purple), var(--fg-purple-light));
      padding: 4rem 2rem; text-align: center; position: relative; overflow: hidden;
    }
    .cta-banner::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(270deg, rgba(255,107,107,0.1), transparent, rgba(245,166,35,0.1));
      background-size: 400% 400%; animation: gradientShift 8s ease infinite;
    }
    .cta-banner h2 { color: white; font-size: clamp(1.75rem, 4vw, 2.75rem); margin-bottom: 1rem; position: relative; z-index: 1; }
    .cta-banner p { color: rgba(255,255,255,0.75); font-size: 1.1rem; margin-bottom: 2rem; position: relative; z-index: 1; }

    /* Footer v6 */
    .figgy-footer-v6 {
      background: linear-gradient(180deg, #1a0e3a, #0f0a1a); color: rgba(255,255,255,0.9);
      padding: 4rem 2rem 2rem; text-align: center; position: relative; overflow: hidden;
    }
    .figgy-footer-v6::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(270deg, rgba(44,8,125,0.2), transparent, rgba(255,107,107,0.1));
      background-size: 400% 400%; animation: gradientShift 12s ease infinite;
    }

    /* Scroll to top piggy */
    .scroll-top-piggy {
      position: fixed; bottom: 2rem; right: 2rem; width: 48px; height: 48px;
      border-radius: 50%; background: var(--fg-purple); color: white; border: none;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; box-shadow: 0 4px 20px rgba(44,8,125,0.3);
      opacity: 0; transform: translateY(20px); transition: all 0.3s ease; z-index: 100;
    }
    .scroll-top-piggy.visible { opacity: 1; transform: translateY(0); }
    .scroll-top-piggy:hover { transform: translateY(-4px); box-shadow: 0 8px 30px rgba(44,8,125,0.4); }

    /* Cursor trail */
    .cursor-dot {
      position: fixed; width: 8px; height: 8px; border-radius: 50%;
      background: rgba(44,8,125,0.3); pointer-events: none; z-index: 9998;
      transition: transform 0.15s ease, opacity 0.3s ease; mix-blend-mode: multiply;
    }
    .dark .cursor-dot { background: rgba(255,107,107,0.3); mix-blend-mode: screen; }

    /* Coin rain animation */
    .coin-rain-piece {
      position: fixed; font-size: 1.5rem; top: -50px; z-index: 10000; pointer-events: none;
      animation: coinFall 3s ease-in forwards;
    }
    @keyframes coinFall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
    }

    /* Page load stagger */
    .load-stagger { opacity: 0; transform: translateY(30px); }
    .load-stagger.loaded { opacity: 1; transform: translateY(0); transition: all 0.6s cubic-bezier(0.4,0,0.2,1); }

    /* Counter animation */
    .count-up { display: inline-block; }

    /* Parallax mouse class */
    .parallax-mouse { transition: transform 0.3s ease-out; will-change: transform; }

    /* Animated data viz in showcase */
    .viz-bar { transition: height 1s cubic-bezier(0.4,0,0.2,1); }
    .viz-number { font-family: 'JetBrains Mono', monospace; font-weight: 800; }

    @media (prefers-reduced-motion: reduce) {
      .sparkle, .piggy-bounce, .coin-float, .coin-float-2, .coin-float-3,
      .chart-draw, .dollar-fade, .dollar-fade-2, .dollar-fade-3,
      .gradient-text-animated, .hero-mesh-bg::before, .shape-cube, .shape-sphere,
      .flag-wave, .lock-click, .coins-stack, .page-turn, .btn-pulse,
      .cursor-dot, .coin-rain-piece, .trust-card-v6::before {
        animation: none !important;
      }
      .hiw-timeline-line { transition: none !important; width: 100% !important; }
      .load-stagger { opacity: 1 !important; transform: none !important; }
    }

    /* ‚ïê‚ïê‚ïê Affiliate Product Recommendations ‚ïê‚ïê‚ïê */
    .affiliate-section {
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border-primary);
    }
    .affiliate-section h4 {
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }
    .affiliate-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1rem;
    }
    .affiliate-card {
      display: flex;
      gap: 0.75rem;
      padding: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-primary);
      border-radius: 12px;
      text-decoration: none;
      color: var(--text-primary);
      transition: all 0.3s ease;
    }
    .affiliate-card:hover {
      border-color: var(--fg-purple);
      box-shadow: 0 4px 12px rgba(44, 8, 125, 0.08);
      transform: translateY(-2px);
    }
    .affiliate-card-icon {
      font-size: 2rem;
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(44, 8, 125, 0.05);
      border-radius: 8px;
    }
    .affiliate-card-info h5 {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--text-primary);
    }
    .affiliate-card-info p {
      font-size: 0.78rem;
      color: var(--text-muted);
      line-height: 1.4;
    }
    .affiliate-disclosure {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-top: 0.75rem;
      font-style: italic;
    }
    @media (max-width: 640px) {
      .affiliate-cards { grid-template-columns: 1fr; }
    }

    /* ‚ïê‚ïê‚ïê AFFILIATE RESOURCES ‚ïê‚ïê‚ïê */
    .affiliate-resources {
      margin-top: 2.5rem;
      padding: 2rem;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-primary);
    }
    .affiliate-resources h3 {
      font-size: 1.25rem;
      margin-bottom: 1.25rem;
      color: var(--text-primary);
    }
    .affiliate-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    .affiliate-card {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-primary);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-primary);
      text-decoration: none;
      color: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .affiliate-card:hover {
      border-color: var(--fg-purple);
      box-shadow: 0 2px 12px rgba(44, 8, 125, 0.1);
    }
    .affiliate-info {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      min-width: 0;
    }
    .affiliate-title {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-primary);
      line-height: 1.3;
    }
    .affiliate-author {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }
    .affiliate-why {
      font-size: 0.8rem;
      color: var(--text-tertiary);
      line-height: 1.4;
    }
    .affiliate-disclosure {
      margin-top: 1rem;
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-align: center;
      font-style: italic;
    }
    @media (max-width: 600px) {
      .affiliate-grid {
        grid-template-columns: 1fr;
      }
      .affiliate-resources {
        padding: 1.25rem;
      }
    }
    /* ‚ïê‚ïê‚ïê AFFILIATE UPGRADE STYLES ‚ïê‚ïê‚ïê */
/* =============================================
   FiggyBank Affiliate Upgrade Styles
   ============================================= */

:root {
  --fg-purple: #2C087D;
  --fg-coral: #FF6B6B;
  --fg-cream: #FCFAF4;
}

/* ‚îÄ‚îÄ A/D: Inline Affiliate Card ‚îÄ‚îÄ */

.affiliate-inline {
  position: relative;
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.25rem 1.5rem;
  margin: 1.5rem 0;
  background: var(--bg-card, #fff);
  border-radius: var(--radius-lg, 12px);
  border: 2px solid transparent;
  background-clip: padding-box;
  box-shadow: 0 2px 12px rgba(44, 8, 125, 0.08);
  opacity: 0;
  transform: translateY(8px);
  animation: affFadeIn 0.4s ease forwards;
  animation-delay: 0.5s;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}

.affiliate-inline::before {
  content: '';
  position: absolute;
  inset: -2px;
  border-radius: calc(var(--radius-lg, 12px) + 2px);
  background: linear-gradient(135deg, var(--fg-purple), var(--fg-coral));
  z-index: -1;
}

.affiliate-inline:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(44, 8, 125, 0.14);
}

@keyframes affFadeIn {
  to { opacity: 1; transform: translateY(0); }
}

.affiliate-inline__icon {
  font-size: 2.5rem;
  flex-shrink: 0;
  line-height: 1;
}

.affiliate-inline__body {
  flex: 1;
  min-width: 0;
}

.affiliate-inline__label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  color: var(--text-muted, #999);
  margin-bottom: 0.15rem;
}

.affiliate-inline__heading {
  font-size: 0.85rem;
  color: var(--text-secondary, #666);
  margin-bottom: 0.25rem;
}

.affiliate-inline__title {
  font-size: 1.05rem;
  font-weight: 700;
  color: var(--text-primary, #1a1a1a);
  margin-bottom: 0.1rem;
}

.affiliate-inline__author {
  font-size: 0.85rem;
  color: var(--text-secondary, #555);
}

.affiliate-inline__pitch {
  font-size: 0.85rem;
  color: var(--text-secondary, #666);
  margin-top: 0.25rem;
}

.affiliate-inline__stars {
  color: #f5a623;
  font-size: 0.9rem;
  margin-top: 0.15rem;
}

.affiliate-inline__cta {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.6rem 1.2rem;
  background: var(--fg-coral);
  color: #fff;
  border: none;
  border-radius: var(--radius-md, 8px);
  font-size: 0.9rem;
  font-weight: 600;
  white-space: nowrap;
  cursor: pointer;
  transition: background 0.15s ease, transform 0.15s ease;
  text-decoration: none;
}

.affiliate-inline__cta:hover {
  background: #e85555;
  transform: scale(1.03);
}

/* ‚îÄ‚îÄ B: Floating Smart Tip ‚îÄ‚îÄ */

.smart-tip {
  position: fixed;
  bottom: 1.5rem;
  right: 1.5rem;
  z-index: 9999;
  width: 320px;
  background: var(--bg-card, #fff);
  border-radius: var(--radius-lg, 12px);
  box-shadow: 0 8px 32px rgba(0,0,0,0.15);
  border: 1px solid var(--border-primary, #e5e5e5);
  opacity: 0;
  transform: translateY(20px) scale(0.95);
  animation: tipSlideIn 0.35s ease forwards;
  overflow: hidden;
}

@keyframes tipSlideIn {
  to { opacity: 1; transform: translateY(0) scale(1); }
}

.smart-tip__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.75rem 1rem;
  background: linear-gradient(135deg, var(--fg-purple), #5b21b6);
  color: #fff;
}

.smart-tip__header-text {
  font-size: 0.85rem;
  font-weight: 600;
}

.smart-tip__close {
  background: none;
  border: none;
  color: #fff;
  font-size: 1.2rem;
  cursor: pointer;
  opacity: 0.7;
  padding: 0;
  line-height: 1;
}

.smart-tip__close:hover { opacity: 1; }

.smart-tip__body {
  padding: 1rem;
  display: flex;
  gap: 0.75rem;
  align-items: flex-start;
}

.smart-tip__emoji {
  font-size: 2rem;
  flex-shrink: 0;
}

.smart-tip__info { flex: 1; min-width: 0; }

.smart-tip__title {
  font-size: 0.95rem;
  font-weight: 700;
  color: var(--text-primary, #1a1a1a);
}

.smart-tip__author {
  font-size: 0.8rem;
  color: var(--text-muted, #999);
}

.smart-tip__stars {
  color: #f5a623;
  font-size: 0.8rem;
}

.smart-tip__footer {
  padding: 0 1rem 1rem;
}

.smart-tip__btn {
  display: block;
  width: 100%;
  text-align: center;
  padding: 0.55rem;
  background: var(--fg-coral);
  color: #fff;
  border: none;
  border-radius: var(--radius-md, 8px);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: background 0.15s ease;
}

.smart-tip__btn:hover { background: #e85555; }

.smart-tip__sponsored {
  text-align: center;
  font-size: 0.65rem;
  color: var(--text-muted, #999);
  padding-top: 0.4rem;
}

/* ‚îÄ‚îÄ E: Enhanced existing affiliates ‚îÄ‚îÄ */

.affiliate-resources .aff-new-badge {
  display: inline-block;
  background: var(--fg-coral);
  color: #fff;
  font-size: 0.65rem;
  font-weight: 700;
  padding: 0.15rem 0.5rem;
  border-radius: 999px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  animation: badgePulse 2s ease-in-out infinite;
  vertical-align: middle;
  margin-left: 0.4rem;
}

@keyframes badgePulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

.affiliate-resources .aff-enhanced-cta {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  padding: 0.5rem 1rem;
  background: var(--fg-coral);
  color: #fff;
  border: none;
  border-radius: var(--radius-md, 8px);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: background 0.15s ease;
  margin-top: 0.5rem;
}

.affiliate-resources .aff-enhanced-cta:hover { background: #e85555; }

/* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */

@media (max-width: 600px) {
  .affiliate-inline {
    flex-direction: column;
    text-align: center;
    padding: 1rem;
  }
  .affiliate-inline__cta {
    width: 100%;
    justify-content: center;
  }
  .smart-tip {
    width: calc(100% - 2rem);
    left: 1rem;
    right: 1rem;
    bottom: 1rem;
  }
}

  </style>

  <!-- PDF Export Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <a href="#main-content" class="skip-to-content">Skip to main content</a>

  <!-- Keyboard Shortcuts Overlay -->
  <div class="shortcuts-overlay hidden" id="shortcuts-overlay" role="dialog" aria-label="Keyboard shortcuts" onclick="if(event.target===this)this.classList.add('hidden')">
    <div class="shortcuts-card">
      <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
      <div class="shortcut-row"><span>Show this help</span><span class="shortcut-key">?</span></div>
      <div class="shortcut-row"><span>Business Valuation</span><span class="shortcut-key">1</span></div>
      <div class="shortcut-row"><span>Mortgage Calculator</span><span class="shortcut-key">2</span></div>
      <div class="shortcut-row"><span>Investment Returns</span><span class="shortcut-key">3</span></div>
      <div class="shortcut-row"><span>RRSP vs TFSA</span><span class="shortcut-key">4</span></div>
      <div class="shortcut-row"><span>Compound Interest</span><span class="shortcut-key">5</span></div>
      <div class="shortcut-row"><span>M&A Analyzer</span><span class="shortcut-key">6</span></div>
      <div class="shortcut-row"><span>Startup Runway</span><span class="shortcut-key">7</span></div>
      <div class="shortcut-row"><span>Net Worth</span><span class="shortcut-key">8</span></div>
      <div class="shortcut-row"><span>Toggle Theme</span><span class="shortcut-key">T</span></div>
      <div class="shortcut-row"><span>Home</span><span class="shortcut-key">H</span></div>
    </div>
  </div>

  <div id="scroll-progress"></div>

  <!-- ‚ïê‚ïê NAVIGATION ‚ïê‚ïê -->
  <nav class="nav-bar" id="navbar">
    <div class="nav-inner">
      <a href="#" class="nav-logo" onclick="showPage('home'); return false;">
        <!-- FiggyBank Piggy Bank Logo SVG -->
        <svg class="nav-logo-svg" width="36" height="36" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="32" cy="36" rx="22" ry="18" fill="#FF8A8A"/>
          <ellipse cx="32" cy="36" rx="22" ry="18" fill="url(#piggyGrad)" opacity="0.5"/>
          <!-- Ears -->
          <ellipse cx="16" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(-15 16 22)"/>
          <ellipse cx="16" cy="22" rx="4" ry="5" fill="#FFB5B5" transform="rotate(-15 16 22)"/>
          <ellipse cx="48" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(15 48 22)"/>
          <ellipse cx="48" cy="22" rx="4" ry="5" fill="#FFB5B5" transform="rotate(15 48 22)"/>
          <!-- Coin slot -->
          <rect x="26" y="19" width="12" height="3" rx="1.5" fill="#F5A623"/>
          <rect x="27" y="20" width="10" height="1" rx="0.5" fill="#D4891A"/>
          <!-- Snout -->
          <ellipse cx="32" cy="40" rx="8" ry="6" fill="#FFB5B5"/>
          <circle cx="29" cy="39.5" r="1.5" fill="#E88A8A"/>
          <circle cx="35" cy="39.5" r="1.5" fill="#E88A8A"/>
          <!-- Eyes -->
          <circle cx="24" cy="32" r="2.5" fill="#2C087D"/>
          <circle cx="40" cy="32" r="2.5" fill="#2C087D"/>
          <circle cx="25" cy="31" r="1" fill="white"/>
          <circle cx="41" cy="31" r="1" fill="white"/>
          <!-- Smile -->
          <path d="M28 43 Q32 46 36 43" stroke="#E88A8A" stroke-width="1.5" fill="none" stroke-linecap="round"/>
          <!-- Legs -->
          <rect x="20" y="50" width="5" height="6" rx="2.5" fill="#FF8A8A"/>
          <rect x="39" y="50" width="5" height="6" rx="2.5" fill="#FF8A8A"/>
          <!-- Tail -->
          <path d="M54 34 Q58 30 56 26 Q54 22 58 20" stroke="#FF8A8A" stroke-width="2.5" fill="none" stroke-linecap="round"/>
          <defs>
            <linearGradient id="piggyGrad" x1="10" y1="18" x2="54" y2="54">
              <stop offset="0%" stop-color="#FFD4D4"/>
              <stop offset="100%" stop-color="#FF6B6B" stop-opacity="0.3"/>
            </linearGradient>
          </defs>
        </svg>
        <span>FiggyBank</span>
      </a>
      
      <ul class="nav-links" id="nav-links">
        <li><a href="#" onclick="showPage('home'); return false;">Home</a></li>
        <li class="nav-dropdown">
          <a href="#" class="nav-dropdown-trigger" onclick="return false;">Calculators <span style="font-size:0.6em;margin-left:2px;">‚ñæ</span></a>
          <div class="nav-dropdown-menu">
            <div class="nav-dropdown-grid">
              <div class="nav-dropdown-group">
                <span class="nav-dropdown-label">üè† Home & Property</span>
                <a href="#" onclick="showPage('mortgage'); return false;">Mortgage</a>
                <a href="#" onclick="showPage('fhsa'); return false;">FHSA</a>
                <a href="#" onclick="showPage('rentbuy'); return false;">Rent vs Buy</a>
                <a href="#" onclick="showPage('lease'); return false;">Lease vs Buy</a>
              </div>
              <div class="nav-dropdown-group">
                <span class="nav-dropdown-label">üí∞ Tax & Income</span>
                <a href="#" onclick="showPage('tax'); return false;">Tax Estimator</a>
                <a href="#" onclick="showPage('incometax'); return false;">Full Income Tax</a>
                <a href="#" onclick="showPage('capgains'); return false;">Capital Gains</a>
                <a href="#" onclick="showPage('salary'); return false;">Salary</a>
              </div>
              <div class="nav-dropdown-group">
                <span class="nav-dropdown-label">üìà Investing & Savings</span>
                <a href="#" onclick="showPage('tfsa'); return false;">TFSA Room</a>
                <a href="#" onclick="showPage('investment'); return false;">Investment Returns</a>
                <a href="#" onclick="showPage('compound'); return false;">Compound Interest</a>
                <a href="#" onclick="showPage('gic'); return false;">GIC Ladder</a>
                <a href="#" onclick="showPage('currency'); return false;">Currency</a>
              </div>
              <div class="nav-dropdown-group">
                <span class="nav-dropdown-label">üè¶ Retirement</span>
                <a href="#" onclick="showPage('rrsp'); return false;">RRSP Refund</a>
                <a href="#" onclick="showPage('retirement'); return false;">RRSP vs TFSA</a>
                <a href="#" onclick="showPage('resp'); return false;">RESP</a>
                <a href="#" onclick="showPage('cpp'); return false;">CPP/OAS</a>
              </div>
              <div class="nav-dropdown-group">
                <span class="nav-dropdown-label">üè¢ Business & Debt</span>
                <a href="#" onclick="showPage('valuation'); return false;">Valuation</a>
                <a href="#" onclick="showPage('merger'); return false;">M&A Analyzer</a>
                <a href="#" onclick="showPage('runway'); return false;">Startup Runway</a>
                <a href="#" onclick="showPage('debt'); return false;">Debt Payoff</a>
                <a href="#" onclick="showPage('networth'); return false;">Net Worth</a>
                <a href="#" onclick="showPage('compare'); return false;">Compare</a>
              </div>
            </div>
          </div>
        </li>
        <li class="nav-dropdown">
          <a href="#" class="nav-dropdown-trigger" onclick="return false;">Tools <span style="font-size:0.6em;margin-left:2px;">‚ñæ</span></a>
          <div class="nav-dropdown-menu">
            <div class="nav-dropdown-grid">
              <div class="nav-dropdown-group">
                <span class="nav-dropdown-label">üß≠ Interactive</span>
                <a href="quiz.html">Financial Health Quiz</a>
                <a href="benchmarks.html">How Do You Compare?</a>
                <a href="cost-of-living.html">Cost of Living</a>
              </div>
              <div class="nav-dropdown-group">
                <span class="nav-dropdown-label">üìã Resources</span>
                <a href="checklists.html">Life Checklists</a>
                <a href="glossary.html">Financial Glossary</a>
              </div>
            </div>
          </div>
        </li>
        <li><a href="blog/">Blog</a></li>
      </ul>
      
      <div class="nav-actions">
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">‚òÄÔ∏è</button>
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Menu">‚ò∞</button>
      </div>
    </div>
  </nav>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       HOME PAGE ‚Äî CreditGenie-inspired
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <main id="main-content">
  <div class="page active" id="page-home">

    <!-- ‚ïê‚ïê HERO v6 ‚Äî DRAMATIC ‚ïê‚ïê -->
    <section class="figgy-hero" style="position:relative;">
      <div class="hero-mesh-bg"></div>
      <div class="sparkle-container" id="sparkle-container"></div>

      <!-- Parallax floating decorations -->
      <div class="hero-floater parallax-mouse" data-speed="15" style="top:12%;left:6%;opacity:0.2;">
        <svg width="50" height="50" viewBox="0 0 50 50"><circle cx="25" cy="25" r="22" fill="none" stroke="#FF6B6B" stroke-width="2" stroke-dasharray="5 4"/></svg>
      </div>
      <div class="hero-floater parallax-mouse" data-speed="25" style="top:20%;right:8%;opacity:0.15;">
        <svg width="60" height="60" viewBox="0 0 60 60"><circle cx="30" cy="30" r="26" fill="#F5A623" opacity="0.25"/><text x="30" y="37" text-anchor="middle" font-size="22" fill="#F5A623" font-weight="700">$</text></svg>
      </div>
      <div class="hero-floater parallax-mouse" data-speed="10" style="bottom:18%;left:10%;opacity:0.12;">
        <svg width="45" height="45" viewBox="0 0 45 45"><rect x="5" y="5" width="35" height="35" rx="6" fill="none" stroke="#2C087D" stroke-width="2" opacity="0.3"/></svg>
      </div>
      <div class="hero-floater parallax-mouse" data-speed="20" style="bottom:25%;right:5%;opacity:0.15;">
        <svg width="55" height="55" viewBox="0 0 55 55"><polygon points="27,4 34,20 52,22 39,34 42,52 27,44 12,52 15,34 2,22 20,20" fill="none" stroke="#FF6B6B" stroke-width="1.5" opacity="0.35"/></svg>
      </div>

      <div class="figgy-hero-inner">
        <div class="figgy-hero-left">
          <h1 class="hero-huge load-stagger" style="transition-delay:0.1s;">
            Crunch your<br>
            <span class="hero-word-rotator">
              <span class="gradient-text-animated">mortgage</span>
              <span class="gradient-text-animated">taxes</span>
              <span class="gradient-text-animated">investments</span>
              <span class="gradient-text-animated">business valuation</span>
              <span class="gradient-text-animated">mortgage</span>
            </span>
          </h1>
          <p class="load-stagger" style="transition-delay:0.25s;">Free Canadian financial calculators ‚Äî mortgage, tax, business valuation, RRSP vs TFSA, and more. No sign-ups, no nonsense ‚Äî just smart tools that help you make better money decisions.</p>
          <div class="load-stagger" style="display:flex;gap:1rem;flex-wrap:wrap;transition-delay:0.4s;">
            <a href="#tools-section" class="btn btn-primary btn-lg btn-pulse btn-animated" style="min-width:220px;font-size:1.15rem;">
              <span class="btn-text-wrap">
                <span class="btn-initial">Explore Tools ‚Üí</span>
                <span class="btn-hover">Let's go! üê∑</span>
              </span>
            </a>
          </div>
        </div>
        <div class="figgy-hero-right load-stagger" style="transition-delay:0.5s;">
          <!-- Animated SVG piggy bank scene -->
          <div class="hero-scene">
            <svg viewBox="0 0 400 320" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Chart lines (self-drawing) -->
              <polyline class="chart-draw" points="30,250 80,230 130,240 180,200 230,180 280,140 330,100 370,60" stroke="#2C087D" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.3"/>
              <polyline class="chart-draw" style="animation-delay:0.8s" points="30,260 80,255 130,250 180,235 230,220 280,195 330,160 370,120" stroke="#FF6B6B" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" opacity="0.25"/>
              <!-- Grid lines -->
              <line x1="30" y1="280" x2="370" y2="280" stroke="#2C087D" stroke-width="1" opacity="0.1"/>
              <line x1="30" y1="220" x2="370" y2="220" stroke="#2C087D" stroke-width="1" opacity="0.05"/>
              <line x1="30" y1="160" x2="370" y2="160" stroke="#2C087D" stroke-width="1" opacity="0.05"/>
              <!-- Piggy bank (bouncing) -->
              <g class="piggy-bounce">
                <ellipse cx="200" cy="230" rx="70" ry="55" fill="#FF8A8A"/>
                <ellipse cx="200" cy="230" rx="70" ry="55" fill="url(#heroGrad)" opacity="0.4"/>
                <!-- Ears -->
                <ellipse cx="150" cy="185" rx="16" ry="20" fill="#FF8A8A" transform="rotate(-12 150 185)"/>
                <ellipse cx="150" cy="185" rx="11" ry="15" fill="#FFB5B5" transform="rotate(-12 150 185)"/>
                <ellipse cx="250" cy="185" rx="16" ry="20" fill="#FF8A8A" transform="rotate(12 250 185)"/>
                <ellipse cx="250" cy="185" rx="11" ry="15" fill="#FFB5B5" transform="rotate(12 250 185)"/>
                <!-- Coin slot -->
                <rect x="184" y="172" width="32" height="7" rx="3.5" fill="#F5A623"/>
                <rect x="186" y="174" width="28" height="3" rx="1.5" fill="#D4891A"/>
                <!-- Snout -->
                <ellipse cx="200" cy="245" rx="22" ry="16" fill="#FFB5B5"/>
                <circle cx="192" cy="243" r="4" fill="#E88A8A"/>
                <circle cx="208" cy="243" r="4" fill="#E88A8A"/>
                <!-- Eyes -->
                <circle cx="178" cy="218" r="7" fill="#2C087D"/>
                <circle cx="222" cy="218" r="7" fill="#2C087D"/>
                <circle cx="180" cy="216" r="2.5" fill="white"/>
                <circle cx="224" cy="216" r="2.5" fill="white"/>
                <!-- Smile -->
                <path d="M188 255 Q200 265 212 255" stroke="#E88A8A" stroke-width="3" fill="none" stroke-linecap="round"/>
                <!-- Legs -->
                <rect x="163" y="278" width="14" height="16" rx="7" fill="#FF8A8A"/>
                <rect x="223" y="278" width="14" height="16" rx="7" fill="#FF8A8A"/>
                <!-- Tail -->
                <path d="M270 225 Q282 218 278 205 Q275 195 282 188" stroke="#FF8A8A" stroke-width="4" fill="none" stroke-linecap="round"/>
              </g>
              <!-- Floating coins -->
              <g class="coin-float">
                <circle cx="100" cy="140" r="18" fill="#F5A623" opacity="0.9"/>
                <circle cx="100" cy="140" r="13" fill="none" stroke="#D4891A" stroke-width="1.5"/>
                <text x="100" y="146" text-anchor="middle" font-size="16" fill="#8B6914" font-weight="700">$</text>
              </g>
              <g class="coin-float-2">
                <circle cx="310" cy="90" r="14" fill="#F5A623" opacity="0.8"/>
                <circle cx="310" cy="90" r="10" fill="none" stroke="#D4891A" stroke-width="1"/>
                <text x="310" y="95" text-anchor="middle" font-size="12" fill="#8B6914" font-weight="700">$</text>
              </g>
              <g class="coin-float-3">
                <circle cx="70" cy="80" r="11" fill="#F5A623" opacity="0.7"/>
                <text x="70" y="85" text-anchor="middle" font-size="10" fill="#8B6914" font-weight="700">$</text>
              </g>
              <!-- Dollar signs floating -->
              <text class="dollar-fade" x="340" y="180" font-size="20" fill="#2C087D" opacity="0.4" font-weight="700">$</text>
              <text class="dollar-fade-2" x="55" y="200" font-size="16" fill="#FF6B6B" opacity="0.3" font-weight="700">$</text>
              <text class="dollar-fade-3" x="290" y="260" font-size="14" fill="#F5A623" opacity="0.3" font-weight="700">$</text>
              <defs>
                <linearGradient id="heroGrad" x1="130" y1="175" x2="270" y2="285">
                  <stop offset="0%" stop-color="#FFD4D4"/>
                  <stop offset="100%" stop-color="#FF6B6B" stop-opacity="0.3"/>
                </linearGradient>
              </defs>
            </svg>
          </div>
        </div>
      </div>
    </section>

    <!-- ‚ïê‚ïê FEATURED CALCULATORS ‚Äî Interactive Tabbed Showcase ‚ïê‚ïê -->
    <div class="section-white" style="position:relative;overflow:hidden;">
      <!-- Floating 3D shapes -->
      <div class="floating-shape parallax-mouse" data-speed="30" style="top:10%;left:5%;"><div class="shape-sphere" style="width:50px;height:50px;"></div></div>
      <div class="floating-shape parallax-mouse" data-speed="20" style="top:60%;right:3%;"><div class="shape-cube"><div style="width:40px;height:40px;background:rgba(44,8,125,0.08);border:1px solid rgba(44,8,125,0.15);border-radius:4px;"></div></div></div>
      <div class="floating-shape parallax-mouse" data-speed="15" style="bottom:15%;left:8%;"><div class="shape-sphere" style="width:35px;height:35px;background:radial-gradient(circle at 30% 30%,rgba(245,166,35,0.25),rgba(255,107,107,0.1));"></div></div>

      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">‚ú® Featured Calculators</div>
          <h2 class="section-title js-show">Powerful tools,<br>ridiculously simple</h2>
        </div>

        <!-- Tabs -->
        <div class="showcase-tabs js-show">
          <button class="showcase-tab active" onclick="switchShowcase('mortgage')">üè† Mortgage</button>
          <button class="showcase-tab" onclick="switchShowcase('valuation')">üè¢ Business Valuation</button>
          <button class="showcase-tab" onclick="switchShowcase('tax')">üßæ Tax</button>
          <button class="showcase-tab" onclick="switchShowcase('ma')">ü§ù M&A</button>
        </div>

        <!-- Glassmorphism showcase card -->
        <div class="glass-showcase js-show" id="showcase-card">
          <!-- Mortgage Panel -->
          <div class="showcase-panel active" id="showcase-mortgage">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">Canadian Mortgage Calculator</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">The only mortgage calculator that actually does Canadian semi-annual compounding correctly. CMHC, stress test, and land transfer tax built in.</p>
                <ul class="feature-bullets">
                  <li>Semi-annual compounding (as required by law)</li>
                  <li>CMHC insurance premiums</li>
                  <li>OSFI B-20 stress test</li>
                  <li>Provincial land transfer taxes</li>
                </ul>
                <a href="#" onclick="showPage('mortgage'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:4px;align-items:flex-end;height:140px;padding:1rem;background:rgba(44,8,125,0.03);border-radius:var(--radius-lg);">
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="55%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="70%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="45%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="80%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="65%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#FF6B6B,rgba(255,107,107,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="95%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="85%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#2C087D,rgba(44,8,125,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="60%"></div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">Monthly Payment</div>
                  <div class="viz-number count-up" data-count-up="3584" data-suffix="" style="font-size:2.25rem;font-weight:900;background:linear-gradient(135deg,#2C087D,#FF6B6B);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">$3,584</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Valuation Panel -->
          <div class="showcase-panel" id="showcase-valuation">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">Business Valuation</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">Three professional valuation methods ‚Äî DCF, comparable multiples, and asset-based approaches. Sensitivity tables included.</p>
                <ul class="feature-bullets">
                  <li>5-year DCF with terminal value</li>
                  <li>Industry-specific multiples</li>
                  <li>Sensitivity analysis tables</li>
                  <li>Professional PDF export</li>
                </ul>
                <a href="#" onclick="showPage('valuation'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:4px;align-items:flex-end;height:140px;padding:1rem;background:rgba(99,102,241,0.03);border-radius:var(--radius-lg);">
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="40%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="55%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="65%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#6366f1,rgba(99,102,241,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="75%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#8b5cf6,rgba(139,92,246,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="100%"></div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">Enterprise Value</div>
                  <div class="viz-number" style="font-size:2.25rem;font-weight:900;background:linear-gradient(135deg,#6366f1,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;">$8.2M</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tax Panel -->
          <div class="showcase-panel" id="showcase-tax">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">Canadian Tax Estimator</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">Federal + provincial tax calculations with all Canadian-specific brackets. See exactly where your money goes.</p>
                <ul class="feature-bullets">
                  <li>2025/2026 federal & provincial brackets</li>
                  <li>CPP, EI, and basic personal amount</li>
                  <li>Marginal vs effective rate breakdown</li>
                  <li>Compare across provinces</li>
                </ul>
                <a href="#" onclick="showPage('tax'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:6px;align-items:flex-end;height:140px;padding:1rem;background:rgba(239,68,68,0.03);border-radius:var(--radius-lg);">
                  <div style="flex:1;display:flex;flex-direction:column;gap:2px;justify-content:flex-end;height:100%;">
                    <div class="viz-bar" style="background:#ef4444;border-radius:4px;height:0;" data-target-height="35%"></div>
                    <div class="viz-bar" style="background:#f59e0b;border-radius:4px;height:0;" data-target-height="20%"></div>
                    <div class="viz-bar" style="background:#10b981;border-radius:4px;height:0;" data-target-height="45%"></div>
                  </div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">Effective Rate</div>
                  <div class="viz-number" style="font-size:2.25rem;font-weight:900;color:#ef4444;">28.7%</div>
                </div>
              </div>
            </div>
          </div>

          <!-- M&A Panel -->
          <div class="showcase-panel" id="showcase-ma">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:3rem;align-items:center;">
              <div>
                <h3 style="font-size:1.5rem;margin-bottom:0.75rem;">M&A Deal Analyzer</h3>
                <p style="color:var(--text-secondary);margin-bottom:1.25rem;">Model accretion/dilution, financing mix, and synergy impact. The same analysis investment banks charge thousands for.</p>
                <ul class="feature-bullets">
                  <li>Accretion/dilution analysis</li>
                  <li>Cash, stock, and mixed financing</li>
                  <li>Synergy modeling</li>
                  <li>Sensitivity tables</li>
                </ul>
                <a href="#" onclick="showPage('merger'); return false;" class="btn btn-primary" style="margin-top:1.25rem;">Try it ‚Üí</a>
              </div>
              <div>
                <div style="display:flex;gap:4px;align-items:flex-end;height:140px;padding:1rem;background:rgba(16,185,129,0.03);border-radius:var(--radius-lg);">
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="50%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="62%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="78%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.5));border-radius:4px 4px 0 0;height:0;" data-target-height="90%"></div>
                  <div class="viz-bar" style="flex:1;background:linear-gradient(to top,#10b981,rgba(16,185,129,0.6));border-radius:4px 4px 0 0;height:0;" data-target-height="100%"></div>
                </div>
                <div style="text-align:center;margin-top:1rem;">
                  <div style="font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;font-weight:600;">EPS Impact</div>
                  <div class="viz-number" style="font-size:2.25rem;font-weight:900;color:#10b981;">+12.4% Accretive</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê ALL TOOLS GRID ‚ïê‚ïê -->
    <div class="section-cream" id="tools-section">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üßÆ All Tools</div>
          <h2 class="section-title js-show">Every calculator you need</h2>
          <p class="section-desc js-show">20 professional-grade tools, zero price tag.</p>
        </div>

        <div class="tools-category-label js-show" style="display:flex;align-items:center;gap:0.75rem;"><span style="width:30px;height:2px;background:var(--fg-coral);display:inline-block;flex-shrink:0;"></span>Business & M&A<span style="flex:1;height:1px;background:var(--border-primary);"></span></div>
        <div class="tools-grid">
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('valuation')">
            <div class="tool-icon" style="background:rgba(44,8,125,0.08);">üè¢</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Business Valuation</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">DCF, multiples & asset-based approaches</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('merger')">
            <div class="tool-icon" style="background:rgba(139,92,246,0.08);">ü§ù</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">M&A Deal Analyzer</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Accretion/dilution & financing mix</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('runway')">
            <div class="tool-icon" style="background:rgba(168,85,247,0.08);">üöÄ</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Startup Runway</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Burn rate, hiring & fundraising timing</p>
            <span class="card-arrow">‚Üí</span>
          </div>
        </div>

        <div class="tools-category-label js-show" style="display:flex;align-items:center;gap:0.75rem;"><span style="width:30px;height:2px;background:var(--fg-coral);display:inline-block;flex-shrink:0;"></span>Personal Finance<span style="flex:1;height:1px;background:var(--border-primary);"></span></div>
        <div class="tools-grid">
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('mortgage')">
            <div class="tool-icon" style="background:rgba(6,182,212,0.08);">üè†</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Canadian Mortgage</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Semi-annual compounding, CMHC, stress test</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('investment')">
            <div class="tool-icon" style="background:rgba(16,185,129,0.08);">üìà</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Investment Returns</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">CAGR, DCA & portfolio growth</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('compound')">
            <div class="tool-icon" style="background:rgba(236,72,153,0.08);">üìä</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Compound Interest</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Visualize the power of compounding</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('networth')">
            <div class="tool-icon" style="background:rgba(34,197,94,0.08);">üí∞</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Net Worth Tracker</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Track assets, liabilities & progress</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('salary')">
            <div class="tool-icon" style="background:rgba(20,184,166,0.08);">üíº</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Salary & Compensation</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Total comp, take-home & benefits</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('debt')">
            <div class="tool-icon" style="background:rgba(239,68,68,0.08);">üí≥</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Debt Payoff</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Snowball, avalanche & payoff timeline</p>
            <span class="card-arrow">‚Üí</span>
          </div>
        </div>

        <div class="tools-category-label js-show" style="display:flex;align-items:center;gap:0.75rem;"><span style="width:30px;height:2px;background:var(--fg-coral);display:inline-block;flex-shrink:0;"></span>Tax & Planning<span style="flex:1;height:1px;background:var(--border-primary);"></span></div>
        <div class="tools-grid">
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('retirement')">
            <div class="tool-icon" style="background:rgba(245,158,11,0.08);">üè¶</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">RRSP vs TFSA</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Compare tax-advantaged accounts</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('tax')">
            <div class="tool-icon" style="background:rgba(239,68,68,0.08);">üßæ</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Canadian Tax Estimator</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Federal + provincial brackets</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('lease')">
            <div class="tool-icon" style="background:rgba(245,158,11,0.08);">üöó</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Lease vs Buy</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Total cost comparison over time</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('currency')">
            <div class="tool-icon" style="background:rgba(20,184,166,0.08);">üí±</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Currency Converter</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Live exchange rates</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('compare')">
            <div class="tool-icon" style="background:rgba(168,85,247,0.08);">‚öñÔ∏è</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Side-by-Side Compare</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Compare any two financial options</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('fhsa')">
            <div class="tool-icon" style="background:rgba(34,197,94,0.08);">üè†</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">FHSA Calculator</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">First home savings with tax benefits</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('resp')">
            <div class="tool-icon" style="background:rgba(139,92,246,0.08);">üéì</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">RESP Calculator</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Education savings with government grants</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('rentbuy')">
            <div class="tool-icon" style="background:rgba(245,158,11,0.08);">üèòÔ∏è</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Rent vs Buy</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Should you rent or buy? Full analysis</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('gic')">
            <div class="tool-icon" style="background:rgba(16,185,129,0.08);">ü™ú</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">GIC Ladder</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Build a GIC ladder for steady returns</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('cpp')">
            <div class="tool-icon" style="background:rgba(239,68,68,0.08);">üá®üá¶</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">CPP/OAS Calculator</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">Retirement benefits & income planning</p>
            <span class="card-arrow">‚Üí</span>
          </div>
          <div class="tool-card" style="opacity:0;transform:translateY(30px)" onclick="showPage('capgains')">
            <div class="tool-icon" style="background:rgba(236,72,153,0.08);">üìä</div>
            <h4 style="font-size:0.95rem;margin-bottom:0.25rem;">Capital Gains Tax</h4>
            <p style="font-size:0.8rem;color:var(--text-secondary);">2024+ inclusion rates calculator</p>
            <span class="card-arrow">‚Üí</span>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê HOW IT WORKS ‚Äî Animated Timeline ‚ïê‚ïê -->
    <div class="section-white">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üéØ How It Works</div>
          <h2 class="section-title js-show">Three steps. Zero friction.</h2>
        </div>
        <div class="hiw-timeline" id="hiw-timeline" style="display:grid;grid-template-columns:repeat(3,1fr);gap:2rem;position:relative;">
          <div class="hiw-timeline-line" id="hiw-line"></div>
          <div class="hiw-step-enhanced js-show">
            <div class="hiw-step-icon">
              <svg width="40" height="40" viewBox="0 0 40 40"><rect x="4" y="8" width="32" height="24" rx="4" fill="none" stroke="#2C087D" stroke-width="2.5"/><circle cx="20" cy="20" r="6" fill="#FF6B6B" opacity="0.3"/><path d="M14 20h12M20 14v12" stroke="#2C087D" stroke-width="2" stroke-linecap="round"/></svg>
            </div>
            <div style="font-size:0.75rem;color:var(--fg-coral);font-weight:800;letter-spacing:0.1em;margin-bottom:0.5rem;">STEP 01</div>
            <h3 style="font-size:1.1rem;margin-bottom:0.5rem;">Pick your calculator</h3>
            <p style="font-size:0.9rem;color:var(--text-secondary);">Browse 20+ financial tools ‚Äî from mortgage to M&A, we've got you covered.</p>
          </div>
          <div class="hiw-step-enhanced js-show js-show-up-20">
            <div class="hiw-step-icon">
              <svg width="40" height="40" viewBox="0 0 40 40"><rect x="8" y="4" width="24" height="32" rx="3" fill="none" stroke="#2C087D" stroke-width="2.5"/><line x1="13" y1="12" x2="27" y2="12" stroke="#FF6B6B" stroke-width="2" stroke-linecap="round"/><line x1="13" y1="18" x2="23" y2="18" stroke="#2C087D" stroke-width="1.5" stroke-linecap="round" opacity="0.4"/><line x1="13" y1="24" x2="25" y2="24" stroke="#2C087D" stroke-width="1.5" stroke-linecap="round" opacity="0.4"/><circle cx="27" cy="28" r="5" fill="#F5A623" opacity="0.3"/><path d="M25 28l2 2 3-4" stroke="#F5A623" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <div style="font-size:0.75rem;color:var(--fg-coral);font-weight:800;letter-spacing:0.1em;margin-bottom:0.5rem;">STEP 02</div>
            <h3 style="font-size:1.1rem;margin-bottom:0.5rem;">Punch in your numbers</h3>
            <p style="font-size:0.9rem;color:var(--text-secondary);">Easy inputs with smart defaults. Watch results update in real time.</p>
          </div>
          <div class="hiw-step-enhanced js-show js-show-up-40">
            <div class="hiw-step-icon">
              <svg width="40" height="40" viewBox="0 0 40 40"><path d="M6 30 L14 18 L22 24 L34 8" stroke="#2C087D" stroke-width="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/><circle cx="34" cy="8" r="4" fill="#10b981" opacity="0.4"/><path d="M30 8h4v4" stroke="#10b981" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/><rect x="4" y="32" width="32" height="2" rx="1" fill="#2C087D" opacity="0.15"/></svg>
            </div>
            <div style="font-size:0.75rem;color:var(--fg-coral);font-weight:800;letter-spacing:0.1em;margin-bottom:0.5rem;">STEP 03</div>
            <h3 style="font-size:1.1rem;margin-bottom:0.5rem;">Make better decisions</h3>
            <p style="font-size:0.9rem;color:var(--text-secondary);">Export PDF reports, compare scenarios, and act with confidence.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê NUMBERS DON'T LIE ‚ïê‚ïê -->
    <div class="section-cream">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üìä Numbers Don't Lie</div>
          <h2 class="section-title js-show">The proof is in the pudding</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card js-show">
            <div class="stat-bg-element">üßÆ</div>
            <div class="stat-number count-up" data-count-up="14" data-suffix="+">0</div>
            <div class="stat-label">Calculators</div>
          </div>
          <div class="stat-card js-show js-show-up-10">
            <div class="stat-bg-element">üí∞</div>
            <div class="stat-number count-up" data-count-up="100" data-suffix="%">0</div>
            <div class="stat-label">Free Forever</div>
          </div>
          <div class="stat-card js-show js-show-up-20">
            <div class="stat-bg-element">üîí</div>
            <div class="stat-number" style="font-size:clamp(2.5rem,5vw,4rem);">0</div>
            <div class="stat-label">Data Stored</div>
          </div>
          <div class="stat-card js-show js-show-up-30">
            <div class="stat-bg-element">üçÅ</div>
            <div class="stat-number" style="font-size:clamp(2rem,4vw,3rem);">üá®üá¶</div>
            <div class="stat-label">Canadian-Built</div>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê TRUST / FEATURES ‚Äî Glassmorphism v6 ‚ïê‚ïê -->
    <div class="section-white">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üí™ Why FiggyBank</div>
          <h2 class="section-title js-show">Built different. Built for you.</h2>
        </div>
        <div class="trust-grid">
          <div class="trust-card-v6 js-show">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <rect x="10" y="20" width="50" height="32" rx="3" fill="#ef4444" opacity="0.15"/>
                <g class="flag-wave">
                  <rect x="15" y="22" width="44" height="28" rx="2" fill="white"/>
                  <rect x="15" y="22" width="12" height="28" fill="#ef4444"/>
                  <rect x="47" y="22" width="12" height="28" fill="#ef4444"/>
                  <path d="M37 26 L38.5 30 L42 29 L40 32 L44 33 L40.5 35 L41.5 39 L37 37 L32.5 39 L33.5 35 L30 33 L34 32 L32 29 L35.5 30Z" fill="#ef4444"/>
                </g>
                <rect x="10" y="20" width="3" height="40" rx="1.5" fill="#666"/>
              </svg>
            </div>
            <h4>Canadian-First</h4>
            <p>Built for Canadian tax brackets, CMHC rules, RRSP limits, and semi-annual mortgage compounding.</p>
          </div>
          <div class="trust-card-v6 js-show js-show-up-10">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <g class="lock-click">
                  <rect x="22" y="38" width="36" height="28" rx="5" fill="#2C087D" opacity="0.9"/>
                  <path d="M28 38V28a12 12 0 0 1 24 0v10" stroke="#2C087D" stroke-width="4" fill="none" stroke-linecap="round"/>
                  <circle cx="40" cy="50" r="4" fill="white"/>
                  <rect x="38" y="52" width="4" height="6" rx="2" fill="white"/>
                </g>
              </svg>
            </div>
            <h4>Privacy-First</h4>
            <p>All calculations run in your browser. Nothing stored. Nothing sent. Your numbers never leave your device.</p>
          </div>
          <div class="trust-card-v6 js-show js-show-up-20">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <g class="coins-stack">
                  <ellipse cx="40" cy="55" rx="22" ry="7" fill="#F5A623" opacity="0.6"/>
                  <ellipse cx="40" cy="48" rx="22" ry="7" fill="#F5A623" opacity="0.7"/>
                  <ellipse cx="40" cy="41" rx="22" ry="7" fill="#F5A623" opacity="0.8"/>
                  <ellipse cx="40" cy="34" rx="22" ry="7" fill="#F5A623"/>
                  <text x="40" y="38" text-anchor="middle" font-size="12" fill="#8B6914" font-weight="700">$</text>
                </g>
              </svg>
            </div>
            <h4>Always Free</h4>
            <p>No accounts, no paywalls, no BS. Just open the page and start crunching numbers.</p>
          </div>
          <div class="trust-card-v6 js-show js-show-up-30">
            <div class="trust-svg-icon">
              <svg viewBox="0 0 80 80" fill="none">
                <g class="page-turn">
                  <rect x="15" y="12" width="40" height="52" rx="3" fill="white" stroke="#ddd" stroke-width="1.5"/>
                  <rect x="25" y="12" width="40" height="52" rx="3" fill="white" stroke="#ccc" stroke-width="1.5"/>
                  <line x1="32" y1="24" x2="58" y2="24" stroke="#2C087D" stroke-width="2" opacity="0.3" stroke-linecap="round"/>
                  <line x1="32" y1="32" x2="55" y2="32" stroke="#2C087D" stroke-width="2" opacity="0.2" stroke-linecap="round"/>
                  <line x1="32" y1="40" x2="52" y2="40" stroke="#2C087D" stroke-width="2" opacity="0.15" stroke-linecap="round"/>
                  <rect x="32" y="48" width="20" height="8" rx="2" fill="#FF6B6B" opacity="0.15"/>
                  <text x="42" y="55" text-anchor="middle" font-size="6" fill="#FF6B6B" font-weight="700">PDF</text>
                </g>
              </svg>
            </div>
            <h4>Export Ready</h4>
            <p>Professional PDF reports for client meetings, boardrooms, or your own records.</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê FROM THE BLOG ‚ïê‚ïê -->
    <div class="section-cream">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">üìù From the Blog</div>
          <h2 class="section-title js-show">Smart money insights</h2>
          <p class="section-desc js-show">Canadian personal finance guides, strategies, and calculators explained.</p>
        </div>
        
        <div class="blog-cards-grid js-show" id="homepage-blog-cards">
          <!-- Blog cards loaded via JavaScript -->
        </div>
        
        <div style="text-align: center;">
          <a href="blog/" class="view-all-blog js-show">
            View All Articles
            <span>‚Üí</span>
          </a>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê SEO CONTENT ‚Äî CALCULATOR DESCRIPTIONS ‚ïê‚ïê -->
    <div class="section-cream">
      <section class="section">
        <div class="section-header">
          <h2 class="section-title js-show" style="font-size:clamp(1.5rem,3vw,2rem);">Learn More About Our Calculators</h2>
          <p class="section-desc js-show" style="max-width:700px;margin:0 auto 1.5rem;font-size:0.95rem;">Over 20 professional-grade financial calculators designed specifically for Canadians.</p>
        </div>

        <details style="max-width:1100px;margin:0 auto;">
          <summary style="cursor:pointer;display:flex;align-items:center;justify-content:center;gap:0.5rem;padding:0.875rem 1.75rem;background:var(--bg-card);border:1px solid var(--border-primary);border-radius:var(--radius-full);font-weight:600;font-size:0.9rem;color:var(--text-primary);margin:0 auto 2rem;width:fit-content;transition:all 0.3s ease;">
            <span>Explore all 20+ calculators</span>
            <span style="transition:transform 0.3s ease;">‚ñæ</span>
          </summary>

        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(min(320px,100%),1fr));gap:2rem;animation:fadeInUp 0.4s ease both;">
          
          <!-- Mortgage & Home Buying -->
          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üè†</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">Canadian Mortgage Calculator</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Calculate your monthly mortgage payment with accurate Canadian semi-annual compounding, CMHC insurance for high-ratio mortgages, provincial land transfer tax, and OSFI B-20 stress test qualification. Essential for every Canadian home buyer.</p>
          </div>

          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üéØ</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">FHSA Calculator ‚Äî First Home Savings Account</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">The First Home Savings Account (FHSA) lets Canadians save up to $40,000 tax-free for their first home. Contributions are tax-deductible like an RRSP, and withdrawals for a first home purchase are tax-free like a TFSA. Plan your contributions and maximize this powerful savings vehicle.</p>
          </div>

          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üèòÔ∏è</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">Rent vs Buy Calculator for Canada</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Should you rent or buy a home? Compare the true total cost of renting vs buying including mortgage payments, property taxes, maintenance, opportunity cost of your down payment, home appreciation, and investment returns. Make an informed decision based on your local market.</p>
          </div>

          <!-- Education & Family -->
          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üéì</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">RESP Calculator with CESG Grants</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Plan your child's education with a Registered Education Savings Plan (RESP). Our calculator includes Canada Education Savings Grant (CESG) matching ‚Äî get 20% on the first $2,500 you contribute each year. Maximize free government money for your child's future.</p>
          </div>

          <!-- Tax & Retirement Planning -->
          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üßæ</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">Canadian Tax Calculator 2026</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Estimate your 2026 federal and provincial income tax with up-to-date tax brackets for all 10 provinces and 3 territories. Includes CPP2 contributions, EI premiums, RRSP deductions, and basic personal amount. Essential for tax planning and salary negotiations.</p>
          </div>

          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üìä</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">Capital Gains Tax Calculator Canada</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Calculate capital gains tax on stocks, real estate, and investment property sales. Understand the 50% inclusion rate, principal residence exemption, and how capital gains affect your tax bill. Essential for investors and property owners across Canada.</p>
          </div>

          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üè¶</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">RRSP vs TFSA Optimizer</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Should you contribute to your RRSP or TFSA first? Compare tax-sheltered growth side-by-side based on your current tax bracket, expected retirement income, and contribution room. Maximize your Canadian retirement savings with the right strategy.</p>
          </div>

          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üë¥</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">CPP and OAS Calculator</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Estimate your Canada Pension Plan (CPP) and Old Age Security (OAS) retirement benefits. Compare taking CPP early at 60 vs waiting until 70 for a 42% increase. Plan when to start your government pensions to maximize lifetime income.</p>
          </div>

          <!-- Investment & Savings -->
          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üíé</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">GIC Ladder Calculator</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Build a GIC ladder strategy with staggered maturity dates to balance higher interest rates with liquidity. Perfect for conservative Canadian investors who want guaranteed returns with regular access to funds.</p>
          </div>

          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üìà</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">Compound Interest Calculator</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Visualize the power of compound interest over time. See how regular contributions and time in the market can grow your wealth. Perfect for TFSA planning, RRSP projections, and long-term investment strategies.</p>
          </div>

          <!-- Debt Management -->
          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üí≥</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">Debt Payoff Calculator ‚Äî Avalanche vs Snowball</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Compare debt payoff strategies for credit cards, student loans, and lines of credit. The avalanche method minimizes interest; the snowball method builds momentum. Find the best strategy to become debt-free faster.</p>
          </div>

          <!-- Business & M&A -->
          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">üè¢</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">Business Valuation Calculator for Canada</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Value a small business using DCF (discounted cash flow), comparable multiples (EBITDA, revenue), and asset-based approaches. Includes industry rules of thumb and goodwill calculations. Essential for Canadian business owners, buyers, and M&A professionals.</p>
          </div>

          <div class="glass-card" style="padding:2rem;">
            <div style="font-size:2rem;margin-bottom:1rem;">ü§ù</div>
            <h3 style="font-size:1.25rem;font-weight:700;color:var(--text-primary);margin-bottom:0.75rem;">M&A Deal Analyzer</h3>
            <p style="color:var(--text-secondary);line-height:1.6;">Analyze mergers and acquisitions with accretion/dilution modeling, financing mix optimization, and synergy calculations. Model all-cash, all-stock, and mixed consideration deals. Professional-grade M&A analysis for Canadian transactions.</p>
          </div>

        </div>

        <div style="margin-top:3rem;text-align:center;padding:2.5rem;background:linear-gradient(135deg,rgba(44,8,125,0.03),rgba(255,107,107,0.02));border-radius:var(--radius-lg);border:1px solid var(--border-primary);">
          <p style="font-size:1.1rem;color:var(--text-secondary);line-height:1.7;max-width:700px;margin:0 auto;">All calculators are <strong style="color:var(--text-primary);">100% free, no sign-up required</strong>, and <strong style="color:var(--text-primary);">fully privacy-protected</strong> ‚Äî all calculations run in your browser. Your financial data never leaves your device.</p>
        </div>
        </details>
      </section>
    </div>

    <!-- ‚ïê‚ïê FAQ ‚ïê‚ïê -->
    <div class="section-white">
      <section class="section">
        <div class="section-header">
          <div class="section-label js-show">‚ùì FAQ</div>
          <h2 class="section-title js-show">Got questions?</h2>
        </div>
        <div class="faq-list">
          <div class="accordion-item js-show">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Is FiggyBank really free?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Yes, 100% free. All 20+ calculators are available without creating an account or paying anything. We believe everyone deserves access to quality financial tools.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-10">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Is my data safe?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Absolutely. All calculations run entirely in your browser using JavaScript. No data is sent to any server. Your financial numbers never leave your device. We don't even have a database.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-20">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>How accurate are the Canadian mortgage calculations?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Our mortgage calculator uses Canadian semi-annual compounding as required by law, includes CMHC insurance premiums for high-ratio mortgages, provincial land transfer taxes, and OSFI B-20 stress test calculations. Results match major bank calculators.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-30">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Should I choose RRSP or TFSA?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">It depends on your current vs. expected retirement tax rate. Generally, RRSP is better if your current tax rate is higher than your expected retirement rate. Use our RRSP vs TFSA Optimizer to compare based on your specific situation ‚Äî it'll show you the exact dollar difference.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-40">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Can I export results as PDF?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">Yes! Most calculators have an "Export PDF" button that generates a professional report with your inputs, results, and charts. Great for client meetings, personal records, or sharing with your financial advisor.</div>
            </div>
          </div>
          <div class="accordion-item js-show js-show-up-50">
            <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
              <span>Are the tax brackets up to date?</span>
              <span class="accordion-arrow">‚ñæ</span>
            </div>
            <div class="accordion-body">
              <div class="accordion-body-inner">We update federal and provincial tax brackets annually. The current calculator reflects 2025/2026 Canadian tax rates, CPP/EI contributions, and basic personal amounts for all provinces and territories.</div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê CTA BANNER ‚ïê‚ïê -->
    <div class="cta-banner">
      <div style="max-width:700px;margin:0 auto;position:relative;">
        <div style="font-size:4rem;margin-bottom:1rem;">üê∑</div>
        <h2>Ready to crunch some numbers?</h2>
        <p>20+ free calculators. Zero sign-ups. 100% Canadian.</p>
        <a href="#tools-section" class="btn" style="background:white;color:#2C087D;font-weight:700;padding:1rem 2.5rem;border-radius:var(--radius-full);font-size:1.1rem;position:relative;z-index:1;">Explore All Tools ‚Üí</a>
      </div>
    </div>

    <!-- ‚ïê‚ïê FOOTER v6 ‚ïê‚ïê -->
    <!-- ‚ïê‚ïê CONTACT US ‚ïê‚ïê -->
    <section id="contact-section" style="padding:4rem 1.5rem;background:var(--bg-primary);">
      <div style="max-width:600px;margin:0 auto;">
        <h2 class="js-show" style="text-align:center;font-size:clamp(1.5rem,3vw,2.25rem);font-weight:900;color:var(--text-primary);margin-bottom:0.5rem;">Get in Touch</h2>
        <p class="js-show js-show-up-10" style="text-align:center;color:var(--text-secondary);margin-bottom:2rem;">Have a question, suggestion, or just want to say hi? Drop us a line.</p>
        <form class="js-show js-show-up-20" action="https://formsubmit.co/rajankchopra@gmail.com" method="POST" style="display:flex;flex-direction:column;gap:1rem;">
          <input type="hidden" name="_subject" value="FiggyBank Contact Form">
          <input type="hidden" name="_captcha" value="true">
          <input type="hidden" name="_template" value="table">
          <input type="hidden" name="_next" value="https://figgybank.ca/">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
            <div>
              <label style="display:block;font-size:0.8rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">Name</label>
              <input type="text" name="name" required placeholder="Your name" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--border-primary);border-radius:var(--radius-md);background:var(--bg-card);color:var(--text-primary);font-size:0.9rem;transition:border-color 0.3s;outline:none;" onfocus="this.style.borderColor='var(--fg-purple)'" onblur="this.style.borderColor='var(--border-primary)'">
            </div>
            <div>
              <label style="display:block;font-size:0.8rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">Email</label>
              <input type="email" name="email" required placeholder="you@example.com" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--border-primary);border-radius:var(--radius-md);background:var(--bg-card);color:var(--text-primary);font-size:0.9rem;transition:border-color 0.3s;outline:none;" onfocus="this.style.borderColor='var(--fg-purple)'" onblur="this.style.borderColor='var(--border-primary)'">
            </div>
          </div>
          <div>
            <label style="display:block;font-size:0.8rem;font-weight:600;color:var(--text-primary);margin-bottom:0.25rem;">Message</label>
            <textarea name="message" required rows="4" placeholder="What's on your mind?" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--border-primary);border-radius:var(--radius-md);background:var(--bg-card);color:var(--text-primary);font-size:0.9rem;resize:vertical;font-family:inherit;transition:border-color 0.3s;outline:none;" onfocus="this.style.borderColor='var(--fg-purple)'" onblur="this.style.borderColor='var(--border-primary)'"></textarea>
          </div>
          <button type="submit" style="padding:0.85rem 2rem;background:var(--fg-purple);color:white;border:none;border-radius:var(--radius-md);font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.3s;align-self:flex-start;" onmouseover="this.style.background='var(--fg-purple-light)';this.style.transform='translateY(-2px)'" onmouseout="this.style.background='var(--fg-purple)';this.style.transform='translateY(0)'">Send Message ‚Üí</button>
        </form>
      </div>
    </section>

    <footer class="figgy-footer-v6">
      <div style="max-width:800px;margin:0 auto;position:relative;z-index:1;">
        <div style="margin-bottom:1.5rem;">
          <svg width="56" height="56" viewBox="0 0 64 64" fill="none">
            <ellipse cx="32" cy="36" rx="22" ry="18" fill="#FF8A8A"/>
            <ellipse cx="16" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(-15 16 22)"/>
            <ellipse cx="48" cy="22" rx="6" ry="7" fill="#FF8A8A" transform="rotate(15 48 22)"/>
            <rect x="26" y="19" width="12" height="3" rx="1.5" fill="#F5A623"/>
            <ellipse cx="32" cy="40" rx="8" ry="6" fill="#FFB5B5"/>
            <circle cx="29" cy="39.5" r="1.5" fill="#E88A8A"/>
            <circle cx="35" cy="39.5" r="1.5" fill="#E88A8A"/>
            <circle cx="24" cy="32" r="2.5" fill="white"/>
            <circle cx="40" cy="32" r="2.5" fill="white"/>
            <circle cx="25" cy="31" r="1" fill="#2C087D"/>
            <circle cx="41" cy="31" r="1" fill="#2C087D"/>
          </svg>
        </div>
        <h2 style="color:white;font-size:clamp(1.75rem,3.5vw,2.5rem);margin-bottom:1rem;">Your money. Your math. Your move.</h2>
        <p style="color:rgba(255,255,255,0.55);margin-bottom:2rem;font-size:1.05rem;">Smart money moves made simple ‚Äî start crunching numbers today.</p>
        <div style="display:flex;gap:2rem;justify-content:center;flex-wrap:wrap;margin-bottom:2.5rem;">
          <a href="#" onclick="document.getElementById('tools-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Business & M&A</a>
          <a href="#" onclick="document.getElementById('tools-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Personal Finance</a>
          <a href="#" onclick="document.getElementById('tools-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Tax & Planning</a>
          <a href="#contact-section" onclick="document.getElementById('contact-section').scrollIntoView({behavior:'smooth'});return false;" style="color:rgba(255,255,255,0.6);text-decoration:none;font-size:0.85rem;transition:color 0.3s;">Contact Us</a>
        </div>
        <div style="border-top:1px solid rgba(255,255,255,0.08);padding-top:1.5rem;">
          <p style="font-size:0.7rem;color:rgba(255,255,255,0.3);max-width:600px;margin:0 auto 1rem;line-height:1.6;">‚ö†Ô∏è <strong>Disclaimer:</strong> All calculations provided by FiggyBank are for illustrative and educational purposes only. They do not constitute financial, tax, legal, or investment advice. Always verify results independently and consult a qualified professional before making financial decisions.</p>
          <p style="font-size:0.8rem;color:rgba(255,255,255,0.35);">Built with ‚ù§Ô∏è in Canada üá®üá¶</p>
          <p style="margin-top:0.5rem;font-size:0.8rem;color:rgba(255,255,255,0.35);">¬© 2026 FiggyBank</p>
        </div>
      </div>
    </footer>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CALCULATOR PAGES (preserved from original)
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-valuation" role="region" aria-label="Business Valuation Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè¢</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Business Valuation Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Estimate business value using DCF, comparable multiples, and asset-based approaches.</p>
      </div>
      
      <!-- Method Tabs -->
      <div class="tabs" style="max-width: 400px; margin: 2rem auto;" id="val-tabs">
        <button class="tab active" onclick="switchValTab('dcf')">DCF</button>
        <button class="tab" onclick="switchValTab('multiples')">Multiples</button>
        <button class="tab" onclick="switchValTab('asset')">Asset-Based</button>
      </div>
      
      <!-- Action Buttons -->
      <div class="action-buttons" style="justify-content: center; margin-bottom: 1rem;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport(document.getElementById('val-dcf').style.display!=='none'?'Business Valuation (DCF)':document.getElementById('val-multiples').style.display!=='none'?'Business Valuation (Multiples)':'Business Valuation (Asset-Based)')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults(document.getElementById('val-dcf').style.display!=='none'?'Business Valuation (DCF)':document.getElementById('val-multiples').style.display!=='none'?'Business Valuation (Multiples)':'Business Valuation (Asset-Based)')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('valuation')">üîó Share Results</button>
      </div>

      <!-- Compare All Methods -->
      <div id="val-compare" class="chart-container" style="margin-bottom: 2rem; display: none;">
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìä Compare All Methods (Football Field)</div>
        <div id="val-compare-chart"></div>
      </div>

      <!-- DCF Method -->
      <div id="val-dcf" class="animate-fade-up" style="margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Assumptions</h3>
            
            <div class="input-group">
              <label>
                Annual Free Cash Flow (FCF)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Net cash generated by the business after all operating expenses and capital expenditures</span>
                </span>
              </label>
              <input type="number" id="dcf-fcf" value="1000000" placeholder="1,000,000" oninput="calculateDCF()" />
              <span class="input-help">Current annual free cash flow ($)</span>
            </div>
            
            <div class="input-group">
              <label>
                Growth Rate (Year 1-5)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Expected annual growth rate for the projection period</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-growth" min="0" max="30" value="10" step="0.5" oninput="calculateDCF(); document.getElementById('dcf-growth-val').textContent = this.value + '%'" />
                <span id="dcf-growth-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-primary);">10%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>
                Terminal Growth Rate
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Long-term sustainable growth rate (typically 2-3%, matching GDP growth)</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-terminal" min="0" max="5" value="2.5" step="0.25" oninput="calculateDCF(); document.getElementById('dcf-terminal-val').textContent = this.value + '%'" />
                <span id="dcf-terminal-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-accent);">2.5%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>
                Discount Rate (WACC)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-content">Weighted Average Cost of Capital ‚Äî the required rate of return for investors</span>
                </span>
              </label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dcf-wacc" min="5" max="25" value="12" step="0.5" oninput="calculateDCF(); document.getElementById('dcf-wacc-val').textContent = this.value + '%'" />
                <span id="dcf-wacc-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">12%</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>Projection Years</label>
              <select id="dcf-years" onchange="calculateDCF()">
                <option value="5" selected>5 Years</option>
                <option value="7">7 Years</option>
                <option value="10">10 Years</option>
              </select>
            </div>
            
            <div class="input-group">
              <label>Net Debt</label>
              <input type="number" id="dcf-debt" value="0" placeholder="0" oninput="calculateDCF()" />
              <span class="input-help">Total debt minus cash (negative = net cash position)</span>
            </div>
          </div>
          
          <div class="calc-results" id="dcf-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
        
        <!-- DCF Sensitivity Table -->
        <div class="chart-container" style="margin-top: 2rem;" id="dcf-sensitivity">
          <!-- Populated by JS -->
        </div>
        
        <!-- FCF Projection Chart -->
        <div class="chart-container" style="margin-top: 1rem;" id="dcf-chart">
          <!-- Populated by JS -->
        </div>
      </div>
      
      <!-- Multiples Method -->
      <div id="val-multiples" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Company Metrics</h3>
            
            <div class="input-group">
              <label>Annual Revenue</label>
              <input type="number" id="mult-revenue" value="5000000" oninput="calculateMultiples()" />
            </div>
            
            <div class="input-group">
              <label>EBITDA</label>
              <input type="number" id="mult-ebitda" value="1200000" oninput="calculateMultiples()" />
            </div>
            
            <div class="input-group">
              <label>Net Income</label>
              <input type="number" id="mult-income" value="800000" oninput="calculateMultiples()" />
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Industry Presets</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 0.375rem; margin-bottom: 1rem;">
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('saas')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">SaaS</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('manufacturing')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Manufacturing</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('retail')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Retail</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('healthcare')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Healthcare</button>
              <button class="btn btn-secondary btn-sm" onclick="setIndustryPreset('professional')" style="font-size:0.7rem;padding:0.3rem 0.6rem;">Prof Services</button>
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 0.5rem 0 1rem;">Industry Multiples</h3>
            
            <div class="input-group">
              <label>EV/Revenue Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-ev-rev" min="0.5" max="15" value="3" step="0.25" oninput="calculateMultiples(); document.getElementById('mult-ev-rev-val').textContent = this.value + 'x'" />
                <span id="mult-ev-rev-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">3x</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>EV/EBITDA Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-ev-ebitda" min="3" max="25" value="10" step="0.5" oninput="calculateMultiples(); document.getElementById('mult-ev-ebitda-val').textContent = this.value + 'x'" />
                <span id="mult-ev-ebitda-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">10x</span>
              </div>
            </div>
            
            <div class="input-group">
              <label>P/E Multiple</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="mult-pe" min="5" max="40" value="15" step="0.5" oninput="calculateMultiples(); document.getElementById('mult-pe-val').textContent = this.value + 'x'" />
                <span id="mult-pe-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">15x</span>
              </div>
            </div>
          </div>
          
          <div class="calc-results" id="multiples-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
      </div>
      
      <!-- Asset-Based Method -->
      <div id="val-asset" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Assets</h3>
            
            <div class="input-group">
              <label>Cash & Equivalents</label>
              <input type="number" id="asset-cash" value="500000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Accounts Receivable</label>
              <input type="number" id="asset-ar" value="300000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Inventory</label>
              <input type="number" id="asset-inv" value="200000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Property & Equipment</label>
              <input type="number" id="asset-ppe" value="1000000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Other Assets</label>
              <input type="number" id="asset-other" value="150000" oninput="calculateAsset()" />
            </div>
            
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Liabilities</h3>
            
            <div class="input-group">
              <label>Accounts Payable</label>
              <input type="number" id="asset-ap" value="200000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Loans & Debt</label>
              <input type="number" id="asset-debt" value="400000" oninput="calculateAsset()" />
            </div>
            <div class="input-group">
              <label>Other Liabilities</label>
              <input type="number" id="asset-otherliab" value="100000" oninput="calculateAsset()" />
            </div>
          </div>
          
          <div class="calc-results" id="asset-results" aria-live="polite">
            <!-- Results populated by JS -->
          </div>
        </div>
      </div>

      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/1591845823?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Built to Sell</span>
              <span class="affiliate-author">John Warrillow</span>
              <span class="affiliate-why">Canadian author on building a business worth buying</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/B00000JZKB?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Texas Instruments BA II Plus</span>
              <span class="affiliate-why">The industry-standard financial calculator for valuation work</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/1733478159?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">The Art of Selling Your Business</span>
              <span class="affiliate-author">John Warrillow</span>
              <span class="affiliate-why">Practical guide to maximizing your exit</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       MORTGAGE CALCULATOR PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-mortgage" role="region" aria-label="Canadian Mortgage Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè†</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Canadian Mortgage Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Calculate payments with OSFI stress test, land transfer tax, and complete amortization schedule.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Canadian Mortgage Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Canadian Mortgage Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('mortgage')">üîó Share Results</button>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Mortgage Details</h3>
          
          <div class="input-group">
            <label>Home Price</label>
            <input type="number" id="mort-price" value="800000" oninput="calculateMortgage()" />
          </div>
          
          <div class="input-group">
            <label>Down Payment (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="mort-down" min="5" max="50" value="20" step="1" oninput="calculateMortgage(); document.getElementById('mort-down-val').textContent = this.value + '%'" />
              <span id="mort-down-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">20%</span>
            </div>
            <span class="input-help" id="mort-down-help">Down payment: $160,000</span>
          </div>
          
          <div class="input-group">
            <label>Interest Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="mort-rate" min="1" max="10" value="5.5" step="0.05" oninput="calculateMortgage(); document.getElementById('mort-rate-val').textContent = this.value + '%'" />
              <span id="mort-rate-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">5.5%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Amortization Period</label>
            <select id="mort-amort" onchange="calculateMortgage()">
              <option value="25" selected>25 Years</option>
              <option value="30">30 Years</option>
              <option value="20">20 Years</option>
              <option value="15">15 Years</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Payment Frequency</label>
            <select id="mort-freq" onchange="calculateMortgage()">
              <option value="12" selected>Monthly</option>
              <option value="26">Bi-Weekly</option>
              <option value="52">Weekly</option>
              <option value="24">Semi-Monthly</option>
            </select>
          </div>
          
          <div class="input-group">
            <label>Province</label>
            <select id="mort-province" onchange="calculateMortgage()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland</option>
              <option value="PE">PEI</option>
            </select>
          </div>
        </div>
        
        <div class="calc-results" id="mortgage-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <!-- Stress Test -->
      <div class="chart-container" style="margin-top: 2rem;" id="mortgage-stress">
        <!-- Populated by JS -->
      </div>

      <!-- Rate Increase Stress Test -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-rate-stress">
        <!-- Populated by JS -->
      </div>

      <!-- Payment Breakdown Donut -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-breakdown">
        <!-- Populated by JS -->
      </div>
      
      <!-- Amortization Schedule -->
      <div class="chart-container" style="margin-top: 1rem;" id="mortgage-amort">
        <!-- Populated by JS -->
      </div>

      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/0968394744?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">The Wealthy Barber Returns</span>
              <span class="affiliate-author">David Chilton</span>
              <span class="affiliate-why">Classic Canadian personal finance ‚Äî covers mortgages, saving, and spending wisely</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/B00UG9HB1Q?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Fireproof Document Safe</span>
              <span class="affiliate-why">Protect your mortgage docs, title, and insurance papers</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       INVESTMENT RETURNS PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-investment" role="region" aria-label="Investment Returns Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìà</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Investment Returns Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Calculate CAGR, simulate dollar-cost averaging, and project portfolio growth over time.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport(document.getElementById('inv-cagr').style.display!=='none'?'Investment Returns (CAGR)':'Investment Returns (DCA)')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults(document.getElementById('inv-cagr').style.display!=='none'?'Investment Returns (CAGR)':'Investment Returns (DCA)')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('investment')">üîó Share Results</button>
      </div>

      <div class="tabs" style="max-width: 300px; margin: 2rem auto;" id="inv-tabs">
        <button class="tab active" onclick="switchInvTab('cagr')">CAGR</button>
        <button class="tab" onclick="switchInvTab('dca')">DCA Sim</button>
      </div>
      
      <!-- CAGR Calculator -->
      <div id="inv-cagr" style="margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Investment Details</h3>
            
            <div class="input-group">
              <label>Initial Investment</label>
              <input type="number" id="cagr-initial" value="10000" oninput="calculateCAGR()" />
            </div>
            <div class="input-group">
              <label>Final Value</label>
              <input type="number" id="cagr-final" value="25000" oninput="calculateCAGR()" />
            </div>
            <div class="input-group">
              <label>Time Period (Years)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="cagr-years" min="1" max="30" value="5" step="1" oninput="calculateCAGR(); document.getElementById('cagr-years-val').textContent = this.value + ' yrs'" />
                <span id="cagr-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">5 yrs</span>
              </div>
            </div>
          </div>
          
          <div class="calc-results" id="cagr-results" aria-live="polite"></div>
        </div>
      </div>
      
      <!-- DCA Simulator -->
      <div id="inv-dca" style="display: none; margin-top: 2rem;">
        <div class="calc-grid">
          <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
            <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">DCA Parameters</h3>
            
            <div class="input-group">
              <label>Monthly Investment</label>
              <input type="number" id="dca-monthly" value="500" oninput="calculateDCA()" />
            </div>
            <div class="input-group">
              <label>Expected Annual Return (%)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-return" min="1" max="20" value="8" step="0.5" oninput="calculateDCA(); document.getElementById('dca-return-val').textContent = this.value + '%'" />
                <span id="dca-return-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">8%</span>
              </div>
            </div>
            <div class="input-group">
              <label>Investment Period (Years)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-years" min="1" max="40" value="20" step="1" oninput="calculateDCA(); document.getElementById('dca-years-val').textContent = this.value + ' yrs'" />
                <span id="dca-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">20 yrs</span>
              </div>
            </div>
            <div class="input-group">
              <label>Initial Lump Sum (optional)</label>
              <input type="number" id="dca-initial" value="0" oninput="calculateDCA()" />
            </div>
            <div class="input-group">
              <label>Dividend Yield (%)</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-dividend" min="0" max="8" value="0" step="0.25" oninput="calculateDCA(); document.getElementById('dca-dividend-val').textContent = this.value + '%'" />
                <span id="dca-dividend-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-success);">0%</span>
              </div>
              <span class="input-help">Dividends reinvested (DRIP) ‚Äî added to return</span>
            </div>
            <div class="input-group">
              <label>Inflation Rate (%) ‚Äî optional</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input type="range" id="dca-inflation" min="0" max="5" value="2.5" step="0.1" oninput="calculateDCA(); document.getElementById('dca-inflation-val').textContent = this.value + '%'" />
                <span id="dca-inflation-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">2.5%</span>
              </div>
              <span class="input-help">Shows real (inflation-adjusted) values alongside nominal</span>
            </div>
          </div>
          
          <div class="calc-results" id="dca-results" aria-live="polite"></div>
        </div>
        
        <div class="chart-container" style="margin-top: 2rem;" id="dca-chart"></div>
        <div class="chart-container" style="margin-top: 1rem;" id="dca-table"></div>

        <div class="affiliate-resources">
          <h3>üìö Recommended Resources</h3>
          <div class="affiliate-grid">
            <a href="https://www.amazon.ca/dp/0857197681?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
                <span class="affiliate-title">The Psychology of Money</span>
                <span class="affiliate-author">Morgan Housel</span>
                <span class="affiliate-why">Timeless lessons on wealth, greed, and happiness</span>
              </div>
            </a>
            <a href="https://www.amazon.ca/dp/1119356296?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
                <span class="affiliate-title">Millionaire Teacher</span>
                <span class="affiliate-author">Andrew Hallam</span>
                <span class="affiliate-why">Build wealth on any salary ‚Äî with Canadian examples</span>
              </div>
            </a>
            <a href="https://www.amazon.ca/dp/1775343707?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
                <span class="affiliate-title">Beat the Bank</span>
                <span class="affiliate-author">Larry Bates</span>
                <span class="affiliate-why">How Canadians can stop overpaying for investments</span>
              </div>
            </a>
          </div>
          <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       RRSP vs TFSA PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-retirement" role="region" aria-label="RRSP vs TFSA Optimizer">
  <div class="calc-container" style="padding-top: 6rem;">
    <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
    <div class="calc-header animate-fade-up">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚öñÔ∏è</div>
      <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">RRSP vs TFSA: Which Wins for You?</h1>
      <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Personalized comparison based on your income, province, and retirement plans. See the real numbers.</p>
    </div>
    <div class="action-buttons" style="justify-content: center;">
      <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('RRSP vs TFSA Comparison')">üìÑ PDF</button>
      <button class="btn btn-secondary btn-sm" onclick="copyResults('RRSP vs TFSA Comparison')">üìã Copy</button>
      <button class="btn btn-secondary btn-sm" onclick="shareCalculator('retirement')">üîó Share</button>
    </div>
    <div class="calc-grid" style="margin-top: 2rem;">
      <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
        <div class="input-group">
          <label for="rvt-age">Current Age</label>
          <input type="number" id="rvt-age" min="18" max="70" value="30" oninput="calculateRetirement()">
        </div>
        <div class="input-group">
          <label for="rvt-retire-age">Retirement Age</label>
          <input type="number" id="rvt-retire-age" min="30" max="80" value="65" oninput="calculateRetirement()">
        </div>
        <div class="input-group">
          <label for="rvt-income">Current Annual Income</label>
          <div class="input-with-prefix">
            <span class="input-prefix">$</span>
            <input type="number" id="rvt-income" placeholder="85,000" min="0" step="1000" value="85000" oninput="calculateRetirement()">
          </div>
        </div>
        <div class="input-group">
          <label for="rvt-province">Province / Territory</label>
          <select id="rvt-province" onchange="calculateRetirement()">
            <option value="AB">Alberta</option>
            <option value="BC">British Columbia</option>
            <option value="MB">Manitoba</option>
            <option value="NB">New Brunswick</option>
            <option value="NL">Newfoundland & Labrador</option>
            <option value="NS">Nova Scotia</option>
            <option value="NT">Northwest Territories</option>
            <option value="NU">Nunavut</option>
            <option value="ON" selected>Ontario</option>
            <option value="PE">Prince Edward Island</option>
            <option value="QC">Quebec</option>
            <option value="SK">Saskatchewan</option>
            <option value="YT">Yukon</option>
          </select>
        </div>
        <div class="input-group">
          <label for="rvt-retire-income">Expected Retirement Income <span style="color: var(--text-secondary); font-weight: 400;">(withdrawals/yr)</span></label>
          <div class="input-with-prefix">
            <span class="input-prefix">$</span>
            <input type="number" id="rvt-retire-income" placeholder="50,000" min="0" step="1000" value="50000" oninput="calculateRetirement()">
          </div>
        </div>
        <div class="input-group">
          <label for="rvt-contribution">Annual Contribution</label>
          <div class="input-with-prefix">
            <span class="input-prefix">$</span>
            <input type="number" id="rvt-contribution" placeholder="10,000" min="0" step="500" value="10000" oninput="calculateRetirement()">
          </div>
        </div>
        <div class="input-group">
          <label for="rvt-return">Expected Rate of Return (%)</label>
          <input type="number" id="rvt-return" min="0" max="20" step="0.5" value="6" oninput="calculateRetirement()">
        </div>
        <div class="input-group">
          <label for="rvt-inflation">Inflation Rate (%) <span style="color: var(--text-secondary); font-weight: 400;">optional</span></label>
          <input type="number" id="rvt-inflation" min="0" max="10" step="0.5" value="2" oninput="calculateRetirement()">
        </div>
        <button class="btn btn-primary" onclick="calculateRetirement()" style="width: 100%; margin-top: 1rem;">Compare RRSP vs TFSA</button>
      </div>
      <div class="calc-results" id="rrsptfsa-results" aria-live="polite"></div>
    </div>
    <div id="rrsptfsa-breakdown" style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary);"></div>
    <div class="affiliate-resources">
      <h3>üìö Recommended Resources</h3>
      <div class="affiliate-grid">
        <a href="https://www.amazon.ca/dp/1119356296?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
          <div class="affiliate-info">
            <span class="affiliate-title">Millionaire Teacher</span>
            <span class="affiliate-author">Andrew Hallam</span>
            <span class="affiliate-why">Index investing for Canadians ‚Äî TFSA & RRSP strategies</span>
          </div>
        </a>
        <a href="https://www.amazon.ca/dp/0143190008?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
          <div class="affiliate-info">
            <span class="affiliate-title">The Wealthy Barber Returns</span>
            <span class="affiliate-author">David Chilton</span>
            <span class="affiliate-why">Canadian RRSP and retirement planning essentials</span>
          </div>
        </a>
      </div>
      <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
    </div>
  </div>
</div>


  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       COMPOUND INTEREST PAGE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-compound" role="region" aria-label="Compound Interest Visualizer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Compound Interest Visualizer</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">See the magic of compound growth. Small contributions today become extraordinary wealth tomorrow.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Compound Interest')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Compound Interest')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('compound')">üîó Share Results</button>
      </div>

      <!-- Rule of 72 Quick Calculator -->
      <div class="glass-card animate-fade-up" style="padding: var(--space-xl); margin-top: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
        <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">‚ö° Rule of 72 ‚Äî Quick Doubling Calculator</div>
        <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">Enter an interest rate to see how long it takes to double, or enter a target doubling time to find the required rate.</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
          <div class="input-group">
            <label>Annual Rate (%)</label>
            <input type="number" id="r72-rate" value="7" step="0.1" min="0.1" oninput="calcRule72('rate')" />
            <span class="input-help" id="r72-rate-result" style="font-weight:600; color: var(--brand-primary);">‚âà 10.3 years to double</span>
          </div>
          <div class="input-group">
            <label>Doubling Time (Years)</label>
            <input type="number" id="r72-years" value="10" step="0.5" min="0.5" oninput="calcRule72('years')" />
            <span class="input-help" id="r72-years-result" style="font-weight:600; color: var(--brand-primary);">‚âà 7.2% rate needed</span>
          </div>
        </div>
      </div>

      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Initial Amount ($)</label>
            <input type="number" id="comp-initial" value="10000" min="0" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Monthly Contribution ($)</label>
            <input type="number" id="comp-monthly" value="300" min="0" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Annual Interest Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="comp-rate" min="1" max="15" value="7" step="0.25" oninput="calculateCompound(); document.getElementById('comp-rate-val').textContent = this.value + '%'" />
              <span id="comp-rate-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right;">7%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Time Period (Years)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="comp-years" min="1" max="50" value="25" step="1" oninput="calculateCompound(); document.getElementById('comp-years-val').textContent = this.value + ' yrs'" />
              <span id="comp-years-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">25 yrs</span>
            </div>
          </div>
          <div class="input-group">
            <label>Compounding Frequency</label>
            <select id="comp-freq" onchange="calculateCompound()">
              <option value="12" selected>Monthly</option>
              <option value="4">Quarterly</option>
              <option value="1">Annually</option>
              <option value="365">Daily</option>
            </select>
          </div>
          
          <div class="divider"></div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">üìä Compare Scenario B</h3>
          <div class="input-group">
            <label>Rate B (%)</label>
            <input type="number" id="comp-rate-b" value="5" step="0.25" oninput="calculateCompound()" />
          </div>
          <div class="input-group">
            <label>Monthly Contribution B</label>
            <input type="number" id="comp-monthly-b" value="500" oninput="calculateCompound()" />
          </div>
        </div>
        
        <div class="calc-results" id="compound-results" aria-live="polite"></div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="compound-chart"></div>
      <div class="chart-container" style="margin-top: 1rem;" id="compound-comparison"></div>

      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/0451499085?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">The Automatic Millionaire</span>
              <span class="affiliate-author">David Bach</span>
              <span class="affiliate-why">Automate your finances and let compounding do the work</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/1612681131?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Rich Dad Poor Dad</span>
              <span class="affiliate-author">Robert Kiyosaki</span>
              <span class="affiliate-why">The book that launched a million investors</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
  </div>

  <!-- Placeholder pages for remaining tools -->
  <div class="page" id="page-merger" role="region" aria-label="M&A Deal Analyzer">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ü§ù</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">M&A Deal Analyzer</h1>
        <p style="color: var(--text-secondary);">Accretion/dilution analysis, synergy modeling, and deal structuring.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('M&A Deal Analyzer')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('M&A Deal Analyzer')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('merger')">üîó Share Results</button>
      </div>

      <div class="calc-grid animate-fade-up" style="margin-top: 2rem;">
        <!-- Inputs -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Acquirer</h3>

          <div class="input-group">
            <label>Earnings Per Share (EPS)
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Acquirer's current diluted EPS</span></span>
            </label>
            <input type="number" id="ma-acq-eps" value="5.00" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Share Price ($)</label>
            <input type="number" id="ma-acq-price" value="100" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Shares Outstanding (M)</label>
            <input type="number" id="ma-acq-shares" value="500" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>P/E Multiple
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Acquirer's current price-to-earnings ratio</span></span>
            </label>
            <input type="number" id="ma-acq-pe" value="20" step="0.1" oninput="calculateMA()" />
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Target</h3>

          <div class="input-group">
            <label>Earnings Per Share (EPS)</label>
            <input type="number" id="ma-tgt-eps" value="2.50" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Share Price ($)</label>
            <input type="number" id="ma-tgt-price" value="40" step="0.01" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Shares Outstanding (M)</label>
            <input type="number" id="ma-tgt-shares" value="200" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Offer Premium</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-premium" min="10" max="50" value="25" step="1" oninput="calculateMA(); document.getElementById('ma-premium-val').textContent = this.value + '%'" />
              <span id="ma-premium-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-primary);">25%</span>
            </div>
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Deal Structure</h3>

          <div class="input-group">
            <label>Cash Portion</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-cash-pct" min="0" max="100" value="50" step="5" oninput="calculateMA(); document.getElementById('ma-cash-val').textContent = this.value + '% Cash / ' + (100 - this.value) + '% Stock'" />
              <span id="ma-cash-val" class="mono" style="font-size: 0.85rem; min-width: 10rem; text-align: right; color: var(--brand-accent);">50% Cash / 50% Stock</span>
            </div>
          </div>
          <div class="input-group">
            <label>Cost of Debt (for Cash Financing)
              <span class="tooltip-wrapper"><span class="tooltip-icon">?</span><span class="tooltip-content">Pre-tax interest rate on new debt raised to fund the cash portion</span></span>
            </label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-debt-cost" min="1" max="12" value="5" step="0.25" oninput="calculateMA(); document.getElementById('ma-debt-cost-val').textContent = this.value + '%'" />
              <span id="ma-debt-cost-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-warning);">5%</span>
            </div>
          </div>
          <div class="input-group">
            <label>Tax Rate</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="ma-tax" min="0" max="40" value="25" step="1" oninput="calculateMA(); document.getElementById('ma-tax-val').textContent = this.value + '%'" />
              <span id="ma-tax-val" class="mono" style="font-size: 0.85rem; min-width: 3.5rem; text-align: right; color: var(--brand-danger);">25%</span>
            </div>
          </div>

          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Synergies</h3>

          <div class="input-group">
            <label>Expected Revenue Synergies ($M)</label>
            <input type="number" id="ma-rev-syn" value="0" step="1" oninput="calculateMA()" />
          </div>
          <div class="input-group">
            <label>Expected Cost Synergies ($M)</label>
            <input type="number" id="ma-cost-syn" value="50" step="1" oninput="calculateMA()" />
          </div>
        </div>

        <!-- Results -->
        <div class="calc-results" id="ma-results" aria-live="polite">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Sensitivity Table -->
      <div class="chart-container animate-fade-up" style="margin-top: 2rem;" id="ma-sensitivity">
        <!-- Populated by JS -->
      </div>

      <!-- Sources & Uses -->
      <div class="chart-container animate-fade-up" style="margin-top: 1rem;" id="ma-sources-uses">
        <!-- Populated by JS -->
      </div>

      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/1119706181?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Investment Banking</span>
              <span class="affiliate-author">Rosenbaum & Pearl</span>
              <span class="affiliate-why">The definitive IB guide ‚Äî valuation, M&A, and LBOs</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/0692928855?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">The Acquirer's Multiple</span>
              <span class="affiliate-author">Tobias Carlisle</span>
              <span class="affiliate-why">Deep value approach to finding acquisition targets</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/B0000YVENS?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">HP 12C Financial Calculator</span>
              <span class="affiliate-why">The legendary financial calculator trusted by deal-makers</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
  </div>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       STARTUP RUNWAY CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-runway" role="region" aria-label="Startup Runway Calculator">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üöÄ</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Startup Runway Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Calculate your burn rate, runway, and break-even point. Plan with multiple scenarios.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Startup Runway')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Startup Runway')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('runway')">üîó Share Results</button>
      </div>

      <!-- Scenario Tabs -->
      <div class="tabs" id="runway-tabs" style="max-width: 420px; margin: 0 auto 2rem;">
        <button class="tab" onclick="switchRunwayTab('conservative')" id="runway-tab-conservative">Conservative</button>
        <button class="tab active" onclick="switchRunwayTab('base')" id="runway-tab-base">Base Case</button>
        <button class="tab" onclick="switchRunwayTab('aggressive')" id="runway-tab-aggressive">Aggressive</button>
      </div>

      <div class="calc-grid">
        <!-- Inputs -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üì• Financial Inputs</h3>

          <div class="input-group">
            <label>Cash in Bank ($)</label>
            <input type="number" id="rw-cash" value="500000" min="0" oninput="calculateRunway()" placeholder="500000" />
          </div>

          <div class="input-group">
            <label>Monthly Revenue ($)</label>
            <input type="number" id="rw-revenue" value="20000" min="0" oninput="calculateRunway()" placeholder="20000" />
          </div>

          <div class="input-group">
            <label>Monthly Revenue Growth Rate: <span id="rw-growth-val" class="mono" style="color:var(--brand-primary);">5%</span></label>
            <input type="range" id="rw-growth" min="0" max="30" step="0.5" value="5" oninput="document.getElementById('rw-growth-val').textContent=this.value+'%'; calculateRunway();" />
            <div class="input-help">0% ‚Äî 30% monthly growth</div>
          </div>

          <div class="input-group">
            <label>Monthly Fixed Costs ($)</label>
            <input type="number" id="rw-fixed" value="45000" oninput="calculateRunway()" placeholder="Rent, salaries, tools" />
            <div class="input-help">Rent, salaries, tools, subscriptions</div>
          </div>

          <div class="input-group">
            <label>Monthly Variable Costs ($)</label>
            <input type="number" id="rw-variable" value="8000" oninput="calculateRunway()" placeholder="8000" />
          </div>

          <div class="input-group">
            <label>One-Time Upcoming Expenses ($)</label>
            <input type="number" id="rw-onetime" value="0" oninput="calculateRunway()" placeholder="0" />
          </div>

          <div class="input-group">
            <label>General Monthly Cost Escalation ($)</label>
            <input type="number" id="rw-hiring" value="2000" min="0" oninput="calculateRunway()" placeholder="2000" />
            <div class="input-help">Additional cost increase per month (cumulative) ‚Äî separate from named hires below</div>
          </div>
          
          <div class="divider"></div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">üë• Hiring Plan</h3>
          <div id="rw-hiring-plan" style="font-size: 0.8rem;">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr auto; gap: 0.375rem; margin-bottom: 0.5rem; align-items: end;">
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Role</label><input type="text" value="Engineer" class="rw-hire-role" oninput="calculateRunway()" /></div>
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Salary/mo</label><input type="number" value="8000" class="rw-hire-salary" oninput="calculateRunway()" /></div>
              <div class="input-group" style="margin:0"><label style="font-size:0.65rem">Start Month</label><input type="number" value="3" class="rw-hire-month" min="1" oninput="calculateRunway()" /></div>
              <button class="btn btn-secondary btn-sm" onclick="this.closest('[style]').remove();calculateRunway();" style="padding:0.2rem 0.4rem;margin-bottom:2px;font-size:0.7rem;">‚úï</button>
            </div>
          </div>
          <button class="btn btn-secondary btn-sm" onclick="addHireRow()" style="font-size:0.7rem;">+ Add Hire</button>
        </div>

        <!-- Results -->
        <div class="calc-results">
          <div class="result-card" style="text-align: center;">
            <div class="result-label">Monthly Burn Rate</div>
            <div class="result-value" id="rw-burn">$0</div>
            <div class="input-help">Current costs ‚àí revenue</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Runway (No Growth)</div>
            <div class="result-value" id="rw-runway-flat" style="font-size: 1.5rem;">0 months</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Runway (With Growth)</div>
            <div class="result-value" id="rw-runway-growth" style="font-size: 1.5rem;">0 months</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Cash Zero Date</div>
            <div class="result-value" id="rw-zero-date" style="font-size: 1.25rem;">‚Äî</div>
          </div>

          <div id="rw-safe-zone" class="result-card" style="text-align: center;">
            <div class="result-label">Safety Zone</div>
            <div class="result-value" id="rw-safe-text" style="font-size: 1.5rem;">‚Äî</div>
          </div>

          <div class="result-card" style="text-align: center;">
            <div class="result-label">Break-Even Month</div>
            <div class="result-value" id="rw-breakeven" style="font-size: 1.25rem;">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-container" style="margin-top: 2rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìä Monthly Cash Balance Projection</h3>
        <div id="rw-scenario-label" style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;">Base Case Scenario</div>
        <div id="rw-chart" style="display: flex; align-items: flex-end; gap: 3px; height: 220px; position: relative; padding-bottom: 24px;">
          <!-- bars injected by JS -->
        </div>
        <div style="display: flex; align-items: center; gap: 1rem; margin-top: 0.75rem; font-size: 0.72rem; color: var(--text-muted);">
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:linear-gradient(135deg,var(--brand-primary),var(--brand-accent));display:inline-block;"></span> Positive Balance</span>
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:var(--brand-danger);display:inline-block;"></span> Negative / Danger</span>
          <span style="display:flex;align-items:center;gap:4px;"><span style="width:12px;height:12px;border-radius:2px;background:var(--brand-success);display:inline-block;"></span> Break-Even Reached</span>
        </div>
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/0307887898?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">The Lean Startup</span>
        <span class="affiliate-author">Eric Ries</span>
        <span class="affiliate-why">Build, measure, learn ‚Äî extend your runway intelligently</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/073521414X?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Profit First</span>
        <span class="affiliate-author">Mike Michalowicz</span>
        <span class="affiliate-why">Transform your startup from cash-eating to profitable</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       NET WORTH TRACKER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-networth" role="region" aria-label="Net Worth Tracker">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí∞</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Net Worth Tracker</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Track your complete financial picture. Save snapshots to monitor progress over time.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Net Worth Tracker')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Net Worth Tracker')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('networth')">üîó Share Results</button>
      </div>

      <div class="calc-grid">
        <!-- Assets Column -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--brand-success);">üìà Assets</h3>

          <div class="input-group">
            <label>Cash & Savings ($)</label>
            <input type="number" id="nw-cash" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>TFSA ($)</label>
            <input type="number" id="nw-tfsa" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>RRSP ($)</label>
            <input type="number" id="nw-rrsp" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Non-Registered Investments ($)</label>
            <input type="number" id="nw-nonreg" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Real Estate ($)</label>
            <input type="number" id="nw-realestate" value="0" oninput="calculateNetWorth()" />
            <div class="input-help">Primary residence market value</div>
          </div>
          <div class="input-group">
            <label>Vehicles ($)</label>
            <input type="number" id="nw-vehicles" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Other Assets ($)</label>
            <input type="number" id="nw-other-assets" value="0" oninput="calculateNetWorth()" />
            <div class="input-help">Business equity, crypto, collectibles</div>
          </div>
        </div>

        <!-- Liabilities Column -->
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: var(--brand-danger);">üìâ Liabilities</h3>

          <div class="input-group">
            <label>Mortgage Balance ($)</label>
            <input type="number" id="nw-mortgage" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Car Loans ($)</label>
            <input type="number" id="nw-carloans" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Student Loans ($)</label>
            <input type="number" id="nw-student" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Credit Card Debt ($)</label>
            <input type="number" id="nw-cc" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Line of Credit ($)</label>
            <input type="number" id="nw-loc" value="0" oninput="calculateNetWorth()" />
          </div>
          <div class="input-group">
            <label>Other Debt ($)</label>
            <input type="number" id="nw-other-debt" value="0" oninput="calculateNetWorth()" />
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Assets</div>
          <div class="result-value" id="nw-total-assets" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Liabilities</div>
          <div class="result-value" id="nw-total-liabilities" style="font-size: 1.5rem; color: var(--brand-danger); -webkit-text-fill-color: var(--brand-danger);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Liquid Net Worth</div>
          <div class="result-value" id="nw-liquid" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Excludes real estate & vehicles</div>
        </div>
      </div>

      <!-- Big Net Worth Card -->
      <div class="result-card" style="text-align: center; margin-top: 1.5rem; padding: var(--space-2xl);">
        <div class="result-label" style="font-size: 0.9rem;">Net Worth</div>
        <div class="result-value" id="nw-networth" style="font-size: 3rem;">$0</div>
        <div id="nw-dta" style="margin-top: 0.75rem;"></div>
      </div>

      <!-- Pie Chart + Snapshot -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
        <!-- Asset Allocation Pie -->
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ü•ß Asset Allocation</h3>
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div id="nw-pie" style="width: 150px; height: 150px; border-radius: 50%; flex-shrink: 0; background: var(--border-primary);"></div>
            <div id="nw-pie-legend" style="font-size: 0.75rem; display: flex; flex-direction: column; gap: 0.375rem;"></div>
          </div>
        </div>

        <!-- Snapshots -->
        <div class="chart-container">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
            <h3 style="font-size: 0.95rem;">üì∏ Snapshots</h3>
            <button class="btn btn-primary btn-sm" onclick="saveNetWorthSnapshot()">Save Snapshot</button>
          </div>
          <div id="nw-snapshots" style="max-height: 250px; overflow-y: auto; font-size: 0.8rem;"></div>
        </div>
      </div>

      <!-- Net Worth Trend Chart -->
      <div class="chart-container" style="margin-top: 1.5rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìà Net Worth Over Time</h3>
        <div id="nw-trend-chart"></div>
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/0143115766?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Your Money or Your Life</span>
        <span class="affiliate-author">Vicki Robin</span>
        <span class="affiliate-why">Rethink your relationship with money and track what matters</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/B088FCSL6S?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Financial Goal Planner Journal</span>
        <span class="affiliate-why">Track your net worth progress month by month</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/B00UG9HB1Q?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Fireproof Document Safe</span>
        <span class="affiliate-why">Protect your financial records and important documents</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       LEASE VS BUY CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-lease" role="region" aria-label="Lease vs Buy Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üöó</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Lease vs Buy Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Compare the total cost of leasing versus buying a vehicle over the same period.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Lease vs Buy')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Lease vs Buy')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('lease')">üîó Share Results</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Vehicle & Lease</h3>
          <div class="input-group">
            <label>Vehicle Price ($)</label>
            <input type="number" id="lb-price" value="45000" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Lease Payment / Month ($)</label>
            <input type="number" id="lb-lease-payment" value="450" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Lease Term (Months)</label>
            <input type="number" id="lb-lease-term" value="48" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Residual Value ($)</label>
            <input type="number" id="lb-residual" value="18000" oninput="calculateLeaseBuy()" />
            <span class="input-help">Value at end of lease / what you'd sell for</span>
          </div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Buy Financing</h3>
          <div class="input-group">
            <label>Buy Loan Rate (%)</label>
            <input type="number" id="lb-buy-rate" value="5.5" step="0.1" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Buy Loan Term (Months)</label>
            <input type="number" id="lb-buy-term" value="60" oninput="calculateLeaseBuy()" />
          </div>
          <div class="input-group">
            <label>Down Payment ($)</label>
            <input type="number" id="lb-down" value="5000" oninput="calculateLeaseBuy()" />
          </div>
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Running Costs Difference</h3>
          <div class="input-group">
            <label>Insurance Difference / Month ($)</label>
            <input type="number" id="lb-insurance-diff" value="50" oninput="calculateLeaseBuy()" />
            <span class="input-help">How much MORE buying costs for insurance (can be negative)</span>
          </div>
          <div class="input-group">
            <label>Maintenance Difference / Month ($)</label>
            <input type="number" id="lb-maint-diff" value="30" oninput="calculateLeaseBuy()" />
            <span class="input-help">How much MORE buying costs for maintenance (can be negative)</span>
          </div>
        </div>
        <div class="calc-results" id="lease-buy-results" aria-live="polite"></div>
      </div>
      <div class="chart-container" style="margin-top: 2rem;" id="lease-buy-chart"></div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/0968394744?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">The Wealthy Barber Returns</span>
        <span class="affiliate-author">David Chilton</span>
        <span class="affiliate-why">Smart Canadian thinking on big purchases like vehicles</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CANADIAN TAX ESTIMATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-tax" role="region" aria-label="Canadian Tax Estimator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üßæ</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Canadian Tax Estimator</h1>
        <p style="color: var(--text-secondary); max-width: 500px; margin: 0 auto;">Estimate your 2025 federal and provincial income tax across all 10 Canadian provinces.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Canadian Tax Estimator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Canadian Tax Estimator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('tax')">üîó Share Results</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Province</label>
            <select id="tax-province" onchange="calculateTax()">
              <option value="ON">Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="PE">Prince Edward Island</option>
            </select>
          </div>
          <div class="input-group">
            <label>Employment Income ($)</label>
            <input type="number" id="tax-employment" value="85000" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Self-Employment Income ($)</label>
            <input type="number" id="tax-self" value="0" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Capital Gains ($)</label>
            <input type="number" id="tax-capgains" value="0" oninput="calculateTax()" />
            <span class="input-help">Only 50% is taxable</span>
          </div>
          <div class="input-group">
            <label>Eligible Dividends ($)</label>
            <input type="number" id="tax-dividends" value="0" oninput="calculateTax()" />
            <span class="input-help">Grossed up by 38% for tax, then dividend tax credit applied</span>
          </div>
          <div class="input-group">
            <label>RRSP Deduction ($)</label>
            <input type="number" id="tax-rrsp" value="0" oninput="calculateTax()" />
          </div>
          <div class="input-group">
            <label>Other Deductions ($)</label>
            <input type="number" id="tax-other-ded" value="0" oninput="calculateTax()" />
          </div>
        </div>
        <div class="calc-results" id="tax-results" aria-live="polite"></div>
      </div>
      <div class="chart-container" style="margin-top: 2rem;" id="tax-chart"></div>
      <div class="chart-container" style="margin-top: 1rem;" id="tax-province-compare"></div>

      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/B08PH5Q51P?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Fujitsu ScanSnap Scanner</span>
              <span class="affiliate-why">Digitize receipts and tax documents ‚Äî never lose a deduction</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
  </div>

  </main>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SALARY & COMPENSATION ANALYZER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-salary" role="region" aria-label="Salary & Compensation Analyzer">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üíº</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Salary & Compensation Analyzer</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Analyze your total compensation package including base, bonus, equity, and benefits with Canadian tax estimates.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Salary & Compensation Analyzer')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Salary & Compensation Analyzer')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('salary')">üîó Share Results</button>
      </div>

      <div class="calc-grid">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: #14b8a6;">üí∞ Cash Compensation</h3>
          <div class="input-group">
            <label>Annual Base Salary ($)</label>
            <input type="number" id="sal-base" value="85000" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Bonus (%)</label>
            <input type="number" id="sal-bonus-pct" value="10" step="1" oninput="calculateSalary()" />
            <div class="input-help">Annual bonus as % of base salary</div>
          </div>

          <h3 style="font-size: 0.95rem; margin: 1.5rem 0 1rem; color: #14b8a6;">üìä Stock Options / Equity</h3>
          <div class="input-group">
            <label>Number of Shares</label>
            <input type="number" id="sal-shares" value="1000" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Strike Price ($)</label>
            <input type="number" id="sal-strike" value="10" step="0.01" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Current Share Price ($)</label>
            <input type="number" id="sal-current-price" value="25" step="0.01" oninput="calculateSalary()" />
          </div>
          <div class="input-group">
            <label>Vesting Period (years)</label>
            <input type="number" id="sal-vesting" value="4" min="1" oninput="calculateSalary()" />
          </div>
        </div>

        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem; color: #14b8a6;">üè• Benefits</h3>
          <div class="input-group">
            <label>Health Benefits Value ($/yr)</label>
            <input type="number" id="sal-health" value="5000" oninput="calculateSalary()" />
            <div class="input-help">Employer-paid health, dental, vision</div>
          </div>
          <div class="input-group">
            <label>Pension / RRSP Match ($/yr)</label>
            <input type="number" id="sal-pension" value="4000" oninput="calculateSalary()" />
          </div>

          <h3 style="font-size: 0.95rem; margin: 1.5rem 0 1rem; color: #14b8a6;">üçÅ Tax Province</h3>
          <div class="input-group">
            <label>Province</label>
            <select id="sal-province" onchange="calculateSalary()">
              <option value="ON" selected>Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="AB">Alberta</option>
              <option value="QC">Quebec</option>
              <option value="MB">Manitoba</option>
              <option value="SK">Saskatchewan</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="PE">Prince Edward Island</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Compensation</div>
          <div class="result-value" id="sal-total-comp" style="font-size: 1.5rem;">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">After-Tax Take-Home</div>
          <div class="result-value" id="sal-take-home" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
          <div class="input-help">After income tax, CPP &amp; EI</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Effective Deduction Rate</div>
          <div class="result-value" id="sal-eff-tax" style="font-size: 1.5rem;">0%</div>
          <div class="input-help">Includes tax, CPP &amp; EI</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Hourly Rate Equivalent</div>
          <div class="result-value" id="sal-hourly" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Based on 2,080 hrs/yr</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Stock Option Value</div>
          <div class="result-value" id="sal-equity-val" style="font-size: 1.5rem;">$0</div>
          <div class="input-help">Intrinsic value (annualized)</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Annual Bonus</div>
          <div class="result-value" id="sal-bonus-val" style="font-size: 1.5rem;">$0</div>
        </div>
      </div>

      <!-- Deduction Breakdown -->
      <div class="glass-card" style="padding: var(--space-lg); margin-top: 1rem;">
        <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">üçÅ Canadian Deductions Breakdown</div>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.75rem; font-size: 0.85rem;" id="sal-deductions">
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">Income Tax</div><div class="mono" style="font-weight: 700;" id="sal-income-tax">$0</div></div>
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">CPP</div><div class="mono" style="font-weight: 700;" id="sal-cpp">$0</div></div>
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">EI</div><div class="mono" style="font-weight: 700;" id="sal-ei">$0</div></div>
          <div style="text-align: center;"><div style="font-size: 0.72rem; color: var(--text-muted);">Total Deductions</div><div class="mono" style="font-weight: 700; color: var(--brand-danger);" id="sal-total-ded">$0</div></div>
        </div>
      </div>

      <!-- Comparison + Pie -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">ü•ß Compensation Breakdown</h3>
          <div style="display: flex; align-items: center; gap: 1.5rem;">
            <div id="sal-pie" style="width: 150px; height: 150px; border-radius: 50%; flex-shrink: 0; background: var(--border-primary);"></div>
            <div id="sal-pie-legend" style="font-size: 0.75rem; display: flex; flex-direction: column; gap: 0.375rem;"></div>
          </div>
        </div>
        <div class="chart-container">
          <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìä How You Compare</h3>
          <div id="sal-comparison" style="font-size: 0.85rem;"></div>
        </div>
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/1523505745?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">I Will Teach You to Be Rich</span>
        <span class="affiliate-author">Ramit Sethi</span>
        <span class="affiliate-why">Negotiate your salary and automate your money</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/0062407805?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Never Split the Difference</span>
        <span class="affiliate-author">Chris Voss</span>
        <span class="affiliate-why">FBI negotiation tactics for your next salary conversation</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       DEBT PAYOFF CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-debt" role="region" aria-label="Debt Payoff Calculator">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1000px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí≥</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Debt Payoff Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Compare Avalanche vs Snowball strategies. See your debt-free date and how extra payments save you money.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Debt Payoff Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Debt Payoff Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('debt')">üîó Share Results</button>
      </div>

      <div class="calc-inputs glass-card" style="padding: var(--space-xl); margin-top: 1.5rem;">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
          <h3 style="font-size: 0.95rem; color: #ef4444;">üìã Your Debts</h3>
          <button class="btn btn-primary btn-sm" onclick="addDebtRow()">+ Add Debt</button>
        </div>
        <div id="debt-rows">
          <div class="debt-row" style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 1.5fr auto; gap: 0.5rem; align-items: end; margin-bottom: 0.5rem;">
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="Credit Card" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="8000" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="19.99" step="0.01" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="200" oninput="calculateDebt()" /></div>
            <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">‚úï</button>
          </div>
          <div class="debt-row" style="display: grid; grid-template-columns: 2fr 1.5fr 1fr 1.5fr auto; gap: 0.5rem; align-items: end; margin-bottom: 0.5rem;">
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="Car Loan" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="15000" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="6.5" step="0.01" oninput="calculateDebt()" /></div>
            <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="350" oninput="calculateDebt()" /></div>
            <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">‚úï</button>
          </div>
        </div>
      </div>

      <div class="calc-inputs glass-card" style="padding: var(--space-xl); margin-top: 1rem;">
        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
          <div>
            <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem;">‚öîÔ∏è Strategy</h3>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn-primary btn-sm" id="debt-btn-avalanche" onclick="setDebtStrategy('avalanche')">üèîÔ∏è Avalanche</button>
              <button class="btn btn-secondary btn-sm" id="debt-btn-snowball" onclick="setDebtStrategy('snowball')">‚õÑ Snowball</button>
            </div>
            <div class="input-help" style="margin-top:0.25rem" id="debt-strategy-help">Highest interest rate first ‚Äî saves the most money</div>
          </div>
          <div style="flex:1; min-width: 200px;">
            <h3 style="font-size: 0.95rem; margin-bottom: 0.5rem;">üí™ Extra Monthly Payment</h3>
            <input type="range" id="debt-extra" min="0" max="2000" step="25" value="200" oninput="document.getElementById('debt-extra-val').textContent='$'+this.value; calculateDebt();" style="width:100%;" />
            <div style="display:flex;justify-content:space-between;font-size:0.75rem;color:var(--text-secondary)"><span>$0</span><span id="debt-extra-val">$200</span><span>$2,000</span></div>
          </div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Total Interest Paid</div>
          <div class="result-value" id="debt-total-interest" style="font-size: 1.5rem; color: var(--brand-danger); -webkit-text-fill-color: var(--brand-danger);">$0</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Debt-Free Date</div>
          <div class="result-value" id="debt-free-date" style="font-size: 1.3rem;">‚Äî</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Months to Debt-Free</div>
          <div class="result-value" id="debt-months" style="font-size: 1.5rem;">0</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-top: 1rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">Savings vs Minimum Only</div>
          <div class="result-value" id="debt-savings" style="font-size: 1.5rem; color: var(--brand-success); -webkit-text-fill-color: var(--brand-success);">$0</div>
          <div class="input-help">Interest saved with extra payments</div>
        </div>
        <div class="result-card" style="text-align: center; padding: var(--space-xl);">
          <div class="result-label" style="font-size: 1rem;">üéØ Debt-Free Countdown</div>
          <div class="result-value" id="debt-countdown" style="font-size: 2rem;">‚Äî</div>
        </div>
      </div>

      <!-- Timeline Chart -->
      <div class="chart-container" style="margin-top: 1.5rem;">
        <h3 style="font-size: 0.95rem; margin-bottom: 1rem;">üìà Payoff Timeline</h3>
        <div id="debt-timeline-chart" style="height: 250px; position: relative;"></div>
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/1595555277?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">The Total Money Makeover</span>
        <span class="affiliate-author">Dave Ramsey</span>
        <span class="affiliate-why">The proven plan for getting out of debt</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/B088FCSL6S?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Budget Planner & Expense Tracker</span>
        <span class="affiliate-why">Track every dollar on your debt-free journey</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SIDE-BY-SIDE COMPARISON
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-compare" role="region" aria-label="Side-by-Side Comparison">
    <div class="calc-container" style="padding-top: 6rem; max-width: 1100px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">‚öñÔ∏è</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Side-by-Side Comparison</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Compare two mortgage scenarios to see which option saves you more money.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Side-by-Side Comparison')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Side-by-Side Comparison')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('compare')">üîó Share Results</button>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
        <!-- Scenario A -->
        <div class="glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--brand-primary);">üÖ∞Ô∏è Scenario A</h3>
          <div class="input-group"><label>Home Price ($)</label><input type="number" id="cmp-a-price" value="600000" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Interest Rate (%)</label><input type="number" id="cmp-a-rate" value="5.5" step="0.01" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Amortization (years)</label><input type="number" id="cmp-a-amort" value="25" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Down Payment (%)</label><input type="number" id="cmp-a-down" value="20" oninput="calculateComparison()" /></div>
        </div>
        <!-- Scenario B -->
        <div class="glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 1rem; margin-bottom: 1rem; color: var(--brand-accent);">üÖ±Ô∏è Scenario B</h3>
          <div class="input-group"><label>Home Price ($)</label><input type="number" id="cmp-b-price" value="550000" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Interest Rate (%)</label><input type="number" id="cmp-b-rate" value="4.8" step="0.01" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Amortization (years)</label><input type="number" id="cmp-b-amort" value="30" oninput="calculateComparison()" /></div>
          <div class="input-group"><label>Down Payment (%)</label><input type="number" id="cmp-b-down" value="20" oninput="calculateComparison()" /></div>
        </div>
      </div>

      <!-- Results -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem;">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üÖ∞Ô∏è Monthly Payment</div>
          <div class="result-value" id="cmp-a-payment" style="font-size: 1.5rem;">$0</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Total Interest: <span id="cmp-a-interest">$0</span></div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Cost: <span id="cmp-a-total">$0</span></div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üÖ±Ô∏è Monthly Payment</div>
          <div class="result-value" id="cmp-b-payment" style="font-size: 1.5rem;">$0</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">Total Interest: <span id="cmp-b-interest">$0</span></div>
          <div style="font-size: 0.8rem; color: var(--text-secondary);">Total Cost: <span id="cmp-b-total">$0</span></div>
        </div>
      </div>

      <!-- Verdict -->
      <div class="result-card" style="margin-top: 1.5rem; text-align: center; padding: var(--space-xl);">
        <div class="result-label" style="font-size: 1.1rem;">üèÜ Verdict</div>
        <div class="result-value" id="cmp-verdict" style="font-size: 1.2rem; line-height: 1.6;">Enter values to compare</div>
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/B00000JZKB?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Texas Instruments BA II Plus</span>
        <span class="affiliate-why">Run your own calculations alongside the comparison</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/B088FCSL6S?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Budget Planner Journal</span>
        <span class="affiliate-why">Track and compare your financial scenarios on paper</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CURRENCY CONVERTER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-currency" role="region" aria-label="Currency Converter">
    <div class="calc-container" style="padding-top: 6rem; max-width: 700px;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>

      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí±</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Currency Converter</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Convert Canadian Dollars to major world currencies. Rates are approximate.</p>
      </div>

      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Currency Converter')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Currency Converter')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('currency')">üîó Share Results</button>
      </div>

      <div class="glass-card" style="padding: var(--space-xl); margin-top: 2rem;">
        <div class="input-group">
          <label>Amount in CAD ($)</label>
          <input type="number" id="currency-amount" value="1000" oninput="convertCurrency()" style="font-size: 1.2rem; text-align: center;" />
        </div>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;" id="currency-results">
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá∫üá∏ US Dollar (USD)</div>
          <div class="result-value" id="cur-usd" style="font-size: 1.4rem;">$0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.7353 USD</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá™üá∫ Euro (EUR)</div>
          <div class="result-value" id="cur-eur" style="font-size: 1.4rem;">‚Ç¨0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.6803 EUR</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá¨üáß British Pound (GBP)</div>
          <div class="result-value" id="cur-gbp" style="font-size: 1.4rem;">¬£0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 0.5814 GBP</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üáÆüá≥ Indian Rupee (INR)</div>
          <div class="result-value" id="cur-inr" style="font-size: 1.4rem;">‚Çπ0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 62.50 INR</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üáØüáµ Japanese Yen (JPY)</div>
          <div class="result-value" id="cur-jpy" style="font-size: 1.4rem;">¬•0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 111.11 JPY</div>
        </div>
        <div class="result-card" style="text-align: center;">
          <div class="result-label">üá¶üá∫ Australian Dollar (AUD)</div>
          <div class="result-value" id="cur-aud" style="font-size: 1.4rem;">A$0</div>
          <div style="font-size: 0.75rem; color: var(--text-secondary);">1 CAD = 1.1236 AUD</div>
        </div>
      </div>

      <p style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-top: 1.5rem;">‚ö†Ô∏è Rates are approximate and for reference only. Check a live source for current rates.</p>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/0060555661?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">The Intelligent Investor</span>
        <span class="affiliate-author">Benjamin Graham</span>
        <span class="affiliate-why">The foundational text on value investing and global markets</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       FHSA CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-fhsa" role="region" aria-label="FHSA Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè†</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">FHSA Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">First Home Savings Account ‚Äî save tax-free for your first home with tax-deductible contributions.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('FHSA Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('FHSA Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('fhsa')">üîó Share</button>
      </div>
      
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Annual Contribution ($)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="fhsa-contribution" min="1000" max="8000" value="8000" step="500" oninput="calculateFHSA(); document.getElementById('fhsa-contribution-val').textContent = '$' + parseInt(this.value).toLocaleString()" />
              <span id="fhsa-contribution-val" class="mono" style="font-size: 0.85rem; min-width: 4.5rem; text-align: right;">$8,000</span>
            </div>
            <span class="input-help">Maximum $8,000 per year</span>
          </div>
          
          <div class="input-group">
            <label>Years Until Home Purchase</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="fhsa-years" min="1" max="15" value="5" step="1" oninput="calculateFHSA(); document.getElementById('fhsa-years-val').textContent = this.value + ' years'" />
              <span id="fhsa-years-val" class="mono" style="font-size: 0.85rem; min-width: 4.5rem; text-align: right;">5 years</span>
            </div>
            <span class="input-help">Must be used within 15 years</span>
          </div>
          
          <div class="input-group">
            <label>Expected Annual Return (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="fhsa-return" min="1" max="12" value="6" step="0.5" oninput="calculateFHSA(); document.getElementById('fhsa-return-val').textContent = this.value + '%'" />
              <span id="fhsa-return-val" class="mono" style="font-size: 0.85rem; min-width: 4.5rem; text-align: right;">6%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Marginal Tax Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="fhsa-taxrate" min="20" max="54" value="33" step="1" oninput="calculateFHSA(); document.getElementById('fhsa-taxrate-val').textContent = this.value + '%'" />
              <span id="fhsa-taxrate-val" class="mono" style="font-size: 0.85rem; min-width: 4.5rem; text-align: right;">33%</span>
            </div>
            <span class="input-help">For tax deduction calculations</span>
          </div>
          
          <div class="input-group">
            <label>Current Savings Towards Home ($)</label>
            <input type="number" id="fhsa-current" value="0" oninput="calculateFHSA()" />
          </div>
        </div>
        
        <div class="calc-results" id="fhsa-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="fhsa-chart">
        <!-- Chart populated by JS -->
      </div>

      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/0968394744?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">The Wealthy Barber Returns</span>
              <span class="affiliate-author">David Chilton</span>
              <span class="affiliate-why">Essential Canadian financial literacy for first-time buyers</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/1119715911?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Home Buying for Canadians for Dummies</span>
              <span class="affiliate-why">Step-by-step guide to buying your first home in Canada</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       RESP CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-resp" role="region" aria-label="RESP Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üéì</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">RESP Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Plan your child's education savings with government grants and investment growth.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('RESP Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('RESP Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('resp')">üîó Share</button>
      </div>
      
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Child's Current Age</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="resp-age" min="0" max="17" value="0" step="1" oninput="calculateRESP(); document.getElementById('resp-age-val').textContent = this.value + ' years old'" />
              <span id="resp-age-val" class="mono" style="font-size: 0.85rem; min-width: 6rem; text-align: right;">0 years old</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Monthly Contribution ($)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="resp-monthly" min="50" max="500" value="208" step="10" oninput="calculateRESP(); document.getElementById('resp-monthly-val').textContent = '$' + parseInt(this.value).toLocaleString()" />
              <span id="resp-monthly-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">$208</span>
            </div>
            <span class="input-help">$208/month ‚âà $2,500/year (max CESG match)</span>
          </div>
          
          <div class="input-group">
            <label>Expected Annual Return (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="resp-return" min="2" max="10" value="5" step="0.5" oninput="calculateRESP(); document.getElementById('resp-return-val').textContent = this.value + '%'" />
              <span id="resp-return-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">5%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Province</label>
            <select id="resp-province" onchange="calculateRESP()">
              <option value="ON">Ontario</option>
              <option value="BC">British Columbia</option>
              <option value="QC">Quebec</option>
              <option value="AB">Alberta</option>
              <option value="SK">Saskatchewan</option>
              <option value="MB">Manitoba</option>
              <option value="NS">Nova Scotia</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="PE">Prince Edward Island</option>
            </select>
            <span class="input-help">BC, QC, SK offer additional provincial grants</span>
          </div>
        </div>
        
        <div class="calc-results" id="resp-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="resp-chart">
        <!-- Chart populated by JS -->
      </div>

      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/B01B9A0XLA?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Wealthing Like Rabbits</span>
              <span class="affiliate-author">Robert Brown</span>
              <span class="affiliate-why">Makes saving for your kids' future feel achievable</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       RENT VS BUY CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-rentbuy" role="region" aria-label="Rent vs Buy Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üèòÔ∏è</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Rent vs Buy Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Compare the true cost of renting vs buying over time with complete financial analysis.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Rent vs Buy Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Rent vs Buy Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('rentbuy')">üîó Share</button>
      </div>
      
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Purchase Details</h3>
          
          <div class="input-group">
            <label>Home Price ($)</label>
            <input type="number" id="rb-price" value="700000" oninput="calculateRentBuy()" />
          </div>
          
          <div class="input-group">
            <label>Down Payment (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="rb-down" min="5" max="50" value="20" step="1" oninput="calculateRentBuy(); document.getElementById('rb-down-val').textContent = this.value + '%'" />
              <span id="rb-down-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">20%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Mortgage Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="rb-rate" min="1" max="10" value="5.5" step="0.1" oninput="calculateRentBuy(); document.getElementById('rb-rate-val').textContent = this.value + '%'" />
              <span id="rb-rate-val" class="mono" style="font-size: 0.85rem; min-width: 4rem; text-align: right;">5.5%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Amortization (years)</label>
            <select id="rb-amort" onchange="calculateRentBuy()">
              <option value="25">25 years</option>
              <option value="30">30 years</option>
            </select>
          </div>
          
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Renting Details</h3>
          
          <div class="input-group">
            <label>Monthly Rent ($)</label>
            <input type="number" id="rb-rent" value="2500" oninput="calculateRentBuy()" />
          </div>
          
          <div class="input-group">
            <label>Annual Rent Increase (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="rb-rentinc" min="0" max="8" value="3" step="0.5" oninput="calculateRentBuy(); document.getElementById('rb-rentinc-val').textContent = this.value + '%'" />
              <span id="rb-rentinc-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">3%</span>
            </div>
          </div>
          
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">Other Assumptions</h3>
          
          <div class="input-group">
            <label>Property Tax Rate (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="rb-proptax" min="0.5" max="2.5" value="1" step="0.1" oninput="calculateRentBuy(); document.getElementById('rb-proptax-val').textContent = this.value + '%'" />
              <span id="rb-proptax-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">1%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Annual Maintenance (% of home value)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="rb-maint" min="0.5" max="3" value="1" step="0.25" oninput="calculateRentBuy(); document.getElementById('rb-maint-val').textContent = this.value + '%'" />
              <span id="rb-maint-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">1%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Expected Home Appreciation (%)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="rb-apprec" min="-2" max="8" value="3" step="0.5" oninput="calculateRentBuy(); document.getElementById('rb-apprec-val').textContent = this.value + '%'" />
              <span id="rb-apprec-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">3%</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Investment Return (% for renter)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="rb-invret" min="2" max="12" value="7" step="0.5" oninput="calculateRentBuy(); document.getElementById('rb-invret-val').textContent = this.value + '%'" />
              <span id="rb-invret-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">7%</span>
            </div>
          </div>
        </div>
        
        <div class="calc-results" id="rb-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="rb-chart">
        <!-- Chart populated by JS -->
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/0968394744?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">The Wealthy Barber Returns</span>
        <span class="affiliate-author">David Chilton</span>
        <span class="affiliate-why">Classic Canadian guide to smart housing and money decisions</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/1119356296?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Millionaire Teacher</span>
        <span class="affiliate-author">Andrew Hallam</span>
        <span class="affiliate-why">Build wealth on any salary ‚Äî with Canadian examples</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       GIC LADDER CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-gic" role="region" aria-label="GIC Ladder Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">ü™ú</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">GIC Ladder Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Build a GIC ladder strategy for better liquidity and steady returns.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('GIC Ladder Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('GIC Ladder Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('gic')">üîó Share</button>
      </div>
      
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Total Investment ($)</label>
            <input type="number" id="gic-amount" value="50000" oninput="calculateGIC()" />
            <span class="input-help">Will be divided into 5 equal parts</span>
          </div>
          
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin: 1.5rem 0 1rem;">GIC Rates (%)</h3>
          
          <div class="input-group">
            <label>1-Year GIC Rate</label>
            <input type="number" id="gic-rate1" value="4.0" step="0.1" oninput="calculateGIC()" />
          </div>
          
          <div class="input-group">
            <label>2-Year GIC Rate</label>
            <input type="number" id="gic-rate2" value="4.2" step="0.1" oninput="calculateGIC()" />
          </div>
          
          <div class="input-group">
            <label>3-Year GIC Rate</label>
            <input type="number" id="gic-rate3" value="4.3" step="0.1" oninput="calculateGIC()" />
          </div>
          
          <div class="input-group">
            <label>4-Year GIC Rate</label>
            <input type="number" id="gic-rate4" value="4.4" step="0.1" oninput="calculateGIC()" />
          </div>
          
          <div class="input-group">
            <label>5-Year GIC Rate</label>
            <input type="number" id="gic-rate5" value="4.5" step="0.1" oninput="calculateGIC()" />
          </div>
        </div>
        
        <div class="calc-results" id="gic-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <div class="chart-container" style="margin-top: 2rem;" id="gic-chart">
        <!-- Chart populated by JS -->
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/1775343707?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Beat the Bank</span>
        <span class="affiliate-author">Larry Bates</span>
        <span class="affiliate-why">Understand the true cost of financial products in Canada</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CPP/OAS RETIREMENT INCOME CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page" id="page-cpp" role="region" aria-label="CPP/OAS Retirement Income Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üá®üá¶</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">CPP/OAS Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Estimate your Canada Pension Plan and Old Age Security benefits.</p>
      </div>
      
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('CPP/OAS Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('CPP/OAS Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('cpp')">üîó Share</button>
      </div>
      
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label>Current Age</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="cpp-age" min="30" max="69" value="55" step="1" oninput="calculateCPP(); document.getElementById('cpp-age-val').textContent = this.value" />
              <span id="cpp-age-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">55</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Planned CPP Start Age</label>
            <select id="cpp-start" onchange="calculateCPP()">
              <option value="60">60</option>
              <option value="61">61</option>
              <option value="62">62</option>
              <option value="63">63</option>
              <option value="64">64</option>
              <option value="65" selected>65</option>
              <option value="66">66</option>
              <option value="67">67</option>
              <option value="68">68</option>
              <option value="69">69</option>
              <option value="70">70</option>
            </select>
            <span class="input-help">0.6% reduction/month before 65, 0.7% increase/month after</span>
          </div>
          
          <div class="input-group">
            <label>Years of Maximum CPP Contributions</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="cpp-years" min="0" max="39" value="30" step="1" oninput="calculateCPP(); document.getElementById('cpp-years-val').textContent = this.value + ' years'" />
              <span id="cpp-years-val" class="mono" style="font-size: 0.85rem; min-width: 5rem; text-align: right;">30 years</span>
            </div>
          </div>
          
          <div class="input-group">
            <label>Average Career Earnings (% of YMPE)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
              <input type="range" id="cpp-earnings" min="50" max="100" value="80" step="5" oninput="calculateCPP(); document.getElementById('cpp-earnings-val').textContent = this.value + '%'" />
              <span id="cpp-earnings-val" class="mono" style="font-size: 0.85rem; min-width: 3rem; text-align: right;">80%</span>
            </div>
            <span class="input-help">YMPE = Year's Maximum Pensionable Earnings</span>
          </div>
          
          <div class="input-group">
            <label>Other Annual Retirement Income ($)</label>
            <input type="number" id="cpp-otherincome" value="30000" oninput="calculateCPP()" />
            <span class="input-help">Used to calculate OAS clawback</span>
          </div>
        </div>
        
        <div class="calc-results" id="cpp-results" aria-live="polite">
          <!-- Results populated by JS -->
        </div>
      </div>
      
      <div style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary);" id="cpp-comparison">
        <!-- Comparison table populated by JS -->
      </div>

      <div class="affiliate-resources">
  <h3>üìö Recommended Resources</h3>
  <div class="affiliate-grid">
    <a href="https://www.amazon.ca/dp/0968394744?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">The Wealthy Barber Returns</span>
        <span class="affiliate-author">David Chilton</span>
        <span class="affiliate-why">Canada's most-loved finance book ‚Äî covers CPP, OAS, and retirement planning</span>
      </div>
    </a>
    <a href="https://www.amazon.ca/dp/B01B9A0XLA?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
        <span class="affiliate-title">Wealthing Like Rabbits</span>
        <span class="affiliate-author">Robert Brown</span>
        <span class="affiliate-why">Fun, accessible Canadian guide to retirement savings</span>
      </div>
    </a>
  </div>
  <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       CAPITAL GAINS TAX CALCULATOR
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-capgains" role="region" aria-label="Capital Gains Tax Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìä</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Capital Gains Tax Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Calculate Canadian capital gains tax with 2024+ inclusion rate changes. Compare old vs new rules.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Capital Gains Tax Calculator')">üìÑ Download PDF Report</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Capital Gains Tax Calculator')">üìã Copy Results</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('capgains')">üîó Share</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">

          <div class="input-group">
            <label for="cg-asset-type">Asset Type</label>
            <select id="cg-asset-type" onchange="calculateCapGains()">
              <option value="stocks">Stocks / ETFs / Mutual Funds</option>
              <option value="real-estate">Real Estate (non-principal)</option>
              <option value="crypto">Cryptocurrency</option>
              <option value="business">Qualified Small Business Shares</option>
              <option value="farm">Qualified Farm/Fishing Property</option>
              <option value="other">Other Capital Property</option>
            </select>
          </div>

          <div class="input-group">
            <label for="cg-year">Year of Disposition</label>
            <select id="cg-year" onchange="calculateCapGains()">
              <option value="2023">2023 or earlier</option>
              <option value="2024">2024</option>
              <option value="2025" selected>2025</option>
              <option value="2026">2026+</option>
            </select>
          </div>

          <div class="input-group">
            <label for="cg-province">Province / Territory</label>
            <select id="cg-province" onchange="calculateCapGains()">
              <option value="AB">Alberta</option>
              <option value="BC">British Columbia</option>
              <option value="MB">Manitoba</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="NS">Nova Scotia</option>
              <option value="NT">Northwest Territories</option>
              <option value="NU">Nunavut</option>
              <option value="ON" selected>Ontario</option>
              <option value="PE">Prince Edward Island</option>
              <option value="QC">Quebec</option>
              <option value="SK">Saskatchewan</option>
              <option value="YT">Yukon</option>
            </select>
          </div>

          <div class="input-group">
            <label for="cg-sale-price">Sale Price / Proceeds of Disposition ($)</label>
            <input type="number" id="cg-sale-price" value="500000" min="0" step="1000" oninput="calculateCapGains()">
          </div>

          <div class="input-group">
            <label for="cg-acb">Adjusted Cost Base (ACB) ($)</label>
            <input type="number" id="cg-acb" value="200000" min="0" step="1000" oninput="calculateCapGains()">
          </div>

          <div class="input-group">
            <label for="cg-expenses">Selling Expenses / Commissions ($)</label>
            <input type="number" id="cg-expenses" value="0" min="0" step="100" oninput="calculateCapGains()">
          </div>

          <div class="input-group">
            <label for="cg-other-gains">Other Capital Gains This Year ($)</label>
            <input type="number" id="cg-other-gains" value="0" min="0" step="1000" oninput="calculateCapGains()">
            <small style="color: var(--text-secondary);">Used to determine if total exceeds $250K threshold</small>
          </div>

          <div class="input-group">
            <label for="cg-capital-losses">Capital Losses to Apply ($)</label>
            <input type="number" id="cg-capital-losses" value="0" min="0" step="1000" oninput="calculateCapGains()">
            <small style="color: var(--text-secondary);">Carry-forward/back losses to offset gains</small>
          </div>

          <div class="input-group">
            <label for="cg-other-income">Other Taxable Income ($)</label>
            <input type="number" id="cg-other-income" value="80000" min="0" step="1000" oninput="calculateCapGains()">
            <small style="color: var(--text-secondary);">Employment, business, etc. (for bracket calculation)</small>
          </div>

          <div class="input-group" id="cg-lcge-group">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" id="cg-lcge" onchange="calculateCapGains()">
              Apply Lifetime Capital Gains Exemption (LCGE)
            </label>
            <small style="color: var(--text-secondary);">$1.25M for qualified small business shares (2025+), $1.016M (2024)</small>
          </div>

          <div class="input-group">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
              <input type="checkbox" id="cg-principal-res" onchange="calculateCapGains()">
              Principal Residence Exemption
            </label>
          </div>

        </div>
        <div class="calc-results" id="cg-results" aria-live="polite"></div>
      </div>
      <div style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary);" id="cg-breakdown"></div>
      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/1119356296?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Millionaire Teacher</span>
              <span class="affiliate-author">Andrew Hallam</span>
              <span class="affiliate-why">Build wealth on any salary ‚Äî with Canadian examples</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/0143193856?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Wealthing Like Rabbits</span>
              <span class="affiliate-author">Robert R. Brown</span>
              <span class="affiliate-why">Fun Canadian guide to personal finance fundamentals</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
</div>


  <!-- TFSA Contribution Room Calculator -->
<div class="page" id="page-tfsa" role="region" aria-label="TFSA Contribution Room Calculator">
  <div class="calc-container" style="padding-top: 6rem;">
    <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
    <div class="calc-header animate-fade-up">
      <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üè¶</div>
      <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">TFSA Contribution Room Calculator</h1>
      <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Track your TFSA contribution room from 2009 to today. Never over-contribute again.</p>
    </div>
    <div class="action-buttons" style="justify-content: center;">
      <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('TFSA Contribution Room Calculator')">üìÑ Download PDF Report</button>
      <button class="btn btn-secondary btn-sm" onclick="copyResults('TFSA Contribution Room Calculator')">üìã Copy Results</button>
      <button class="btn btn-secondary btn-sm" onclick="shareCalculator('tfsa')">üîó Share</button>
    </div>
    <div class="calc-grid" style="margin-top: 2rem;">
      <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
        <div class="input-group">
          <label for="tfsa-birth-year">Birth Year</label>
          <input type="number" id="tfsa-birth-year" min="1900" max="2008" value="1990" oninput="calculateTFSA()">
        </div>
        <div class="input-group">
          <label for="tfsa-resident-check">
            <input type="checkbox" id="tfsa-resident-check" checked oninput="calculateTFSA(); document.getElementById('tfsa-residency-year-group').style.display = this.checked ? 'none' : 'block';">
            Born in Canada / resident since before 2009
          </label>
        </div>
        <div class="input-group" id="tfsa-residency-year-group" style="display: none;">
          <label for="tfsa-residency-year">Year You Became a Canadian Resident</label>
          <input type="number" id="tfsa-residency-year" min="2009" max="2026" value="2015" oninput="calculateTFSA()">
        </div>
        <div class="input-group">
          <label for="tfsa-contributions">Total Contributions to Date ($)</label>
          <input type="number" id="tfsa-contributions" min="0" step="100" value="0" oninput="calculateTFSA()">
        </div>
        <button class="btn btn-primary" onclick="calculateTFSA()" style="width: 100%; margin-top: 1rem;">Calculate My TFSA Room</button>
      </div>
      <div class="calc-results" id="tfsa-results" aria-live="polite"></div>
    </div>
    <div style="margin-top: 2rem;" id="tfsa-chart"></div>
    <div style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary);" id="tfsa-breakdown"></div>
    <div class="affiliate-resources">
      <h3>üìö Recommended Resources</h3>
      <div class="affiliate-grid">
        <a href="https://www.amazon.ca/dp/1119356296?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
          <div class="affiliate-info">
            <span class="affiliate-title">Millionaire Teacher</span>
            <span class="affiliate-author">Andrew Hallam</span>
            <span class="affiliate-why">Canadian investing fundamentals</span>
          </div>
        </a>
        <a href="https://www.amazon.ca/dp/0143188410?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
          <div class="affiliate-info">
            <span class="affiliate-title">Wealthing Like Rabbits</span>
            <span class="affiliate-author">Robert R. Brown</span>
            <span class="affiliate-why">Fun intro to Canadian personal finance</span>
          </div>
        </a>
      </div>
      <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
    </div>
  </div>
</div>


  <!-- RRSP Tax Refund Calculator -->
<div class="page" id="page-rrsp" role="region" aria-label="RRSP Tax Refund Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üí∞</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">RRSP Tax Refund Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">See exactly how much you'll get back ‚Äî and find the optimal contribution to minimize your tax bill.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('RRSP Tax Refund Calculator')">üìÑ PDF</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('RRSP Tax Refund Calculator')">üìã Copy</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('rrsp')">üîó Share</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">
          <div class="input-group">
            <label for="rrsp-income">Employment Income</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="rrsp-income" placeholder="85,000" min="0" step="100" oninput="calculateRRSP()">
            </div>
          </div>
          <div class="input-group">
            <label for="rrsp-other-income">Other Income <span style="color: var(--text-secondary); font-weight: 400;">(optional)</span></label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="rrsp-other-income" placeholder="0" min="0" step="100" oninput="calculateRRSP()">
            </div>
          </div>
          <div class="input-group">
            <label for="rrsp-province">Province / Territory</label>
            <select id="rrsp-province" onchange="calculateRRSP()">
              <option value="AB">Alberta</option>
              <option value="BC">British Columbia</option>
              <option value="MB">Manitoba</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland &amp; Labrador</option>
              <option value="NS">Nova Scotia</option>
              <option value="NT">Northwest Territories</option>
              <option value="NU">Nunavut</option>
              <option value="ON" selected>Ontario</option>
              <option value="PE">Prince Edward Island</option>
              <option value="QC">Quebec</option>
              <option value="SK">Saskatchewan</option>
              <option value="YT">Yukon</option>
            </select>
          </div>
          <div class="input-group">
            <label for="rrsp-contribution">Planned RRSP Contribution</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="rrsp-contribution" placeholder="10,000" min="0" step="100" oninput="calculateRRSP()">
            </div>
            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;" id="rrsp-room-hint">2026 max: 18% of earned income, up to $32,490</div>
          </div>
          <button class="btn btn-primary" onclick="calculateRRSP()" style="width: 100%; margin-top: 0.5rem;">Calculate Tax Refund</button>
        </div>
        <div class="calc-results" id="rrsp-results" aria-live="polite"></div>
      </div>
      <div style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary);" id="rrsp-breakdown"></div>
      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/0143190008?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">The Wealthy Barber Returns</span>
              <span class="affiliate-author">David Chilton</span>
              <span class="affiliate-why">Essential Canadian financial planning</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
</div>


  <!-- Canadian Income Tax Calculator -->
<div class="page" id="page-incometax" role="region" aria-label="Canadian Income Tax Calculator">
    <div class="calc-container" style="padding-top: 6rem;">
      <div class="calc-back" onclick="showPage('home')" role="button" tabindex="0" aria-label="Back to Tools">‚Üê Back to Tools</div>
      <div class="calc-header animate-fade-up">
        <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üßæ</div>
        <h1 style="font-size: 2rem; margin-bottom: 0.5rem;">Canadian Income Tax Calculator</h1>
        <p style="color: var(--text-secondary); max-width: 540px; margin: 0 auto;">Complete T1 tax estimator for all provinces and territories. Employment, self-employment, investments, and more.</p>
      </div>
      <div class="action-buttons" style="justify-content: center;">
        <button class="btn btn-secondary btn-sm" onclick="generatePDFReport('Canadian Income Tax Calculator')">üìÑ PDF</button>
        <button class="btn btn-secondary btn-sm" onclick="copyResults('Canadian Income Tax Calculator')">üìã Copy</button>
        <button class="btn btn-secondary btn-sm" onclick="shareCalculator('incometax')">üîó Share</button>
      </div>
      <div class="calc-grid" style="margin-top: 2rem;">
        <div class="calc-inputs glass-card" style="padding: var(--space-xl);">

          <div class="input-group">
            <label for="incometax-province">Province / Territory</label>
            <select id="incometax-province" onchange="calculateIncomeTax()">
              <option value="AB">Alberta</option>
              <option value="BC">British Columbia</option>
              <option value="MB">Manitoba</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland &amp; Labrador</option>
              <option value="NS">Nova Scotia</option>
              <option value="NT">Northwest Territories</option>
              <option value="NU">Nunavut</option>
              <option value="ON" selected>Ontario</option>
              <option value="PE">Prince Edward Island</option>
              <option value="QC">Quebec</option>
              <option value="SK">Saskatchewan</option>
              <option value="YT">Yukon</option>
            </select>
          </div>

          <div class="input-group">
            <label for="incometax-employment">Employment Income</label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="incometax-employment" placeholder="85,000" min="0" step="100" oninput="calculateIncomeTax()">
            </div>
          </div>

          <div class="input-group">
            <label for="incometax-selfemploy">Self-Employment Income <span style="color: var(--text-secondary); font-weight: 400;">(optional)</span></label>
            <div class="input-with-prefix">
              <span class="input-prefix">$</span>
              <input type="number" id="incometax-selfemploy" placeholder="0" min="0" step="100" oninput="calculateIncomeTax()">
            </div>
          </div>

          <!-- Collapsible: Investment Income -->
          <details style="margin-top: 0.5rem;">
            <summary style="cursor: pointer; font-weight: 600; color: var(--text-secondary); font-size: 0.9rem; padding: 0.5rem 0;">üìà Investment Income</summary>
            <div style="padding-top: 0.5rem;">
              <div class="input-group">
                <label for="incometax-capitalgains">Capital Gains <span style="color: var(--text-secondary); font-weight: 400;">(total, 50% taxable)</span></label>
                <div class="input-with-prefix">
                  <span class="input-prefix">$</span>
                  <input type="number" id="incometax-capitalgains" placeholder="0" min="0" step="100" oninput="calculateIncomeTax()">
                </div>
              </div>
              <div class="input-group">
                <label for="incometax-eligible-div">Eligible Dividends <span style="color: var(--text-secondary); font-weight: 400;">(Canadian public co.)</span></label>
                <div class="input-with-prefix">
                  <span class="input-prefix">$</span>
                  <input type="number" id="incometax-eligible-div" placeholder="0" min="0" step="100" oninput="calculateIncomeTax()">
                </div>
              </div>
              <div class="input-group">
                <label for="incometax-ineligible-div">Ineligible Dividends <span style="color: var(--text-secondary); font-weight: 400;">(Canadian private co.)</span></label>
                <div class="input-with-prefix">
                  <span class="input-prefix">$</span>
                  <input type="number" id="incometax-ineligible-div" placeholder="0" min="0" step="100" oninput="calculateIncomeTax()">
                </div>
              </div>
            </div>
          </details>

          <!-- Collapsible: Other Income -->
          <details style="margin-top: 0.25rem;">
            <summary style="cursor: pointer; font-weight: 600; color: var(--text-secondary); font-size: 0.9rem; padding: 0.5rem 0;">üè† Other Income &amp; Deductions</summary>
            <div style="padding-top: 0.5rem;">
              <div class="input-group">
                <label for="incometax-rental">Rental Income (net) <span style="color: var(--text-secondary); font-weight: 400;">(optional)</span></label>
                <div class="input-with-prefix">
                  <span class="input-prefix">$</span>
                  <input type="number" id="incometax-rental" placeholder="0" min="0" step="100" oninput="calculateIncomeTax()">
                </div>
              </div>
              <div class="input-group">
                <label for="incometax-rrsp">RRSP Deduction</label>
                <div class="input-with-prefix">
                  <span class="input-prefix">$</span>
                  <input type="number" id="incometax-rrsp" placeholder="0" min="0" step="100" oninput="calculateIncomeTax()">
                </div>
              </div>
              <div class="input-group">
                <label for="incometax-other-deductions">Other Deductions <span style="color: var(--text-secondary); font-weight: 400;">(union dues, childcare, etc.)</span></label>
                <div class="input-with-prefix">
                  <span class="input-prefix">$</span>
                  <input type="number" id="incometax-other-deductions" placeholder="0" min="0" step="100" oninput="calculateIncomeTax()">
                </div>
              </div>
            </div>
          </details>

          <button class="btn btn-primary" onclick="calculateIncomeTax()" style="width: 100%; margin-top: 1rem;">Calculate My Taxes</button>
        </div>
        <div class="calc-results" id="incometax-results" aria-live="polite"></div>
      </div>
      <div id="incometax-breakdown" style="margin-top: 2rem; padding: 1.5rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary);"></div>
      <div class="affiliate-resources">
        <h3>üìö Recommended Resources</h3>
        <div class="affiliate-grid">
          <a href="https://www.amazon.ca/dp/0143190008?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">The Wealthy Barber Returns</span>
              <span class="affiliate-author">David Chilton</span>
              <span class="affiliate-why">Essential Canadian financial planning</span>
            </div>
          </a>
          <a href="https://www.amazon.ca/dp/1119856159?tag=figgy0a0-20" target="_blank" rel="noopener noreferrer sponsored" class="affiliate-card">
            <div class="affiliate-info">
              <span class="affiliate-title">Personal Finance for Canadians FD</span>
              <span class="affiliate-author">Eric Tyson &amp; Tony Martin</span>
              <span class="affiliate-why">Comprehensive Canadian tax &amp; finance guide</span>
            </div>
          </a>
        </div>
        <p class="affiliate-disclosure">As an Amazon Associate, FiggyBank earns from qualifying purchases.</p>
      </div>
    </div>
</div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       JAVASCRIPT ENGINE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <script>
    console.log('FiggyBank v6.0 loaded ‚Äî run runTests() in console to verify');

    // ‚ïê‚ïê‚ïê v6 HOMEPAGE ENHANCEMENTS ‚ïê‚ïê‚ïê

    // Scroll progress bar
    const scrollProgress = document.getElementById('scroll-progress');
    if (scrollProgress) {
      window.addEventListener('scroll', () => {
        const h = document.documentElement.scrollHeight - window.innerHeight;
        scrollProgress.style.width = h > 0 ? (window.scrollY / h * 100) + '%' : '0%';
      }, { passive: true });
    }

    // Sparkle generator
    (function initSparkles() {
      const c = document.getElementById('sparkle-container');
      if (!c) return;
      for (let i = 0; i < 20; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = Math.random() * 100 + '%';
        s.style.top = Math.random() * 100 + '%';
        s.style.animationDelay = (Math.random() * 4) + 's';
        s.style.animationDuration = (2 + Math.random() * 3) + 's';
        const size = 2 + Math.random() * 4;
        s.style.width = size + 'px';
        s.style.height = size + 'px';
        c.appendChild(s);
      }
    })();

    // Mouse parallax
    document.addEventListener('mousemove', (e) => {
      const x = (e.clientX / window.innerWidth - 0.5) * 2;
      const y = (e.clientY / window.innerHeight - 0.5) * 2;
      document.querySelectorAll('.parallax-mouse').forEach(el => {
        const speed = parseFloat(el.dataset.speed) || 20;
        el.style.transform = `translate(${x * speed}px, ${y * speed}px)`;
      });
    });

    // Cursor glow trail
    (function initCursorTrail() {
      if (window.matchMedia('(pointer: coarse)').matches) return;
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
      const dot = document.createElement('div');
      dot.className = 'cursor-dot';
      document.body.appendChild(dot);
      let mx = 0, my = 0;
      document.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
      function tick() {
        dot.style.left = mx + 'px';
        dot.style.top = my + 'px';
        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    })();

    // Showcase tab switching
    function switchShowcase(tab) {
      document.querySelectorAll('.showcase-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.showcase-panel').forEach(p => p.classList.remove('active'));
      event.target.classList.add('active');
      const panel = document.getElementById('showcase-' + tab);
      if (panel) {
        panel.classList.add('active');
        // Animate bars in the active panel
        panel.querySelectorAll('.viz-bar').forEach((bar, i) => {
          bar.style.height = '0';
          setTimeout(() => { bar.style.height = bar.dataset.targetHeight || '50%'; }, 100 + i * 80);
        });
      }
    }
    // Init first panel bars
    setTimeout(() => {
      const firstPanel = document.querySelector('.showcase-panel.active');
      if (firstPanel) {
        firstPanel.querySelectorAll('.viz-bar').forEach((bar, i) => {
          setTimeout(() => { bar.style.height = bar.dataset.targetHeight || '50%'; }, 200 + i * 80);
        });
      }
    }, 600);

    // 3D tilt on tool cards
    document.querySelectorAll('.tool-card').forEach(card => {
      card.addEventListener('mousemove', e => {
        const rect = card.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width - 0.5;
        const y = (e.clientY - rect.top) / rect.height - 0.5;
        card.style.transform = `perspective(800px) rotateY(${x * 8}deg) rotateX(${-y * 8}deg) translateY(-4px)`;
      });
      card.addEventListener('mouseleave', () => {
        card.style.transform = '';
      });
    });

    // Staggered entrance for tool cards
    const staggerObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const cards = entry.target.querySelectorAll('.tool-card');
          cards.forEach((card, i) => {
            setTimeout(() => { card.classList.add('is-visible'); card.style.opacity = '1'; card.style.transform = 'translateY(0)'; }, i * 50);
          });
          staggerObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.tools-grid').forEach(g => staggerObserver.observe(g));

    // HIW timeline line animation
    const hiwObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const line = document.getElementById('hiw-line');
          if (line) line.classList.add('drawn');
          hiwObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.3 });
    const hiwEl = document.getElementById('hiw-timeline');
    if (hiwEl) hiwObserver.observe(hiwEl);

    // Page load stagger animation
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        document.querySelectorAll('.load-stagger').forEach(el => el.classList.add('loaded'));
      }, 100);
    });
    // In case DOMContentLoaded already fired
    setTimeout(() => {
      document.querySelectorAll('.load-stagger').forEach(el => el.classList.add('loaded'));
    }, 200);

    // Scroll-to-top piggy button
    (function initScrollTop() {
      const btn = document.createElement('button');
      btn.className = 'scroll-top-piggy';
      btn.innerHTML = 'üê∑';
      btn.setAttribute('aria-label', 'Scroll to top');
      btn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
      document.body.appendChild(btn);
      window.addEventListener('scroll', () => {
        btn.classList.toggle('visible', window.scrollY > 500);
      }, { passive: true });
    })();

    // Easter egg: click piggy logo 5 times for coin rain
    (function initEasterEgg() {
      let clicks = 0, timer;
      const logo = document.querySelector('.nav-logo');
      if (!logo) return;
      logo.addEventListener('click', function(e) {
        clicks++;
        clearTimeout(timer);
        timer = setTimeout(() => { clicks = 0; }, 2000);
        if (clicks >= 5) {
          clicks = 0;
          const coins = ['ü™ô', 'üí∞', 'üíµ', 'üê∑', '‚ú®', '$'];
          for (let i = 0; i < 40; i++) {
            const coin = document.createElement('div');
            coin.className = 'coin-rain-piece';
            coin.textContent = coins[Math.floor(Math.random() * coins.length)];
            coin.style.left = Math.random() * 100 + 'vw';
            coin.style.animationDuration = (2 + Math.random() * 2) + 's';
            coin.style.animationDelay = (Math.random() * 0.5) + 's';
            document.body.appendChild(coin);
            setTimeout(() => coin.remove(), 4000);
          }
        }
      });
    })();

    // ‚îÄ‚îÄ IntersectionObserver for js-show elements (CreditGenie-style) ‚îÄ‚îÄ
    const jsShowObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          jsShowObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
    document.querySelectorAll('.js-show').forEach(el => jsShowObserver.observe(el));

    // ‚îÄ‚îÄ Floating Particles Generator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    (function initParticles() {
      const container = document.getElementById('hero-particles');
      if (!container) return;
      const colors = ['var(--brand-primary)', 'var(--brand-secondary)', 'var(--brand-accent)', 'var(--brand-success)'];
      for (let i = 0; i < 30; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const size = 2 + Math.random() * 6;
        p.style.width = size + 'px';
        p.style.height = size + 'px';
        p.style.left = Math.random() * 100 + '%';
        p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        p.style.animationDuration = (15 + Math.random() * 25) + 's';
        p.style.animationDelay = (-Math.random() * 30) + 's';
        container.appendChild(p);
      }
    })();

    // ‚îÄ‚îÄ Featured Calculator Demo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function updateFeaturedDemo() {
      const fcf = parseFloat(document.getElementById('featured-fcf').value) || 0;
      const growth = (parseFloat(document.getElementById('featured-growth').value) || 0) / 100;
      const wacc = 0.12, terminal = 0.025, years = 5;
      if (wacc <= terminal || fcf <= 0) { document.getElementById('featured-result').textContent = '$0'; return; }
      let pv = 0;
      for (let i = 1; i <= years; i++) pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
      const ff = fcf * Math.pow(1 + growth, years) * (1 + terminal);
      pv += (ff / (wacc - terminal)) / Math.pow(1 + wacc, years);
      document.getElementById('featured-result').textContent = fmt(pv);
    }
    setTimeout(updateFeaturedDemo, 100);

    // ‚îÄ‚îÄ Industry Multiplier Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function setIndustryPreset(industry) {
      const presets = {
        saas: { evRev: 8, evEbitda: 25, pe: 35 },
        manufacturing: { evRev: 1.5, evEbitda: 8, pe: 14 },
        retail: { evRev: 0.75, evEbitda: 7, pe: 12 },
        healthcare: { evRev: 3, evEbitda: 14, pe: 22 },
        professional: { evRev: 2, evEbitda: 10, pe: 18 }
      };
      const p = presets[industry];
      if (!p) return;
      document.getElementById('mult-ev-rev').value = p.evRev;
      document.getElementById('mult-ev-rev-val').textContent = p.evRev + 'x';
      document.getElementById('mult-ev-ebitda').value = p.evEbitda;
      document.getElementById('mult-ev-ebitda-val').textContent = p.evEbitda + 'x';
      document.getElementById('mult-pe').value = p.pe;
      document.getElementById('mult-pe-val').textContent = p.pe + 'x';
      calculateMultiples();
    }

    // ‚îÄ‚îÄ Hiring Plan Row ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addHireRow() {
      const plan = document.getElementById('rw-hiring-plan');
      const row = document.createElement('div');
      row.style.cssText = 'display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:0.375rem;margin-bottom:0.5rem;align-items:end;';
      row.innerHTML = '<div class="input-group" style="margin:0"><label style="font-size:0.65rem">Role</label><input type="text" value="New Hire" class="rw-hire-role" oninput="calculateRunway()" /></div><div class="input-group" style="margin:0"><label style="font-size:0.65rem">Salary/mo</label><input type="number" value="6000" class="rw-hire-salary" oninput="calculateRunway()" /></div><div class="input-group" style="margin:0"><label style="font-size:0.65rem">Start Month</label><input type="number" value="6" class="rw-hire-month" min="1" oninput="calculateRunway()" /></div><button class="btn btn-secondary btn-sm" onclick="this.closest(\'[style]\').remove();calculateRunway();" style="padding:0.2rem 0.4rem;margin-bottom:2px;font-size:0.7rem;">‚úï</button>';
      plan.appendChild(row);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // NEW CALCULATORS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // ‚îÄ‚îÄ FHSA Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateFHSA() {
      const annualContrib = parseFloat(document.getElementById('fhsa-contribution').value) || 8000;
      const years = parseInt(document.getElementById('fhsa-years').value) || 5;
      const returnRate = (parseFloat(document.getElementById('fhsa-return').value) || 6) / 100;
      const taxRate = (parseFloat(document.getElementById('fhsa-taxrate').value) || 33) / 100;
      const currentSavings = parseFloat(document.getElementById('fhsa-current').value) || 0;
      
      // FHSA has $40,000 lifetime max
      const maxContrib = Math.min(annualContrib * years, 40000);
      const actualYears = Math.ceil(maxContrib / annualContrib);
      
      // Calculate FHSA balance with compound growth
      let fhsaBalance = 0;
      let totalContrib = 0;
      let totalTaxSavings = 0;
      const yearData = [];
      
      for (let y = 1; y <= years; y++) {
        const contrib = (totalContrib + annualContrib <= 40000) ? annualContrib : Math.max(0, 40000 - totalContrib);
        if (contrib > 0) {
          totalContrib += contrib;
          totalTaxSavings += contrib * taxRate;
          fhsaBalance += contrib;
        }
        fhsaBalance *= (1 + returnRate);
        yearData.push({ year: y, balance: fhsaBalance });
      }
      
      const investmentGrowth = fhsaBalance - totalContrib;
      const totalWithSavings = fhsaBalance + currentSavings;
      
      // Compare to TFSA (no deduction) ‚Äî same contributions, same growth, but no tax deduction
      let tfsaBalance = 0;
      let tfsaContrib = 0;
      for (let y = 1; y <= years; y++) {
        const contrib = (tfsaContrib + annualContrib <= 40000) ? annualContrib : Math.max(0, 40000 - tfsaContrib);
        if (contrib > 0) { tfsaContrib += contrib; tfsaBalance += contrib; }
        tfsaBalance *= (1 + returnRate);
      }
      
      // Compare to RRSP (deduction but taxed on withdrawal)
      const rrspBalance = fhsaBalance; // Same growth
      const rrspAfterTax = rrspBalance * (1 - taxRate);
      
      document.getElementById('fhsa-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Total FHSA Value</div>
          <div class="result-value">${fmtFull(fhsaBalance)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">Tax-free withdrawal for home purchase</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Your Contributions</div>
          <div class="result-value">${fmtFull(totalContrib)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">${years} years √ó max $8,000/yr (lifetime max $40K)</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Investment Growth</div>
          <div class="result-value">${fmtFull(investmentGrowth)}</div>
          <div style="font-size: 0.8rem; color: var(--text-success); margin-top: 0.25rem;">Tax-free growth at ${(returnRate * 100).toFixed(1)}% annually</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Tax Savings from Deductions</div>
          <div class="result-value">${fmtFull(totalTaxSavings)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">Contributions are tax-deductible</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Total for Down Payment</div>
          <div class="result-value">${fmtFull(totalWithSavings)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">FHSA + current savings</div>
        </div>
        
        <div class="result-card" style="grid-column: 1 / -1;">
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 0.75rem;">Account Comparison</div>
          <div style="display: grid; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
              <span><strong>FHSA</strong> (Tax deduction + tax-free growth)</span>
              <span class="mono" style="color: var(--brand-success); font-weight: 600;">${fmtFull(fhsaBalance)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
              <span>TFSA (No deduction, tax-free growth)</span>
              <span class="mono">${fmtFull(tfsaBalance)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
              <span>RRSP (Deduction but taxed on withdrawal)</span>
              <span class="mono">${fmtFull(rrspAfterTax)}</span>
            </div>
          </div>
          <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem;">üí° FHSA combines the best of RRSP (tax deduction) and TFSA (tax-free withdrawal) for first-time home buyers!</div>
        </div>
      `;
      
      // Enhanced Chart with Donut + Growth Visualization
      document.getElementById('fhsa-chart').innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1.5rem;">
          <div style="text-align: center;">
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Balance Breakdown</div>
            <div style="display: flex; justify-content: center; margin-bottom: 1rem;">
              ${svgDonut([
                {value: totalContrib, color: 'var(--brand-primary)', label: 'Contributions'},
                {value: investmentGrowth, color: 'var(--brand-success)', label: 'Growth'}
              ], 140)}
            </div>
            <div style="display: flex; gap: 1rem; justify-content: center; font-size: 0.75rem;">
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-primary); border-radius: 2px; margin-right: 4px;"></span>Contributions ${fmtPct((totalContrib/fhsaBalance)*100, 0)}</div>
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-success); border-radius: 2px; margin-right: 4px;"></span>Growth ${fmtPct((investmentGrowth/fhsaBalance)*100, 0)}</div>
            </div>
          </div>
          <div>
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Account Type Comparison</div>
            ${svgHorizontalBars([
              {label: 'FHSA', value: fhsaBalance, color: 'var(--brand-success)'},
              {label: 'TFSA', value: tfsaBalance, color: 'var(--brand-primary)'},
              {label: 'RRSP (net)', value: rrspAfterTax, color: 'var(--brand-warning)'}
            ], 350, 150)}
          </div>
        </div>
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Year-by-Year Growth</div>
        <div style="display: flex; align-items: flex-end; gap: 8px; height: 200px; padding: 1rem 0;">
          ${yearData.map((d, i) => {
            const pct = (d.balance / Math.max(...yearData.map(x => x.balance))) * 100;
            return `
              <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 100%;">
                <span style="font-size: 0.75rem; font-weight: 600; margin-bottom: 4px;">${fmt(d.balance, 0)}</span>
                <div data-target-height="${pct}%" style="width: 100%; background: linear-gradient(to top, var(--brand-primary), var(--brand-accent)); border-radius: 6px 6px 0 0; height: 0%; min-height: 4px; transition: height 0.8s ease ${i * 0.1}s;"></div>
                <span style="font-size: 0.7rem; color: var(--text-muted); margin-top: 4px;">Yr ${d.year}</span>
              </div>
            `;
          }).join('')}
        </div>
      `;
      // Animate bars after DOM update
      setTimeout(() => {
        document.querySelectorAll('#fhsa-chart [data-target-height]').forEach((el) => {
          el.style.height = el.getAttribute('data-target-height');
        });
      }, 50);
    }

    // ‚îÄ‚îÄ RESP Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateRESP() {
      const childAge = parseInt(document.getElementById('resp-age').value) || 0;
      const monthlyContrib = parseFloat(document.getElementById('resp-monthly').value) || 208;
      const returnRate = (parseFloat(document.getElementById('resp-return').value) || 5) / 100;
      const province = document.getElementById('resp-province').value;
      
      const yearsRemaining = Math.max(0, 18 - childAge);
      const annualContrib = monthlyContrib * 12;
      
      // CESG: 20% on first $2,500/year, max $500/year, lifetime max $7,200
      let totalContrib = 0;
      let totalCESG = 0;
      let totalProvGrant = 0;
      let balance = 0;
      const yearData = [];
      
      for (let y = 1; y <= yearsRemaining; y++) {
        const currentAge = childAge + y;
        
        // Personal contribution
        totalContrib += annualContrib;
        balance += annualContrib;
        
        // CESG (available until age 17)
        if (currentAge <= 17) {
          const cesgEligible = Math.min(annualContrib, 2500);
          const cesgAmount = Math.min(cesgEligible * 0.20, 500);
          if (totalCESG + cesgAmount <= 7200) {
            totalCESG += cesgAmount;
            balance += cesgAmount;
          }
        }
        
        // Provincial grants
        if (province === 'QC' && currentAge <= 17) {
          // QESI: 10% on first $2,500
          const qesiAmount = Math.min(annualContrib, 2500) * 0.10;
          totalProvGrant += qesiAmount;
          balance += qesiAmount;
        } else if (province === 'BC' && currentAge === 6) {
          // BCTESG: one-time $1,200 at age 6
          totalProvGrant += 1200;
          balance += 1200;
        } else if (province === 'SK' && currentAge <= 17) {
          // SAGES: matches first $2,500 at variable rate (simplified as one-time $500)
          if (y === 1) {
            totalProvGrant += 500;
            balance += 500;
          }
        }
        
        // Apply annual return
        balance *= (1 + returnRate);
        
        yearData.push({ year: y, age: currentAge, balance: balance });
      }
      
      const totalGrowth = balance - totalContrib - totalCESG - totalProvGrant;
      const avgTuition = 7000 * 4; // $28,000 for 4 years
      
      document.getElementById('resp-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Projected Total at Age 18</div>
          <div class="result-value">${fmtFull(balance)}</div>
          <div style="font-size: 0.8rem; color: var(--text-success); margin-top: 0.25rem;">${yearsRemaining} years of growth</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Your Contributions</div>
          <div class="result-value">${fmtFull(totalContrib)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">${fmtFull(monthlyContrib)}/month √ó ${yearsRemaining} years</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Government CESG</div>
          <div class="result-value">${fmtFull(totalCESG)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">20% match on first $2,500/yr</div>
        </div>
        
        ${totalProvGrant > 0 ? `
        <div class="result-card">
          <div class="result-label">Provincial Grant (${province})</div>
          <div class="result-value">${fmtFull(totalProvGrant)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">${province === 'QC' ? 'QESI' : province === 'BC' ? 'BCTESG' : 'SAGES'}</div>
        </div>
        ` : ''}
        
        <div class="result-card">
          <div class="result-label">Investment Growth</div>
          <div class="result-value">${fmtFull(totalGrowth)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">Tax-free growth at ${(returnRate * 100).toFixed(1)}%</div>
        </div>
        
        <div class="result-card" style="grid-column: 1 / -1;">
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 0.5rem;">Education Cost Comparison</div>
          <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--bg-secondary); border-radius: 6px; margin-bottom: 0.5rem;">
            <span>Average Canadian Tuition (4 years)</span>
            <span class="mono">${fmtFull(avgTuition)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: ${balance >= avgTuition ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; border-radius: 6px;">
            <span><strong>Your RESP Balance</strong></span>
            <span class="mono" style="font-weight: 600; color: ${balance >= avgTuition ? 'var(--brand-success)' : 'var(--brand-danger)'};">${fmtFull(balance)}</span>
          </div>
          ${balance >= avgTuition 
            ? `<div style="font-size: 0.75rem; color: var(--brand-success); margin-top: 0.5rem;">‚úì Fully funded! ${fmtFull(balance - avgTuition)} extra for living expenses.</div>` 
            : `<div style="font-size: 0.75rem; color: var(--brand-danger); margin-top: 0.5rem;">‚ö†Ô∏è Shortfall of ${fmtFull(avgTuition - balance)}. Consider increasing monthly contributions.</div>`
          }
        </div>
      `;
      
      // Enhanced chart with donut breakdown + stacked bars
      const maxVal = Math.max(...yearData.map(d => d.balance));
      document.getElementById('resp-chart').innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1.5rem;">
          <div style="text-align: center;">
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Total Balance Breakdown</div>
            <div style="display: flex; justify-content: center; margin-bottom: 1rem;">
              ${svgDonut([
                {value: totalContrib, color: 'var(--brand-primary)', label: 'Your Contributions'},
                {value: totalCESG + totalProvGrant, color: 'var(--fg-gold)', label: 'Government Grants'},
                {value: totalGrowth, color: 'var(--brand-success)', label: 'Investment Growth'}
              ], 140)}
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.75rem; align-items: center;">
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-primary); border-radius: 2px; margin-right: 4px;"></span>Your Money: ${fmtFull(totalContrib)}</div>
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--fg-gold); border-radius: 2px; margin-right: 4px;"></span>Grants: ${fmtFull(totalCESG + totalProvGrant)}</div>
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-success); border-radius: 2px; margin-right: 4px;"></span>Growth: ${fmtFull(totalGrowth)}</div>
            </div>
          </div>
          <div>
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Money Multiplier Effect</div>
            ${svgBarChart([
              {label: 'Contrib', value: totalContrib, color: 'var(--brand-primary)'},
              {label: 'Grants', value: totalCESG + totalProvGrant, color: 'var(--fg-gold)'},
              {label: 'Growth', value: totalGrowth, color: 'var(--brand-success)'},
              {label: 'Total', value: balance, color: 'var(--brand-accent)'}
            ], 300, 180)}
            <div style="font-size: 0.7rem; color: var(--text-muted); text-align: center; margin-top: 0.5rem;">
              Every $1 contributed becomes ${((balance / totalContrib).toFixed(2))} with grants + growth
            </div>
          </div>
        </div>
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Year-by-Year Stacked Growth</div>
        ${yearData.filter((d, i) => i % Math.ceil(yearsRemaining / 8) === 0 || i === yearsRemaining - 1).map((d, i) => {
          const yrIndex = yearData.indexOf(d);
          const contribSoFar = totalContrib * (yrIndex + 1) / yearsRemaining;
          const cesgSoFar = totalCESG * Math.min(1, (yrIndex + 1) / yearsRemaining);
          const contribPct = (contribSoFar / d.balance) * 100;
          const cesgPct = (cesgSoFar / d.balance) * 100;
          const growthPct = 100 - contribPct - cesgPct;
          return `
          <div style="margin-bottom: 0.75rem;">
            <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;">
              <span><strong>Age ${d.age}</strong></span>
              <span class="mono" style="font-weight: 600;">${fmtFull(d.balance)}</span>
            </div>
            <div style="display: flex; height: 28px; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
              <div style="width: ${contribPct.toFixed(1)}%; background: var(--brand-primary);" title="Contributions"></div>
              <div style="width: ${cesgPct.toFixed(1)}%; background: var(--fg-gold);" title="Grants"></div>
              <div style="width: ${growthPct.toFixed(1)}%; background: var(--brand-success);" title="Growth"></div>
            </div>
          </div>
        `}).join('')}
        <div style="display: flex; gap: 1rem; font-size: 0.75rem; margin-top: 1rem; justify-content: center;">
          <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-primary); border-radius: 2px; margin-right: 4px;"></span>Contributions</div>
          <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--fg-gold); border-radius: 2px; margin-right: 4px;"></span>Grants</div>
          <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-success); border-radius: 2px; margin-right: 4px;"></span>Growth</div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ Rent vs Buy Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateRentBuy() {
      const homePrice = parseFloat(document.getElementById('rb-price').value) || 700000;
      const downPct = (parseFloat(document.getElementById('rb-down').value) || 20) / 100;
      const mortRate = (parseFloat(document.getElementById('rb-rate').value) || 5.5) / 100;
      const amortYears = parseInt(document.getElementById('rb-amort').value) || 25;
      const monthlyRent = parseFloat(document.getElementById('rb-rent').value) || 2500;
      const rentIncrease = (parseFloat(document.getElementById('rb-rentinc').value) || 3) / 100;
      const propTaxRate = (parseFloat(document.getElementById('rb-proptax').value) || 1) / 100;
      const maintRate = (parseFloat(document.getElementById('rb-maint').value) || 1) / 100;
      const appreciationRate = (parseFloat(document.getElementById('rb-apprec').value) || 3) / 100;
      const investReturn = (parseFloat(document.getElementById('rb-invret').value) || 7) / 100;
      
      const downPayment = homePrice * downPct;
      const principal = homePrice - downPayment;
      
      // CMHC if down < 20%
      let cmhcPremium = 0;
      if (downPct < 0.20) {
        if (downPct >= 0.15) cmhcPremium = principal * 0.028;
        else if (downPct >= 0.10) cmhcPremium = principal * 0.031;
        else cmhcPremium = principal * 0.04;
      }
      
      const mortgage = principal + cmhcPremium;
      
      // Canadian mortgage: semi-annual compounding
      const semiAnnualRate = Math.pow(1 + mortRate / 2, 2) - 1;
      const monthlyRate = Math.pow(1 + semiAnnualRate, 1 / 12) - 1;
      const totalPayments = amortYears * 12;
      const monthlyPayment = mortgage * (monthlyRate * Math.pow(1 + monthlyRate, totalPayments)) / (Math.pow(1 + monthlyRate, totalPayments) - 1);
      
      // Calculate for 5, 10, 15, 25 years
      const scenarios = [5, 10, 15, 25];
      const results = scenarios.map(years => {
        // Buyer costs
        let mortgageBalance = mortgage;
        let totalMortgagePaid = 0;
        let totalPropTax = 0;
        let totalMaint = 0;
        
        for (let m = 1; m <= years * 12; m++) {
          const interestPaid = mortgageBalance * monthlyRate;
          const principalPaid = monthlyPayment - interestPaid;
          totalMortgagePaid += monthlyPayment;
          mortgageBalance = Math.max(0, mortgageBalance - principalPaid);
        }
        
        for (let y = 1; y <= years; y++) {
          const currentHomeValue = homePrice * Math.pow(1 + appreciationRate, y);
          totalPropTax += currentHomeValue * propTaxRate;
          totalMaint += currentHomeValue * maintRate;
        }
        
        const homeValue = homePrice * Math.pow(1 + appreciationRate, years);
        const buyerEquity = homeValue - mortgageBalance;
        const buyerTotalCost = downPayment + cmhcPremium + totalMortgagePaid + totalPropTax + totalMaint;
        const buyerNetWorth = buyerEquity;
        
        // Renter costs
        let rent = monthlyRent;
        let totalRentPaid = 0;
        let renterInvestments = downPayment; // Invest the down payment
        
        for (let m = 1; m <= years * 12; m++) {
          totalRentPaid += rent;
          // Renter invests the difference (if any)
          const savings = Math.max(0, monthlyPayment + (homePrice * (propTaxRate + maintRate) / 12) - rent);
          renterInvestments += savings;
          renterInvestments *= Math.pow(1 + investReturn, 1/12);
          
          // Increase rent annually
          if (m % 12 === 0) rent *= (1 + rentIncrease);
        }
        
        const renterNetWorth = renterInvestments;
        const renterTotalCost = totalRentPaid;
        
        return {
          years,
          buyerNetWorth,
          buyerTotalCost,
          renterNetWorth,
          renterTotalCost,
          advantage: buyerNetWorth > renterNetWorth ? 'Buy' : 'Rent',
          difference: Math.abs(buyerNetWorth - renterNetWorth)
        };
      });
      
      const breakEvenIdx = results.findIndex(r => r.buyerNetWorth > r.renterNetWorth);
      const breakEven = breakEvenIdx >= 0 ? results[breakEvenIdx].years : '25+';
      
      document.getElementById('rb-results').innerHTML = `
        <div class="result-card" style="grid-column: 1 / -1;">
          <div style="text-align: center;">
            <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Break-Even Point</div>
            <div style="font-size: 2.5rem; font-weight: 700; color: var(--brand-primary);">${breakEven} years</div>
            <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">When buying becomes better than renting</div>
          </div>
        </div>
        
        ${results.map(r => `
          <div class="result-card" style="grid-column: 1 / -1;">
            <div style="font-size: 0.9rem; font-weight: 700; margin-bottom: 0.75rem;">After ${r.years} Years</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
              <div style="padding: 0.75rem; background: var(--bg-secondary); border-radius: 6px;">
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">üè† Buyer Net Worth</div>
                <div class="mono" style="font-size: 1.1rem; font-weight: 600;">${fmtFull(r.buyerNetWorth)}</div>
              </div>
              <div style="padding: 0.75rem; background: var(--bg-secondary); border-radius: 6px;">
                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">üèòÔ∏è Renter Net Worth</div>
                <div class="mono" style="font-size: 1.1rem; font-weight: 600;">${fmtFull(r.renterNetWorth)}</div>
              </div>
            </div>
            <div style="text-align: center; margin-top: 0.75rem; padding: 0.5rem; background: ${r.advantage === 'Buy' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)'}; border-radius: 6px; font-size: 0.85rem;">
              <strong>${r.advantage}</strong> wins by ${fmtFull(r.difference)}
            </div>
          </div>
        `).join('')}
      `;
      
      // Chart
      const chartYears = Array.from({length: 26}, (_, i) => i);
      const chartData = chartYears.map(y => {
        if (y === 0) return { year: 0, buyer: 0, renter: downPayment };
        
        let mortgageBalance = mortgage;
        for (let m = 1; m <= y * 12; m++) {
          const interestPaid = mortgageBalance * monthlyRate;
          const principalPaid = monthlyPayment - interestPaid;
          mortgageBalance = Math.max(0, mortgageBalance - principalPaid);
        }
        const homeValue = homePrice * Math.pow(1 + appreciationRate, y);
        const buyerNW = homeValue - mortgageBalance;
        
        let rent = monthlyRent;
        let renterInv = downPayment;
        for (let m = 1; m <= y * 12; m++) {
          const savings = Math.max(0, monthlyPayment + (homePrice * (propTaxRate + maintRate) / 12) - rent);
          renterInv += savings;
          renterInv *= Math.pow(1 + investReturn, 1/12);
          if (m % 12 === 0) rent *= (1 + rentIncrease);
        }
        
        return { year: y, buyer: buyerNW, renter: renterInv };
      });
      
      const maxNW = Math.max(...chartData.map(d => Math.max(d.buyer, d.renter)));
      const milestones = chartData.filter(d => [5, 10, 15, 25].includes(d.year));
      
      document.getElementById('rb-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Net Worth at Key Milestones</div>
        <div style="margin-bottom: 2rem;">
          ${svgBarChart(milestones.flatMap(d => [
            {label: `Buy ${d.year}yr`, value: d.buyer, color: 'var(--brand-success)'},
            {label: `Rent ${d.year}yr`, value: d.renter, color: 'var(--brand-warning)'}
          ]), 600, 220)}
        </div>
        
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Net Worth Growth Over 25 Years</div>
        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 12px; margin-bottom: 1rem;">
          ${svgLineChart([
            ...chartData.filter(d => d.year % 2 === 0).map(d => ({x: d.year.toString(), y: d.buyer}))
          ], 500, 200)}
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; font-size: 0.75rem;">
          <div style="padding: 0.75rem; background: rgba(16, 185, 129, 0.1); border-radius: 8px; text-align: center;">
            <div style="font-weight: 600; color: var(--brand-success); margin-bottom: 0.25rem;">üè† Buying</div>
            <div style="font-size: 0.7rem; color: var(--text-muted);">Build equity through ownership</div>
          </div>
          <div style="padding: 0.75rem; background: rgba(245, 158, 11, 0.1); border-radius: 8px; text-align: center;">
            <div style="font-weight: 600; color: var(--brand-warning); margin-bottom: 0.25rem;">üèòÔ∏è Renting</div>
            <div style="font-size: 0.7rem; color: var(--text-muted);">Invest the difference</div>
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ GIC Ladder Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateGIC() {
      const totalInvestment = parseFloat(document.getElementById('gic-amount').value) || 50000;
      const rate1 = (parseFloat(document.getElementById('gic-rate1').value) || 4.0) / 100;
      const rate2 = (parseFloat(document.getElementById('gic-rate2').value) || 4.2) / 100;
      const rate3 = (parseFloat(document.getElementById('gic-rate3').value) || 4.3) / 100;
      const rate4 = (parseFloat(document.getElementById('gic-rate4').value) || 4.4) / 100;
      const rate5 = (parseFloat(document.getElementById('gic-rate5').value) || 4.5) / 100;
      
      const perGIC = totalInvestment / 5;
      const rates = [rate1, rate2, rate3, rate4, rate5];
      
      // GIC Ladder strategy: Year 1 matures, reinvest at 5-year rate
      let ladderTotal = 0;
      const ladderSchedule = [];
      
      for (let year = 1; year <= 10; year++) {
        let yearInterest = 0;
        
        for (let gic = 0; gic < 5; gic++) {
          const initialTerm = gic + 1;
          const maturityYear = initialTerm;
          
          if (year <= maturityYear) {
            // Still in initial term
            yearInterest += perGIC * rates[gic];
          } else {
            // Reinvested at 5-year rate
            const timesSinceReinvest = year - maturityYear;
            yearInterest += perGIC * Math.pow(1 + rate5, timesSinceReinvest) * rate5;
          }
        }
        
        ladderTotal += yearInterest;
        ladderSchedule.push({ year, interest: yearInterest, total: totalInvestment + ladderTotal });
      }
      
      // Compare: All in 1-year (rolled)
      let oneYearTotal = totalInvestment;
      for (let y = 1; y <= 10; y++) {
        oneYearTotal *= (1 + rate1);
      }
      const oneYearInterest = oneYearTotal - totalInvestment;
      
      // Compare: All in 5-year (rolled at years 5 and 10)
      const fiveYearAfter5 = totalInvestment * Math.pow(1 + rate5, 5);
      const fiveYearAfter10 = fiveYearAfter5 * Math.pow(1 + rate5, 5);
      const fiveYearInterest = fiveYearAfter10 - totalInvestment;
      
      document.getElementById('gic-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">GIC Ladder (10 Years)</div>
          <div class="result-value">${fmtFull(totalInvestment + ladderTotal)}</div>
          <div style="font-size: 0.8rem; color: var(--text-success); margin-top: 0.25rem;">Interest: ${fmtFull(ladderTotal)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">All in 1-Year GIC</div>
          <div class="result-value">${fmtFull(oneYearTotal)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">Interest: ${fmtFull(oneYearInterest)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">All in 5-Year GIC</div>
          <div class="result-value">${fmtFull(fiveYearAfter10)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">Interest: ${fmtFull(fiveYearInterest)}</div>
        </div>
        
        <div class="result-card" style="grid-column: 1 / -1;">
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 0.75rem;">Strategy Comparison</div>
          <div style="display: grid; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: ${ladderTotal > Math.max(oneYearInterest, fiveYearInterest) ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg-secondary)'}; border-radius: 6px;">
              <span><strong>ü™ú GIC Ladder</strong> (Liquidity + Growth)</span>
              <span class="mono" style="font-weight: 600;">${fmtFull(ladderTotal)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: ${oneYearInterest > Math.max(ladderTotal, fiveYearInterest) ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg-secondary)'}; border-radius: 6px;">
              <span>1-Year Rolling (Max Liquidity)</span>
              <span class="mono">${fmtFull(oneYearInterest)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: ${fiveYearInterest > Math.max(ladderTotal, oneYearInterest) ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg-secondary)'}; border-radius: 6px;">
              <span>5-Year Locked (Max Rate)</span>
              <span class="mono">${fmtFull(fiveYearInterest)}</span>
            </div>
          </div>
          <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem;">üí° GIC ladder provides annual liquidity while capturing higher rates.</div>
        </div>
        
        <div class="result-card" style="grid-column: 1 / -1;">
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 0.75rem;">Reinvestment Schedule</div>
          <div style="overflow-x: auto;">
            <table style="width: 100%; font-size: 0.8rem; border-collapse: collapse;">
              <thead>
                <tr style="border-bottom: 2px solid var(--border-primary);">
                  <th style="padding: 0.5rem; text-align: left;">Year</th>
                  <th style="padding: 0.5rem; text-align: right;">Annual Interest</th>
                  <th style="padding: 0.5rem; text-align: right;">Total Value</th>
                </tr>
              </thead>
              <tbody>
                ${ladderSchedule.slice(0, 5).map(s => `
                  <tr style="border-bottom: 1px solid var(--border-primary);">
                    <td style="padding: 0.5rem;">${s.year}</td>
                    <td style="padding: 0.5rem; text-align: right;" class="mono">${fmtFull(s.interest)}</td>
                    <td style="padding: 0.5rem; text-align: right;" class="mono">${fmtFull(s.total)}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;
      
      // Enhanced Chart with comparison bars and timeline
      const chartData = [
        { label: 'GIC Ladder', value: ladderTotal, color: 'var(--brand-success)' },
        { label: '1-Year Rolling', value: oneYearInterest, color: 'var(--brand-warning)' },
        { label: '5-Year Locked', value: fiveYearInterest, color: 'var(--brand-primary)' }
      ];
      
      document.getElementById('gic-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Strategy Comparison: Total Interest Earned (10 Years)</div>
        <div style="margin-bottom: 2rem;">
          ${svgHorizontalBars(chartData, 500, 160)}
        </div>
        
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">GIC Ladder Reinvestment Timeline</div>
        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 12px;">
          <div style="display: flex; gap: 1rem; align-items: flex-end; height: 200px; padding: 1rem 0;">
            ${ladderSchedule.slice(0, 10).map((s, i) => {
              const maxTotal = Math.max(...ladderSchedule.slice(0, 10).map(x => x.total));
              const pct = (s.total / maxTotal) * 100;
              return `
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 100%;">
                  <span style="font-size: 0.7rem; font-weight: 600; margin-bottom: 4px;">${fmt(s.total, 0)}</span>
                  <div style="width: 100%; background: linear-gradient(to top, var(--brand-primary), var(--brand-success)); border-radius: 4px 4px 0 0; height: ${pct}%; min-height: 6px; transition: height 0.8s ease ${i * 0.08}s;"></div>
                  <span style="font-size: 0.65rem; color: var(--text-muted); margin-top: 4px;">Yr ${s.year}</span>
                </div>
              `;
            }).join('')}
          </div>
          <div style="font-size: 0.7rem; color: var(--text-muted); text-align: center; margin-top: 0.5rem;">
            Annual interest + reinvestment grows your total value year over year
          </div>
        </div>
      `;
    }

    // ‚îÄ‚îÄ CPP/OAS Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateCPP() {
      const currentAge = parseInt(document.getElementById('cpp-age').value) || 55;
      const cppStartAge = parseInt(document.getElementById('cpp-start').value) || 65;
      const yearsContrib = parseInt(document.getElementById('cpp-years').value) || 30;
      const earningsPct = (parseInt(document.getElementById('cpp-earnings').value) || 80) / 100;
      const otherIncome = parseFloat(document.getElementById('cpp-otherincome').value) || 30000;
      
      // CPP 2026 max at 65
      const maxCPP = 1364.60;
      
      // Age adjustment
      const monthsFrom65 = (cppStartAge - 65) * 12;
      let ageAdjustment = 1;
      if (cppStartAge < 65) {
        ageAdjustment = 1 - (Math.abs(monthsFrom65) * 0.006); // 0.6% per month
      } else if (cppStartAge > 65) {
        ageAdjustment = 1 + (monthsFrom65 * 0.007); // 0.7% per month
      }
      
      // CPP calculation
      const cppBase = (yearsContrib / 39) * earningsPct * maxCPP;
      const cppMonthly = cppBase * ageAdjustment;
      const cppAnnual = cppMonthly * 12;
      
      // OAS 2026
      const maxOAS = 727.67;
      let oasMonthly = maxOAS;
      let oasClawback = 0;
      
      const totalRetirementIncome = cppAnnual + otherIncome + (oasMonthly * 12);
      const oasThreshold = 90997;
      const oasFullClawback = 148000;
      
      if (totalRetirementIncome > oasThreshold) {
        oasClawback = Math.min((totalRetirementIncome - oasThreshold) * 0.15, maxOAS * 12);
        oasMonthly = Math.max(0, maxOAS - (oasClawback / 12));
      }
      
      const oasAnnual = oasMonthly * 12;
      const totalAnnual = cppAnnual + oasAnnual + otherIncome;
      
      document.getElementById('cpp-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Monthly CPP at ${cppStartAge}</div>
          <div class="result-value">${fmtFull(cppMonthly)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">${fmtFull(cppAnnual)}/year</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Monthly OAS at 65</div>
          <div class="result-value">${fmtFull(oasMonthly)}</div>
          ${oasClawback > 0 ? `<div style="font-size: 0.8rem; color: var(--brand-danger); margin-top: 0.25rem;">Clawback: ${fmtFull(oasClawback)}/year</div>` : `<div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">No clawback</div>`}
        </div>
        
        <div class="result-card">
          <div class="result-label">Total Annual Income</div>
          <div class="result-value">${fmtFull(totalAnnual)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">CPP + OAS + Other</div>
        </div>
        
        <div class="result-card" style="grid-column: 1 / -1;">
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 0.75rem;">Retirement Income Breakdown</div>
          <div style="display: grid; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
              <span>CPP (${cppStartAge})</span>
              <span class="mono">${fmtFull(cppAnnual)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
              <span>OAS (65)</span>
              <span class="mono">${fmtFull(oasAnnual)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: var(--bg-secondary); border-radius: 6px;">
              <span>Other Income</span>
              <span class="mono">${fmtFull(otherIncome)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 0.75rem; background: var(--brand-primary); color: white; border-radius: 6px; font-weight: 600;">
              <span>Total Annual</span>
              <span class="mono">${fmtFull(totalAnnual)}</span>
            </div>
          </div>
        </div>
      `;
      
      // CPP comparison at different ages
      const ageComparison = [60, 65, 70].map(age => {
        const monthsFrom65 = (age - 65) * 12;
        let adj = 1;
        if (age < 65) adj = 1 - (Math.abs(monthsFrom65) * 0.006);
        else if (age > 65) adj = 1 + (monthsFrom65 * 0.007);
        const monthly = cppBase * adj;
        return { age, monthly, annual: monthly * 12, adjustment: ((adj - 1) * 100).toFixed(1) };
      });
      
      document.getElementById('cpp-comparison').innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
          <div>
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">CPP Start Age Comparison</div>
            ${svgHorizontalBars(ageComparison.map(a => ({
              label: `Age ${a.age} (${a.adjustment > 0 ? '+' : ''}${a.adjustment}%)`,
              value: a.annual,
              color: a.age === cppStartAge ? 'var(--brand-success)' : 'var(--brand-primary)'
            })), 400, 160)}
            <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.75rem; text-align: center;">
              Early: -0.6%/month | Delay: +0.7%/month
            </div>
          </div>
          <div style="text-align: center;">
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Total Retirement Income</div>
            <div style="display: flex; justify-content: center; margin-bottom: 1rem;">
              ${svgDonut([
                {value: cppAnnual, color: 'var(--brand-primary)', label: 'CPP'},
                {value: oasAnnual, color: 'var(--fg-gold)', label: 'OAS'},
                {value: otherIncome, color: 'var(--brand-secondary)', label: 'Other'}
              ], 140)}
            </div>
            <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.75rem;">
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-primary); border-radius: 2px; margin-right: 4px;"></span>CPP: ${fmtFull(cppAnnual)}</div>
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--fg-gold); border-radius: 2px; margin-right: 4px;"></span>OAS: ${fmtFull(oasAnnual)}</div>
              <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-secondary); border-radius: 2px; margin-right: 4px;"></span>Other: ${fmtFull(otherIncome)}</div>
            </div>
          </div>
        </div>
        
        ${oasClawback > 0 ? `
        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem;">
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 0.5rem; color: var(--brand-danger);">‚ö†Ô∏è OAS Clawback Visualization</div>
          <div style="display: flex; gap: 1rem; align-items: center;">
            <div style="flex: 1;">
              <div style="font-size: 0.75rem; margin-bottom: 0.25rem;">Income Above Threshold: ${fmtFull(totalRetirementIncome - oasThreshold)}</div>
              <div style="background: var(--bg-primary); height: 24px; border-radius: 6px; overflow: hidden;">
                <div style="width: ${Math.min(100, ((totalRetirementIncome - oasThreshold) / (oasFullClawback - oasThreshold)) * 100).toFixed(1)}%; height: 100%; background: var(--brand-danger);"></div>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 0.75rem; color: var(--text-muted);">Clawback</div>
              <div style="font-size: 1.1rem; font-weight: 600; color: var(--brand-danger);">${fmtFull(oasClawback)}</div>
            </div>
          </div>
          <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">15% of income above $90,997, max clawback at $148,000</div>
        </div>
        ` : ''}
        
        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 1rem;">üí° Taking CPP early (before 65) reduces benefits by 0.6%/month. Delaying (after 65) increases benefits by 0.7%/month.</div>
      `;
    }


    // ‚ïê‚ïê‚ïê UTILITY FUNCTIONS (moved before calculators) ‚ïê‚ïê‚ïê
    const fmt = (n, decimals = 0) => {
      if (n === undefined || n === null || isNaN(n)) return '$0';
      const abs = Math.abs(n);
      if (abs >= 1e9) return (n < 0 ? '-' : '') + '$' + (abs / 1e9).toFixed(1) + 'B';
      if (abs >= 1e6) return (n < 0 ? '-' : '') + '$' + (abs / 1e6).toFixed(1) + 'M';
      if (abs >= 1e3) return (n < 0 ? '-' : '') + '$' + (abs / 1e3).toFixed(decimals > 0 ? decimals : 0) + 'K';
      return new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD', minimumFractionDigits: decimals, maximumFractionDigits: decimals }).format(n);
    };
    
    const fmtFull = (n) => new Intl.NumberFormat('en-CA', { style: 'currency', currency: 'CAD', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(n || 0);
    
    const fmtPct = (n, decimals = 1) => (n || 0).toFixed(decimals) + '%';
    
    const fmtNum = (n) => new Intl.NumberFormat('en-CA', { maximumFractionDigits: 0 }).format(n || 0);
    
    // ‚îÄ‚îÄ Chart Helper Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // SVG Donut Chart
    function svgDonut(segments, size = 140) {
      // segments = [{value, color, label}]
      const total = segments.reduce((s, seg) => s + seg.value, 0);
      if (total === 0) return '';
      
      const cx = size / 2, cy = size / 2, r = (size / 2) - 12;
      const innerR = r * 0.6; // Donut hole
      let cumulative = 0;
      
      const paths = segments.map(seg => {
        const start = cumulative / total * 2 * Math.PI - Math.PI / 2;
        cumulative += seg.value;
        const end = cumulative / total * 2 * Math.PI - Math.PI / 2;
        const largeArc = (seg.value / total) > 0.5 ? 1 : 0;
        
        const x1 = cx + r * Math.cos(start), y1 = cy + r * Math.sin(start);
        const x2 = cx + r * Math.cos(end), y2 = cy + r * Math.sin(end);
        const x3 = cx + innerR * Math.cos(end), y3 = cy + innerR * Math.sin(end);
        const x4 = cx + innerR * Math.cos(start), y4 = cy + innerR * Math.sin(start);
        
        return `<path d="M${x1},${y1} A${r},${r} 0 ${largeArc} 1 ${x2},${y2} L${x3},${y3} A${innerR},${innerR} 0 ${largeArc} 0 ${x4},${y4} Z" fill="${seg.color}" opacity="0.9" stroke="var(--bg-primary)" stroke-width="2"/>`;
      });
      
      return `<svg viewBox="0 0 ${size} ${size}" width="${size}" height="${size}" style="filter: drop-shadow(0 2px 8px rgba(0,0,0,0.1));">${paths.join('')}</svg>`;
    }
    
    // Animated Bar Chart (vertical)
    function svgBarChart(bars, width = 300, height = 200) {
      // bars = [{label, value, color}]
      const maxVal = Math.max(...bars.map(b => b.value));
      if (maxVal === 0) return '';
      
      const barWidth = (width - 40) / bars.length;
      const padding = Math.min(barWidth * 0.2, 8);
      
      const barElements = bars.map((bar, i) => {
        const barHeight = (bar.value / maxVal) * (height - 40);
        const x = 20 + i * barWidth + padding;
        const y = height - 20 - barHeight;
        
        return `
          <rect x="${x}" y="${height - 20}" width="${barWidth - padding * 2}" height="0" fill="${bar.color}" opacity="0.85" rx="4">
            <animate attributeName="height" from="0" to="${barHeight}" dur="0.6s" fill="freeze" begin="${i * 0.1}s"/>
            <animate attributeName="y" from="${height - 20}" to="${y}" dur="0.6s" fill="freeze" begin="${i * 0.1}s"/>
          </rect>
          <text x="${x + (barWidth - padding * 2) / 2}" y="${y - 5}" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="600">${fmt(bar.value, 0)}</text>
          <text x="${x + (barWidth - padding * 2) / 2}" y="${height - 5}" text-anchor="middle" fill="var(--text-muted)" font-size="10">${bar.label}</text>
        `;
      }).join('');
      
      return `<svg viewBox="0 0 ${width} ${height}" width="100%" height="${height}" style="max-width: ${width}px;">${barElements}</svg>`;
    }
    
    // Horizontal Bar Chart (good for comparisons)
    function svgHorizontalBars(bars, width = 400, height = null) {
      // bars = [{label, value, color}]
      const maxVal = Math.max(...bars.map(b => b.value));
      if (maxVal === 0) return '';
      
      const barHeight = 40;
      const gap = 16;
      const totalHeight = height || (bars.length * (barHeight + gap) + 20);
      
      const barElements = bars.map((bar, i) => {
        const barWidth = (bar.value / maxVal) * (width - 160);
        const y = 10 + i * (barHeight + gap);
        
        return `
          <text x="10" y="${y + barHeight / 2 + 5}" fill="var(--text-primary)" font-size="13" font-weight="500">${bar.label}</text>
          <rect x="150" y="${y}" width="0" height="${barHeight}" fill="${bar.color}" opacity="0.85" rx="6">
            <animate attributeName="width" from="0" to="${barWidth}" dur="0.8s" fill="freeze" begin="${i * 0.15}s"/>
          </rect>
          <text x="${160 + barWidth}" y="${y + barHeight / 2 + 5}" fill="var(--text-primary)" font-size="13" font-weight="600">${fmt(bar.value, 0)}</text>
        `;
      }).join('');
      
      return `<svg viewBox="0 0 ${width} ${totalHeight}" width="100%" height="${totalHeight}">${barElements}</svg>`;
    }
    
    // Waterfall Chart
    function svgWaterfall(steps, width = 400, height = 250) {
      // steps = [{label, value, isPositive}]
      const maxVal = Math.max(...steps.map(s => Math.abs(s.value)));
      if (maxVal === 0) return '';
      
      const stepWidth = (width - 80) / steps.length;
      const padding = Math.min(stepWidth * 0.15, 6);
      let runningTotal = 0;
      
      const elements = steps.map((step, i) => {
        const startY = height - 40 - (runningTotal / maxVal) * (height - 80);
        runningTotal += step.value;
        const endY = height - 40 - (runningTotal / maxVal) * (height - 80);
        const barHeight = Math.abs(endY - startY);
        const x = 40 + i * stepWidth + padding;
        const color = step.isPositive ? 'var(--brand-success)' : 'var(--brand-danger)';
        
        return `
          <rect x="${x}" y="${Math.min(startY, endY)}" width="${stepWidth - padding * 2}" height="${barHeight}" fill="${color}" opacity="0.85" rx="4"/>
          ${i < steps.length - 1 ? `<line x1="${x + stepWidth - padding * 2}" y1="${endY}" x2="${x + stepWidth + padding}" y2="${endY}" stroke="var(--text-muted)" stroke-width="1" stroke-dasharray="3,3"/>` : ''}
          <text x="${x + (stepWidth - padding * 2) / 2}" y="${height - 25}" text-anchor="middle" fill="var(--text-muted)" font-size="10">${step.label}</text>
          <text x="${x + (stepWidth - padding * 2) / 2}" y="${Math.min(startY, endY) - 5}" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="600">${fmt(step.value, 0)}</text>
        `;
      }).join('');
      
      return `<svg viewBox="0 0 ${width} ${height}" width="100%" height="${height}">${elements}</svg>`;
    }
    
    // Line Chart
    function svgLineChart(points, width = 400, height = 200) {
      // points = [{x: label, y: value}]
      if (points.length === 0) return '';
      
      const maxY = Math.max(...points.map(p => p.y));
      const minY = Math.min(...points.map(p => p.y), 0);
      const range = maxY - minY || 1;
      
      const xStep = (width - 60) / (points.length - 1);
      const pathPoints = points.map((p, i) => {
        const x = 30 + i * xStep;
        const y = height - 30 - ((p.y - minY) / range) * (height - 60);
        return `${x},${y}`;
      }).join(' ');
      
      const areaPath = `M 30,${height - 30} L ${pathPoints} L ${30 + (points.length - 1) * xStep},${height - 30} Z`;
      
      const dots = points.map((p, i) => {
        const x = 30 + i * xStep;
        const y = height - 30 - ((p.y - minY) / range) * (height - 60);
        return `
          <circle cx="${x}" cy="${y}" r="4" fill="var(--brand-primary)" stroke="var(--bg-primary)" stroke-width="2"/>
          <text x="${x}" y="${height - 10}" text-anchor="middle" fill="var(--text-muted)" font-size="10">${p.x}</text>
          ${i % Math.ceil(points.length / 6) === 0 ? `<text x="${x}" y="${y - 10}" text-anchor="middle" fill="var(--text-primary)" font-size="11" font-weight="600">${fmt(p.y, 0)}</text>` : ''}
        `;
      }).join('');
      
      return `<svg viewBox="0 0 ${width} ${height}" width="100%" height="${height}">
        <defs><linearGradient id="lineGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:var(--brand-primary);stop-opacity:0.3"/><stop offset="100%" style="stop-color:var(--brand-primary);stop-opacity:0"/></linearGradient></defs>
        <path d="${areaPath}" fill="url(#lineGrad)"/>
        <polyline points="${pathPoints}" fill="none" stroke="var(--brand-primary)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        ${dots}
      </svg>`;
    }
    

    // ‚îÄ‚îÄ Capital Gains Tax Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateCapGains() {
  // ‚îÄ‚îÄ Inputs ‚îÄ‚îÄ
  const assetType = document.getElementById('cg-asset-type').value;
  const year = document.getElementById('cg-year').value;
  const province = document.getElementById('cg-province').value;
  const salePrice = parseFloat(document.getElementById('cg-sale-price').value) || 0;
  const acb = parseFloat(document.getElementById('cg-acb').value) || 0;
  const expenses = parseFloat(document.getElementById('cg-expenses').value) || 0;
  const otherGains = parseFloat(document.getElementById('cg-other-gains').value) || 0;
  const capitalLosses = parseFloat(document.getElementById('cg-capital-losses').value) || 0;
  const otherIncome = parseFloat(document.getElementById('cg-other-income').value) || 0;
  const applyLCGE = document.getElementById('cg-lcge').checked;
  const principalRes = document.getElementById('cg-principal-res').checked;

  // Show/hide LCGE based on asset type
  const lcgeGroup = document.getElementById('cg-lcge-group');
  const lcgeEligible = (assetType === 'business' || assetType === 'farm');
  lcgeGroup.style.display = lcgeEligible ? '' : 'none';

  // ‚îÄ‚îÄ Capital Gain ‚îÄ‚îÄ
  let capitalGain = salePrice - acb - expenses;
  if (principalRes) capitalGain = 0;
  if (capitalGain < 0) capitalGain = 0;

  // Apply losses
  let netGain = Math.max(0, capitalGain - capitalLosses);

  // LCGE
  let lcgeAmount = 0;
  if (applyLCGE && lcgeEligible && netGain > 0) {
    const lcgeLimit = (year === '2023') ? 971190 : (year === '2024') ? 1016836 : 1250000;
    lcgeAmount = Math.min(netGain, lcgeLimit);
    netGain = Math.max(0, netGain - lcgeAmount);
  }

  // Total gains for threshold
  const totalGains = netGain + otherGains;

  // ‚îÄ‚îÄ Inclusion Rate Logic ‚îÄ‚îÄ
  function calcTaxableGain(gain, totalForThreshold, useNewRules) {
    if (!useNewRules || year === '2023') {
      return gain * 0.5; // Old rules: flat 50%
    }
    // New rules (2024+): 50% on first $250K of total gains, 66.67% above
    if (totalForThreshold <= 250000) {
      return gain * 0.5;
    }
    // Portion of THIS gain that falls above $250K threshold
    const gainBelowThreshold = Math.max(0, 250000 - (totalForThreshold - gain));
    const gainAboveThreshold = gain - gainBelowThreshold;
    return (Math.max(0, gainBelowThreshold) * 0.5) + (Math.max(0, gainAboveThreshold) * 2 / 3);
  }

  const taxableGainNew = calcTaxableGain(netGain, totalGains, true);
  const taxableGainOld = calcTaxableGain(netGain, totalGains, false);

  // ‚îÄ‚îÄ Federal Tax Brackets 2025/2026 ‚îÄ‚îÄ
  const fedBrackets = [
    { limit: 57375, rate: 0.15 },
    { limit: 114750, rate: 0.205 },
    { limit: 158468, rate: 0.26 },
    { limit: 221708, rate: 0.29 },
    { limit: Infinity, rate: 0.33 }
  ];

  // ‚îÄ‚îÄ Provincial Brackets (2025 values) ‚îÄ‚îÄ
  const provBrackets = {
    AB: [
      { limit: 148269, rate: 0.10 },
      { limit: 177922, rate: 0.12 },
      { limit: 237230, rate: 0.13 },
      { limit: 355845, rate: 0.14 },
      { limit: Infinity, rate: 0.15 }
    ],
    BC: [
      { limit: 47937, rate: 0.0506 },
      { limit: 95875, rate: 0.077 },
      { limit: 110076, rate: 0.105 },
      { limit: 133664, rate: 0.1229 },
      { limit: 181232, rate: 0.147 },
      { limit: 252752, rate: 0.168 },
      { limit: Infinity, rate: 0.205 }
    ],
    MB: [
      { limit: 47000, rate: 0.108 },
      { limit: 100000, rate: 0.1275 },
      { limit: Infinity, rate: 0.174 }
    ],
    NB: [
      { limit: 49958, rate: 0.094 },
      { limit: 99916, rate: 0.14 },
      { limit: 185064, rate: 0.16 },
      { limit: Infinity, rate: 0.195 }
    ],
    NL: [
      { limit: 43198, rate: 0.087 },
      { limit: 86395, rate: 0.145 },
      { limit: 154244, rate: 0.158 },
      { limit: 215943, rate: 0.178 },
      { limit: 275870, rate: 0.198 },
      { limit: 551739, rate: 0.208 },
      { limit: 1103478, rate: 0.213 },
      { limit: Infinity, rate: 0.218 }
    ],
    NS: [
      { limit: 29590, rate: 0.0879 },
      { limit: 59180, rate: 0.1495 },
      { limit: 93000, rate: 0.1667 },
      { limit: 150000, rate: 0.175 },
      { limit: Infinity, rate: 0.21 }
    ],
    NT: [
      { limit: 50597, rate: 0.059 },
      { limit: 101198, rate: 0.086 },
      { limit: 164525, rate: 0.122 },
      { limit: Infinity, rate: 0.1405 }
    ],
    NU: [
      { limit: 53268, rate: 0.04 },
      { limit: 106537, rate: 0.07 },
      { limit: 173205, rate: 0.09 },
      { limit: Infinity, rate: 0.115 }
    ],
    ON: [
      { limit: 51446, rate: 0.0505 },
      { limit: 102894, rate: 0.0915 },
      { limit: 150000, rate: 0.1116 },
      { limit: 220000, rate: 0.1216 },
      { limit: Infinity, rate: 0.1316 }
    ],
    PE: [
      { limit: 32656, rate: 0.098 },
      { limit: 64313, rate: 0.138 },
      { limit: 105000, rate: 0.167 },
      { limit: 140000, rate: 0.175 },
      { limit: Infinity, rate: 0.1875 }
    ],
    QC: [
      { limit: 51780, rate: 0.14 },
      { limit: 103545, rate: 0.19 },
      { limit: 126000, rate: 0.24 },
      { limit: Infinity, rate: 0.2575 }
    ],
    SK: [
      { limit: 52057, rate: 0.105 },
      { limit: 148734, rate: 0.125 },
      { limit: Infinity, rate: 0.145 }
    ],
    YT: [
      { limit: 55867, rate: 0.064 },
      { limit: 111733, rate: 0.09 },
      { limit: 154906, rate: 0.109 },
      { limit: 500000, rate: 0.128 },
      { limit: Infinity, rate: 0.15 }
    ]
  };

  // ‚îÄ‚îÄ Bracket Tax Calculator ‚îÄ‚îÄ
  function calcBracketTax(brackets, taxableIncome) {
    let tax = 0;
    let prev = 0;
    for (const b of brackets) {
      if (taxableIncome <= prev) break;
      const amt = Math.min(taxableIncome, b.limit) - prev;
      tax += amt * b.rate;
      prev = b.limit;
    }
    return tax;
  }

  // Tax on other income alone
  const fedTaxBase = calcBracketTax(fedBrackets, otherIncome);
  const provTaxBase = calcBracketTax(provBrackets[province] || provBrackets.ON, otherIncome);

  // Tax on other income + taxable gain (new rules)
  const fedTaxTotalNew = calcBracketTax(fedBrackets, otherIncome + taxableGainNew);
  const provTaxTotalNew = calcBracketTax(provBrackets[province] || provBrackets.ON, otherIncome + taxableGainNew);
  const fedTaxOnGainNew = fedTaxTotalNew - fedTaxBase;
  const provTaxOnGainNew = provTaxTotalNew - provTaxBase;
  const totalTaxNew = fedTaxOnGainNew + provTaxOnGainNew;

  // Tax on other income + taxable gain (old rules)
  const fedTaxTotalOld = calcBracketTax(fedBrackets, otherIncome + taxableGainOld);
  const provTaxTotalOld = calcBracketTax(provBrackets[province] || provBrackets.ON, otherIncome + taxableGainOld);
  const fedTaxOnGainOld = fedTaxTotalOld - fedTaxBase;
  const provTaxOnGainOld = provTaxTotalOld - provTaxBase;
  const totalTaxOld = fedTaxOnGainOld + provTaxOnGainOld;

  const additionalTax = totalTaxNew - totalTaxOld;
  const effectiveRate = netGain > 0 ? (totalTaxNew / netGain * 100) : 0;
  const effectiveRateOld = netGain > 0 ? (totalTaxOld / netGain * 100) : 0;
  const netProceeds = salePrice - expenses - totalTaxNew;
  const inclusionRate = netGain > 0 ? (taxableGainNew / netGain * 100) : 50;

  // Determine which tax applies
  const isNewRules = (year !== '2023');
  const activeTax = isNewRules ? totalTaxNew : totalTaxOld;
  const activeFedTax = isNewRules ? fedTaxOnGainNew : fedTaxOnGainOld;
  const activeProvTax = isNewRules ? provTaxOnGainNew : provTaxOnGainOld;
  const activeTaxableGain = isNewRules ? taxableGainNew : taxableGainOld;
  const activeEffRate = isNewRules ? effectiveRate : effectiveRateOld;

  // ‚îÄ‚îÄ Render Results ‚îÄ‚îÄ
  const resultsEl = document.getElementById('cg-results');
  const showComparison = isNewRules && totalGains > 250000;

  resultsEl.innerHTML = `
    <div class="result-card glass-card" style="border-left: 4px solid var(--brand-success);">
      <div class="result-label">Capital Gain</div>
      <div class="result-value mono">${fmtFull(capitalGain)}</div>
    </div>
    ${lcgeAmount > 0 ? `
    <div class="result-card glass-card" style="border-left: 4px solid var(--brand-warning);">
      <div class="result-label">LCGE Applied</div>
      <div class="result-value mono">‚àí${fmtFull(lcgeAmount)}</div>
    </div>` : ''}
    ${capitalLosses > 0 ? `
    <div class="result-card glass-card">
      <div class="result-label">Capital Losses Applied</div>
      <div class="result-value mono">‚àí${fmtFull(Math.min(capitalLosses, capitalGain))}</div>
    </div>` : ''}
    <div class="result-card glass-card">
      <div class="result-label">Net Capital Gain</div>
      <div class="result-value mono">${fmtFull(netGain)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Effective Inclusion Rate</div>
      <div class="result-value mono">${inclusionRate.toFixed(1)}%</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Taxable Capital Gain</div>
      <div class="result-value mono">${fmtFull(activeTaxableGain)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Federal Tax on Gain</div>
      <div class="result-value mono">${fmtFull(activeFedTax)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Provincial Tax on Gain</div>
      <div class="result-value mono">${fmtFull(activeProvTax)}</div>
    </div>
    <div class="result-card glass-card" style="border-left: 4px solid var(--brand-danger);">
      <div class="result-label">Total Tax</div>
      <div class="result-value mono" style="font-size: 1.5rem;">${fmtFull(activeTax)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Effective Tax Rate on Gain</div>
      <div class="result-value mono">${activeEffRate.toFixed(1)}%</div>
    </div>
    <div class="result-card glass-card" style="border-left: 4px solid var(--brand-success);">
      <div class="result-label">Net Proceeds After Tax</div>
      <div class="result-value mono" style="font-size: 1.3rem;">${fmtFull(netProceeds)}</div>
    </div>
    ${showComparison ? `
    <div class="result-card glass-card" style="border-left: 4px solid var(--brand-warning); background: rgba(255,193,7,0.05);">
      <div class="result-label">‚ö†Ô∏è New Rules Impact</div>
      <div style="margin-top: 0.5rem;">
        <div style="display:flex;justify-content:space-between;margin-bottom:0.3rem;">
          <span style="color:var(--text-secondary);">Tax under old rules (50%)</span>
          <span class="mono">${fmtFull(totalTaxOld)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;margin-bottom:0.3rem;">
          <span style="color:var(--text-secondary);">Tax under new rules</span>
          <span class="mono">${fmtFull(totalTaxNew)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;padding-top:0.5rem;border-top:1px solid var(--border-primary);">
          <span style="font-weight:600;color:var(--brand-danger);">Additional tax from new rules</span>
          <span class="mono" style="font-weight:700;color:var(--brand-danger);">+${fmtFull(additionalTax)}</span>
        </div>
      </div>
    </div>` : ''}
  `;

  // ‚îÄ‚îÄ Breakdown Section ‚îÄ‚îÄ
  const breakdownEl = document.getElementById('cg-breakdown');

  // Bar chart: old vs new inclusion
  const barChartHTML = (showComparison) ? `
    <div style="margin-bottom: 2rem;">
      <h3 style="margin-bottom: 1rem;">üìä Inclusion Rate Comparison</h3>
      <div style="display:flex;gap:1.5rem;align-items:flex-end;height:160px;padding:0 1rem;">
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;">
          <span class="mono" style="font-weight:600;margin-bottom:0.5rem;">${fmtFull(taxableGainOld)}</span>
          <div style="width:100%;background:var(--brand-success);border-radius:8px 8px 0 0;height:${Math.max(10, (taxableGainOld / Math.max(taxableGainNew, 1)) * 120)}px;transition:height 0.3s;"></div>
          <span style="margin-top:0.5rem;font-size:0.85rem;color:var(--text-secondary);">Old Rules (50%)</span>
        </div>
        <div style="flex:1;display:flex;flex-direction:column;align-items:center;">
          <span class="mono" style="font-weight:600;margin-bottom:0.5rem;">${fmtFull(taxableGainNew)}</span>
          <div style="width:100%;background:var(--brand-warning);border-radius:8px 8px 0 0;height:120px;transition:height 0.3s;"></div>
          <span style="margin-top:0.5rem;font-size:0.85rem;color:var(--text-secondary);">New Rules</span>
        </div>
      </div>
    </div>` : '';

  // Donut chart
  const donutData = [
    { label: 'Federal Tax', value: activeFedTax, color: '#3b82f6' },
    { label: 'Provincial Tax', value: activeProvTax, color: '#8b5cf6' },
    { label: 'Net Proceeds', value: Math.max(0, salePrice - expenses - activeTax), color: '#22c55e' }
  ].filter(d => d.value > 0);

  const donutHTML = (netGain > 0 && typeof svgDonut === 'function')
    ? `<div style="margin-bottom:2rem;"><h3 style="margin-bottom:1rem;">üç© Tax Breakdown</h3>${svgDonut(donutData, 220)}</div>`
    : '';

  // Waterfall chart
  const waterfallSteps = [
    { label: 'Sale Price', value: salePrice, type: 'add' },
    { label: 'Cost Base', value: -acb, type: 'sub' },
    { label: 'Expenses', value: -expenses, type: 'sub' },
    ...(capitalLosses > 0 ? [{ label: 'Losses', value: -Math.min(capitalLosses, capitalGain), type: 'sub' }] : []),
    ...(lcgeAmount > 0 ? [{ label: 'LCGE', value: -lcgeAmount, type: 'sub' }] : []),
    { label: 'Fed Tax', value: -activeFedTax, type: 'sub' },
    { label: 'Prov Tax', value: -activeProvTax, type: 'sub' },
    { label: 'Net', value: netProceeds, type: 'total' }
  ];

  const waterfallHTML = (netGain > 0 && typeof svgWaterfall === 'function')
    ? `<div style="margin-bottom:2rem;"><h3 style="margin-bottom:1rem;">üìâ Proceeds Waterfall</h3>${svgWaterfall(waterfallSteps)}</div>`
    : '';

  // Strategies
  const strategies = [];
  if (!principalRes && assetType === 'real-estate')
    strategies.push('üè† If this was ever your principal residence, the <strong>Principal Residence Exemption</strong> could eliminate the entire gain.');
  if (netGain > 250000 && isNewRules)
    strategies.push('üìÖ Consider splitting the sale across two tax years to keep each year under the $250K threshold and stay at the 50% inclusion rate.');
  if (!applyLCGE && lcgeEligible)
    strategies.push('üè¢ Qualified small business shares may be eligible for the <strong>Lifetime Capital Gains Exemption</strong> ($1.25M for 2025+).');
  if (capitalLosses === 0)
    strategies.push('üìâ Harvest capital losses from other investments to offset this gain. Losses can be carried back 3 years or forward indefinitely.');
  if (otherIncome > 100000)
    strategies.push('üí∞ Consider <strong>spousal attribution planning</strong> ‚Äî transferring assets to a lower-income spouse (with proper documentation) can reduce the marginal rate.');
  strategies.push('üè¶ Maximize RRSP contributions to reduce other taxable income and lower the marginal rate applied to your capital gain.');
  if (assetType === 'crypto')
    strategies.push('ü™ô Ensure accurate ACB tracking for crypto ‚Äî each trade, swap, and DeFi transaction can trigger a taxable event.');
  if (assetType === 'real-estate')
    strategies.push('üìã Don\'t forget to include renovation costs, legal fees, and land transfer taxes in your adjusted cost base.');

  const strategiesHTML = strategies.length > 0 ? `
    <div style="margin-top: 2rem;">
      <h3 style="margin-bottom: 1rem;">üí° Tax-Saving Strategies</h3>
      <div style="display: grid; gap: 0.75rem;">
        ${strategies.map(s => `<div style="padding: 0.75rem 1rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary); font-size: 0.95rem; line-height: 1.5;">${s}</div>`).join('')}
      </div>
    </div>` : '';

  breakdownEl.innerHTML = barChartHTML + donutHTML + waterfallHTML + strategiesHTML;

  if (!netGain && !capitalGain) {
    resultsEl.innerHTML = `
      <div class="result-card glass-card" style="text-align:center;padding:2rem;">
        <div style="font-size:2rem;margin-bottom:0.5rem;">‚úÖ</div>
        <div class="result-label">No Capital Gain</div>
        <p style="color:var(--text-secondary);margin-top:0.5rem;">
          ${principalRes ? 'Principal Residence Exemption eliminates the entire gain.' : 'The sale price does not exceed your cost base and expenses.'}
        </p>
      </div>`;
    breakdownEl.innerHTML = '';
  }
}

// Auto-calculate on load
if (document.getElementById('cg-sale-price')) calculateCapGains();


    // ‚ïê‚ïê‚ïê TFSA CONTRIBUTION ROOM CALCULATOR ‚ïê‚ïê‚ïê
function calculateTFSA() {
  const ANNUAL_LIMITS = {
    2009: 5000, 2010: 5000, 2011: 5000, 2012: 5000,
    2013: 5500, 2014: 5500,
    2015: 10000,
    2016: 5500, 2017: 5500, 2018: 5500,
    2019: 6000, 2020: 6000, 2021: 6000, 2022: 6000, 2023: 6000,
    2024: 7000, 2025: 7000, 2026: 7000
  };

  const CURRENT_YEAR = 2026;
  const birthYear = parseInt(document.getElementById('tfsa-birth-year').value) || 1990;
  const bornInCanada = document.getElementById('tfsa-resident-check').checked;
  const residencyYear = bornInCanada ? 2009 : (parseInt(document.getElementById('tfsa-residency-year').value) || 2015);
  const totalContributions = parseFloat(document.getElementById('tfsa-contributions').value) || 0;

  // TFSA starts accumulating from the year you turn 18 OR 2009, whichever is later
  const year18 = birthYear + 18;
  const eligibleFrom = Math.max(2009, year18, residencyYear);

  // Build year-by-year breakdown
  const breakdown = [];
  let cumulative = 0;
  for (let y = eligibleFrom; y <= CURRENT_YEAR; y++) {
    const limit = ANNUAL_LIMITS[y] || 0;
    cumulative += limit;
    breakdown.push({ year: y, limit, cumulative });
  }

  const totalRoom = cumulative;
  const currentYearLimit = ANNUAL_LIMITS[CURRENT_YEAR] || 0;
  const remainingRoom = totalRoom - totalContributions;
  const overContribution = Math.max(0, totalContributions - totalRoom);
  const monthlyPenalty = Math.floor(overContribution / 100) * 1;

  // Render results
  const resultsEl = document.getElementById('tfsa-results');
  let statusHTML = '';
  if (overContribution > 0) {
    statusHTML = `
      <div class="result-card" style="border-left: 4px solid var(--brand-danger);">
        <div class="result-label">‚ö†Ô∏è Over-Contribution</div>
        <div class="result-value mono" style="color: var(--brand-danger);">${fmtFull(overContribution)}</div>
      </div>
      <div class="result-card" style="border-left: 4px solid var(--brand-warning);">
        <div class="result-label">Estimated Monthly Penalty</div>
        <div class="result-value mono" style="color: var(--brand-warning);">${fmtFull(monthlyPenalty)}/mo</div>
        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">CRA charges 1% per month on the highest excess amount in each month</div>
      </div>`;
  } else {
    statusHTML = `
      <div class="result-card" style="border-left: 4px solid var(--brand-success);">
        <div class="result-label">Remaining Room</div>
        <div class="result-value mono" style="color: var(--brand-success);">${fmtFull(remainingRoom)}</div>
      </div>`;
  }

  resultsEl.innerHTML = `
    <div class="result-card">
      <div class="result-label">Total Cumulative Room</div>
      <div class="result-value mono">${fmtFull(totalRoom)}</div>
      <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">From ${eligibleFrom} to ${CURRENT_YEAR} (${breakdown.length} years)</div>
    </div>
    <div class="result-card">
      <div class="result-label">${CURRENT_YEAR} Annual Limit</div>
      <div class="result-value mono">${fmtFull(currentYearLimit)}</div>
    </div>
    <div class="result-card">
      <div class="result-label">Your Total Contributions</div>
      <div class="result-value mono">${fmtFull(totalContributions)}</div>
    </div>
    ${statusHTML}
  `;

  // Render SVG bar chart
  const chartEl = document.getElementById('tfsa-chart');
  if (breakdown.length > 0) {
    const svgW = 700, svgH = 300, pad = { t: 20, r: 20, b: 50, l: 60 };
    const plotW = svgW - pad.l - pad.r;
    const plotH = svgH - pad.t - pad.b;
    const maxVal = breakdown[breakdown.length - 1].cumulative;
    const barW = Math.max(4, Math.min(30, plotW / breakdown.length - 2));
    const gap = (plotW - barW * breakdown.length) / (breakdown.length + 1);

    let bars = '', labels = '';
    breakdown.forEach((d, i) => {
      const x = pad.l + gap + i * (barW + gap);
      const h = (d.cumulative / maxVal) * plotH;
      const y = pad.t + plotH - h;
      const fill = d.cumulative <= totalContributions ? 'var(--brand-danger)' : 'var(--brand-success)';
      bars += `<rect x="${x}" y="${y}" width="${barW}" height="${h}" fill="${fill}" rx="2"><title>${d.year}: ${fmtFull(d.cumulative)} cumulative</title></rect>`;
      if (breakdown.length <= 18 || i % 2 === 0) {
        labels += `<text x="${x + barW / 2}" y="${svgH - 10}" text-anchor="middle" fill="var(--text-muted)" font-size="10">${d.year}</text>`;
      }
    });

    // Y-axis labels
    let yLabels = '';
    for (let i = 0; i <= 4; i++) {
      const val = (maxVal / 4) * i;
      const y = pad.t + plotH - (val / maxVal) * plotH;
      yLabels += `<text x="${pad.l - 8}" y="${y + 4}" text-anchor="end" fill="var(--text-muted)" font-size="10">${(val / 1000).toFixed(0)}k</text>`;
      yLabels += `<line x1="${pad.l}" y1="${y}" x2="${svgW - pad.r}" y2="${y}" stroke="var(--border-primary)" stroke-dasharray="3,3"/>`;
    }

    // Contribution line
    let contribLine = '';
    if (totalContributions > 0 && totalContributions <= maxVal * 1.1) {
      const cy = pad.t + plotH - (Math.min(totalContributions, maxVal) / maxVal) * plotH;
      contribLine = `<line x1="${pad.l}" y1="${cy}" x2="${svgW - pad.r}" y2="${cy}" stroke="var(--brand-warning)" stroke-width="2" stroke-dasharray="6,4"/>
        <text x="${svgW - pad.r}" y="${cy - 6}" text-anchor="end" fill="var(--brand-warning)" font-size="11" font-weight="600">Your contributions</text>`;
    }

    chartEl.innerHTML = `
      <div class="glass-card" style="padding: 1.5rem; overflow-x: auto;">
        <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">üìä Cumulative TFSA Room by Year</h3>
        <svg viewBox="0 0 ${svgW} ${svgH}" style="width: 100%; max-width: ${svgW}px; height: auto;">
          ${yLabels}${bars}${labels}${contribLine}
        </svg>
      </div>`;
  } else {
    chartEl.innerHTML = '';
  }

  // Render breakdown table
  const breakdownEl = document.getElementById('tfsa-breakdown');
  if (breakdown.length > 0) {
    let rows = breakdown.map(d => `
      <tr>
        <td style="padding: 0.5rem 0.75rem;" class="mono">${d.year}</td>
        <td style="padding: 0.5rem 0.75rem; text-align: right;" class="mono">${fmtFull(d.limit)}</td>
        <td style="padding: 0.5rem 0.75rem; text-align: right; font-weight: 600;" class="mono">${fmtFull(d.cumulative)}</td>
      </tr>`).join('');

    breakdownEl.innerHTML = `
      <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">üìã Year-by-Year Breakdown</h3>
      <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
          <thead>
            <tr style="border-bottom: 2px solid var(--border-primary);">
              <th style="padding: 0.5rem 0.75rem; text-align: left;">Year</th>
              <th style="padding: 0.5rem 0.75rem; text-align: right;">Annual Limit</th>
              <th style="padding: 0.5rem 0.75rem; text-align: right;">Cumulative Room</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
      <p style="margin-top: 1rem; font-size: 0.8rem; color: var(--text-muted);">
        Note: This calculator does not account for withdrawals (which restore room the following year) or carry-forward adjustments from the CRA. Check your My CRA Account for your official TFSA room.
      </p>`;
  } else {
    breakdownEl.innerHTML = `<p style="color: var(--text-muted);">You are not yet eligible for TFSA contribution room. Eligibility begins the year you turn 18 (and no earlier than 2009).</p>`;
  }
}

// Auto-calculate on load
document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('tfsa-birth-year')) calculateTFSA();
});


    // ‚ïê‚ïê‚ïê RRSP TAX REFUND CALCULATOR ‚ïê‚ïê‚ïê
function calculateRRSP() {
  const income = parseFloat(document.getElementById('rrsp-income').value) || 0;
  const otherIncome = parseFloat(document.getElementById('rrsp-other-income').value) || 0;
  const province = document.getElementById('rrsp-province').value;
  const contribution = parseFloat(document.getElementById('rrsp-contribution').value) || 0;

  const resultsEl = document.getElementById('rrsp-results');
  const breakdownEl = document.getElementById('rrsp-breakdown');

  if (income <= 0) {
    resultsEl.innerHTML = '<div class="result-card glass-card" style="padding:2rem;text-align:center;color:var(--text-secondary);">Enter your income to see your RRSP tax refund.</div>';
    breakdownEl.innerHTML = '';
    return;
  }

  const totalIncome = income + otherIncome;
  const maxRoom = Math.min(totalIncome * 0.18, 32490);
  document.getElementById('rrsp-room-hint').textContent = `2026 max: 18% of earned income, up to $32,490 ‚Äî Your room: ${fmtFull(maxRoom)}`;

  const effectiveContribution = Math.min(contribution, maxRoom, totalIncome);
  const taxableWithout = Math.max(totalIncome, 0);
  const taxableWith = Math.max(totalIncome - effectiveContribution, 0);

  // Federal brackets 2026
  const fedBrackets = [
    { min: 0, max: 57375, rate: 0.15 },
    { min: 57375, max: 114750, rate: 0.205 },
    { min: 114750, max: 158468, rate: 0.26 },
    { min: 158468, max: 220000, rate: 0.29 },
    { min: 220000, max: Infinity, rate: 0.33 }
  ];

  // Provincial brackets 2025/2026
  const provBrackets = {
    AB: [
      { min: 0, max: 148269, rate: 0.10 },
      { min: 148269, max: 177922, rate: 0.12 },
      { min: 177922, max: 237230, rate: 0.13 },
      { min: 237230, max: 355845, rate: 0.14 },
      { min: 355845, max: Infinity, rate: 0.15 }
    ],
    BC: [
      { min: 0, max: 47937, rate: 0.0506 },
      { min: 47937, max: 95875, rate: 0.077 },
      { min: 95875, max: 110076, rate: 0.105 },
      { min: 110076, max: 133664, rate: 0.1229 },
      { min: 133664, max: 181232, rate: 0.147 },
      { min: 181232, max: 252752, rate: 0.168 },
      { min: 252752, max: Infinity, rate: 0.205 }
    ],
    MB: [
      { min: 0, max: 47000, rate: 0.108 },
      { min: 47000, max: 100000, rate: 0.1275 },
      { min: 100000, max: Infinity, rate: 0.174 }
    ],
    NB: [
      { min: 0, max: 49958, rate: 0.094 },
      { min: 49958, max: 99916, rate: 0.14 },
      { min: 99916, max: 185064, rate: 0.16 },
      { min: 185064, max: Infinity, rate: 0.195 }
    ],
    NL: [
      { min: 0, max: 43198, rate: 0.087 },
      { min: 43198, max: 86395, rate: 0.145 },
      { min: 86395, max: 154244, rate: 0.158 },
      { min: 154244, max: 215943, rate: 0.178 },
      { min: 215943, max: 275870, rate: 0.198 },
      { min: 275870, max: 551739, rate: 0.208 },
      { min: 551739, max: 1103478, rate: 0.213 },
      { min: 1103478, max: Infinity, rate: 0.218 }
    ],
    NS: [
      { min: 0, max: 29590, rate: 0.0879 },
      { min: 29590, max: 59180, rate: 0.1495 },
      { min: 59180, max: 93000, rate: 0.1667 },
      { min: 93000, max: 150000, rate: 0.175 },
      { min: 150000, max: Infinity, rate: 0.21 }
    ],
    NT: [
      { min: 0, max: 50597, rate: 0.059 },
      { min: 50597, max: 101198, rate: 0.086 },
      { min: 101198, max: 164525, rate: 0.122 },
      { min: 164525, max: Infinity, rate: 0.1405 }
    ],
    NU: [
      { min: 0, max: 53268, rate: 0.04 },
      { min: 53268, max: 106537, rate: 0.07 },
      { min: 106537, max: 173205, rate: 0.09 },
      { min: 173205, max: Infinity, rate: 0.115 }
    ],
    ON: [
      { min: 0, max: 52886, rate: 0.0505 },
      { min: 52886, max: 105775, rate: 0.0915 },
      { min: 105775, max: 150000, rate: 0.1116 },
      { min: 150000, max: 220000, rate: 0.1216 },
      { min: 220000, max: Infinity, rate: 0.1316 }
    ],
    PE: [
      { min: 0, max: 32656, rate: 0.0965 },
      { min: 32656, max: 64313, rate: 0.1363 },
      { min: 64313, max: 105000, rate: 0.1665 },
      { min: 105000, max: 140000, rate: 0.18 },
      { min: 140000, max: Infinity, rate: 0.1875 }
    ],
    QC: [
      { min: 0, max: 51780, rate: 0.14 },
      { min: 51780, max: 103545, rate: 0.19 },
      { min: 103545, max: 126000, rate: 0.24 },
      { min: 126000, max: Infinity, rate: 0.2575 }
    ],
    SK: [
      { min: 0, max: 52057, rate: 0.105 },
      { min: 52057, max: 148734, rate: 0.125 },
      { min: 148734, max: Infinity, rate: 0.145 }
    ],
    YT: [
      { min: 0, max: 57375, rate: 0.064 },
      { min: 57375, max: 114750, rate: 0.09 },
      { min: 114750, max: 158468, rate: 0.109 },
      { min: 158468, max: 220000, rate: 0.128 },
      { min: 220000, max: 500000, rate: 0.15 },
      { min: 500000, max: Infinity, rate: 0.15 }
    ]
  };

  function calcTax(taxableIncome, brackets) {
    let tax = 0;
    for (const b of brackets) {
      if (taxableIncome <= b.min) break;
      const taxable = Math.min(taxableIncome, b.max) - b.min;
      tax += taxable * b.rate;
    }
    return tax;
  }

  function getMarginalRate(taxableIncome, brackets) {
    let rate = brackets[0].rate;
    for (const b of brackets) {
      if (taxableIncome > b.min) rate = b.rate;
    }
    return rate;
  }

  function getOptimalContribution(taxableIncome, brackets) {
    // Find current bracket threshold and how much to contribute to drop to next lower bracket
    for (let i = brackets.length - 1; i >= 0; i--) {
      if (taxableIncome > brackets[i].min) {
        const amountInBracket = taxableIncome - brackets[i].min;
        return { amount: amountInBracket, bracketRate: brackets[i].rate, nextThreshold: brackets[i].min };
      }
    }
    return { amount: 0, bracketRate: 0, nextThreshold: 0 };
  }

  const prov = provBrackets[province] || provBrackets.ON;

  const fedTaxWithout = calcTax(taxableWithout, fedBrackets);
  const fedTaxWith = calcTax(taxableWith, fedBrackets);
  const provTaxWithout = calcTax(taxableWithout, prov);
  const provTaxWith = calcTax(taxableWith, prov);

  const totalTaxWithout = fedTaxWithout + provTaxWithout;
  const totalTaxWith = fedTaxWith + provTaxWith;
  const refund = totalTaxWithout - totalTaxWith;

  const fedMarginal = getMarginalRate(taxableWithout, fedBrackets);
  const provMarginal = getMarginalRate(taxableWithout, prov);
  const combinedMarginal = fedMarginal + provMarginal;
  const effectiveRate = taxableWithout > 0 ? totalTaxWithout / taxableWithout : 0;

  // Optimal contribution to drop federal bracket
  const fedOptimal = getOptimalContribution(taxableWithout, fedBrackets);
  const provOptimal = getOptimalContribution(taxableWithout, prov);
  const optimalContrib = Math.min(fedOptimal.amount, maxRoom);

  // Bar chart max
  const barMax = Math.max(totalTaxWithout, 1);

  resultsEl.innerHTML = `
    <div class="result-card glass-card" style="padding: 1.5rem; text-align: center; background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(59,130,246,0.1));">
      <div class="result-label">Your RRSP Tax Refund</div>
      <div class="result-value mono" style="font-size: 2.5rem; color: var(--brand-success);">${fmtFull(refund)}</div>
      <div style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.25rem;">
        from a ${fmtFull(effectiveContribution)} contribution
      </div>
    </div>
    <div class="result-card glass-card" style="padding: 1.25rem;">
      <div class="result-label">Combined Marginal Rate</div>
      <div class="result-value mono" style="font-size: 1.5rem;">${(combinedMarginal * 100).toFixed(2)}%</div>
      <div style="color: var(--text-secondary); font-size: 0.8rem;">Federal ${(fedMarginal * 100).toFixed(1)}% + Provincial ${(provMarginal * 100).toFixed(1)}%</div>
    </div>
    <div class="result-card glass-card" style="padding: 1.25rem;">
      <div class="result-label">Effective Tax Rate</div>
      <div class="result-value mono" style="font-size: 1.5rem;">${(effectiveRate * 100).toFixed(2)}%</div>
      <div style="color: var(--text-secondary); font-size: 0.8rem;">On total income of ${fmtFull(taxableWithout)}</div>
    </div>
    <div class="result-card glass-card" style="padding: 1.25rem;">
      <div class="result-label">Optimal Contribution</div>
      <div class="result-value mono" style="font-size: 1.5rem; color: var(--brand-warning);">${fmtFull(optimalContrib)}</div>
      <div style="color: var(--text-secondary); font-size: 0.8rem;">To drop to next federal bracket (${(fedOptimal.bracketRate * 100).toFixed(1)}% ‚Üí ${fedOptimal.nextThreshold > 0 ? (getMarginalRate(fedOptimal.nextThreshold, fedBrackets) * 100).toFixed(1) : '0'}%)</div>
    </div>
    <div class="result-card glass-card" style="padding: 1.25rem;">
      <div class="result-label" style="margin-bottom: 1rem;">Tax Comparison</div>
      <div style="display: flex; gap: 1.5rem; align-items: flex-end; height: 120px; margin-bottom: 0.75rem;">
        <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; height:100%;">
          <div class="mono" style="font-size:0.8rem; margin-bottom:0.25rem; color:var(--brand-danger);">${fmtFull(totalTaxWithout)}</div>
          <div style="width:100%; background:var(--brand-danger); border-radius:var(--radius-lg) var(--radius-lg) 0 0; min-height:8px; height:${(totalTaxWithout / barMax * 100).toFixed(1)}%;"></div>
          <div style="font-size:0.75rem; color:var(--text-secondary); margin-top:0.35rem;">Without RRSP</div>
        </div>
        <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; height:100%;">
          <div class="mono" style="font-size:0.8rem; margin-bottom:0.25rem; color:var(--brand-success);">${fmtFull(totalTaxWith)}</div>
          <div style="width:100%; background:var(--brand-success); border-radius:var(--radius-lg) var(--radius-lg) 0 0; min-height:8px; height:${(totalTaxWith / barMax * 100).toFixed(1)}%;"></div>
          <div style="font-size:0.75rem; color:var(--text-secondary); margin-top:0.35rem;">With RRSP</div>
        </div>
      </div>
      <div style="text-align:center; font-size:0.85rem; color:var(--brand-success); font-weight:600;">You save ${fmtFull(refund)}</div>
    </div>
  `;

  // Breakdown section ‚Äî bracket visualization + federal/provincial split
  const fedBracketRows = fedBrackets.map(b => {
    const lo = b.min;
    const hi = b.max === Infinity ? '‚àû' : fmtFull(b.max);
    const inBracket = Math.max(0, Math.min(taxableWithout, b.max === Infinity ? taxableWithout : b.max) - b.min);
    const taxInBracket = inBracket * b.rate;
    const active = taxableWithout > b.min;
    return `<tr style="opacity:${active ? 1 : 0.4};">
      <td style="padding:0.4rem 0.75rem;">${fmtFull(lo)} ‚Äì ${hi}</td>
      <td style="padding:0.4rem 0.75rem; text-align:right;" class="mono">${(b.rate * 100).toFixed(1)}%</td>
      <td style="padding:0.4rem 0.75rem; text-align:right;" class="mono">${fmtFull(inBracket)}</td>
      <td style="padding:0.4rem 0.75rem; text-align:right;" class="mono">${fmtFull(taxInBracket)}</td>
    </tr>`;
  }).join('');

  const provBracketRows = prov.map(b => {
    const lo = b.min;
    const hi = b.max === Infinity ? '‚àû' : fmtFull(b.max);
    const inBracket = Math.max(0, Math.min(taxableWithout, b.max === Infinity ? taxableWithout : b.max) - b.min);
    const taxInBracket = inBracket * b.rate;
    const active = taxableWithout > b.min;
    return `<tr style="opacity:${active ? 1 : 0.4};">
      <td style="padding:0.4rem 0.75rem;">${fmtFull(lo)} ‚Äì ${hi}</td>
      <td style="padding:0.4rem 0.75rem; text-align:right;" class="mono">${(b.rate * 100).toFixed(1)}%</td>
      <td style="padding:0.4rem 0.75rem; text-align:right;" class="mono">${fmtFull(inBracket)}</td>
      <td style="padding:0.4rem 0.75rem; text-align:right;" class="mono">${fmtFull(taxInBracket)}</td>
    </tr>`;
  }).join('');

  const provName = document.getElementById('rrsp-province').selectedOptions[0].text;

  // Bracket position visualization
  const allBracketThresholds = fedBrackets.filter(b => b.max !== Infinity).map(b => b.max);
  const vizMax = Math.max(taxableWithout * 1.2, 250000);
  const incomePos = (taxableWithout / vizMax * 100).toFixed(1);
  const bracketMarkers = allBracketThresholds.map(t => {
    const pos = (t / vizMax * 100).toFixed(1);
    return `<div style="position:absolute; left:${pos}%; top:0; bottom:0; width:1px; background:var(--border-primary);"></div>
            <div style="position:absolute; left:${pos}%; bottom:-1.4rem; font-size:0.65rem; color:var(--text-secondary); transform:translateX(-50%);">${(t/1000).toFixed(0)}k</div>`;
  }).join('');

  breakdownEl.innerHTML = `
    <h3 style="margin: 0 0 1rem 0; font-size: 1.1rem;">üìä Where Your Income Falls</h3>
    <div style="position:relative; height:28px; background:var(--bg-secondary); border-radius:14px; overflow:visible; margin-bottom:2.5rem; border:1px solid var(--border-primary);">
      <div style="position:absolute; left:0; top:0; bottom:0; width:${incomePos}%; background:linear-gradient(90deg, var(--brand-success), var(--brand-warning)); border-radius:14px; transition:width 0.4s ease;"></div>
      ${bracketMarkers}
      <div style="position:absolute; left:${incomePos}%; top:-6px; width:3px; height:40px; background:var(--brand-danger); border-radius:2px; transform:translateX(-50%);"></div>
      <div style="position:absolute; left:${incomePos}%; top:-1.8rem; font-size:0.75rem; font-weight:600; color:var(--brand-danger); transform:translateX(-50%); white-space:nowrap;">${fmtFull(taxableWithout)}</div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem;">
      <div>
        <h4 style="margin: 0 0 0.75rem 0; font-size: 0.95rem;">üá®üá¶ Federal Brackets</h4>
        <table style="width:100%; font-size:0.8rem; border-collapse:collapse;">
          <thead><tr style="border-bottom:1px solid var(--border-primary);">
            <th style="padding:0.4rem 0.75rem; text-align:left;">Range</th>
            <th style="padding:0.4rem 0.75rem; text-align:right;">Rate</th>
            <th style="padding:0.4rem 0.75rem; text-align:right;">Income</th>
            <th style="padding:0.4rem 0.75rem; text-align:right;">Tax</th>
          </tr></thead>
          <tbody>${fedBracketRows}</tbody>
          <tfoot><tr style="border-top:1px solid var(--border-primary); font-weight:600;">
            <td colspan="3" style="padding:0.5rem 0.75rem;">Total Federal Tax</td>
            <td style="padding:0.5rem 0.75rem; text-align:right;" class="mono">${fmtFull(fedTaxWithout)}</td>
          </tr></tfoot>
        </table>
      </div>
      <div>
        <h4 style="margin: 0 0 0.75rem 0; font-size: 0.95rem;">üè† ${provName} Brackets</h4>
        <table style="width:100%; font-size:0.8rem; border-collapse:collapse;">
          <thead><tr style="border-bottom:1px solid var(--border-primary);">
            <th style="padding:0.4rem 0.75rem; text-align:left;">Range</th>
            <th style="padding:0.4rem 0.75rem; text-align:right;">Rate</th>
            <th style="padding:0.4rem 0.75rem; text-align:right;">Income</th>
            <th style="padding:0.4rem 0.75rem; text-align:right;">Tax</th>
          </tr></thead>
          <tbody>${provBracketRows}</tbody>
          <tfoot><tr style="border-top:1px solid var(--border-primary); font-weight:600;">
            <td colspan="3" style="padding:0.5rem 0.75rem;">Total Provincial Tax</td>
            <td style="padding:0.5rem 0.75rem; text-align:right;" class="mono">${fmtFull(provTaxWithout)}</td>
          </tr></tfoot>
        </table>
      </div>
    </div>

    <div style="margin-top:1.5rem; padding:1rem; background:rgba(16,185,129,0.08); border-radius:var(--radius-lg); border:1px solid rgba(16,185,129,0.2);">
      <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:1rem; text-align:center;">
        <div>
          <div style="font-size:0.8rem; color:var(--text-secondary);">Federal Savings</div>
          <div class="mono" style="font-size:1.1rem; font-weight:600; color:var(--brand-success);">${fmtFull(fedTaxWithout - fedTaxWith)}</div>
        </div>
        <div>
          <div style="font-size:0.8rem; color:var(--text-secondary);">Provincial Savings</div>
          <div class="mono" style="font-size:1.1rem; font-weight:600; color:var(--brand-success);">${fmtFull(provTaxWithout - provTaxWith)}</div>
        </div>
        <div>
          <div style="font-size:0.8rem; color:var(--text-secondary);">Total Refund</div>
          <div class="mono" style="font-size:1.1rem; font-weight:700; color:var(--brand-success);">${fmtFull(refund)}</div>
        </div>
      </div>
    </div>
  `;
}


    // ‚ïê‚ïê‚ïê CANADIAN INCOME TAX CALCULATOR ‚ïê‚ïê‚ïê
function calculateIncomeTax() {
  const v = id => parseFloat(document.getElementById(id)?.value) || 0;
  const province = document.getElementById('incometax-province').value;
  const employment = v('incometax-employment');
  const selfEmploy = v('incometax-selfemploy');
  const capitalGainsTotal = v('incometax-capitalgains');
  const eligibleDiv = v('incometax-eligible-div');
  const ineligibleDiv = v('incometax-ineligible-div');
  const rental = v('incometax-rental');
  const rrspDeduction = v('incometax-rrsp');
  const otherDeductions = v('incometax-other-deductions');

  const resultsEl = document.getElementById('incometax-results');
  const breakdownEl = document.getElementById('incometax-breakdown');

  if (employment + selfEmploy + capitalGainsTotal + eligibleDiv + ineligibleDiv + rental <= 0) {
    resultsEl.innerHTML = '';
    breakdownEl.innerHTML = '';
    return;
  }

  // ‚îÄ‚îÄ 2026 Constants ‚îÄ‚îÄ
  const CPP_RATE = 0.0595;
  const CPP_MAX_PENSIONABLE = 71300;
  const CPP_EXEMPTION = 3500;
  const CPP_MAX_CONTRIB = 4034.10; // employee portion
  const CPP2_RATE = 0.04;
  const CPP2_CEILING = 81200;
  const CPP2_MAX_CONTRIB = 396.00;
  const EI_RATE = 0.0164;
  const EI_MAX_INSURABLE = 65700;
  const EI_MAX_PREMIUM = 1077.48;
  const FEDERAL_BPA = 16129;

  // QPP for Quebec
  const QPP_RATE = 0.0640;
  const QPP_MAX_CONTRIB = 4340.80;
  const QPIP_RATE_EE = 0.00494;
  const QPIP_MAX_INSURABLE = 98000;
  const QPIP_MAX_PREMIUM = 484.12;
  const EI_RATE_QC = 0.01312; // reduced EI for Quebec
  const EI_MAX_QC = 862.62;

  // ‚îÄ‚îÄ Capital gains inclusion ‚îÄ‚îÄ
  const capitalGainsTaxable = capitalGainsTotal * 0.5;

  // ‚îÄ‚îÄ Dividend gross-up ‚îÄ‚îÄ
  const eligibleGrossUp = eligibleDiv * 1.38;
  const ineligibleGrossUp = ineligibleDiv * 1.15;

  // ‚îÄ‚îÄ Total & taxable income ‚îÄ‚îÄ
  const totalIncome = employment + selfEmploy + capitalGainsTaxable + eligibleGrossUp + ineligibleGrossUp + rental;
  const taxableIncome = Math.max(0, totalIncome - rrspDeduction - otherDeductions);

  // ‚îÄ‚îÄ CPP / QPP ‚îÄ‚îÄ
  const earnedIncome = employment + selfEmploy;
  const isQuebec = province === 'QC';
  let cppContrib = 0, cpp2Contrib = 0, eiPremium = 0, qpipPremium = 0;

  if (isQuebec) {
    // QPP
    const qppPensionable = Math.min(earnedIncome, CPP_MAX_PENSIONABLE);
    const qppBase = Math.max(0, qppPensionable - CPP_EXEMPTION);
    cppContrib = Math.min(qppBase * QPP_RATE, QPP_MAX_CONTRIB);
    // QPP2
    if (earnedIncome > CPP_MAX_PENSIONABLE) {
      const qpp2Base = Math.min(earnedIncome, CPP2_CEILING) - CPP_MAX_PENSIONABLE;
      cpp2Contrib = Math.min(Math.max(0, qpp2Base) * CPP2_RATE, CPP2_MAX_CONTRIB);
    }
    // Self-employed pays both portions
    if (selfEmploy > 0 && employment === 0) {
      cppContrib *= 2;
      cpp2Contrib *= 2;
    } else if (selfEmploy > 0 && employment > 0) {
      // Additional self-employ CPP on self-employ portion
      const empCpp = Math.min(Math.max(0, Math.min(employment, CPP_MAX_PENSIONABLE) - CPP_EXEMPTION) * QPP_RATE, QPP_MAX_CONTRIB);
      const totalCpp = Math.min(Math.max(0, Math.min(earnedIncome, CPP_MAX_PENSIONABLE) - CPP_EXEMPTION) * QPP_RATE, QPP_MAX_CONTRIB);
      const selfCpp = totalCpp - empCpp;
      cppContrib = empCpp + selfCpp * 2;
    }
    // QPIP
    qpipPremium = Math.min(earnedIncome * QPIP_RATE_EE, QPIP_MAX_PREMIUM);
    // EI (reduced)
    eiPremium = Math.min(employment * EI_RATE_QC, EI_MAX_QC);
  } else {
    // CPP
    const cppPensionable = Math.min(earnedIncome, CPP_MAX_PENSIONABLE);
    const cppBase = Math.max(0, cppPensionable - CPP_EXEMPTION);
    cppContrib = Math.min(cppBase * CPP_RATE, CPP_MAX_CONTRIB);
    // CPP2
    if (earnedIncome > CPP_MAX_PENSIONABLE) {
      const cpp2Base = Math.min(earnedIncome, CPP2_CEILING) - CPP_MAX_PENSIONABLE;
      cpp2Contrib = Math.min(Math.max(0, cpp2Base) * CPP2_RATE, CPP2_MAX_CONTRIB);
    }
    // Self-employed pays both portions
    if (selfEmploy > 0 && employment === 0) {
      cppContrib *= 2;
      cpp2Contrib *= 2;
    } else if (selfEmploy > 0 && employment > 0) {
      const empCpp = Math.min(Math.max(0, Math.min(employment, CPP_MAX_PENSIONABLE) - CPP_EXEMPTION) * CPP_RATE, CPP_MAX_CONTRIB);
      const totalCpp = Math.min(Math.max(0, Math.min(earnedIncome, CPP_MAX_PENSIONABLE) - CPP_EXEMPTION) * CPP_RATE, CPP_MAX_CONTRIB);
      const selfCpp = totalCpp - empCpp;
      cppContrib = empCpp + selfCpp * 2;
    }
    // EI (employees only)
    eiPremium = Math.min(employment * EI_RATE, EI_MAX_PREMIUM);
  }

  // ‚îÄ‚îÄ Federal tax brackets 2026 ‚îÄ‚îÄ
  const fedBrackets = [
    [57375, 0.15],
    [114750 - 57375, 0.205],
    [158468 - 114750, 0.26],
    [220000 - 158468, 0.29],
    [Infinity, 0.33]
  ];

  // ‚îÄ‚îÄ Provincial brackets 2026 ‚îÄ‚îÄ
  const provData = {
    AB: {
      name: 'Alberta', bpa: 22323,
      brackets: [[148269, 0.10], [177922 - 148269, 0.12], [237230 - 177922, 0.13], [355845 - 237230, 0.14], [Infinity, 0.15]],
      eligDTC: 0.10, ineligDTC: 0.10
    },
    BC: {
      name: 'British Columbia', bpa: 12580,
      brackets: [[47937, 0.0506], [95875 - 47937, 0.077], [110076 - 95875, 0.105], [133664 - 110076, 0.1229], [181232 - 133664, 0.147], [252752 - 181232, 0.168], [Infinity, 0.205]],
      eligDTC: 0.10, ineligDTC: 0.0196
    },
    MB: {
      name: 'Manitoba', bpa: 15780,
      brackets: [[47000, 0.108], [100000 - 47000, 0.1275], [Infinity, 0.174]],
      eligDTC: 0.08, ineligDTC: 0.007
    },
    NB: {
      name: 'New Brunswick', bpa: 13044,
      brackets: [[49958, 0.094], [99916 - 49958, 0.14], [185064 - 99916, 0.16], [Infinity, 0.195]],
      eligDTC: 0.0314, ineligDTC: 0.0291
    },
    NL: {
      name: 'Newfoundland & Labrador', bpa: 10818,
      brackets: [[43198, 0.087], [86395 - 43198, 0.145], [154244 - 86395, 0.158], [215943 - 154244, 0.178], [275870 - 215943, 0.198], [551739 - 275870, 0.208], [1103478 - 551739, 0.213], [Infinity, 0.218]],
      eligDTC: 0.056, ineligDTC: 0.032
    },
    NS: {
      name: 'Nova Scotia', bpa: 8481,
      brackets: [[29590, 0.0879], [59180 - 29590, 0.1495], [93000 - 59180, 0.1667], [150000 - 93000, 0.175], [Infinity, 0.21]],
      eligDTC: 0.0885, ineligDTC: 0.0299
    },
    NT: {
      name: 'Northwest Territories', bpa: 17373,
      brackets: [[50597, 0.059], [101198 - 50597, 0.086], [164525 - 101198, 0.122], [Infinity, 0.1405]],
      eligDTC: 0.0601, ineligDTC: 0.028
    },
    NU: {
      name: 'Nunavut', bpa: 18767,
      brackets: [[53268, 0.04], [106537 - 53268, 0.07], [173205 - 106537, 0.09], [Infinity, 0.115]],
      eligDTC: 0.0551, ineligDTC: 0.0261
    },
    ON: {
      name: 'Ontario', bpa: 11865,
      brackets: [[51446, 0.0505], [102894 - 51446, 0.0915], [150000 - 102894, 0.1116], [220000 - 150000, 0.1216], [Infinity, 0.1316]],
      surtax: true, surtaxThresholds: [4991, 0.20, 6387, 0.36],
      eligDTC: 0.10, ineligDTC: 0.029863
    },
    PE: {
      name: 'Prince Edward Island', bpa: 13500,
      brackets: [[32656, 0.095], [64313 - 32656, 0.1325], [105000 - 64313, 0.166], [140000 - 105000, 0.1763], [Infinity, 0.19]],
      surtax: true, surtaxThresholds: [12500, 0.10],
      eligDTC: 0.105, ineligDTC: 0.028
    },
    QC: {
      name: 'Quebec', bpa: 18056,
      brackets: [[51780, 0.14], [103545 - 51780, 0.19], [126000 - 103545, 0.24], [Infinity, 0.2575]],
      eligDTC: 0.1132, ineligDTC: 0.0347,
      abatement: 0.165
    },
    SK: {
      name: 'Saskatchewan', bpa: 18491,
      brackets: [[52057, 0.105], [148734 - 52057, 0.125], [Infinity, 0.145]],
      eligDTC: 0.105, ineligDTC: 0.02105
    },
    YT: {
      name: 'Yukon', bpa: 16129,
      brackets: [[57375, 0.064], [114750 - 57375, 0.09], [158468 - 114750, 0.109], [500000 - 158468, 0.128], [Infinity, 0.15]],
      eligDTC: 0.0512, ineligDTC: 0.0241
    }
  };

  // ‚îÄ‚îÄ Tax calculation helper ‚îÄ‚îÄ
  function calcBracketTax(income, brackets) {
    let tax = 0, remaining = income;
    for (const [width, rate] of brackets) {
      const taxable = Math.min(remaining, width);
      tax += taxable * rate;
      remaining -= taxable;
      if (remaining <= 0) break;
    }
    return tax;
  }

  function getMarginalRate(income, brackets) {
    let remaining = income;
    let rate = 0;
    for (const [width, r] of brackets) {
      rate = r;
      remaining -= width;
      if (remaining <= 0) break;
    }
    return rate;
  }

  // ‚îÄ‚îÄ Federal tax ‚îÄ‚îÄ
  let fedTaxGross = calcBracketTax(taxableIncome, fedBrackets);
  const fedBPACredit = FEDERAL_BPA * 0.15;
  const fedCPPCredit = (cppContrib + cpp2Contrib) * 0.15;
  const fedEICredit = eiPremium * 0.15;
  const fedEligDTC = eligibleGrossUp * 0.150198;
  const fedIneligDTC = ineligibleGrossUp * 0.090301;
  let federalTax = Math.max(0, fedTaxGross - fedBPACredit - fedCPPCredit - fedEICredit - fedEligDTC - fedIneligDTC);

  // Quebec abatement
  if (isQuebec) {
    federalTax *= (1 - provData.QC.abatement);
  }

  // ‚îÄ‚îÄ Provincial tax ‚îÄ‚îÄ
  const prov = provData[province];
  let provTaxGross = calcBracketTax(taxableIncome, prov.brackets);
  const provBPACredit = prov.bpa * (prov.brackets[0][1]);
  const provEligDTC = eligibleGrossUp * (prov.eligDTC || 0);
  const provIneligDTC = ineligibleGrossUp * (prov.ineligDTC || 0);
  let provincialTax = Math.max(0, provTaxGross - provBPACredit - provEligDTC - provIneligDTC);

  // Ontario surtax
  if (province === 'ON' && prov.surtax) {
    const baseTax = provincialTax;
    let surtax = 0;
    if (baseTax > 6387) surtax += (baseTax - 6387) * 0.36;
    if (baseTax > 4991) surtax += (baseTax - 4991) * 0.20;
    provincialTax += surtax;
  }

  // PEI surtax
  if (province === 'PE' && prov.surtax) {
    if (provincialTax > 12500) {
      provincialTax += (provincialTax - 12500) * 0.10;
    }
  }

  // Quebec: QPIP premium
  let qpipDisplay = 0;
  if (isQuebec) {
    qpipDisplay = qpipPremium;
  }

  // ‚îÄ‚îÄ Totals ‚îÄ‚îÄ
  const totalTax = federalTax + provincialTax;
  const totalPayrollDeductions = cppContrib + cpp2Contrib + eiPremium + qpipDisplay;
  const totalDeductions = totalTax + totalPayrollDeductions;
  const grossIncome = employment + selfEmploy + capitalGainsTotal + eligibleDiv + ineligibleDiv + rental;
  const netIncome = grossIncome - totalDeductions;
  const effectiveRate = grossIncome > 0 ? (totalDeductions / grossIncome * 100) : 0;
  const fedMarginal = getMarginalRate(taxableIncome, fedBrackets);
  const provMarginal = getMarginalRate(taxableIncome, prov.brackets);
  const marginalRate = (fedMarginal + provMarginal) * 100;
  const monthly = netIncome / 12;
  const biweekly = netIncome / 26;
  const weekly = netIncome / 52;

  // ‚îÄ‚îÄ Render results ‚îÄ‚îÄ
  resultsEl.innerHTML = `
    <div class="result-card glass-card">
      <div class="result-label">Total Income</div>
      <div class="result-value mono">${fmtFull(grossIncome)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Taxable Income</div>
      <div class="result-value mono">${fmtFull(taxableIncome)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Federal Tax</div>
      <div class="result-value mono" style="color: var(--brand-danger)">${fmtFull(federalTax)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Provincial Tax (${prov.name})</div>
      <div class="result-value mono" style="color: var(--brand-danger)">${fmtFull(provincialTax)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">${isQuebec ? 'QPP' : 'CPP'} Contributions</div>
      <div class="result-value mono">${fmtFull(cppContrib)}${cpp2Contrib > 0 ? ` <span style="font-size:0.8rem;color:var(--text-secondary)">+ ${fmtFull(cpp2Contrib)} CPP2</span>` : ''}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">EI Premiums${isQuebec ? ' + QPIP' : ''}</div>
      <div class="result-value mono">${fmtFull(eiPremium)}${isQuebec ? ` <span style="font-size:0.8rem;color:var(--text-secondary)">+ ${fmtFull(qpipDisplay)} QPIP</span>` : ''}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Total Deductions</div>
      <div class="result-value mono" style="color: var(--brand-danger)">${fmtFull(totalDeductions)}</div>
    </div>
    <div class="result-card glass-card" style="border: 2px solid var(--brand-success);">
      <div class="result-label" style="font-size: 1.1rem;">üí∞ Net Take-Home Pay</div>
      <div class="result-value mono" style="color: var(--brand-success); font-size: 1.6rem;">${fmtFull(netIncome)}</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Effective Tax Rate</div>
      <div class="result-value mono">${effectiveRate.toFixed(1)}%</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Marginal Tax Rate</div>
      <div class="result-value mono" style="color: var(--brand-warning)">${marginalRate.toFixed(1)}%</div>
    </div>
    <div class="result-card glass-card">
      <div class="result-label">Monthly / Biweekly / Weekly</div>
      <div class="result-value mono" style="font-size: 0.95rem;">
        ${fmtFull(monthly)} / ${fmtFull(biweekly)} / ${fmtFull(weekly)}
      </div>
    </div>
  `;

  // ‚îÄ‚îÄ Breakdown charts ‚îÄ‚îÄ
  const donutData = [
    { label: 'Federal Tax', value: federalTax, color: '#ef4444' },
    { label: 'Provincial Tax', value: provincialTax, color: '#f97316' },
    { label: `${isQuebec ? 'QPP' : 'CPP'}`, value: cppContrib + cpp2Contrib, color: '#eab308' },
    { label: `EI${isQuebec ? '/QPIP' : ''}`, value: eiPremium + qpipDisplay, color: '#6366f1' },
    { label: 'Take-Home', value: Math.max(0, netIncome), color: '#22c55e' }
  ].filter(d => d.value > 0);

  const waterfallData = [
    { label: 'Gross Income', value: grossIncome, color: '#3b82f6' },
    { label: 'RRSP + Deductions', value: -(rrspDeduction + otherDeductions), color: '#a855f7' },
    { label: 'Federal Tax', value: -federalTax, color: '#ef4444' },
    { label: 'Provincial Tax', value: -provincialTax, color: '#f97316' },
    { label: `${isQuebec ? 'QPP' : 'CPP'}/EI`, value: -(totalPayrollDeductions), color: '#eab308' },
    { label: 'Take-Home', value: Math.max(0, netIncome), color: '#22c55e' }
  ];

  breakdownEl.innerHTML = `
    <h3 style="margin: 0 0 1rem 0; font-size: 1.1rem;">üìä Tax Breakdown</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; align-items: start;">
      <div>
        <h4 style="margin: 0 0 0.75rem; color: var(--text-secondary); font-size: 0.9rem;">Income Allocation</h4>
        ${svgDonut(donutData, 220)}
      </div>
      <div>
        <h4 style="margin: 0 0 0.75rem; color: var(--text-secondary); font-size: 0.9rem;">Income Waterfall</h4>
        ${svgWaterfall(waterfallData, 400, 220)}
      </div>
    </div>
    <div style="margin-top: 1.5rem;">
      <h4 style="margin: 0 0 0.75rem; color: var(--text-secondary); font-size: 0.9rem;">üíµ Monthly Cash Flow</h4>
      <div style="display: flex; gap: 0.5rem; align-items: end; height: 120px;">
        ${[
          { label: 'Gross', val: grossIncome / 12, color: '#3b82f6' },
          { label: 'Fed Tax', val: federalTax / 12, color: '#ef4444' },
          { label: 'Prov Tax', val: provincialTax / 12, color: '#f97316' },
          { label: isQuebec ? 'QPP' : 'CPP', val: (cppContrib + cpp2Contrib) / 12, color: '#eab308' },
          { label: 'EI', val: (eiPremium + qpipDisplay) / 12, color: '#6366f1' },
          { label: 'Net', val: Math.max(0, netIncome) / 12, color: '#22c55e' }
        ].map(b => {
          const maxVal = grossIncome / 12;
          const h = maxVal > 0 ? Math.max(4, (b.val / maxVal) * 100) : 4;
          return `<div style="flex:1;text-align:center;">
            <div style="font-size:0.7rem;color:var(--text-secondary);margin-bottom:2px;">${fmtFull(b.val)}</div>
            <div style="height:${h}px;background:${b.color};border-radius:4px 4px 0 0;"></div>
            <div style="font-size:0.65rem;color:var(--text-secondary);margin-top:2px;">${b.label}</div>
          </div>`;
        }).join('')}
      </div>
    </div>
    <div style="margin-top: 1.5rem; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-lg); border: 1px solid var(--border-primary);">
      <h4 style="margin: 0 0 0.5rem; font-size: 0.9rem;">üìã Detailed Breakdown</h4>
      <table style="width:100%;font-size:0.85rem;border-collapse:collapse;">
        <tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Employment Income</td><td style="text-align:right" class="mono">${fmtFull(employment)}</td></tr>
        ${selfEmploy > 0 ? `<tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Self-Employment Income</td><td style="text-align:right" class="mono">${fmtFull(selfEmploy)}</td></tr>` : ''}
        ${capitalGainsTotal > 0 ? `<tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Capital Gains (taxable: ${fmtFull(capitalGainsTaxable)})</td><td style="text-align:right" class="mono">${fmtFull(capitalGainsTotal)}</td></tr>` : ''}
        ${eligibleDiv > 0 ? `<tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Eligible Dividends (grossed-up: ${fmtFull(eligibleGrossUp)})</td><td style="text-align:right" class="mono">${fmtFull(eligibleDiv)}</td></tr>` : ''}
        ${ineligibleDiv > 0 ? `<tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Ineligible Dividends (grossed-up: ${fmtFull(ineligibleGrossUp)})</td><td style="text-align:right" class="mono">${fmtFull(ineligibleDiv)}</td></tr>` : ''}
        ${rental > 0 ? `<tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Rental Income</td><td style="text-align:right" class="mono">${fmtFull(rental)}</td></tr>` : ''}
        <tr style="border-bottom:2px solid var(--border-primary);font-weight:600"><td style="padding:4px 0">Total Income</td><td style="text-align:right" class="mono">${fmtFull(grossIncome)}</td></tr>
        ${rrspDeduction > 0 ? `<tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">RRSP Deduction</td><td style="text-align:right;color:var(--brand-success)" class="mono">-${fmtFull(rrspDeduction)}</td></tr>` : ''}
        ${otherDeductions > 0 ? `<tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Other Deductions</td><td style="text-align:right;color:var(--brand-success)" class="mono">-${fmtFull(otherDeductions)}</td></tr>` : ''}
        <tr style="border-bottom:2px solid var(--border-primary);font-weight:600"><td style="padding:4px 0">Taxable Income</td><td style="text-align:right" class="mono">${fmtFull(taxableIncome)}</td></tr>
        <tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Federal Tax</td><td style="text-align:right;color:var(--brand-danger)" class="mono">-${fmtFull(federalTax)}</td></tr>
        <tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">Provincial Tax (${prov.name})</td><td style="text-align:right;color:var(--brand-danger)" class="mono">-${fmtFull(provincialTax)}</td></tr>
        <tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">${isQuebec ? 'QPP' : 'CPP'} Contributions</td><td style="text-align:right" class="mono">-${fmtFull(cppContrib + cpp2Contrib)}</td></tr>
        <tr style="border-bottom:1px solid var(--border-primary)"><td style="padding:4px 0">EI Premiums${isQuebec ? ' + QPIP' : ''}</td><td style="text-align:right" class="mono">-${fmtFull(eiPremium + qpipDisplay)}</td></tr>
        <tr style="font-weight:700;font-size:1rem;"><td style="padding:8px 0">Net Take-Home Pay</td><td style="text-align:right;color:var(--brand-success)" class="mono">${fmtFull(netIncome)}</td></tr>
      </table>
    </div>
  `;
}


    // ‚ïê‚ïê‚ïê RRSP VS TFSA COMPARISON TOOL ‚ïê‚ïê‚ïê


// Auto-calculate on load
document.addEventListener('DOMContentLoaded', function() {
  if (document.getElementById('rvt-age')) calculateRetirement();
});


    // ‚îÄ‚îÄ Utility Functions ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // ‚îÄ‚îÄ Page Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const target = document.getElementById('page-' + pageId);
      if (target) {
        target.classList.add('active');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      
      // Close mobile menu
      document.getElementById('nav-links').classList.remove('mobile-open');
      
      // Initialize calculators
      if (pageId === 'valuation') calculateDCF();
      if (pageId === 'mortgage') calculateMortgage();
      if (pageId === 'investment') calculateCAGR();
      if (pageId === 'retirement') calculateRetirement();
      if (pageId === 'compound') calculateCompound();
      if (pageId === 'runway') calculateRunway();
      if (pageId === 'networth') { calculateNetWorth(); loadNetWorthSnapshots(); }
      if (pageId === 'salary') calculateSalary();
      if (pageId === 'debt') calculateDebt();
      if (pageId === 'compare') calculateComparison();
      if (pageId === 'currency') convertCurrency();
      if (pageId === 'lease') calculateLeaseBuy();
      if (pageId === 'tax') calculateTax();
      if (pageId === 'fhsa') calculateFHSA();
      if (pageId === 'resp') calculateRESP();
      if (pageId === 'rentbuy') calculateRentBuy();
      if (pageId === 'gic') calculateGIC();
      if (pageId === 'cpp') calculateCPP();
      if (pageId === 'capgains') calculateCapGains();
      if (pageId === 'tfsa') calculateTFSA();
      if (pageId === 'rrsp') calculateRRSP();
      if (pageId === 'incometax') calculateIncomeTax();
    }
    
    // ‚îÄ‚îÄ Hash-based routing (for external links like blog ‚Üí calculator) ‚îÄ‚îÄ
    function handleHashRoute() {
      const hash = window.location.hash;
      if (hash && hash.startsWith('#page-')) {
        const pageId = hash.replace('#page-', '');
        showPage(pageId);
      }
    }
    window.addEventListener('hashchange', handleHashRoute);
    window.addEventListener('DOMContentLoaded', handleHashRoute);
    // Also run immediately in case DOMContentLoaded already fired
    if (document.readyState !== 'loading') handleHashRoute();

    // ‚îÄ‚îÄ Theme Toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Check localStorage first, then fall back to system preference
    let savedTheme = localStorage.getItem('figgybank-theme');
    let isDark;
    
    if (savedTheme !== null) {
      // User has a saved preference
      isDark = savedTheme === 'dark';
    } else {
      // No saved preference, check system preference
      isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    }
    
    function toggleTheme() {
      isDark = !isDark;
      document.documentElement.classList.toggle('dark', isDark);
      document.querySelector('.theme-toggle').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      localStorage.setItem('figgybank-theme', isDark ? 'dark' : 'light');
    }
    
    // Initialize theme on page load
    if (isDark) {
      document.documentElement.classList.add('dark');
      document.querySelector('.theme-toggle').textContent = 'üåô';
    } else {
      document.documentElement.classList.remove('dark');
      document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
    }
    
    // ‚îÄ‚îÄ Mobile Menu ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function toggleMobileMenu() {
      const nav = document.getElementById('nav-links');
      nav.classList.toggle('mobile-open');
      // Close all dropdowns when closing menu
      if (!nav.classList.contains('mobile-open')) {
        nav.querySelectorAll('.nav-dropdown.open').forEach(d => d.classList.remove('open'));
      }
    }
    
    // Mobile dropdown toggle (tap to open/close)
    document.querySelectorAll('.nav-dropdown-trigger').forEach(trigger => {
      trigger.addEventListener('click', function(e) {
        if (window.innerWidth <= 768) {
          e.preventDefault();
          const dropdown = this.closest('.nav-dropdown');
          const wasOpen = dropdown.classList.contains('open');
          // Close all other dropdowns
          document.querySelectorAll('.nav-dropdown.open').forEach(d => d.classList.remove('open'));
          if (!wasOpen) dropdown.classList.add('open');
        }
      });
    });
    // Also handle resize
    window.addEventListener('resize', function() {
      if (window.innerWidth > 768) {
        document.querySelectorAll('.nav-dropdown.open').forEach(d => d.classList.remove('open'));
      }
    });
    
    // ‚îÄ‚îÄ URL Sharing ‚Äî Encode/Decode Calculator State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function shareCalculator(calcName) {
      const inputs = {};
      
      // Get all input/select elements in the current calculator
      document.querySelectorAll(`#page-${calcName} input, #page-${calcName} select`).forEach(el => {
        if (el.id) {
          inputs[el.id] = el.value;
        }
      });
      
      // Encode to URL
      const params = new URLSearchParams();
      params.set('calc', calcName);
      params.set('data', btoa(JSON.stringify(inputs)));
      
      const shareURL = window.location.origin + window.location.pathname + '?' + params.toString();
      
      // Copy to clipboard
      navigator.clipboard.writeText(shareURL).then(() => {
        showToast('üîó Link copied! Share this URL to restore these exact inputs.');
      }).catch(() => {
        // Fallback for older browsers
        const dummy = document.createElement('textarea');
        document.body.appendChild(dummy);
        dummy.value = shareURL;
        dummy.select();
        document.execCommand('copy');
        document.body.removeChild(dummy);
        showToast('üîó Link copied to clipboard!');
      });
    }

    function loadSharedCalculator() {
      const params = new URLSearchParams(window.location.search);
      const calcName = params.get('calc');
      const dataEncoded = params.get('data');
      
      if (calcName && dataEncoded) {
        try {
          const inputs = JSON.parse(atob(dataEncoded));
          
          // Show the calculator page
          showPage(calcName);
          
          // Wait for page to render, then restore inputs
          setTimeout(() => {
            Object.keys(inputs).forEach(id => {
              const el = document.getElementById(id);
              if (el) {
                el.value = inputs[id];
                
                // Update display values for range sliders
                const displayEl = document.getElementById(id + '-val');
                if (displayEl && el.type === 'range') {
                  const suffix = displayEl.textContent.replace(/[\d.]+/, '').trim();
                  displayEl.textContent = el.value + suffix;
                }
                
                // Trigger calculation functions
                if (el.oninput) el.oninput();
                if (el.onchange) el.onchange();
              }
            });
            
            showToast('‚úÖ Calculator loaded from shared link!');
          }, 500);
          
        } catch (e) {
          console.error('Failed to load shared calculator:', e);
        }
      }
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.textContent = message;
      toast.style.cssText = `
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        background: var(--fg-purple);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl);
        z-index: 10000;
        font-weight: 600;
        animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
      `;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Check for shared calculator on page load
    window.addEventListener('DOMContentLoaded', loadSharedCalculator);
    
    // ‚îÄ‚îÄ Load Blog Cards on Homepage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.addEventListener('DOMContentLoaded', loadHomepageBlogCards);
    
    function loadHomepageBlogCards() {
      const container = document.getElementById('homepage-blog-cards');
      if (!container) return;
      
      // Rick Minji avatar SVG
      const rickAvatar = `<svg width="28" height="28" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="50" cy="50" r="48" fill="url(#avatarGrad)"/>
        <circle cx="50" cy="42" r="18" fill="#FDBCB4"/>
        <path d="M32 38 Q32 22 50 20 Q68 22 68 38 L68 42 Q68 32 50 30 Q32 32 32 42 Z" fill="#4A3C2C"/>
        <circle cx="43" cy="40" r="2" fill="#2C2416"/>
        <circle cx="57" cy="40" r="2" fill="#2C2416"/>
        <circle cx="43.5" cy="39.5" r="0.8" fill="white"/>
        <circle cx="57.5" cy="39.5" r="0.8" fill="white"/>
        <path d="M38 36 Q43 34 48 36" stroke="#4A3C2C" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <path d="M52 36 Q57 34 62 36" stroke="#4A3C2C" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <path d="M50 44 L48 48 L50 48.5 L52 48 Z" fill="#F5A699"/>
        <path d="M44 50 Q50 53 56 50" stroke="#C87872" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <ellipse cx="50" cy="64" rx="14" ry="8" fill="#FDBCB4"/>
        <path d="M36 68 Q36 78 50 80 Q64 78 64 68 L64 100 L36 100 Z" fill="#4A90E2"/>
        <path d="M44 68 L48 72 L50 70 L52 72 L56 68" stroke="#3A7BC8" stroke-width="1.5" fill="none"/>
        <defs>
          <linearGradient id="avatarGrad" x1="0" y1="0" x2="100" y2="100">
            <stop offset="0%" stop-color="#FFE5D9"/>
            <stop offset="100%" stop-color="#FFD4C4"/>
          </linearGradient>
        </defs>
      </svg>`;
      
      fetch('blog/articles.json')
        .then(response => response.json())
        .then(articles => {
          container.innerHTML = articles.map(article => `
            <a href="blog/${article.slug}.html" class="blog-card">
              <span class="blog-card-category">${article.category}</span>
              <h3 class="blog-card-title">${article.title}</h3>
              <p class="blog-card-excerpt">${article.excerpt.substring(0, 120)}${article.excerpt.length > 120 ? '...' : ''}</p>
              <div class="blog-card-footer">
                <div class="blog-card-author">
                  <div class="blog-card-author-avatar">${rickAvatar}</div>
                  <span class="blog-card-author-name">${article.author}</span>
                </div>
                <span class="blog-card-meta">${article.readTime}</span>
              </div>
              <div class="blog-card-readmore">
                Read More
                <span>‚Üí</span>
              </div>
            </a>
          `).join('');
        })
        .catch(err => {
          console.error('Failed to load blog articles:', err);
          container.innerHTML = '<p style="text-align:center;color:var(--text-muted);">Blog articles coming soon!</p>';
        });
    }
    
    // ‚îÄ‚îÄ Navbar Scroll Effect ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.addEventListener('scroll', () => {
      document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50);
    });
    
    // ‚îÄ‚îÄ Intersection Observer for Reveals ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1, rootMargin: '0px 0px -50px 0px' });
    
    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    
    // ‚îÄ‚îÄ Hero Counter Animation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function animateCounters() {
      document.querySelectorAll('[data-count]').forEach(el => {
        const target = parseInt(el.dataset.count) || 0;
        const suffix = el.dataset.suffix || (target > 10 ? '+' : '');
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
          current += increment;
          if (current >= target) {
            current = target;
            clearInterval(timer);
          }
          const val = Math.floor(current);
          el.textContent = (val >= 1000 ? (val / 1000).toFixed(val >= 10000 ? 0 : 1) + 'K' : val) + suffix;
        }, 35);
      });
    }
    
    // Use IntersectionObserver for hero stats
    const heroStatsObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animateCounters();
          heroStatsObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });
    const heroStats = document.querySelector('.hero-stats');
    if (heroStats) heroStatsObserver.observe(heroStats);

    // ‚îÄ‚îÄ Count-up animation for social proof numbers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const countUpObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const el = entry.target;
          const target = parseFloat(el.getAttribute('data-count-up'));
          const suffix = el.getAttribute('data-suffix') || '';
          const decimals = parseInt(el.getAttribute('data-decimals') || '0');
          const duration = 2000;
          const start = performance.now();
          function tick(now) {
            const elapsed = now - start;
            const progress = Math.min(elapsed / duration, 1);
            const eased = 1 - Math.pow(1 - progress, 3);
            const current = eased * target;
            el.textContent = (decimals > 0 ? current.toFixed(decimals) : Math.floor(current).toLocaleString()) + suffix;
            if (progress < 1) requestAnimationFrame(tick);
          }
          requestAnimationFrame(tick);
          countUpObserver.unobserve(el);
        }
      });
    }, { threshold: 0.5 });
    document.querySelectorAll('[data-count-up]').forEach(el => countUpObserver.observe(el));
    
    // ‚îÄ‚îÄ Valuation Tab Switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchValTab(tab) {
      document.querySelectorAll('#val-tabs .tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('val-dcf').style.display = tab === 'dcf' ? 'block' : 'none';
      document.getElementById('val-multiples').style.display = tab === 'multiples' ? 'block' : 'none';
      document.getElementById('val-asset').style.display = tab === 'asset' ? 'block' : 'none';
      
      if (tab === 'dcf') calculateDCF();
      if (tab === 'multiples') calculateMultiples();
      if (tab === 'asset') calculateAsset();
      updateValuationComparison();
    }
    
    // ‚îÄ‚îÄ Investment Tab Switching ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function switchInvTab(tab) {
      document.querySelectorAll('#inv-tabs .tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.getElementById('inv-cagr').style.display = tab === 'cagr' ? 'block' : 'none';
      document.getElementById('inv-dca').style.display = tab === 'dca' ? 'block' : 'none';
      
      if (tab === 'cagr') calculateCAGR();
      if (tab === 'dca') calculateDCA();
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // DCF CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateDCF() {
      const fcf = parseFloat(document.getElementById('dcf-fcf').value) || 0;
      const growth = (parseFloat(document.getElementById('dcf-growth').value) || 0) / 100;
      const terminal = (parseFloat(document.getElementById('dcf-terminal').value) || 0) / 100;
      const wacc = (parseFloat(document.getElementById('dcf-wacc').value) || 0) / 100;
      const years = parseInt(document.getElementById('dcf-years').value) || 5;
      const debt = parseFloat(document.getElementById('dcf-debt').value) || 0;
      
      if (wacc <= terminal) {
        document.getElementById('dcf-results').innerHTML = `
          <div class="result-card" style="border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
            <p style="color: var(--brand-danger); font-weight: 600;">‚ö†Ô∏è Discount rate must be higher than terminal growth rate</p>
          </div>`;
        return;
      }
      if (fcf <= 0) {
        document.getElementById('dcf-results').innerHTML = `
          <div class="result-card" style="border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
            <p style="color: var(--brand-danger); font-weight: 600;">‚ö†Ô∏è Enter a positive Free Cash Flow to calculate valuation</p>
          </div>`;
        document.getElementById('dcf-sensitivity').innerHTML = '';
        document.getElementById('dcf-chart').innerHTML = '';
        return;
      }
      
      // Project FCFs
      let projections = [];
      let pvSum = 0;
      
      for (let i = 1; i <= years; i++) {
        const projFCF = fcf * Math.pow(1 + growth, i);
        const pvFactor = Math.pow(1 + wacc, i);
        const pvFCF = projFCF / pvFactor;
        pvSum += pvFCF;
        projections.push({ year: i, fcf: projFCF, pv: pvFCF });
      }
      
      // Terminal value (Gordon Growth Model)
      const finalFCF = fcf * Math.pow(1 + growth, years);
      const terminalFCF = finalFCF * (1 + terminal);
      const terminalValue = terminalFCF / (wacc - terminal);
      const pvTerminal = terminalValue / Math.pow(1 + wacc, years);
      
      const enterpriseValue = pvSum + pvTerminal;
      const equityValue = enterpriseValue - debt;
      const tvPct = (pvTerminal / enterpriseValue * 100);
      
      // Results
      document.getElementById('dcf-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Enterprise Value</div>
          <div class="result-value">${fmt(enterpriseValue)}</div>
          <div style="margin-top: 0.75rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">PV of FCFs: ${fmt(pvSum)}</span>
            <span class="metric-pill neutral">PV Terminal: ${fmt(pvTerminal)}</span>
          </div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Equity Value</div>
          <div class="result-value" style="${equityValue < 0 ? 'background: linear-gradient(135deg, var(--brand-danger), #f97316); -webkit-background-clip: text;' : ''}">${fmt(equityValue)}</div>
          ${debt !== 0 ? `<div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">After ${debt > 0 ? 'subtracting' : 'adding'} ${fmtFull(Math.abs(debt))} net debt</div>` : ''}
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Key Metrics</div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Terminal Value %</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700; color: ${tvPct > 75 ? 'var(--brand-warning)' : 'var(--text-primary)'};">${tvPct.toFixed(1)}%</div>
              ${tvPct > 75 ? '<div style="font-size: 0.65rem; color: var(--brand-warning);">‚ö†Ô∏è High TV reliance</div>' : ''}
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Implied Multiple</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${(enterpriseValue / fcf).toFixed(1)}x FCF</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Year ${years} FCF</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${fmt(finalFCF)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Terminal Value</div>
              <div class="mono" style="font-size: 1rem; font-weight: 700;">${fmt(terminalValue)}</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">FCF Projections</div>
          ${projections.map(p => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
              <span style="font-size: 0.8rem; color: var(--text-muted);">Year ${p.year}</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(p.fcf)}</span>
              <span class="mono" style="font-size: 0.75rem; color: var(--text-muted);">PV: ${fmt(p.pv)}</span>
            </div>
          `).join('')}
        </div>
      `;
      
      // Sensitivity table
      const waccRange = [-2, -1, 0, 1, 2].map(d => wacc * 100 + d);
      const growthRange = [-1, -0.5, 0, 0.5, 1].map(d => terminal * 100 + d).filter(g => g >= 0);
      
      let tableHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Sensitivity Analysis: Enterprise Value</div>
        <div style="overflow-x: auto;">
        <table class="sensitivity-table">
          <tr>
            <th>WACC \\ Terminal G</th>
            ${growthRange.map(g => `<th>${g.toFixed(1)}%</th>`).join('')}
          </tr>
      `;
      
      waccRange.forEach(w => {
        tableHTML += `<tr><td>${w.toFixed(1)}%</td>`;
        growthRange.forEach(g => {
          if (w / 100 <= g / 100) {
            tableHTML += '<td style="color: var(--text-muted);">N/A</td>';
            return;
          }
          let pv = 0;
          for (let i = 1; i <= years; i++) {
            pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + w / 100, i);
          }
          const tFCF = fcf * Math.pow(1 + growth, years) * (1 + g / 100);
          const tv = tFCF / (w / 100 - g / 100);
          const pvTV = tv / Math.pow(1 + w / 100, years);
          const ev = pv + pvTV;
          const isBase = Math.abs(w - wacc * 100) < 0.01 && Math.abs(g - terminal * 100) < 0.01;
          tableHTML += `<td class="${isBase ? 'highlight' : ''}">${fmt(ev)}</td>`;
        });
        tableHTML += '</tr>';
      });
      
      tableHTML += '</table></div>';
      document.getElementById('dcf-sensitivity').innerHTML = tableHTML;
      updateValuationComparison();
      
      // Bar chart
      const maxFCF = Math.max(...projections.map(p => p.fcf));
      document.getElementById('dcf-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Projected Free Cash Flow</div>
        <div style="display: flex; align-items: flex-end; gap: 0.5rem; height: 200px; padding: 0 0.5rem;">
          ${projections.map(p => `
            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
              <span class="mono" style="font-size: 0.65rem; color: var(--text-muted);">${fmt(p.fcf)}</span>
              <div style="width: 100%; height: ${(p.fcf / maxFCF * 150)}px; background: linear-gradient(180deg, var(--brand-primary), var(--brand-accent)); border-radius: 4px 4px 0 0; transition: height 1s ease; min-height: 4px;"></div>
              <span style="font-size: 0.7rem; color: var(--text-muted);">Y${p.year}</span>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MULTIPLES CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateMultiples() {
      const revenue = parseFloat(document.getElementById('mult-revenue').value) || 0;
      const ebitda = parseFloat(document.getElementById('mult-ebitda').value) || 0;
      const income = parseFloat(document.getElementById('mult-income').value) || 0;
      const evRev = parseFloat(document.getElementById('mult-ev-rev').value) || 0;
      const evEbitda = parseFloat(document.getElementById('mult-ev-ebitda').value) || 0;
      const pe = parseFloat(document.getElementById('mult-pe').value) || 0;
      
      const valRevenue = revenue * evRev;
      const valEbitda = ebitda * evEbitda;
      const valEarnings = income * pe;
      const average = (valRevenue + valEbitda + valEarnings) / 3;
      const median = [valRevenue, valEbitda, valEarnings].sort((a, b) => a - b)[1];
      const low = Math.min(valRevenue, valEbitda, valEarnings);
      const high = Math.max(valRevenue, valEbitda, valEarnings);
      
      // Football field chart
      const maxVal = high * 1.1;
      const barWidth = (v) => (v / maxVal * 100).toFixed(1);
      
      document.getElementById('multiples-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Blended Valuation</div>
          <div class="result-value">${fmt(average)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Average of three methodologies</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Median Valuation</div>
          <div class="result-value">${fmt(median)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Valuation Range (Football Field)</div>
          
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">EV/Revenue (${evRev}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valRevenue)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valRevenue)}%; background: linear-gradient(90deg, #6366f1, #818cf8);"></div>
            </div>
          </div>
          
          <div style="margin-bottom: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">EV/EBITDA (${evEbitda}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valEbitda)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valEbitda)}%; background: linear-gradient(90deg, #8b5cf6, #a78bfa);"></div>
            </div>
          </div>
          
          <div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
              <span style="font-size: 0.8rem; font-weight: 600;">P/E (${pe}x)</span>
              <span class="mono" style="font-size: 0.8rem;">${fmt(valEarnings)}</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${barWidth(valEarnings)}%; background: linear-gradient(90deg, #06b6d4, #22d3ee);"></div>
            </div>
          </div>
          
          <div class="divider"></div>
          <div style="display: flex; justify-content: space-between; font-size: 0.8rem;">
            <span style="color: var(--text-muted);">Range: ${fmt(low)} ‚Äî ${fmt(high)}</span>
            <span style="color: var(--text-muted);">Spread: ${((high - low) / average * 100).toFixed(0)}%</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Implied Metrics</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">EBITDA Margin</div>
              <div class="mono" style="font-weight: 700;">${revenue > 0 ? (ebitda / revenue * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Net Margin</div>
              <div class="mono" style="font-weight: 700;">${revenue > 0 ? (income / revenue * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MULTIPLES - hook comparison
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // (comparison updated via tab switch)

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ASSET-BASED CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateAsset() {
      const cash = parseFloat(document.getElementById('asset-cash').value) || 0;
      const ar = parseFloat(document.getElementById('asset-ar').value) || 0;
      const inv = parseFloat(document.getElementById('asset-inv').value) || 0;
      const ppe = parseFloat(document.getElementById('asset-ppe').value) || 0;
      const other = parseFloat(document.getElementById('asset-other').value) || 0;
      const ap = parseFloat(document.getElementById('asset-ap').value) || 0;
      const debt = parseFloat(document.getElementById('asset-debt').value) || 0;
      const otherLiab = parseFloat(document.getElementById('asset-otherliab').value) || 0;
      
      const totalAssets = cash + ar + inv + ppe + other;
      const totalLiab = ap + debt + otherLiab;
      const nav = totalAssets - totalLiab;
      const currentRatio = (ap + otherLiab) > 0 ? (cash + ar + inv) / (ap + otherLiab) : 0;
      
      document.getElementById('asset-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Net Asset Value (NAV)</div>
          <div class="result-value">${fmtFull(nav)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Balance Sheet</div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem; color: var(--brand-success);">Total Assets</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(totalAssets)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem; color: var(--brand-danger);">Total Liabilities</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(totalLiab)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; font-weight: 700;">
            <span style="font-size: 0.85rem;">Net Asset Value</span>
            <span class="mono" style="font-size: 0.85rem; color: ${nav >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)'};">${fmtFull(nav)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Ratios</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Current Ratio</div>
              <div class="mono" style="font-weight: 700; color: ${currentRatio >= 1.5 ? 'var(--brand-success)' : currentRatio >= 1 ? 'var(--brand-warning)' : 'var(--brand-danger)'};">${currentRatio.toFixed(2)}x</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Debt Ratio</div>
              <div class="mono" style="font-weight: 700;">${totalAssets > 0 ? (totalLiab / totalAssets * 100).toFixed(1) + '%' : 'N/A'}</div>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // MORTGAGE CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateMortgage() {
      const price = parseFloat(document.getElementById('mort-price').value) || 0;
      const downPct = (parseFloat(document.getElementById('mort-down').value) || 0) / 100;
      const rate = (parseFloat(document.getElementById('mort-rate').value) || 0) / 100;
      const amort = parseInt(document.getElementById('mort-amort').value) || 25;
      const freq = parseInt(document.getElementById('mort-freq').value) || 12;
      const province = document.getElementById('mort-province').value;
      
      const downPayment = price * downPct;
      const principal = price - downPayment;
      
      if (price <= 0 || rate <= 0) {
        document.getElementById('mortgage-results').innerHTML = '<div class="result-card"><p style="color: var(--text-muted);">Enter a home price and interest rate to calculate.</p></div>';
        return;
      }
      
      // Update down payment help
      document.getElementById('mort-down-help').textContent = `Down payment: ${fmtFull(downPayment)}`;
      
      // CMHC Insurance (if down < 20%)
      // CMHC does not insure homes over $1,000,000 ‚Äî 20% min down required
      let cmhcPremium = 0;
      let cmhcWarning = '';
      if (downPct < 0.20 && price <= 1000000) {
        // For homes $500K-$1M: min 5% on first $500K + 10% on remainder
        if (price > 500000) {
          const minDown = 500000 * 0.05 + (price - 500000) * 0.10;
          if (downPayment < minDown - 0.01) {
            cmhcWarning = `‚ö†Ô∏è Minimum down payment for homes $500K‚Äì$1M is ${fmtFull(minDown)} (5% on first $500K + 10% on remainder).`;
          }
        }
        if (downPct >= 0.15) cmhcPremium = principal * 0.028;
        else if (downPct >= 0.10) cmhcPremium = principal * 0.031;
        else cmhcPremium = principal * 0.04;
      } else if (downPct < 0.20 && price > 1000000) {
        cmhcWarning = '‚ö†Ô∏è CMHC mortgage insurance is not available for homes over $1,000,000. Minimum 20% down payment required.';
      }
      
      const totalMortgage = principal + cmhcPremium;
      
      // Canadian mortgage: semi-annual compounding
      const semiAnnualRate = Math.pow(1 + rate / 2, 2) - 1;
      const periodicRate = Math.pow(1 + semiAnnualRate, 1 / freq) - 1;
      const totalPayments = amort * freq;
      
      // Payment calculation
      const payment = totalMortgage * (periodicRate * Math.pow(1 + periodicRate, totalPayments)) / (Math.pow(1 + periodicRate, totalPayments) - 1);
      const monthlyEquiv = payment * freq / 12;
      const totalCost = payment * totalPayments;
      const totalInterest = totalCost - totalMortgage;
      
      // OSFI Stress Test
      const stressRate = Math.max(rate + 0.02, 0.0525);
      const stressSemiAnnual = Math.pow(1 + stressRate / 2, 2) - 1;
      const stressPeriodic = Math.pow(1 + stressSemiAnnual, 1 / 12) - 1;
      const stressPayment = totalMortgage * (stressPeriodic * Math.pow(1 + stressPeriodic, amort * 12)) / (Math.pow(1 + stressPeriodic, amort * 12) - 1);
      
      // Land Transfer Tax
      let ltt = 0;
      if (province === 'ON') {
        // Ontario LTT
        if (price <= 55000) ltt = price * 0.005;
        else if (price <= 250000) ltt = 275 + (price - 55000) * 0.01;
        else if (price <= 400000) ltt = 2225 + (price - 250000) * 0.015;
        else if (price <= 2000000) ltt = 4475 + (price - 400000) * 0.02;
        else ltt = 36475 + (price - 2000000) * 0.025;
      } else if (province === 'BC') {
        if (price <= 200000) ltt = price * 0.01;
        else if (price <= 2000000) ltt = 2000 + (price - 200000) * 0.02;
        else if (price <= 3000000) ltt = 38000 + (price - 2000000) * 0.03;
        else ltt = 68000 + (price - 3000000) * 0.05;
      } else if (province === 'QC') {
        // Quebec welcome tax (droits de mutation)
        if (price <= 58900) ltt = price * 0.005;
        else if (price <= 294500) ltt = 294.50 + (price - 58900) * 0.01;
        else if (price <= 500000) ltt = 2650.50 + (price - 294500) * 0.015;
        else if (price <= 1000000) ltt = 5733.00 + (price - 500000) * 0.02;
        else ltt = 15733.00 + (price - 1000000) * 0.025;
      } else if (province === 'MB') {
        if (price <= 30000) ltt = 0;
        else if (price <= 90000) ltt = (price - 30000) * 0.005;
        else if (price <= 150000) ltt = 300 + (price - 90000) * 0.01;
        else if (price <= 200000) ltt = 900 + (price - 150000) * 0.015;
        else ltt = 1650 + (price - 200000) * 0.02;
      }
      // AB, SK, NB, NL, PE, NS: no provincial land transfer tax (or minimal)
      
      const freqLabel = { 12: 'Monthly', 26: 'Bi-Weekly', 52: 'Weekly', 24: 'Semi-Monthly' }[freq];
      
      document.getElementById('mortgage-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">${freqLabel} Payment</div>
          <div class="result-value">${fmtFull(payment)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Monthly equivalent: ${fmtFull(monthlyEquiv)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Total Cost of Mortgage</div>
          <div class="result-value">${fmt(totalCost)}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">Principal: ${fmt(totalMortgage)}</span>
            <span class="metric-pill negative">Interest: ${fmt(totalInterest)}</span>
          </div>
        </div>
        
        ${cmhcPremium > 0 ? `
        <div class="glass-card" style="padding: var(--space-lg); border-color: rgba(245, 158, 11, 0.3);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--brand-warning); margin-bottom: 0.375rem;">‚ö†Ô∏è CMHC INSURANCE REQUIRED</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary);">Down payment is less than 20%. CMHC premium of <span class="mono" style="font-weight: 700;">${fmtFull(cmhcPremium)}</span> added to mortgage.</div>
          ${cmhcWarning ? `<div style="font-size: 0.8rem; color: var(--brand-warning); margin-top: 0.5rem;">${cmhcWarning}</div>` : ''}
        </div>
        ` : ''}
        ${cmhcWarning && cmhcPremium === 0 ? `
        <div class="glass-card" style="padding: var(--space-lg); border-color: rgba(239, 68, 68, 0.3);">
          <div style="font-size: 0.85rem; color: var(--brand-danger); font-weight: 600;">${cmhcWarning}</div>
        </div>
        ` : ''}
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Closing Costs</div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Down Payment</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(downPayment)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Land Transfer Tax</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(ltt)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.375rem 0; border-bottom: 1px solid var(--border-primary);">
            <span style="font-size: 0.85rem;">Legal Fees (est.)</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(2000)}</span>
          </div>
          <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; font-weight: 700;">
            <span style="font-size: 0.85rem;">Total Cash Needed</span>
            <span class="mono" style="font-size: 0.85rem;">${fmtFull(downPayment + ltt + 2000)}</span>
          </div>
        </div>
      `;
      
      // Stress test
      document.getElementById('mortgage-stress').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üèõÔ∏è OSFI Stress Test (B-20)</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
          <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
            <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Your Rate</div>
            <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--brand-success);">${(rate * 100).toFixed(2)}%</div>
            <div class="mono" style="font-size: 1rem; margin-top: 0.375rem;">${fmtFull(monthlyEquiv)}/mo</div>
          </div>
          <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
            <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Stress Test Rate</div>
            <div class="mono" style="font-size: 1.5rem; font-weight: 700; color: var(--brand-warning);">${(stressRate * 100).toFixed(2)}%</div>
            <div class="mono" style="font-size: 1rem; margin-top: 0.375rem;">${fmtFull(stressPayment)}/mo</div>
          </div>
        </div>
        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 1rem; text-align: center;">
          You must qualify at the stress test rate (contract rate + 2% or 5.25%, whichever is higher). Monthly payment increases by ${fmtFull(stressPayment - monthlyEquiv)}.
        </div>
      `;
      
      // Rate Increase Stress Test
      const rateStressEl = document.getElementById('mortgage-rate-stress');
      if (rateStressEl) {
        const calcPaymentAtRate = (r) => {
          const sr = Math.pow(1 + r / 2, 2) - 1;
          const mr = Math.pow(1 + sr, 1 / 12) - 1;
          return totalMortgage * (mr * Math.pow(1 + mr, amort * 12)) / (Math.pow(1 + mr, amort * 12) - 1);
        };
        const p0 = monthlyEquiv;
        const p1 = calcPaymentAtRate(rate + 0.01);
        const p2 = calcPaymentAtRate(rate + 0.02);
        rateStressEl.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìà Rate Increase Impact</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem;">
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">Current Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-success);">${(rate * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p0)}/mo</div>
            </div>
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">+1% Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-warning);">${((rate + 0.01) * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p1)}/mo</div>
              <div style="font-size: 0.72rem; color: var(--brand-danger); margin-top: 0.25rem;">+${fmtFull(p1 - p0)}/mo</div>
            </div>
            <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">+2% Rate</div>
              <div class="mono" style="font-size: 1.2rem; font-weight: 700; color: var(--brand-danger);">${((rate + 0.02) * 100).toFixed(2)}%</div>
              <div class="mono" style="font-size: 0.9rem; margin-top: 0.25rem;">${fmtFull(p2)}/mo</div>
              <div style="font-size: 0.72rem; color: var(--brand-danger); margin-top: 0.25rem;">+${fmtFull(p2 - p0)}/mo</div>
            </div>
          </div>
        `;
      }

      // Payment Breakdown Donut
      const breakdownEl = document.getElementById('mortgage-breakdown');
      if (breakdownEl) {
        breakdownEl.innerHTML = '<div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">ü•ß Total Payment Breakdown</div><div style="display:flex;align-items:center;gap:1.5rem;"><div id="mort-donut" style="width:160px;height:160px;"></div><div id="mort-donut-legend" style="font-size:0.8rem;"></div></div>';
        const donutSegs = [
          { label: 'Principal', value: totalMortgage, color: '#6366f1' },
          { label: 'Interest', value: totalInterest, color: '#ef4444' }
        ];
        if (cmhcPremium > 0) donutSegs.push({ label: 'CMHC', value: cmhcPremium, color: '#f59e0b' });
        renderDonutChart('mort-donut', donutSegs, 160);
        document.getElementById('mort-donut-legend').innerHTML = donutSegs.map(s => 
          `<div style="display:flex;align-items:center;gap:6px;margin-bottom:0.375rem;"><span style="width:10px;height:10px;border-radius:2px;background:${s.color};"></span>${s.label}: ${fmtFull(s.value)}</div>`
        ).join('');
      }

      // Simple amortization visualization
      let balance = totalMortgage;
      const monthlyRate = Math.pow(1 + semiAnnualRate, 1 / 12) - 1;
      const monthlyPmt = totalMortgage * (monthlyRate * Math.pow(1 + monthlyRate, amort * 12)) / (Math.pow(1 + monthlyRate, amort * 12) - 1);
      let yearlyData = [];
      
      for (let year = 1; year <= amort; year++) {
        let yearInterest = 0;
        let yearPrincipal = 0;
        for (let m = 0; m < 12; m++) {
          const interestPmt = balance * monthlyRate;
          const principalPmt = monthlyPmt - interestPmt;
          yearInterest += interestPmt;
          yearPrincipal += principalPmt;
          balance -= principalPmt;
          if (balance < 0) balance = 0;
        }
        yearlyData.push({ year, balance, interest: yearInterest, principal: yearPrincipal });
      }
      
      let amortTableRows = yearlyData.map(d => `
          <tr>
            <td>${d.year}</td>
            <td>${fmtFull(d.year === 1 ? totalMortgage : yearlyData[d.year-2].balance)}</td>
            <td>${fmtFull(monthlyPmt * 12)}</td>
            <td>${fmtFull(d.principal)}</td>
            <td>${fmtFull(d.interest)}</td>
            <td>${fmtFull(d.balance)}</td>
          </tr>`).join('');

      document.getElementById('mortgage-amort').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Amortization ‚Äî Balance Over Time</div>
        <div style="display: flex; align-items: flex-end; gap: 2px; height: 200px; padding: 0;">
          ${yearlyData.map(d => `
            <div style="flex: 1; height: ${(d.balance / totalMortgage * 190)}px; background: linear-gradient(180deg, var(--brand-primary), var(--brand-accent)); border-radius: 2px 2px 0 0; min-height: 2px; position: relative;" title="Year ${d.year}: ${fmtFull(d.balance)} remaining"></div>
          `).join('')}
        </div>
        <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted); margin-top: 0.5rem;">
          <span>Year 1</span>
          <span>Year ${Math.floor(amort / 2)}</span>
          <span>Year ${amort}</span>
        </div>
        <div class="accordion-item" style="margin-top: 1.5rem;">
          <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
            <span>üìã View Full Amortization Schedule</span>
            <span class="accordion-arrow">‚ñº</span>
          </div>
          <div class="accordion-body">
            <div class="accordion-body-inner" style="overflow-x: auto; padding: 0.5rem;">
              <table class="sensitivity-table">
                <thead>
                  <tr>
                    <th>Year</th>
                    <th>Opening Balance</th>
                    <th>Annual Payment</th>
                    <th>Principal</th>
                    <th>Interest</th>
                    <th>Closing Balance</th>
                  </tr>
                </thead>
                <tbody>${amortTableRows}</tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CAGR CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateCAGR() {
      const initial = parseFloat(document.getElementById('cagr-initial').value) || 0;
      const final_ = parseFloat(document.getElementById('cagr-final').value) || 0;
      const years = parseFloat(document.getElementById('cagr-years').value) || 1;
      
      if (initial <= 0) {
        document.getElementById('cagr-results').innerHTML = `<div class="result-card"><p style="color: var(--text-muted);">Enter a positive initial investment.</p></div>`;
        return;
      }
      
      const cagr = (Math.pow(final_ / initial, 1 / years) - 1) * 100;
      const totalReturn = ((final_ - initial) / initial) * 100;
      const gain = final_ - initial;
      
      // Generate year-by-year growth data
      const cagrDecimal = cagr / 100;
      const growthData = [];
      for (let y = 0; y <= years; y++) {
        const value = initial * Math.pow(1 + cagrDecimal, y);
        growthData.push({x: y.toString(), y: value});
      }
      
      document.getElementById('cagr-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">CAGR</div>
          <div class="result-value">${cagr.toFixed(2)}%</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">Compound Annual Growth Rate</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Total Return</div>
          <div class="result-value" style="${totalReturn >= 0 ? '' : 'background: linear-gradient(135deg, var(--brand-danger), #f97316); -webkit-background-clip: text;'}">${totalReturn.toFixed(1)}%</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
            <span class="metric-pill ${gain >= 0 ? 'positive' : 'negative'}">${gain >= 0 ? '+' : ''}${fmtFull(gain)}</span>
          </div>
        </div>
        
        <div class="result-card" style="grid-column: 1 / -1;">
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Investment Growth Over Time</div>
          <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 12px;">
            ${svgLineChart(growthData, 500, 200)}
          </div>
          <div style="display: flex; gap: 2rem; justify-content: center; margin-top: 1rem; font-size: 0.8rem;">
            <div style="text-align: center;">
              <div style="color: var(--text-muted); font-size: 0.7rem;">Start</div>
              <div class="mono" style="font-weight: 600;">${fmtFull(initial)}</div>
            </div>
            <div style="text-align: center;">
              <div style="color: var(--text-muted); font-size: 0.7rem;">End</div>
              <div class="mono" style="font-weight: 600; color: var(--brand-success);">${fmtFull(final_)}</div>
            </div>
            <div style="text-align: center;">
              <div style="color: var(--text-muted); font-size: 0.7rem;">Gain</div>
              <div class="mono" style="font-weight: 600; color: ${gain >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)'};">${gain >= 0 ? '+' : ''}${fmtFull(gain)}</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Rule of 72</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary);">
            At ${cagr.toFixed(1)}% CAGR, your money doubles every <strong style="color: var(--text-primary);">${cagr > 0 ? (72 / cagr).toFixed(1) : '‚àû'} years</strong>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Benchmarks</div>
          <div style="font-size: 0.8rem; color: var(--text-secondary); display: flex; flex-direction: column; gap: 0.5rem;">
            <div style="display: flex; justify-content: space-between;">
              <span>S&P 500 (30yr avg)</span>
              <span class="mono" style="color: ${cagr > 10.7 ? 'var(--brand-success)' : 'var(--text-muted)'};">~10.7%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>Warren Buffett</span>
              <span class="mono" style="color: ${cagr > 20 ? 'var(--brand-success)' : 'var(--text-muted)'};">~20%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span>GIC (Canada)</span>
              <span class="mono">~4-5%</span>
            </div>
          </div>
        </div>
      `;
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SVG CHART COMPONENTS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    /**
     * Animated SVG Donut Chart
     * @param {string} containerId - ID of the container element
     * @param {Array} segments - [{label, value, color}]
     * @param {number} size - diameter in px (default 150)
     */
    function renderDonutChart(containerId, segments, size) {
      size = size || 150;
      const container = document.getElementById(containerId);
      if (!container) return;
      const total = segments.reduce(function(s, seg) { return s + seg.value; }, 0);
      if (total <= 0) {
        container.innerHTML = '<div style="width:'+size+'px;height:'+size+'px;border-radius:50%;background:var(--border-primary);"></div>';
        return;
      }
      const r = 50, cx = 60, cy = 60;
      const circumference = 2 * Math.PI * r;
      let cumOffset = 0;
      let svgSegments = '';
      segments.forEach(function(seg, i) {
        const pct = seg.value / total;
        const dashLen = pct * circumference;
        const dashGap = circumference - dashLen;
        const offset = -cumOffset * circumference;
        svgSegments += '<circle class="svg-donut-segment donut-init" cx="'+cx+'" cy="'+cy+'" r="'+r+'" ' +
          'stroke="'+seg.color+'" ' +
          'stroke-dasharray="'+dashLen+' '+dashGap+'" ' +
          'stroke-dashoffset="'+offset+'" ' +
          'style="--circumference:'+circumference+'" ' +
          'data-label="'+seg.label+'" data-value="'+seg.value+'" data-pct="'+(pct*100).toFixed(1)+'" />';
        cumOffset += pct;
      });
      container.innerHTML = '<div class="svg-donut-chart" style="width:'+size+'px;height:'+size+'px;">' +
        '<svg viewBox="0 0 120 120" width="'+size+'" height="'+size+'">' + svgSegments + '</svg>' +
        '<div class="svg-donut-center"><div class="donut-hover-label">Total</div><div class="donut-hover-value">' + fmtFull(total) + '</div></div></div>';

      // Animate in
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          container.querySelectorAll('.donut-init').forEach(function(c) { c.classList.remove('donut-init'); });
        });
      });

      // Hover interactivity
      var centerLabel = container.querySelector('.donut-hover-label');
      var centerValue = container.querySelector('.donut-hover-value');
      container.querySelectorAll('.svg-donut-segment').forEach(function(seg) {
        seg.addEventListener('mouseenter', function() {
          centerLabel.textContent = seg.getAttribute('data-label');
          centerValue.textContent = fmtFull(parseFloat(seg.getAttribute('data-value'))) + ' (' + seg.getAttribute('data-pct') + '%)';
        });
        seg.addEventListener('mouseleave', function() {
          centerLabel.textContent = 'Total';
          centerValue.textContent = fmtFull(total);
        });
      });
    }

    /**
     * SVG Gauge Chart (half-circle)
     * @param {string} containerId
     * @param {number} value - current value (0-100 scale)
     * @param {Array} zones - [{from, to, color}] in 0-100 range
     * @param {string} label - text label
     * @param {number} width - width in px
     */
    function renderGauge(containerId, value, zones, label, width) {
      width = width || 180;
      var container = document.getElementById(containerId);
      if (!container) return;
      value = Math.max(0, Math.min(100, value));
      var cx = 100, cy = 90, r = 70;
      // Arc from 180deg to 0deg (left to right)
      var arcSvg = '';
      zones.forEach(function(z) {
        var startAngle = Math.PI - (z.from / 100) * Math.PI;
        var endAngle = Math.PI - (z.to / 100) * Math.PI;
        var x1 = cx + r * Math.cos(startAngle);
        var y1 = cy - r * Math.sin(startAngle);
        var x2 = cx + r * Math.cos(endAngle);
        var y2 = cy - r * Math.sin(endAngle);
        var largeArc = (z.to - z.from) > 50 ? 1 : 0;
        arcSvg += '<path class="svg-gauge-arc" d="M '+x1+' '+y1+' A '+r+' '+r+' 0 '+largeArc+' 1 '+x2+' '+y2+'" stroke="'+z.color+'" />';
      });
      // Needle
      var needleAngle = Math.PI - (value / 100) * Math.PI;
      var needleLen = r - 10;
      var nx = cx + needleLen * Math.cos(needleAngle);
      var ny = cy - needleLen * Math.sin(needleAngle);
      // Start with needle at 0 position (left), animate to target
      var startAngle = 180; // pointing left
      var targetAngle = 180 - (value / 100) * 180;

      container.innerHTML = '<div class="svg-gauge" style="width:'+width+'px;">' +
        '<svg viewBox="0 0 200 110" width="'+width+'">' +
        arcSvg +
        '<circle cx="'+cx+'" cy="'+cy+'" r="4" fill="var(--text-primary)" />' +
        '<line id="'+containerId+'-needle" x1="'+cx+'" y1="'+cy+'" x2="'+(cx-needleLen)+'" y2="'+cy+'" stroke="var(--text-primary)" stroke-width="2.5" stroke-linecap="round" style="transform-origin:'+cx+'px '+cy+'px;transform:rotate(0deg);transition:transform 1.2s cubic-bezier(0.4,0,0.2,1);" />' +
        '</svg>' +
        '<div class="svg-gauge-label"><div class="gauge-value">'+(label || value.toFixed(0)+'%')+'</div></div></div>';

      // Animate needle
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          var needle = document.getElementById(containerId + '-needle');
          if (needle) {
            var rot = -(value / 100) * 180;
            needle.style.transform = 'rotate(' + rot + 'deg)';
          }
        });
      });
    }

    /**
     * Sparkline SVG inline component
     * @param {Array} data - array of numbers
     * @param {number} width
     * @param {number} height
     * @param {string} color
     * @returns {string} HTML string
     */
    function sparkline(data, width, height, color) {
      if (!data || data.length < 2) return '';
      width = width || 80;
      height = height || 24;
      color = color || 'var(--brand-primary)';
      var min = Math.min.apply(null, data);
      var max = Math.max.apply(null, data);
      var range = max - min || 1;
      var step = width / (data.length - 1);
      var points = data.map(function(v, i) {
        return { x: i * step, y: height - ((v - min) / range) * (height - 2) - 1 };
      });
      // Build smooth path with quadratic bezier
      var d = 'M ' + points[0].x + ' ' + points[0].y;
      for (var i = 1; i < points.length; i++) {
        var cpx = (points[i-1].x + points[i].x) / 2;
        d += ' Q ' + cpx + ' ' + points[i-1].y + ' ' + points[i].x + ' ' + points[i].y;
      }
      // Fill area
      var fillD = d + ' L ' + points[points.length-1].x + ' ' + height + ' L 0 ' + height + ' Z';
      return '<span class="sparkline-inline"><svg width="'+width+'" height="'+height+'" viewBox="0 0 '+width+' '+height+'">' +
        '<path class="sparkline-fill" d="'+fillD+'" fill="'+color+'" />' +
        '<path class="sparkline-path" d="'+d+'" stroke="'+color+'" />' +
        '</svg></span>';
    }

    /**
     * SVG Stacked Area Chart
     * @param {string} containerId
     * @param {Array} data - [{label, bottom, top}] where bottom=contributions, top=total
     * @param {object} opts - {bottomColor, topColor, bottomLabel, topLabel, xLabels, yPrefix}
     */
    function renderAreaChart(containerId, data, opts) {
      var container = document.getElementById(containerId);
      if (!container || !data || data.length === 0) return;
      opts = opts || {};
      var bColor = opts.bottomColor || 'var(--brand-primary)';
      var tColor = opts.topColor || 'var(--brand-success)';
      var bLabel = opts.bottomLabel || 'Contributions';
      var tLabel = opts.topLabel || 'Earnings';
      var yPrefix = opts.yPrefix || '$';

      var maxVal = 0;
      data.forEach(function(d) { if (d.top > maxVal) maxVal = d.top; });
      if (maxVal === 0) maxVal = 1;

      var W = 600, H = 260, padL = 55, padR = 15, padT = 15, padB = 35;
      var chartW = W - padL - padR, chartH = H - padT - padB;
      var n = data.length;
      var stepX = chartW / Math.max(n - 1, 1);

      // Gridlines + Y labels
      var gridCount = 5;
      var gridSvg = '';
      for (var g = 0; g <= gridCount; g++) {
        var gy = padT + (g / gridCount) * chartH;
        var gVal = maxVal * (1 - g / gridCount);
        gridSvg += '<line class="svg-area-gridline" x1="'+padL+'" y1="'+gy+'" x2="'+(W-padR)+'" y2="'+gy+'" />';
        var yLabel = gVal >= 1e6 ? (gVal/1e6).toFixed(1)+'M' : gVal >= 1e3 ? (gVal/1e3).toFixed(0)+'K' : gVal.toFixed(0);
        gridSvg += '<text class="svg-area-label" x="'+(padL-5)+'" y="'+(gy+3)+'" text-anchor="end">'+yPrefix+yLabel+'</text>';
      }

      // X labels
      var xLabelSvg = '';
      var labelInterval = Math.max(1, Math.ceil(n / 10));
      data.forEach(function(d, i) {
        if (i % labelInterval === 0 || i === n - 1) {
          var lx = padL + i * stepX;
          xLabelSvg += '<text class="svg-area-label" x="'+lx+'" y="'+(H - 5)+'" text-anchor="middle">'+(d.label || 'Y'+(i+1))+'</text>';
        }
      });

      // Build paths
      function toY(v) { return padT + chartH - (v / maxVal) * chartH; }
      function toX(i) { return padL + i * stepX; }

      // Bottom area (contributions)
      var bottomPts = data.map(function(d, i) { return { x: toX(i), y: toY(d.bottom) }; });
      // Top area (total)
      var topPts = data.map(function(d, i) { return { x: toX(i), y: toY(d.top) }; });

      function smoothPath(pts) {
        if (pts.length < 2) return 'M ' + pts[0].x + ' ' + pts[0].y;
        var d = 'M ' + pts[0].x + ' ' + pts[0].y;
        for (var i = 1; i < pts.length; i++) {
          var cpx = (pts[i-1].x + pts[i].x) / 2;
          d += ' Q ' + cpx + ' ' + pts[i-1].y + ' ' + pts[i].x + ' ' + pts[i].y;
        }
        return d;
      }

      var baseLine = padT + chartH;
      // Earnings fill (between top line and bottom line)
      var earningsFill = smoothPath(topPts);
      for (var i = bottomPts.length - 1; i >= 0; i--) {
        var cpx2 = i > 0 ? (bottomPts[i].x + bottomPts[i-1].x) / 2 : bottomPts[i].x;
        earningsFill += ' L ' + bottomPts[i].x + ' ' + bottomPts[i].y;
      }
      earningsFill += ' Z';

      // Contributions fill (bottom to baseline)
      var contribFill = smoothPath(bottomPts) + ' L ' + bottomPts[bottomPts.length-1].x + ' ' + baseLine + ' L ' + bottomPts[0].x + ' ' + baseLine + ' Z';

      container.innerHTML = '<div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Portfolio Growth Over Time</div>' +
        '<svg class="svg-area-chart" viewBox="0 0 '+W+' '+H+'">' +
        gridSvg + xLabelSvg +
        '<path class="svg-area-path" d="'+contribFill+'" fill="'+bColor+'" opacity="0.35" />' +
        '<path class="svg-area-path" d="'+earningsFill+'" fill="'+tColor+'" opacity="0.35" />' +
        '<path class="svg-area-path" d="'+smoothPath(bottomPts)+'" fill="none" stroke="'+bColor+'" stroke-width="2" />' +
        '<path class="svg-area-path" d="'+smoothPath(topPts)+'" fill="none" stroke="'+tColor+'" stroke-width="2" />' +
        '</svg>' +
        '<div style="display: flex; gap: 1rem; justify-content: center; margin-top: 0.75rem; font-size: 0.75rem;">' +
        '<div style="display: flex; align-items: center; gap: 0.375rem;"><div style="width: 12px; height: 12px; border-radius: 2px; background: '+bColor+';"></div> '+bLabel+'</div>' +
        '<div style="display: flex; align-items: center; gap: 0.375rem;"><div style="width: 12px; height: 12px; border-radius: 2px; background: '+tColor+';"></div> '+tLabel+'</div></div>';

      // Animate paths in
      requestAnimationFrame(function() {
        requestAnimationFrame(function() {
          container.querySelectorAll('.svg-area-path').forEach(function(p) { p.classList.add('visible'); });
        });
      });
    }

    // DCA SIMULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateDCA() {
      const monthly = parseFloat(document.getElementById('dca-monthly').value) || 0;
      const annualReturn = (parseFloat(document.getElementById('dca-return').value) || 0) / 100;
      const dividendYield = (parseFloat(document.getElementById('dca-dividend').value) || 0) / 100;
      const totalReturn = annualReturn + dividendYield;
      const years = parseInt(document.getElementById('dca-years').value) || 1;
      const initial = parseFloat(document.getElementById('dca-initial').value) || 0;
      
      const monthlyRate = Math.pow(1 + totalReturn, 1 / 12) - 1;
      const totalMonths = years * 12;
      
      let balance = initial;
      let totalContributed = initial;
      let yearlyData = [];
      
      for (let m = 1; m <= totalMonths; m++) {
        balance = balance * (1 + monthlyRate) + monthly;
        totalContributed += monthly;
        if (m % 12 === 0) {
          yearlyData.push({ year: m / 12, balance, contributed: totalContributed, earnings: balance - totalContributed });
        }
      }
      
      const totalEarnings = balance - totalContributed;
      const inflationRate = (parseFloat(document.getElementById('dca-inflation').value) || 0) / 100;
      const realValue = balance / Math.pow(1 + inflationRate, years);
      
      document.getElementById('dca-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Final Portfolio Value (Nominal)</div>
          <div class="result-value">${fmtFull(balance)}</div>
        </div>
        
        <div class="result-card" style="border-color: rgba(245, 158, 11, 0.3); background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.03));">
          <div class="result-label">Real Value (Inflation-Adjusted)</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-warning), #f97316); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(realValue)}</div>
          <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.375rem;">In today's dollars at ${(inflationRate*100).toFixed(1)}% inflation</div>
          <div style="font-size: 0.75rem; color: var(--text-muted);">Purchasing power erosion: ${fmtFull(balance - realValue)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Investment Earnings</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-success), #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(totalEarnings)}</div>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem; flex-wrap: wrap;">
            <span class="metric-pill neutral">Contributed: ${fmtFull(totalContributed)}</span>
            <span class="metric-pill positive">Earned: ${fmtFull(totalEarnings)}</span>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Breakdown</div>
          <div style="margin-bottom: 0.75rem;">
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
              <span>Contributions</span>
              <span class="mono">${(totalContributed / balance * 100).toFixed(0)}%</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${(totalContributed / balance * 100)}%; background: var(--brand-primary);"></div>
            </div>
          </div>
          <div>
            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 0.25rem;">
              <span>Earnings (Compound Growth)</span>
              <span class="mono">${(totalEarnings / balance * 100).toFixed(0)}%</span>
            </div>
            <div class="chart-bar">
              <div class="chart-bar-fill" style="width: ${(totalEarnings / balance * 100)}%; background: linear-gradient(90deg, var(--brand-success), var(--brand-accent));"></div>
            </div>
          </div>
        </div>
      `;
      
      // Growth chart ‚Äî SVG area chart + sparkline for YoY growth
      if (yearlyData.length > 0) {
        var areaData = yearlyData.map(function(d) {
          return { label: 'Y' + d.year, bottom: d.contributed, top: d.balance };
        });
        renderAreaChart('dca-chart', areaData, {
          bottomColor: '#6366f1', topColor: '#10b981',
          bottomLabel: 'Contributions', topLabel: 'Total Value'
        });

        // Sparkline: year-over-year growth rates
        if (yearlyData.length > 1) {
          var yoyGrowth = [];
          for (var si = 1; si < yearlyData.length; si++) {
            yoyGrowth.push(yearlyData[si].balance / yearlyData[si-1].balance - 1);
          }
          var sparkHtml = '<div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.75rem;">YoY Growth ' + sparkline(yoyGrowth, 100, 20, '#10b981') + '</div>';
          var dcaChart = document.getElementById('dca-chart');
          if (dcaChart) dcaChart.innerHTML += sparkHtml;
        }
      }

      // Year-by-year table
      if (yearlyData.length > 0) {
        const tableEl = document.getElementById('dca-table');
        if (tableEl) {
          let rows = yearlyData.map(d => `<tr><td>Year ${d.year}</td><td>${fmtFull(d.contributed)}</td><td>${fmtFull(d.earnings)}</td><td style="font-weight:700;">${fmtFull(d.balance)}</td></tr>`).join('');
          tableEl.innerHTML = `
            <div class="accordion-item">
              <div class="accordion-header" onclick="this.parentElement.classList.toggle('open')">
                <span>üìã Year-by-Year Breakdown</span>
                <span class="accordion-arrow">‚ñº</span>
              </div>
              <div class="accordion-body">
                <div class="accordion-body-inner" style="overflow-x:auto;padding:0.5rem;">
                  <table class="sensitivity-table">
                    <thead><tr><th>Year</th><th>Contributed</th><th>Earnings</th><th>Balance</th></tr></thead>
                    <tbody>${rows}</tbody>
                  </table>
                </div>
              </div>
            </div>`;
        }
      }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // RETIREMENT (RRSP vs TFSA)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateRetirement() {
      const income = parseFloat(document.getElementById('ret-income').value) || 0;
      const contribution = parseFloat(document.getElementById('ret-contribution').value) || 0;
      const age = parseInt(document.getElementById('ret-age').value) || 30;
      const retireAge = parseInt(document.getElementById('ret-retire-age').value) || 65;
      const annualReturn = (parseFloat(document.getElementById('ret-return').value) || 0) / 100;
      const retireIncome = parseFloat(document.getElementById('ret-retire-income').value) || 0;
      const province = document.getElementById('ret-province').value;
      
      const years = retireAge - age;
      if (years <= 0) {
        document.getElementById('retirement-results').innerHTML = '<div class="result-card"><p style="color: var(--text-muted);">Retirement age must be greater than current age.</p></div>';
        return;
      }
      
      // Canadian federal tax brackets (2025)
      const fedTax = (inc) => {
        if (inc <= 0) return 0;
        let tax = 0;
        const brackets = [
          [55867, 0.15], [55867, 0.205], [61942, 0.26], [70000, 0.29], [Infinity, 0.33]
        ];
        let remaining = inc;
        for (const [limit, rate] of brackets) {
          const taxable = Math.min(remaining, limit);
          tax += taxable * rate;
          remaining -= taxable;
          if (remaining <= 0) break;
        }
        return tax;
      };
      
      // Provincial tax brackets (2025 approximations)
      const provBrackets = {
        'ON': [[51446, 0.0505], [51446, 0.0915], [47046, 0.1116], [100000, 0.1216], [Infinity, 0.1316]],
        'BC': [[47937, 0.0506], [47937, 0.077], [13554, 0.105], [24517, 0.1229], [47937, 0.147], [Infinity, 0.168]],
        'AB': [[148269, 0.10], [29654, 0.12], [59308, 0.13], [118616, 0.14], [Infinity, 0.15]],
        'QC': [[51780, 0.14], [51780, 0.19], [21480, 0.24], [Infinity, 0.2575]]
      };
      const provTax = (inc) => {
        if (inc <= 0) return 0;
        const brackets = provBrackets[province] || provBrackets['ON'];
        let tax = 0, remaining = inc;
        for (const [limit, rate] of brackets) {
          const taxable = Math.min(remaining, limit);
          tax += taxable * rate;
          remaining -= taxable;
          if (remaining <= 0) break;
        }
        return tax;
      };
      
      const marginalRate = (inc) => {
        const tax1 = fedTax(inc) + provTax(inc);
        const tax2 = fedTax(inc + 1) + provTax(inc + 1);
        return tax2 - tax1;
      };
      
      const currentMarginal = marginalRate(income);
      const retireMarginal = marginalRate(retireIncome);
      
      // RRSP: Tax deduction now, taxed on withdrawal
      const rrspTaxSavings = contribution * currentMarginal;
      const rrspGross = contribution; // Full amount invested
      let rrspBalance = 0;
      for (let y = 0; y < years; y++) {
        rrspBalance = (rrspBalance + rrspGross) * (1 + annualReturn);
      }
      const rrspAfterTax = rrspBalance * (1 - retireMarginal);
      
      // TFSA: No deduction, tax-free growth and withdrawal
      const tfsaNet = contribution; // Same contribution amount
      let tfsaBalance = 0;
      for (let y = 0; y < years; y++) {
        tfsaBalance = (tfsaBalance + tfsaNet) * (1 + annualReturn);
      }
      
      // RRSP with reinvested refund
      const rrspWithRefund = contribution + rrspTaxSavings;
      let rrspRefundBalance = 0;
      for (let y = 0; y < years; y++) {
        rrspRefundBalance = (rrspRefundBalance + rrspWithRefund) * (1 + annualReturn);
      }
      const rrspRefundAfterTax = rrspRefundBalance * (1 - retireMarginal);
      
      const winner = rrspRefundAfterTax > tfsaBalance ? 'RRSP' : 'TFSA';
      const advantage = Math.abs(rrspRefundAfterTax - tfsaBalance);
      
      // Contribution limit warnings
      const rrspLimit = Math.min(income * 0.18, 31560); // 2024 limit
      const tfsaLimit = 7000; // 2024 annual limit
      const contribWarning = contribution > rrspLimit ? `‚ö†Ô∏è RRSP limit is ${fmtFull(rrspLimit)} (18% of income or $31,560 max). ` : '';
      const tfsaWarning = contribution > tfsaLimit ? `‚ö†Ô∏è TFSA annual limit is ${fmtFull(tfsaLimit)}. Excess may incur 1%/month penalty.` : '';
      
      document.getElementById('retirement-results').innerHTML = `
        <div class="gradient-border-card">
          <div class="gradient-border-card-inner" style="text-align: center;">
            <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.5rem;">Recommendation</div>
            <div style="font-size: 1.75rem; font-weight: 800; margin-bottom: 0.25rem;">${winner} Wins</div>
            <div style="font-size: 0.85rem; color: var(--text-secondary);">by ${fmtFull(advantage)} over ${years} years</div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div style="text-align: center; padding: 1rem; border-radius: var(--radius-md); background: ${winner === 'RRSP' ? 'rgba(99, 102, 241, 0.1)' : 'transparent'};">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">RRSP (After Tax)</div>
              <div class="mono" style="font-size: 1.25rem; font-weight: 700; color: var(--brand-primary);">${fmtFull(rrspRefundAfterTax)}</div>
              <div style="font-size: 0.72rem; color: var(--text-muted); margin-top: 0.25rem;">Pre-tax: ${fmtFull(rrspRefundBalance)}</div>
            </div>
            <div style="text-align: center; padding: 1rem; border-radius: var(--radius-md); background: ${winner === 'TFSA' ? 'rgba(6, 182, 212, 0.1)' : 'transparent'};">
              <div style="font-size: 0.72rem; color: var(--text-muted); text-transform: uppercase;">TFSA (Tax-Free)</div>
              <div class="mono" style="font-size: 1.25rem; font-weight: 700; color: var(--brand-accent);">${fmtFull(tfsaBalance)}</div>
              <div style="font-size: 0.72rem; color: var(--text-muted); margin-top: 0.25rem;">100% tax-free</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Tax Analysis</div>
          <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.85rem;">
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Current Marginal Rate</span>
              <span class="mono" style="font-weight: 700;">${(currentMarginal * 100).toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Retirement Marginal Rate</span>
              <span class="mono" style="font-weight: 700;">${(retireMarginal * 100).toFixed(1)}%</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">RRSP Tax Refund (Annual)</span>
              <span class="mono" style="font-weight: 700; color: var(--brand-success);">${fmtFull(rrspTaxSavings)}</span>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <span style="color: var(--text-secondary);">Tax Rate Arbitrage</span>
              <span class="mono" style="font-weight: 700; color: ${currentMarginal > retireMarginal ? 'var(--brand-success)' : 'var(--brand-danger)'};">${((currentMarginal - retireMarginal) * 100).toFixed(1)}%</span>
            </div>
          </div>
          <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 1rem; padding: 0.75rem; background: rgba(99,102,241,0.05); border-radius: var(--radius-sm);">
            üí° <strong>Rule of thumb:</strong> RRSP wins when your current tax rate is higher than your expected retirement tax rate. TFSA wins when rates are the same or lower now.
          </div>
          ${contribWarning || tfsaWarning ? `<div style="font-size: 0.75rem; color: var(--brand-warning); margin-top: 0.75rem; padding: 0.75rem; background: rgba(245,158,11,0.08); border-radius: var(--radius-sm);">${contribWarning}${tfsaWarning}</div>` : ''}
        </div>
      `;
      
      // Growth comparison chart
      let rrspYearly = [], tfsaYearly = [], rrspBal = 0, tfsaBal = 0;
      for (let y = 1; y <= years; y++) {
        rrspBal = (rrspBal + rrspWithRefund) * (1 + annualReturn);
        tfsaBal = (tfsaBal + tfsaNet) * (1 + annualReturn);
        if (y % Math.max(1, Math.floor(years / 15)) === 0 || y === years) {
          rrspYearly.push({ year: y, rrsp: rrspBal * (1 - retireMarginal), tfsa: tfsaBal });
        }
      }
      const chartData = rrspYearly.map(d => ({ label: 'Y' + d.year, bottom: Math.min(d.rrsp, d.tfsa), top: Math.max(d.rrsp, d.tfsa) }));
      if (chartData.length > 0 && typeof renderAreaChart === 'function') {
        renderAreaChart('retirement-chart', chartData, {
          bottomColor: winner === 'RRSP' ? '#06b6d4' : '#6366f1',
          topColor: winner === 'RRSP' ? '#6366f1' : '#06b6d4',
          bottomLabel: winner === 'RRSP' ? 'TFSA' : 'RRSP (After Tax)',
          topLabel: winner === 'RRSP' ? 'RRSP (After Tax)' : 'TFSA'
        });
      } else {
        const maxRetVal = Math.max(rrspRefundAfterTax, tfsaBalance);
        document.getElementById('retirement-chart').innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìä Growth Over ${years} Years</div>
          <div style="display: flex; align-items: flex-end; gap: 1rem; height: 180px;">
            ${rrspYearly.map(d => `
              <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px;">
                <div style="display: flex; gap: 2px; align-items: flex-end; width: 100%; justify-content: center;">
                  <div style="width: 45%; height: ${(d.rrsp / maxRetVal * 150)}px; background: var(--brand-primary); border-radius: 3px 3px 0 0; min-height: 4px;" title="RRSP: ${fmtFull(d.rrsp)}"></div>
                  <div style="width: 45%; height: ${(d.tfsa / maxRetVal * 150)}px; background: var(--brand-accent); border-radius: 3px 3px 0 0; min-height: 4px;" title="TFSA: ${fmtFull(d.tfsa)}"></div>
                </div>
                <span style="font-size: 0.65rem; color: var(--text-muted);">Y${d.year}</span>
              </div>
            `).join('')}
          </div>
          <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 0.75rem; font-size: 0.75rem;">
            <span><span style="display:inline-block;width:10px;height:10px;background:var(--brand-primary);border-radius:2px;"></span> RRSP (After Tax)</span>
            <span><span style="display:inline-block;width:10px;height:10px;background:var(--brand-accent);border-radius:2px;"></span> TFSA</span>
          </div>
        `;
      }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // COMPOUND INTEREST
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateCompound() {
      const initial = parseFloat(document.getElementById('comp-initial').value) || 0;
      const monthly = parseFloat(document.getElementById('comp-monthly').value) || 0;
      const rate = (parseFloat(document.getElementById('comp-rate').value) || 0) / 100;
      const years = parseInt(document.getElementById('comp-years').value) || 1;
      const freq = parseInt(document.getElementById('comp-freq').value) || 12;
      
      if (rate < 0 || years < 1) return;
      
      // Effective monthly rate based on compounding frequency
      // For freq compoundings/year: effective annual = (1 + r/freq)^freq
      // Then convert to monthly: (1 + effectiveAnnual)^(1/12) - 1
      const effectiveAnnual = Math.pow(1 + rate / freq, freq) - 1;
      const monthlyRate = Math.pow(1 + effectiveAnnual, 1 / 12) - 1;
      
      // Calculate with contributions
      let balance = initial;
      let totalContributed = initial;
      let yearlyData = [];
      
      for (let month = 1; month <= years * 12; month++) {
        balance = balance * (1 + monthlyRate) + monthly;
        totalContributed += monthly;
        
        if (month % 12 === 0) {
          yearlyData.push({
            year: month / 12,
            balance,
            contributed: totalContributed,
            interest: balance - totalContributed
          });
        }
      }
      
      // Without contributions (initial only, using selected compounding)
      const withoutContrib = initial * Math.pow(1 + effectiveAnnual, years);
      
      const totalInterest = balance - totalContributed;
      const effectiveRate = (Math.pow(balance / totalContributed, 1 / years) - 1) * 100;
      
      document.getElementById('compound-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Future Value</div>
          <div class="result-value">${fmtFull(balance)}</div>
        </div>
        
        <div class="result-card">
          <div class="result-label">Interest Earned</div>
          <div class="result-value" style="background: linear-gradient(135deg, var(--brand-success), var(--brand-accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">${fmtFull(totalInterest)}</div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Summary</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Total Contributed</div>
              <div class="mono" style="font-weight: 700;">${fmtFull(totalContributed)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Growth Multiple</div>
              <div class="mono" style="font-weight: 700;">${(balance / totalContributed).toFixed(2)}x</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Without Contributions</div>
              <div class="mono" style="font-weight: 700;">${fmtFull(withoutContrib)}</div>
            </div>
            <div>
              <div style="font-size: 0.72rem; color: var(--text-muted);">Contribution Impact</div>
              <div class="mono" style="font-weight: 700; color: var(--brand-success);">+${fmtFull(balance - withoutContrib)}</div>
            </div>
          </div>
        </div>
        
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">The Power of Compound Interest</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.7;">
            Your ${fmtFull(monthly)}/month contributions turn into <strong style="color: var(--text-primary);">${fmtFull(balance)}</strong> over ${years} years.
            That's <strong style="color: var(--brand-success);">${fmtFull(totalInterest)}</strong> in pure compound growth ‚Äî money your money earned for you.
          </div>
        </div>
      `;
      
      // Enhanced Growth chart with donut breakdown
      if (yearlyData.length > 0) {
        var compAreaData = yearlyData.map(function(d) {
          return { label: 'Y' + d.year, bottom: d.contributed, top: d.balance };
        });
        
        // Add donut breakdown chart at the start
        document.getElementById('compound-chart').innerHTML = `
          <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; margin-bottom: 2rem;">
            <div style="text-align: center;">
              <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Balance Breakdown</div>
              ${svgDonut([
                {value: totalContributed, color: 'var(--brand-primary)', label: 'Principal'},
                {value: totalInterest, color: 'var(--brand-success)', label: 'Interest'}
              ], 140)}
              <div style="display: flex; flex-direction: column; gap: 0.5rem; font-size: 0.75rem; margin-top: 1rem;">
                <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-primary); border-radius: 2px; margin-right: 4px;"></span>Principal: ${fmtFull(totalContributed)}</div>
                <div><span style="display: inline-block; width: 12px; height: 12px; background: var(--brand-success); border-radius: 2px; margin-right: 4px;"></span>Interest: ${fmtFull(totalInterest)}</div>
              </div>
            </div>
            <div>
              <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Milestones</div>
              ${svgHorizontalBars([
                {label: `Year ${Math.floor(years * 0.25)}`, value: yearlyData[Math.floor(years * 0.25) - 1]?.balance || 0, color: 'var(--brand-primary)'},
                {label: `Year ${Math.floor(years * 0.5)}`, value: yearlyData[Math.floor(years * 0.5) - 1]?.balance || 0, color: 'var(--brand-accent)'},
                {label: `Year ${Math.floor(years * 0.75)}`, value: yearlyData[Math.floor(years * 0.75) - 1]?.balance || 0, color: 'var(--brand-warning)'},
                {label: `Year ${years}`, value: balance, color: 'var(--brand-success)'}
              ], 380, 200)}
            </div>
          </div>
        `;
        
        renderAreaChart('compound-chart', compAreaData, {
          bottomColor: '#6366f1', topColor: '#10b981',
          bottomLabel: 'Contributions', topLabel: 'Total (with Interest)'
        });

        // Sparkline: balance trajectory preview
        var balTrajectory = yearlyData.map(function(d) { return d.balance; });
        var compChart = document.getElementById('compound-chart');
        if (compChart) {
          compChart.innerHTML += '<div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.75rem;">Growth Trajectory ' + sparkline(balTrajectory, 100, 20, '#06b6d4') + '</div>';
        }
      }

      // Comparison mode (Scenario B)
      const rateB = (parseFloat(document.getElementById('comp-rate-b').value) || 0) / 100;
      const monthlyB = parseFloat(document.getElementById('comp-monthly-b').value) || 0;
      const compCompare = document.getElementById('compound-comparison');
      if (compCompare && (rateB > 0 || monthlyB > 0)) {
        let balB = initial, contribB = initial;
        let yearlyB = [];
        const effectiveAnnualB = Math.pow(1 + rateB / freq, freq) - 1;
        const monthlyRateB = Math.pow(1 + effectiveAnnualB, 1/12) - 1;
        for (let m = 1; m <= years * 12; m++) {
          balB = balB * (1 + monthlyRateB) + monthlyB;
          contribB += monthlyB;
          if (m % 12 === 0) yearlyB.push({ year: m/12, balance: balB, contributed: contribB });
        }
        const diff = balance - balB;
        compCompare.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üìä Scenario Comparison</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;">
            <div class="glass-card" style="padding:var(--space-lg);text-align:center;">
              <div style="font-size:0.72rem;color:var(--text-muted);text-transform:uppercase;">Scenario A</div>
              <div style="font-size:0.8rem;color:var(--text-secondary);">${(rate*100).toFixed(1)}% ¬∑ ${fmtFull(monthly)}/mo</div>
              <div class="mono" style="font-size:1.5rem;font-weight:700;color:var(--brand-primary);margin-top:0.5rem;">${fmtFull(balance)}</div>
            </div>
            <div class="glass-card" style="padding:var(--space-lg);text-align:center;">
              <div style="font-size:0.72rem;color:var(--text-muted);text-transform:uppercase;">Scenario B</div>
              <div style="font-size:0.8rem;color:var(--text-secondary);">${(rateB*100).toFixed(1)}% ¬∑ ${fmtFull(monthlyB)}/mo</div>
              <div class="mono" style="font-size:1.5rem;font-weight:700;color:var(--brand-accent);margin-top:0.5rem;">${fmtFull(balB)}</div>
            </div>
          </div>
          <div style="text-align:center;margin-top:1rem;font-size:0.9rem;color:var(--text-secondary);">
            Scenario ${diff > 0 ? 'A' : 'B'} wins by <strong style="color:var(--brand-success);">${fmtFull(Math.abs(diff))}</strong>
          </div>
        `;
      } else if (compCompare) {
        compCompare.innerHTML = '';
      }
    }
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // TEST SUITE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function runTests() {
      const results = [];
      let passed = 0;
      let failed = 0;
      
      function assert(name, condition, detail) {
        if (condition) {
          passed++;
          results.push({ name, status: 'PASS', detail });
        } else {
          failed++;
          results.push({ name, status: 'FAIL', detail });
        }
      }
      
      // ‚îÄ‚îÄ Formatting Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      assert('fmt: millions', fmt(5000000) === '$5.0M', fmt(5000000));
      assert('fmt: billions', fmt(2500000000) === '$2.5B', fmt(2500000000));
      assert('fmt: thousands', fmt(50000) === '$50.0K', fmt(50000));
      assert('fmt: zero', fmt(0) === '$0.00', fmt(0));
      assert('fmt: negative', fmt(-3000000).includes('-'), fmt(-3000000));
      assert('fmt: NaN guard', fmt(NaN) === '$0', fmt(NaN));
      assert('fmt: undefined guard', fmt(undefined) === '$0', fmt(undefined));
      assert('fmtPct: basic', fmtPct(12.345) === '12.3%', fmtPct(12.345));
      assert('fmtFull: formats number', fmtFull(1234).length > 0, fmtFull(1234));
      
      // ‚îÄ‚îÄ DCF Calculation Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const fcf = 1000000;
      const growth = 0.10;
      const terminal = 0.025;
      const wacc = 0.12;
      const years = 5;
      
      let pvSum = 0;
      for (let i = 1; i <= years; i++) {
        pvSum += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
      }
      const finalFCF = fcf * Math.pow(1 + growth, years);
      const tv = finalFCF * (1 + terminal) / (wacc - terminal);
      const pvTV = tv / Math.pow(1 + wacc, years);
      const ev = pvSum + pvTV;
      
      assert('DCF: PV of FCFs > 0', pvSum > 0, `PV sum = ${pvSum.toFixed(0)}`);
      assert('DCF: Terminal value > 0', tv > 0, `TV = ${tv.toFixed(0)}`);
      assert('DCF: EV > initial FCF', ev > fcf, `EV = ${ev.toFixed(0)}`);
      assert('DCF: EV reasonable range', ev > 5000000 && ev < 50000000, `EV = ${fmt(ev)}`);
      
      // ‚îÄ‚îÄ M&A Accretion/Dilution Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const acqEPS = 5.00, acqShares = 100, acqPrice = 50;
      const tgtEPS = 2.00, tgtShares = 50, tgtPrice = 20;
      const maPremium = 0.25, maCashPct = 0.50, maDebtCost = 0.05, maTaxRate = 0.25;
      const maOfferPrice = tgtPrice * (1 + maPremium);
      const maDealValue = maOfferPrice * tgtShares;
      const maCashPortion = maDealValue * maCashPct;
      const maStockPortion = maDealValue * (1 - maCashPct);
      const maNewShares = maStockPortion / acqPrice;
      const maProFormaShares = acqShares + maNewShares;
      const maAcqNI = acqEPS * acqShares;
      const maTgtNI = tgtEPS * tgtShares;
      const maInterest = maCashPortion * maDebtCost * (1 - maTaxRate);
      const maProFormaNI = maAcqNI + maTgtNI - maInterest;
      const maProFormaEPS = maProFormaNI / maProFormaShares;
      const maAccDil = ((maProFormaEPS - acqEPS) / acqEPS) * 100;
      assert('M&A: offer price includes premium', maOfferPrice === 25, `Offer = ${maOfferPrice}`);
      assert('M&A: deal value correct', maDealValue === 1250, `Deal = ${maDealValue}`);
      assert('M&A: accretive deal detected', maAccDil > 0, `Accretion = ${maAccDil.toFixed(2)}%`);
      // Dilutive scenario: high premium
      const dilOfferPrice = tgtPrice * 3;
      const dilDealValue = dilOfferPrice * tgtShares;
      const dilNewShares = dilDealValue / acqPrice;
      const dilProFormaShares = acqShares + dilNewShares;
      const dilProFormaEPS = (maAcqNI + maTgtNI) / dilProFormaShares;
      const dilAccDil = ((dilProFormaEPS - acqEPS) / acqEPS) * 100;
      assert('M&A: dilutive with high premium', dilAccDil < 0, `Dilution = ${dilAccDil.toFixed(2)}%`);
      
      // ‚îÄ‚îÄ Mortgage Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const price = 800000;
      const mortDownPct = 0.20;
      const rate = 0.055;
      const principal = price * (1 - mortDownPct);
      const semiRate = Math.pow(1 + rate / 2, 2) - 1;
      const mRate = Math.pow(1 + semiRate, 1 / 12) - 1;
      const mPayment = principal * (mRate * Math.pow(1 + mRate, 300)) / (Math.pow(1 + mRate, 300) - 1);
      
      assert('Mortgage: payment > 0', mPayment > 0, `Payment = ${mPayment.toFixed(2)}`);
      assert('Mortgage: payment reasonable', mPayment > 2000 && mPayment < 6000, `Payment = ${fmtFull(mPayment)}`);
      assert('Mortgage: semi-annual compounding', semiRate > rate, `Effective = ${(semiRate * 100).toFixed(3)}%`);
      
      // ‚îÄ‚îÄ CMHC Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      assert('CMHC: not required at 20% down', mortDownPct >= 0.20, 'Down 20% = no CMHC');
      const cmhc10Down = 0.10;
      const cmhc10Principal = price * (1 - cmhc10Down);
      const cmhc10Premium = cmhc10Principal * 0.031;
      assert('CMHC: premium applies at 10% down', cmhc10Premium > 0, `CMHC = ${cmhc10Premium.toFixed(0)}`);
      assert('CMHC: 10% down premium > 0', cmhc10Down < 0.20 && cmhc10Premium > 20000, `Premium = ${cmhc10Premium.toFixed(0)}`);
      assert('CMHC: no premium at 20%+', mortDownPct >= 0.20, '20% down = exempt');
      
      // ‚îÄ‚îÄ CAGR Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const cagr = (Math.pow(25000 / 10000, 1 / 5) - 1) * 100;
      assert('CAGR: basic calc', Math.abs(cagr - 20.11) < 0.1, `CAGR = ${cagr.toFixed(2)}%`);
      
      // ‚îÄ‚îÄ Compound Interest Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      let balance = 10000;
      for (let m = 0; m < 12; m++) {
        balance *= (1 + 0.07 / 12);
      }
      assert('Compound: 1yr @7%', Math.abs(balance - 10722.9) < 5, `Balance = ${balance.toFixed(2)}`);
      
      // ‚îÄ‚îÄ DCA Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      let dcaBalance = 0;
      const dcaMonthly = 500;
      const dcaRate = Math.pow(1.08, 1 / 12) - 1;
      for (let m = 0; m < 240; m++) {
        dcaBalance = dcaBalance * (1 + dcaRate) + dcaMonthly;
      }
      const dcaTotalContributed = 500 * 240;
      assert('DCA: 20yr result > contributions', dcaBalance > dcaTotalContributed, `Balance = ${dcaBalance.toFixed(0)} > ${dcaTotalContributed}`);
      
      // ‚îÄ‚îÄ DCA with Inflation Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const dcaInflation = 0.03;
      const dcaNominal = dcaBalance;
      const dcaReal = dcaNominal / Math.pow(1 + dcaInflation, 20);
      assert('DCA inflation: real < nominal', dcaReal < dcaNominal, `Real = ${dcaReal.toFixed(0)} < Nominal = ${dcaNominal.toFixed(0)}`);
      assert('DCA inflation: real still positive', dcaReal > 0, `Real = ${dcaReal.toFixed(0)}`);
      
      // ‚îÄ‚îÄ Startup Runway Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const rwCosts = 50000;
      const rwRevenue = 20000;
      const rwBurnRate = rwCosts - rwRevenue;
      assert('Runway: burn rate = costs - revenue', rwBurnRate === 30000, `Burn = ${rwBurnRate}`);
      const rwCash = 300000;
      const rwMonths = rwCash / rwBurnRate;
      assert('Runway: months = cash / burn', rwMonths === 10, `Months = ${rwMonths}`);
      assert('Runway: zero burn when revenue >= costs', (50000 - 50000) === 0, 'Break-even');
      
      // ‚îÄ‚îÄ Net Worth Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const nwAssets = 500000;
      const nwLiabilities = 200000;
      const nwNetWorth = nwAssets - nwLiabilities;
      assert('Net worth: assets - liabilities', nwNetWorth === 300000, `NW = ${nwNetWorth}`);
      assert('Net worth: negative when liabilities > assets', (100000 - 300000) < 0, 'Negative NW');
      
      // ‚îÄ‚îÄ Tax Bracket Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const fedTaxResult = fedTax(120000);
      assert('Fed tax: positive for 120K', fedTaxResult > 0, `Tax = ${fedTaxResult.toFixed(0)}`);
      assert('Fed tax: reasonable', fedTaxResult > 15000 && fedTaxResult < 35000, `Tax = ${fedTaxResult.toFixed(0)}`);
      
      // ‚îÄ‚îÄ Page Navigation Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const allPages = ['home', 'valuation', 'mortgage', 'investment', 'retirement', 'compound', 'merger', 'runway', 'networth', 'salary', 'debt'];
      allPages.forEach(p => {
        assert(`Nav: page-${p} exists`, !!document.getElementById('page-' + p), '');
      });
      
      // ‚îÄ‚îÄ Theme Tests ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      const wasDark = isDark;
      const wasCls = document.documentElement.classList.contains('light');
      toggleTheme();
      assert('Theme: toggles isDark', isDark !== wasDark, `isDark changed to ${isDark}`);
      assert('Theme: light class toggles', document.documentElement.classList.contains('light') !== wasCls, '');
      const themeStored = localStorage.getItem('figgybank-theme');
      assert('Theme: persists to localStorage', themeStored !== null, `Stored: ${themeStored}`);
      toggleTheme(); // Reset
      const themeReset = localStorage.getItem('figgybank-theme');
      assert('Theme: localStorage updates on re-toggle', themeReset !== themeStored, `Now: ${themeReset}`);
      
      // Print results
      console.log(`\nüß™ FIGGYBANK TEST SUITE`);
      console.log(`${'‚ïê'.repeat(50)}`);
      results.forEach(r => {
        console.log(`${r.status === 'PASS' ? '‚úÖ' : '‚ùå'} ${r.name} ${r.detail ? `(${r.detail})` : ''}`);
      });
      console.log(`${'‚ïê'.repeat(50)}`);
      console.log(`Results: ${passed} passed, ${failed} failed, ${passed + failed} total`);
      console.log(failed === 0 ? 'üéâ ALL TESTS PASSED!' : `‚ö†Ô∏è ${failed} TEST(S) FAILED`);
      
      return { passed, failed, total: passed + failed, results };
    }
    
    // Run tests on load (dev mode)
    if (location.hostname === 'localhost' || location.hostname === '127.0.0.1' || location.search.includes('test=true')) {
      window.addEventListener('load', () => {
        setTimeout(runTests, 500);
      });
    }
    
    // Expose for manual testing
    window.runTests = runTests;

    // ‚îÄ‚îÄ M&A Deal Analyzer ‚îÄ‚îÄ
    function calculateMA() {
      const v = id => parseFloat(document.getElementById(id).value) || 0;
      const fmt = (n, d=1) => n.toLocaleString('en-US', {minimumFractionDigits:d, maximumFractionDigits:d});
      const fmtM = n => '$' + fmt(n, 1) + 'M';
      const fmtD = n => '$' + fmt(n, 2);

      // Inputs
      const acqEPS = v('ma-acq-eps'), acqPrice = v('ma-acq-price'), acqShares = v('ma-acq-shares'), acqPE = v('ma-acq-pe');
      const tgtEPS = v('ma-tgt-eps'), tgtPrice = v('ma-tgt-price'), tgtShares = v('ma-tgt-shares');
      const premium = v('ma-premium') / 100;
      const cashPct = v('ma-cash-pct') / 100, stockPct = 1 - cashPct;
      const debtCost = v('ma-debt-cost') / 100, taxRate = v('ma-tax') / 100;
      const revSyn = v('ma-rev-syn'), costSyn = v('ma-cost-syn');

      if (acqEPS <= 0 || acqPrice <= 0 || tgtEPS <= 0 || tgtPrice <= 0) {
        document.getElementById('ma-results').innerHTML = '<div class="result-card"><p style="color: var(--text-muted);">Enter positive values for EPS and share prices to analyze the deal.</p></div>';
        document.getElementById('ma-sensitivity').innerHTML = '';
        document.getElementById('ma-sources-uses').innerHTML = '';
        return;
      }

      // Core calcs
      const offerPrice = tgtPrice * (1 + premium);
      const dealValue = offerPrice * tgtShares; // in $M
      const cashPortion = dealValue * cashPct;
      const stockPortion = dealValue * stockPct;
      const newSharesIssued = acqPrice > 0 ? stockPortion / acqPrice : 0;
      const proFormaShares = acqShares + newSharesIssued;

      // Earnings
      const acqNetIncome = acqEPS * acqShares;
      const tgtNetIncome = tgtEPS * tgtShares;
      const synergies = (revSyn + costSyn) * (1 - taxRate);
      const interestExpense = cashPortion * debtCost * (1 - taxRate);
      const proFormaNetIncome = acqNetIncome + tgtNetIncome + synergies - interestExpense;
      const proFormaEPS = proFormaShares > 0 ? proFormaNetIncome / proFormaShares : 0;
      const accretionDilution = acqEPS !== 0 ? ((proFormaEPS - acqEPS) / acqEPS) * 100 : 0;

      // Goodwill
      const tgtBookValue = tgtShares * tgtPrice; // simplified: book ‚âà market pre-premium
      const goodwill = dealValue - tgtBookValue;

      // Combined P/E
      const combinedPE = proFormaEPS > 0 ? acqPrice / proFormaEPS : 0;

      // Break-even synergies: find synergies needed so accretion = 0
      // proFormaEPS = acqEPS when synergies = S_be
      // (acqNI + tgtNI + S_be*(1-t) - interest) / proFormaShares = acqEPS
      const beNumerator = acqEPS * proFormaShares - acqNetIncome - tgtNetIncome + interestExpense;
      const breakEvenSyn = (1 - taxRate) > 0 ? beNumerator / (1 - taxRate) : 0;

      // Transaction fees
      const txnFees = dealValue * 0.02;

      const adColor = accretionDilution >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)';
      const adLabel = accretionDilution >= 0 ? 'Accretive' : 'Dilutive';

      // Results
      document.getElementById('ma-results').innerHTML = `
        <div class="result-card glass-card" style="padding: var(--space-lg);">
          <h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Deal Summary</h3>
          <div style="display: grid; gap: 1rem;">
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Offer Price / Share</span><div class="mono" style="font-size: 1.3rem; color: var(--brand-primary);">${fmtD(offerPrice)}</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Total Deal Value</span><div class="mono" style="font-size: 1.3rem; color: var(--brand-primary);">${fmtM(dealValue)}</div></div>
            <div style="border-top: 1px solid rgba(255,255,255,0.06); padding-top: 1rem;">
              <span style="color: var(--text-secondary); font-size: 0.85rem;">Pro Forma EPS</span>
              <div class="mono" style="font-size: 1.3rem; color: var(--brand-accent);">${fmtD(proFormaEPS)}</div>
              <span style="font-size: 0.75rem; color: var(--text-muted);">vs. standalone ${fmtD(acqEPS)}</span>
            </div>
            <div style="background: rgba(${accretionDilution >= 0 ? '46,204,113' : '231,76,60'},0.1); border-radius: 0.75rem; padding: 1rem; text-align: center;">
              <span style="color: var(--text-secondary); font-size: 0.85rem;">${adLabel}</span>
              <div class="mono" style="font-size: 1.8rem; font-weight: 700; color: ${adColor};">${accretionDilution >= 0 ? '+' : ''}${fmt(accretionDilution,2)}%</div>
            </div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Goodwill Created</span><div class="mono" style="font-size: 1.1rem;">${fmtM(goodwill)}</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Combined P/E</span><div class="mono" style="font-size: 1.1rem;">${fmt(combinedPE,1)}x</div></div>
            <div><span style="color: var(--text-secondary); font-size: 0.85rem;">Break-even Synergies Needed</span><div class="mono" style="font-size: 1.1rem; color: ${breakEvenSyn > 0 ? 'var(--brand-warning)' : 'var(--brand-success)'};">${fmtM(breakEvenSyn)}</div></div>
          </div>
        </div>
      `;

      // Sensitivity table
      const premiums = [10, 20, 30, 40];
      const cashMixes = [0, 25, 50, 75, 100];
      let tbl = '<h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Sensitivity: Accretion / Dilution %</h3>';
      tbl += '<table class="sensitivity-table"><thead><tr><th>Premium \\ Cash%</th>';
      cashMixes.forEach(c => tbl += `<th>${c}%</th>`);
      tbl += '</tr></thead><tbody>';
      premiums.forEach(p => {
        tbl += `<tr><td style="font-weight:600;">${p}%</td>`;
        cashMixes.forEach(c => {
          const op = tgtPrice * (1 + p/100);
          const dv = op * tgtShares;
          const cp = dv * c/100, sp = dv * (1 - c/100);
          const ns = acqPrice > 0 ? sp / acqPrice : 0;
          const pfs = acqShares + ns;
          const ie = cp * debtCost * (1 - taxRate);
          const pfni = acqNetIncome + tgtNetIncome + synergies - ie;
          const pfeps = pfs > 0 ? pfni / pfs : 0;
          const ad = acqEPS !== 0 ? ((pfeps - acqEPS) / acqEPS) * 100 : 0;
          const cls = ad >= 0 ? 'positive-val' : 'negative-val';
          const hl = (p === v('ma-premium') && c === v('ma-cash-pct')) ? ' highlight' : '';
          tbl += `<td class="${cls}${hl}">${ad >= 0 ? '+' : ''}${ad.toFixed(1)}%</td>`;
        });
        tbl += '</tr>';
      });
      tbl += '</tbody></table>';
      document.getElementById('ma-sensitivity').innerHTML = tbl;

      // Sources & Uses
      const cashOnHand = 0; // simplified
      const newDebt = cashPortion;
      const stockIssued = stockPortion;
      let su = '<h3 style="font-size: 0.85rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 1rem;">Sources & Uses ($M)</h3>';
      su += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">';
      su += '<div><table class="sensitivity-table"><thead><tr><th colspan="2">Sources</th></tr></thead><tbody>';
      su += `<tr><td>New Debt</td><td class="mono">${fmtM(newDebt)}</td></tr>`;
      su += `<tr><td>Stock Issued</td><td class="mono">${fmtM(stockIssued)}</td></tr>`;
      su += `<tr><td>Cash on Hand</td><td class="mono">${fmtM(cashOnHand)}</td></tr>`;
      su += `<tr style="border-top:2px solid rgba(255,255,255,0.1);"><td style="font-weight:700;">Total Sources</td><td class="mono" style="font-weight:700;">${fmtM(dealValue + txnFees)}</td></tr>`;
      su += '</tbody></table></div>';
      su += '<div><table class="sensitivity-table"><thead><tr><th colspan="2">Uses</th></tr></thead><tbody>';
      su += `<tr><td>Purchase Price</td><td class="mono">${fmtM(dealValue)}</td></tr>`;
      su += `<tr><td>Transaction Fees (2%)</td><td class="mono">${fmtM(txnFees)}</td></tr>`;
      su += `<tr><td>Refinancing</td><td class="mono">${fmtM(0)}</td></tr>`;
      su += `<tr style="border-top:2px solid rgba(255,255,255,0.1);"><td style="font-weight:700;">Total Uses</td><td class="mono" style="font-weight:700;">${fmtM(dealValue + txnFees)}</td></tr>`;
      su += '</tbody></table></div></div>';
      document.getElementById('ma-sources-uses').innerHTML = su;
    }

    // Initialize M&A on page load
    document.addEventListener('DOMContentLoaded', function() { if(document.getElementById('ma-acq-eps')) calculateMA(); });

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  STARTUP RUNWAY CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let runwayScenario = 'base';

    function switchRunwayTab(tab) {
      runwayScenario = tab;
      document.querySelectorAll('#runway-tabs .tab').forEach(t => t.classList.remove('active'));
      document.getElementById('runway-tab-' + tab).classList.add('active');
      calculateRunway();
    }

    function getHiringPlan() {
      const roles = document.querySelectorAll('.rw-hire-role');
      const salaries = document.querySelectorAll('.rw-hire-salary');
      const months = document.querySelectorAll('.rw-hire-month');
      const plan = [];
      for (let i = 0; i < roles.length; i++) {
        plan.push({
          role: roles[i].value,
          salary: parseFloat(salaries[i].value) || 0,
          startMonth: parseInt(months[i].value) || 1
        });
      }
      return plan;
    }

    function calculateRunway() {
      const cash = parseFloat(document.getElementById('rw-cash').value) || 0;
      const revenue = parseFloat(document.getElementById('rw-revenue').value) || 0;
      let growthPct = parseFloat(document.getElementById('rw-growth').value) || 0;
      const fixed = parseFloat(document.getElementById('rw-fixed').value) || 0;
      const variable = parseFloat(document.getElementById('rw-variable').value) || 0;
      const onetime = parseFloat(document.getElementById('rw-onetime').value) || 0;
      const hiring = parseFloat(document.getElementById('rw-hiring').value) || 0;
      const hiringPlan = getHiringPlan();

      let scenarioLabel = 'Base Case Scenario';
      let effectiveGrowth = growthPct;
      if (runwayScenario === 'conservative') { effectiveGrowth = 0; scenarioLabel = 'Conservative Scenario (No Growth)'; }
      if (runwayScenario === 'aggressive') { effectiveGrowth = growthPct * 2; scenarioLabel = 'Aggressive Scenario (' + (growthPct * 2) + '% Growth)'; }

      document.getElementById('rw-scenario-label').textContent = scenarioLabel;

      const totalCosts = fixed + variable;
      const burnRate = totalCosts - revenue;
      document.getElementById('rw-burn').textContent = fmtFull(burnRate);

      const maxMonths = 60;
      let balances = [];
      let flatRunway = 0;
      let growthRunway = 0;
      let breakEvenMonth = null;
      let hitZeroGrowth = false;

      // Flat runway (no growth)
      let flatBal = cash - onetime;
      for (let m = 1; m <= maxMonths; m++) {
        let flatCosts = totalCosts + (hiring * m);
        flatBal -= (flatCosts - revenue);
        if (flatBal <= 0) { flatRunway = m; break; }
        if (m === maxMonths) flatRunway = maxMonths;
      }

      // Growth runway
      let bal = cash - onetime;
      let rev = revenue;
      for (let m = 1; m <= maxMonths; m++) {
        rev = rev * (1 + effectiveGrowth / 100);
        let hiringCost = 0;
        hiringPlan.forEach(h => { if (m >= h.startMonth) hiringCost += h.salary; });
        let costs = totalCosts + (hiring * m) + hiringCost;
        bal -= (costs - rev);
        balances.push({ month: m, balance: bal, revenue: rev, costs: costs });
        if (!breakEvenMonth && rev >= costs) breakEvenMonth = m;
        if (!hitZeroGrowth && bal <= 0) { growthRunway = m; hitZeroGrowth = true; }
      }
      if (!hitZeroGrowth) growthRunway = maxMonths;

      document.getElementById('rw-runway-flat').textContent = flatRunway >= maxMonths ? '60+ months' : flatRunway + ' months';
      document.getElementById('rw-runway-growth').textContent = growthRunway >= maxMonths ? '60+ months' : growthRunway + ' months';

      const now = new Date();
      if (growthRunway < maxMonths) {
        const zeroDate = new Date(now.getFullYear(), now.getMonth() + growthRunway, 1);
        document.getElementById('rw-zero-date').textContent = zeroDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      } else {
        document.getElementById('rw-zero-date').textContent = 'N/A (sustainable)';
      }

      const rw = growthRunway;
      const safeEl = document.getElementById('rw-safe-zone');
      const safeText = document.getElementById('rw-safe-text');
      var safeLabel;
      if (rw > 12 || rw >= maxMonths) {
        safeLabel = '\u{1F7E2} Safe Zone';
        safeEl.style.borderColor = 'rgba(16, 185, 129, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.03))';
      } else if (rw >= 6) {
        safeLabel = '\u{1F7E1} Caution';
        safeEl.style.borderColor = 'rgba(245, 158, 11, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(245, 158, 11, 0.03))';
      } else {
        safeLabel = '\u{1F534} Danger';
        safeEl.style.borderColor = 'rgba(239, 68, 68, 0.4)';
        safeEl.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(239, 68, 68, 0.03))';
      }
      // Render gauge for safety zone (0-24 months mapped to 0-100)
      var gaugeVal = Math.min(rw, 24) / 24 * 100;
      safeText.innerHTML = safeLabel + '<div id="rw-gauge" style="margin-top:0.5rem;display:flex;justify-content:center;"></div>';
      renderGauge('rw-gauge', gaugeVal, [
        { from: 0, to: 25, color: '#ef4444' },
        { from: 25, to: 50, color: '#f59e0b' },
        { from: 50, to: 100, color: '#10b981' }
      ], rw >= maxMonths ? '60+ mo' : rw + ' mo', 140);

      document.getElementById('rw-breakeven').textContent = breakEvenMonth ? 'Month ' + breakEvenMonth : 'Not within 60 months';

      // Chart
      const chart = document.getElementById('rw-chart');
      const maxBal = Math.max(...balances.map(b => Math.abs(b.balance)), 1);
      const months = Math.min(balances.length, 36);
      let html = '';
      for (let i = 0; i < months; i++) {
        const b = balances[i];
        const pct = Math.min(Math.abs(b.balance) / maxBal * 100, 100);
        const isNeg = b.balance < 0;
        const isBE = breakEvenMonth && i + 1 === breakEvenMonth;
        let color = isNeg ? 'var(--brand-danger)' : (isBE ? 'var(--brand-success)' : 'linear-gradient(to top, var(--brand-primary), var(--brand-accent))');
        const title = 'Month ' + (i + 1) + ': ' + fmtFull(b.balance);
        html += '<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%;position:relative;" title="' + title + '">';
        html += '<div style="width:100%;height:' + Math.max(pct, 2) + '%;background:' + color + ';border-radius:3px 3px 0 0;min-height:2px;transition:height 0.5s ease;"></div>';
        if (i % 6 === 0 || i === months - 1) html += '<span style="font-size:0.55rem;color:var(--text-muted);position:absolute;bottom:-18px;">M' + (i + 1) + '</span>';
        html += '</div>';
      }
      chart.innerHTML = html;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  NET WORTH TRACKER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function nwVal(id) { return parseFloat(document.getElementById(id).value) || 0; }

    function calculateNetWorth() {
      const assets = {
        'Cash & Savings': nwVal('nw-cash'),
        'TFSA': nwVal('nw-tfsa'),
        'RRSP': nwVal('nw-rrsp'),
        'Non-Registered': nwVal('nw-nonreg'),
        'Real Estate': nwVal('nw-realestate'),
        'Vehicles': nwVal('nw-vehicles'),
        'Other Assets': nwVal('nw-other-assets'),
      };
      const liabilities = {
        'Mortgage': nwVal('nw-mortgage'),
        'Car Loans': nwVal('nw-carloans'),
        'Student Loans': nwVal('nw-student'),
        'Credit Cards': nwVal('nw-cc'),
        'Line of Credit': nwVal('nw-loc'),
        'Other Debt': nwVal('nw-other-debt'),
      };

      const totalAssets = Object.values(assets).reduce((a, b) => a + b, 0);
      const totalLiabilities = Object.values(liabilities).reduce((a, b) => a + b, 0);
      const netWorth = totalAssets - totalLiabilities;
      const liquidNW = totalAssets - assets['Real Estate'] - assets['Vehicles'] - totalLiabilities;

      document.getElementById('nw-total-assets').textContent = fmtFull(totalAssets);
      document.getElementById('nw-total-liabilities').textContent = fmtFull(totalLiabilities);
      document.getElementById('nw-networth').textContent = fmtFull(netWorth);
      document.getElementById('nw-liquid').textContent = fmtFull(liquidNW);

      // Debt-to-asset ratio
      const dtaEl = document.getElementById('nw-dta');
      if (totalAssets > 0) {
        const dta = (totalLiabilities / totalAssets * 100);
        let pillClass = dta > 80 ? 'negative' : dta > 50 ? 'neutral' : 'positive';
        let icon = dta > 80 ? '\u{1F534}' : dta > 50 ? '\u{1F7E1}' : '\u{1F7E2}';
        dtaEl.innerHTML = '<span class="metric-pill ' + pillClass + '">' + icon + ' Debt-to-Asset: ' + dta.toFixed(1) + '%</span>';
      } else {
        dtaEl.innerHTML = '';
      }

      // SVG Donut Chart for asset allocation
      const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];
      const assetEntries = Object.entries(assets).filter(function(e) { return e[1] > 0; });
      if (totalAssets > 0 && assetEntries.length > 0) {
        var donutSegments = assetEntries.map(function(entry, i) {
          return { label: entry[0], value: entry[1], color: colors[i % colors.length] };
        });
        renderDonutChart('nw-pie', donutSegments, 150);
        document.getElementById('nw-pie-legend').innerHTML = assetEntries.map(function(entry, i) {
          var pct = (entry[1] / totalAssets * 100).toFixed(0);
          return '<div style="display:flex;align-items:center;gap:6px;"><span style="width:10px;height:10px;border-radius:2px;background:' + colors[i % colors.length] + ';flex-shrink:0;"></span>' + entry[0] + ' <span class="mono" style="color:var(--text-muted);">' + pct + '%</span></div>';
        }).join('');
      } else {
        document.getElementById('nw-pie').innerHTML = '<div style="width:150px;height:150px;border-radius:50%;background:var(--border-primary);"></div>';
        document.getElementById('nw-pie-legend').innerHTML = '<span style="color:var(--text-muted);">Enter assets to see allocation</span>';
      }

      // Gauge for Debt-to-Asset ratio
      if (totalAssets > 0) {
        var dtaVal = totalLiabilities / totalAssets * 100;
        var dtaContainer = document.getElementById('nw-dta');
        dtaContainer.innerHTML = '<div id="nw-dta-gauge"></div>';
        renderGauge('nw-dta-gauge', Math.min(dtaVal, 100), [
          { from: 0, to: 33, color: '#10b981' },
          { from: 33, to: 66, color: '#f59e0b' },
          { from: 66, to: 100, color: '#ef4444' }
        ], 'D/A: ' + dtaVal.toFixed(1) + '%', 160);
      }
    }

    function saveNetWorthSnapshot() {
      const snap = {
        date: new Date().toISOString(),
        assets: nwVal('nw-cash') + nwVal('nw-tfsa') + nwVal('nw-rrsp') + nwVal('nw-nonreg') + nwVal('nw-realestate') + nwVal('nw-vehicles') + nwVal('nw-other-assets'),
        liabilities: nwVal('nw-mortgage') + nwVal('nw-carloans') + nwVal('nw-student') + nwVal('nw-cc') + nwVal('nw-loc') + nwVal('nw-other-debt'),
      };
      snap.netWorth = snap.assets - snap.liabilities;
      const snaps = JSON.parse(localStorage.getItem('nw-snapshots') || '[]');
      snaps.push(snap);
      localStorage.setItem('nw-snapshots', JSON.stringify(snaps));
      loadNetWorthSnapshots();
    }

    function loadNetWorthSnapshots() {
      const snaps = JSON.parse(localStorage.getItem('nw-snapshots') || '[]');
      const el = document.getElementById('nw-snapshots');
      if (snaps.length === 0) {
        el.innerHTML = '<p style="color:var(--text-muted);font-size:0.8rem;">No snapshots yet. Save one to start tracking.</p>';
        return;
      }
      let html = '<div style="display:flex;flex-direction:column;gap:0.5rem;">';
      snaps.slice().reverse().forEach(function(s) {
        const d = new Date(s.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric', hour: '2-digit', minute: '2-digit' });
        const nwColor = s.netWorth >= 0 ? 'var(--brand-success)' : 'var(--brand-danger)';
        html += '<div style="display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0.75rem;background:var(--bg-secondary);border-radius:var(--radius-sm);border:1px solid var(--border-primary);">';
        html += '<span style="color:var(--text-secondary);">' + d + '</span>';
        html += '<span class="mono" style="font-weight:600;color:' + nwColor + ';">' + fmtFull(s.netWorth) + '</span>';
        html += '</div>';
      });
      html += '</div>';
      html += '<button class="btn btn-ghost btn-sm" style="margin-top:0.75rem;color:var(--brand-danger);font-size:0.72rem;" onclick="if(confirm(\'Clear all snapshots?\')){localStorage.removeItem(\'nw-snapshots\');loadNetWorthSnapshots();}">Clear All Snapshots</button>';
      el.innerHTML = html;

      // Trend chart
      const trendEl = document.getElementById('nw-trend-chart');
      if (trendEl && snaps.length >= 2) {
        const trendData = snaps.map(s => ({
          label: new Date(s.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
          bottom: 0,
          top: s.netWorth
        }));
        const maxNW = Math.max(...snaps.map(s => Math.abs(s.netWorth)), 1);
        trendEl.innerHTML = '<div style="display:flex;align-items:flex-end;gap:4px;height:150px;">' +
          snaps.map(s => {
            const h = Math.max(2, Math.abs(s.netWorth) / maxNW * 140);
            const color = s.netWorth >= 0 ? 'linear-gradient(to top,var(--brand-primary),var(--brand-accent))' : 'var(--brand-danger)';
            return '<div style="flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;height:100%;"><div style="font-size:0.55rem;color:var(--text-muted);margin-bottom:2px;">' + fmtFull(s.netWorth) + '</div><div style="width:100%;height:' + h + 'px;background:' + color + ';border-radius:3px 3px 0 0;"></div></div>';
          }).join('') + '</div>' +
          '<div style="display:flex;justify-content:space-between;font-size:0.6rem;color:var(--text-muted);margin-top:0.25rem;">' +
          '<span>' + new Date(snaps[0].date).toLocaleDateString('en-US',{month:'short',day:'numeric'}) + '</span>' +
          '<span>' + new Date(snaps[snaps.length-1].date).toLocaleDateString('en-US',{month:'short',day:'numeric'}) + '</span></div>';
      } else if (trendEl) {
        trendEl.innerHTML = '<p style="color:var(--text-muted);font-size:0.8rem;">Save 2+ snapshots to see trend</p>';
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  NEWSLETTER SIGNUP
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function subscribeNewsletter() {
      const input = document.getElementById('newsletter-email');
      const email = input.value.trim();
      if (!email || !email.includes('@') || !email.includes('.')) {
        input.style.borderColor = 'var(--brand-danger)';
        setTimeout(function() { input.style.borderColor = ''; }, 2000);
        return;
      }
      const subs = JSON.parse(localStorage.getItem('bb-newsletter') || '[]');
      if (!subs.includes(email)) { subs.push(email); localStorage.setItem('bb-newsletter', JSON.stringify(subs)); }
      input.value = '';
      // Show toast
      const toast = document.createElement('div');
      toast.className = 'toast-success';
      toast.innerHTML = '‚úÖ You\'re subscribed! Welcome aboard.';
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 3500);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  COOKIE CONSENT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    (function() {
      if (localStorage.getItem('bb-cookie-consent')) return;
      var banner = document.createElement('div');
      banner.className = 'cookie-banner';
      banner.innerHTML = '<span>üç™ We use cookies to improve your experience.</span><div class="cookie-banner-btns"><button class="btn btn-primary btn-sm" onclick="acceptCookies(true)">Accept</button><button class="btn btn-secondary btn-sm" onclick="acceptCookies(false)">Decline</button></div>';
      document.body.appendChild(banner);
    })();
    function acceptCookies(accepted) {
      localStorage.setItem('bb-cookie-consent', accepted ? 'accepted' : 'declined');
      var b = document.querySelector('.cookie-banner');
      if (b) b.remove();
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MICRO-INTERACTIONS v1.6
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

    // 1. Smooth Number Animations
    function animateValue(element, start, end, duration) {
      if (!element || duration <= 0) { element.textContent = end; return; }
      const startTime = performance.now();
      const isFormatted = typeof end === 'string';
      const endNum = isFormatted ? parseFloat(end.replace(/[^0-9.\-]/g, '')) : end;
      const startNum = isFormatted ? parseFloat(start.toString().replace(/[^0-9.\-]/g, '')) || 0 : (start || 0);
      if (isNaN(endNum)) { element.textContent = end; return; }
      const prefix = isFormatted ? (end.match(/^[^0-9.\-]*/)||[''])[0] : '';
      const suffix = isFormatted ? (end.match(/[^0-9.\-]*$/)||[''])[0] : '';
      const hasDecimal = isFormatted && end.includes('.');
      const decimals = hasDecimal ? (end.split('.')[1] || '').replace(/[^0-9]/g, '').length : 0;

      function tick(now) {
        const elapsed = now - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic
        const current = startNum + (endNum - startNum) * eased;
        if (isFormatted) {
          element.textContent = prefix + current.toLocaleString('en-US', {minimumFractionDigits: decimals, maximumFractionDigits: decimals}) + suffix;
        } else {
          element.textContent = Math.round(current);
        }
        if (progress < 1) requestAnimationFrame(tick);
        else element.textContent = end; // ensure exact final value
      }
      requestAnimationFrame(tick);
    }

    // Observe .result-value changes and animate them
    (function() {
      const resultObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(m) {
          if (m.type === 'childList' || m.type === 'characterData') {
            const el = m.target.nodeType === 1 ? m.target : m.target.parentElement;
            if (!el || !el.classList || !el.classList.contains('result-value')) return;
            const newVal = el.textContent;
            const oldVal = el.getAttribute('data-prev') || '0';
            if (newVal !== oldVal && !el._animating) {
              el._animating = true;
              el.setAttribute('data-prev', newVal);
              animateValue(el, oldVal, newVal, 600);
              setTimeout(function() { el._animating = false; }, 650);
            }
          }
        });
      });
      // Observe the whole body for result-value text changes
      document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.result-value').forEach(function(el) {
          el.setAttribute('data-prev', el.textContent);
        });
      });
      // Use a simpler approach: patch innerHTML setters on result containers
      const origShowPage = window.showPage;
      // We'll hook into calculator functions instead via a post-render observer
      setInterval(function() {
        document.querySelectorAll('.result-value').forEach(function(el) {
          if (!el.hasAttribute('data-prev')) el.setAttribute('data-prev', el.textContent);
        });
      }, 200);
    })();

    // 2. Input Ripple Effect
    document.addEventListener('click', function(e) {
      const input = e.target.closest('.input-group input, .input-group select');
      if (!input) return;
      const group = input.closest('.input-group');
      if (!group) return;
      const ripple = document.createElement('div');
      ripple.className = 'input-ripple';
      const rect = input.getBoundingClientRect();
      const grect = group.getBoundingClientRect();
      const size = 30;
      ripple.style.width = size + 'px';
      ripple.style.height = size + 'px';
      ripple.style.left = (e.clientX - grect.left - size/2) + 'px';
      ripple.style.top = (e.clientY - grect.top - size/2) + 'px';
      group.appendChild(ripple);
      setTimeout(function() { ripple.remove(); }, 600);
    });

    // 3. Page Transition (fade-out / fade-in)
    (function() {
      const origShowPage = window.showPage;
      window.showPage = function(pageId) {
        const currentPage = document.querySelector('.page.active');
        const targetPage = document.getElementById('page-' + pageId);
        if (!targetPage || currentPage === targetPage) {
          origShowPage(pageId);
          return;
        }
        if (currentPage) {
          currentPage.classList.add('fade-out');
          setTimeout(function() {
            currentPage.classList.remove('active', 'fade-out');
            targetPage.classList.add('active', 'fade-in');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            setTimeout(function() { targetPage.classList.remove('fade-in'); }, 250);
            // Close mobile menu & init calculators
            document.getElementById('nav-links').classList.remove('mobile-open');
            if (pageId === 'valuation') calculateDCF();
            if (pageId === 'mortgage') calculateMortgage();
            if (pageId === 'investment') calculateCAGR();
            if (pageId === 'retirement') calculateRetirement();
            if (pageId === 'compound') calculateCompound();
            if (pageId === 'runway') calculateRunway();
            if (pageId === 'networth') { calculateNetWorth(); loadNetWorthSnapshots(); }
            if (pageId === 'salary') calculateSalary();
            if (pageId === 'debt') calculateDebt();
            if (pageId === 'compare') calculateComparison();
            if (pageId === 'currency') convertCurrency();
            if (pageId === 'lease') calculateLeaseBuy();
            if (pageId === 'tax') calculateTax();
            if (pageId === 'fhsa') calculateFHSA();
            if (pageId === 'resp') calculateRESP();
            if (pageId === 'rentbuy') calculateRentBuy();
            if (pageId === 'gic') calculateGIC();
            if (pageId === 'cpp') calculateCPP();
            if (pageId === 'capgains') calculateCapGains();
            if (pageId === 'tfsa') calculateTFSA();
            if (pageId === 'rrsp') calculateRRSP();
            if (pageId === 'incometax') calculateIncomeTax();
                }, 150);
        } else {
          origShowPage(pageId);
        }
      };
    })();

    // 4. Parallax Hero Blobs
    (function() {
      let ticking = false;
      const blobs = document.querySelectorAll('.hero-blob');
      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            const scrollY = window.scrollY;
            blobs.forEach(function(blob, i) {
              const speed = (i + 1) * 0.05;
              blob.style.transform = 'translateY(' + (scrollY * speed * -1) + 'px)';
            });
            ticking = false;
          });
          ticking = true;
        }
      });
    })();

    // 5. Chart Bar Tooltips ‚Äî handled via CSS class .chart-bar-tooltip + data-tooltip attr
    // The chart rendering functions already use title attrs; we enhance them with CSS tooltips
    // by adding a MutationObserver that converts title attrs on chart bars to our tooltip class
    (function() {
      function enhanceChartBars() {
        document.querySelectorAll('[title]').forEach(function(el) {
          if (el.closest('.chart-container, #rw-chart, #dca-chart, #compound-chart, #dcf-chart')) {
            if (!el.classList.contains('chart-bar-tooltip')) {
              el.classList.add('chart-bar-tooltip');
              el.setAttribute('data-tooltip', el.getAttribute('title'));
              el.removeAttribute('title');
            }
          }
        });
      }
      setInterval(enhanceChartBars, 500);
    })();

    // 6. Loading Skeleton
    (function() {
      const origShowPage2 = window.showPage;
      window.showPage = (function(prev) {
        return function(pageId) {
          prev(pageId);
          if (pageId === 'home') return;
          const page = document.getElementById('page-' + pageId);
          if (!page) return;
          const results = page.querySelectorAll('.calc-results');
          results.forEach(function(r) {
            if (r._skeletonShown) return;
            r._skeletonShown = true;
            r.style.position = 'relative';
            const skel = document.createElement('div');
            skel.className = 'skeleton-overlay';
            skel.innerHTML = '<div class="skeleton-line tall"></div><div class="skeleton-line medium"></div><div class="skeleton-line"></div><div class="skeleton-line short"></div>';
            r.appendChild(skel);
            setTimeout(function() {
              skel.style.transition = 'opacity 0.2s ease';
              skel.style.opacity = '0';
              setTimeout(function() { skel.remove(); r._skeletonShown = false; }, 200);
            }, 300);
          });
        };
      })(window.showPage);
    })();

    // 7. Scroll Progress Bar
    (function() {
      const bar = document.getElementById('scroll-progress');
      let ticking = false;
      window.addEventListener('scroll', function() {
        if (!ticking) {
          requestAnimationFrame(function() {
            const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const pct = scrollHeight > 0 ? (scrollTop / scrollHeight * 100) : 0;
            bar.style.width = pct + '%';
            ticking = false;
          });
          ticking = true;
        }
      });
    })();

    // 8. Easter Egg ‚Äî type "calcstack" anywhere
    (function() {
      let buffer = '';
      const secret = 'figgybank';
      document.addEventListener('keypress', function(e) {
        buffer += e.key.toLowerCase();
        if (buffer.length > secret.length) buffer = buffer.slice(-secret.length);
        if (buffer === secret) {
          buffer = '';
          triggerConfetti();
        }
      });

      function triggerConfetti() {
        const container = document.createElement('div');
        container.className = 'confetti-container';
        document.body.appendChild(container);
        const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#f97316'];
        for (let i = 0; i < 80; i++) {
          const piece = document.createElement('div');
          piece.className = 'confetti-piece';
          piece.style.left = Math.random() * 100 + 'vw';
          piece.style.background = colors[Math.floor(Math.random() * colors.length)];
          piece.style.animationDelay = (Math.random() * 1.5) + 's';
          piece.style.animationDuration = (2 + Math.random() * 2) + 's';
          piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
          piece.style.width = (5 + Math.random() * 8) + 'px';
          piece.style.height = (5 + Math.random() * 8) + 'px';
          container.appendChild(piece);
        }
        setTimeout(function() { container.remove(); }, 5000);
      }
    })();


    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SALARY & COMPENSATION ANALYZER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function calculateSalary() {
      const base = parseFloat(document.getElementById('sal-base').value) || 0;
      const bonusPct = parseFloat(document.getElementById('sal-bonus-pct').value) || 0;
      const shares = parseFloat(document.getElementById('sal-shares').value) || 0;
      const strike = parseFloat(document.getElementById('sal-strike').value) || 0;
      const currentPrice = parseFloat(document.getElementById('sal-current-price').value) || 0;
      const vesting = parseFloat(document.getElementById('sal-vesting').value) || 4;
      const health = parseFloat(document.getElementById('sal-health').value) || 0;
      const pension = parseFloat(document.getElementById('sal-pension').value) || 0;
      const province = document.getElementById('sal-province').value;

      const bonus = base * (bonusPct / 100);
      const intrinsicPerShare = Math.max(0, currentPrice - strike);
      const totalEquity = shares * intrinsicPerShare;
      const annualEquity = totalEquity / vesting;
      const benefits = health + pension;
      const totalComp = base + bonus + annualEquity + benefits;

      // Simplified Canadian marginal tax rates (combined federal + provincial, 2024 approx)
      const taxRates = {
        ON: [[ 55867, 0.2005], [111733, 0.2965], [154906, 0.3148], [220000, 0.3389], [Infinity, 0.5353]],
        BC: [[ 45654, 0.2006], [ 91310, 0.2272], [104835, 0.2950], [127299, 0.3148], [172602, 0.3267], [240716, 0.4070], [Infinity, 0.5350]],
        AB: [[ 55867, 0.2500], [111733, 0.3050], [154906, 0.3600], [208000, 0.4200], [Infinity, 0.4800]],
        QC: [[ 49275, 0.2753], [ 55867, 0.3253], [ 98540, 0.3802], [111733, 0.4397], [154906, 0.4797], [Infinity, 0.5331]],
        MB: [[ 36842, 0.2580], [ 55867, 0.2775], [ 79625, 0.3340], [111733, 0.3783], [154906, 0.4340], [Infinity, 0.5040]],
        SK: [[ 49720, 0.2550], [ 55867, 0.2775], [111733, 0.3577], [142058, 0.3577], [Infinity, 0.4477]],
        NS: [[ 29590, 0.2379], [ 55867, 0.2995], [ 59180, 0.3495], [ 93000, 0.3695], [111733, 0.4295], [150000, 0.4595], [Infinity, 0.5400]],
        NB: [[ 47715, 0.2440], [ 55867, 0.2682], [ 95524, 0.3182], [111733, 0.3552], [154906, 0.3952], [176756, 0.4352], [Infinity, 0.5302]],
        NL: [[ 41457, 0.2350], [ 55867, 0.2850], [ 82913, 0.3150], [111733, 0.3350], [148027, 0.3850], [154906, 0.4350], [207239, 0.4580], [Infinity, 0.5180]],
        PE: [[ 31984, 0.2480], [ 55867, 0.2880], [ 63969, 0.3330], [111733, 0.3530], [140000, 0.3730], [154906, 0.4430], [Infinity, 0.5130]]
      };

      const brackets = taxRates[province] || taxRates['ON'];
      const taxableIncome = base + bonus; // equity/benefits not directly taxed this way
      let tax = 0, prev = 0;
      for (const [limit, rate] of brackets) {
        if (taxableIncome <= prev) break;
        const taxable = Math.min(taxableIncome, limit) - prev;
        tax += taxable * rate;
        prev = limit;
      }

      // CPP contributions (2025 rates)
      const cppExemption = 3500;
      const cppMax1 = 68500; // YMPE
      const cppRate1 = 0.0595;
      const cppMax2 = 73200; // YAMPE (CPP2)
      const cppRate2 = 0.04;
      const cpp1 = Math.max(0, Math.min(taxableIncome, cppMax1) - cppExemption) * cppRate1;
      const cpp2 = taxableIncome > cppMax1 ? Math.max(0, Math.min(taxableIncome, cppMax2) - cppMax1) * cppRate2 : 0;
      const totalCPP = Math.min(cpp1, 3867.50) + Math.min(cpp2, 188);

      // EI contributions (2025 rates)
      const eiMax = 65700;
      const eiRate = province === 'QC' ? 0.01312 : 0.01660; // Quebec has lower EI
      const totalEI = Math.min(taxableIncome * eiRate, province === 'QC' ? 862.62 : 1077.48);

      // QPP for Quebec (replaces CPP with slightly different rates)
      const totalDeductions = tax + totalCPP + totalEI;
      const takeHome = taxableIncome - totalDeductions + annualEquity + benefits;
      const effTaxRate = taxableIncome > 0 ? (totalDeductions / taxableIncome) * 100 : 0;
      const hourly = totalComp / 2080;

      document.getElementById('sal-total-comp').textContent = fmtFull(totalComp);
      document.getElementById('sal-take-home').textContent = fmtFull(takeHome);
      document.getElementById('sal-eff-tax').textContent = fmtPct(effTaxRate);
      document.getElementById('sal-hourly').textContent = '$' + hourly.toFixed(2);
      document.getElementById('sal-equity-val').textContent = fmtFull(annualEquity);
      document.getElementById('sal-bonus-val').textContent = fmtFull(bonus);

      // Deduction breakdown
      document.getElementById('sal-income-tax').textContent = fmtFull(tax);
      document.getElementById('sal-cpp').textContent = fmtFull(totalCPP);
      document.getElementById('sal-ei').textContent = fmtFull(totalEI);
      document.getElementById('sal-total-ded').textContent = fmtFull(totalDeductions);

      // Pie chart
      const parts = [
        { label: 'Base Salary', value: base, color: '#14b8a6' },
        { label: 'Bonus', value: bonus, color: '#f59e0b' },
        { label: 'Equity', value: annualEquity, color: '#8b5cf6' },
        { label: 'Benefits', value: benefits, color: '#3b82f6' }
      ].filter(p => p.value > 0);

      const total = parts.reduce((s, p) => s + p.value, 0);
      let gradParts = [], cumPct = 0;
      parts.forEach(p => {
        const pct = (p.value / total) * 100;
        gradParts.push(`${p.color} ${cumPct}% ${cumPct + pct}%`);
        cumPct += pct;
      });
      // SVG Donut Chart for salary breakdown
      if (total > 0) {
        var salDonutSegs = parts.map(function(p) { return { label: p.label, value: p.value, color: p.color }; });
        renderDonutChart('sal-pie', salDonutSegs, 150);
      } else {
        document.getElementById('sal-pie').innerHTML = '<div style="width:150px;height:150px;border-radius:50%;background:var(--border-primary);"></div>';
      }
      document.getElementById('sal-pie-legend').innerHTML = parts.map(p =>
        `<div style="display:flex;align-items:center;gap:0.5rem;"><span style="width:10px;height:10px;border-radius:50%;background:${p.color};display:inline-block;"></span>${p.label}: ${fmtFull(p.value)} (${((p.value/total)*100).toFixed(0)}%)</div>`
      ).join('');

      // Comparison
      const canadianMedian = 55000;
      const techMedian = 95000;
      const compEl = document.getElementById('sal-comparison');
      const bar = (label, val, max) => {
        const pct = Math.min(100, (val / max) * 100);
        return `<div style="margin-bottom:0.75rem;">
          <div style="display:flex;justify-content:space-between;margin-bottom:0.25rem;"><span>${label}</span><span>${fmtFull(val)}</span></div>
          <div style="height:8px;background:var(--border-primary);border-radius:4px;overflow:hidden;">
            <div style="height:100%;width:${pct}%;background:linear-gradient(90deg,#14b8a6,#0d9488);border-radius:4px;transition:width 0.5s;"></div>
          </div>
        </div>`;
      };
      const maxVal = Math.max(totalComp, canadianMedian, techMedian) * 1.1;
      compEl.innerHTML = bar('Your Total Comp', totalComp, maxVal)
        + bar('Canadian Median', canadianMedian, maxVal)
        + bar('Tech Median', techMedian, maxVal)
        + `<div style="margin-top:0.5rem;font-size:0.8rem;color:var(--text-secondary);">You earn <strong>${totalComp > canadianMedian ? ((totalComp/canadianMedian - 1)*100).toFixed(0) + '% more' : ((1 - totalComp/canadianMedian)*100).toFixed(0) + '% less'}</strong> than the Canadian median</div>`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DEBT PAYOFF CALCULATOR
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let debtStrategy = 'avalanche';

    function setDebtStrategy(s) {
      debtStrategy = s;
      document.getElementById('debt-btn-avalanche').className = s === 'avalanche' ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm';
      document.getElementById('debt-btn-snowball').className = s === 'snowball' ? 'btn btn-primary btn-sm' : 'btn btn-secondary btn-sm';
      document.getElementById('debt-strategy-help').textContent = s === 'avalanche'
        ? 'Highest interest rate first ‚Äî saves the most money'
        : 'Lowest balance first ‚Äî quick wins for motivation';
      calculateDebt();
    }

    function addDebtRow() {
      const container = document.getElementById('debt-rows');
      const row = document.createElement('div');
      row.className = 'debt-row';
      row.style.cssText = 'display:grid;grid-template-columns:2fr 1.5fr 1fr 1.5fr auto;gap:0.5rem;align-items:end;margin-bottom:0.5rem;';
      row.innerHTML = `
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Name</label><input type="text" value="New Debt" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Balance ($)</label><input type="number" value="5000" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Rate (%)</label><input type="number" value="12" step="0.01" oninput="calculateDebt()" /></div>
        <div class="input-group" style="margin:0"><label style="font-size:0.7rem">Min Payment ($)</label><input type="number" value="150" oninput="calculateDebt()" /></div>
        <button class="btn btn-secondary btn-sm" onclick="removeDebtRow(this)" style="padding:0.25rem 0.5rem;margin-bottom:2px;">‚úï</button>`;
      container.appendChild(row);
      calculateDebt();
    }

    function removeDebtRow(btn) {
      const rows = document.querySelectorAll('#debt-rows .debt-row');
      if (rows.length <= 1) return;
      btn.closest('.debt-row').remove();
      calculateDebt();
    }

    function getDebts() {
      const rows = document.querySelectorAll('#debt-rows .debt-row');
      return Array.from(rows).map(row => {
        const inputs = row.querySelectorAll('input');
        return {
          name: inputs[0].value || 'Debt',
          balance: parseFloat(inputs[1].value) || 0,
          rate: parseFloat(inputs[2].value) || 0,
          minPayment: parseFloat(inputs[3].value) || 0
        };
      }).filter(d => d.balance > 0);
    }

    function simulatePayoff(debts, extraMonthly, strategy) {
      let balances = debts.map(d => ({ ...d }));
      let totalInterest = 0;
      let months = 0;
      const maxMonths = 600; // 50 year cap
      const timeline = [{ month: 0, total: balances.reduce((s, d) => s + d.balance, 0) }];

      while (balances.some(d => d.balance > 0.01) && months < maxMonths) {
        months++;
        let extraLeft = extraMonthly;

        // Apply interest
        balances.forEach(d => {
          if (d.balance > 0) {
            const interest = d.balance * (d.rate / 100 / 12);
            d.balance += interest;
            totalInterest += interest;
          }
        });

        // Make minimum payments
        balances.forEach(d => {
          if (d.balance > 0) {
            const payment = Math.min(d.balance, d.minPayment);
            d.balance -= payment;
          }
        });

        // Sort for strategy and apply extra payment
        const sorted = balances.filter(d => d.balance > 0.01);
        if (strategy === 'avalanche') sorted.sort((a, b) => b.rate - a.rate);
        else sorted.sort((a, b) => a.balance - b.balance);

        for (const d of sorted) {
          if (extraLeft <= 0) break;
          const payment = Math.min(d.balance, extraLeft);
          d.balance -= payment;
          extraLeft -= payment;
        }

        timeline.push({ month: months, total: balances.reduce((s, d) => s + Math.max(0, d.balance), 0) });
      }

      return { totalInterest, months, timeline };
    }

    function calculateDebt() {
      const debts = getDebts();
      if (debts.length === 0) return;

      // Warn if any minimum payment doesn't cover monthly interest
      const warnings = debts.filter(d => d.minPayment < d.balance * (d.rate / 100 / 12));
      const warnEl = document.getElementById('debt-warnings');
      if (warnings.length > 0 && !document.getElementById('debt-warnings')) {
        const wDiv = document.createElement('div');
        wDiv.id = 'debt-warnings';
        wDiv.style.cssText = 'margin-top:0.75rem;padding:0.75rem;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.3);border-radius:var(--radius-sm);font-size:0.8rem;color:var(--brand-danger);';
        wDiv.innerHTML = '‚ö†Ô∏è <strong>' + warnings.map(w => w.name).join(', ') + '</strong>: minimum payment doesn\'t cover monthly interest ‚Äî balance will grow!';
        document.querySelector('#debt-rows').parentElement.appendChild(wDiv);
      } else if (warnEl && warnings.length === 0) {
        warnEl.remove();
      } else if (warnEl && warnings.length > 0) {
        warnEl.innerHTML = '‚ö†Ô∏è <strong>' + warnings.map(w => w.name).join(', ') + '</strong>: minimum payment doesn\'t cover monthly interest ‚Äî balance will grow!';
      }

      const extra = parseFloat(document.getElementById('debt-extra').value) || 0;
      const result = simulatePayoff(debts, extra, debtStrategy);
      const minOnly = simulatePayoff(debts, 0, debtStrategy);

      document.getElementById('debt-total-interest').textContent = fmtFull(result.totalInterest);
      document.getElementById('debt-months').textContent = result.months;

      const now = new Date();
      const freeDate = new Date(now.getFullYear(), now.getMonth() + result.months, 1);
      document.getElementById('debt-free-date').textContent = freeDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });

      const savings = minOnly.totalInterest - result.totalInterest;
      document.getElementById('debt-savings').textContent = fmtFull(Math.max(0, savings));

      const yrs = Math.floor(result.months / 12);
      const mos = result.months % 12;
      document.getElementById('debt-countdown').textContent = yrs > 0 ? `${yrs}y ${mos}m` : `${mos} months`;

      // Enhanced Timeline chart with line graph and breakdown
      const chart = document.getElementById('debt-timeline-chart');
      const tl = result.timeline;
      const maxBalance = tl[0].total || 1;
      const step = Math.max(1, Math.floor(tl.length / 20));
      const sampled = tl.filter((_, i) => i % step === 0 || i === tl.length - 1);
      
      // Prepare line chart data
      const lineData = sampled.map(p => ({x: (p.month / 12).toFixed(1), y: p.total}));

      chart.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 1.5rem;">
          <div>
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Payoff Progress</div>
            <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 12px;">
              ${svgLineChart(lineData, 400, 180)}
            </div>
            <div style="text-align: center; font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
              Balance decreases from ${fmtFull(maxBalance)} to $0
            </div>
          </div>
          <div>
            <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Strategy Comparison</div>
            ${svgBarChart([
              {label: 'Extra', value: result.months, color: 'var(--brand-success)'},
              {label: 'Min Only', value: minOnly.months, color: 'var(--brand-danger)'}
            ], 300, 180)}
            <div style="text-align: center; margin-top: 1rem;">
              <div style="font-size: 0.75rem; color: var(--text-muted);">You save</div>
              <div style="font-size: 1.2rem; font-weight: 600; color: var(--brand-success);">
                ${Math.floor((minOnly.months - result.months) / 12)} years ${(minOnly.months - result.months) % 12} months
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PDF EXPORT & COPY RESULTS (All Calculators)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function generatePDFReport(calcName) {
      const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      let assumptions = '';
      let resultsText = '';
      const gv = (id) => { const el = document.getElementById(id); return el ? (el.value || el.textContent || '') : ''; };
      const gvf = (id) => fmtFull(parseFloat(gv(id)) || 0);

      const calcMap = {
        'Business Valuation (DCF)': () => {
          assumptions = `<tr><td>Annual FCF</td><td>${gvf('dcf-fcf')}</td></tr><tr><td>Growth Rate</td><td>${gv('dcf-growth')}%</td></tr><tr><td>Terminal Growth</td><td>${gv('dcf-terminal')}%</td></tr><tr><td>WACC</td><td>${gv('dcf-wacc')}%</td></tr><tr><td>Years</td><td>${gv('dcf-years')}</td></tr><tr><td>Net Debt</td><td>${gvf('dcf-debt')}</td></tr>`;
          resultsText = (document.getElementById('dcf-results') || {}).innerText || '';
        },
        'Business Valuation (Multiples)': () => {
          assumptions = `<tr><td>Revenue</td><td>${gvf('mult-revenue')}</td></tr><tr><td>EBITDA</td><td>${gvf('mult-ebitda')}</td></tr><tr><td>Net Income</td><td>${gvf('mult-income')}</td></tr><tr><td>EV/Revenue</td><td>${gv('mult-ev-rev')}x</td></tr><tr><td>EV/EBITDA</td><td>${gv('mult-ev-ebitda')}x</td></tr><tr><td>P/E</td><td>${gv('mult-pe')}x</td></tr>`;
          resultsText = (document.getElementById('multiples-results') || {}).innerText || '';
        },
        'Business Valuation (Asset-Based)': () => {
          assumptions = `<tr><td>Cash</td><td>${gvf('asset-cash')}</td></tr><tr><td>A/R</td><td>${gvf('asset-ar')}</td></tr><tr><td>Inventory</td><td>${gvf('asset-inv')}</td></tr><tr><td>PP&E</td><td>${gvf('asset-ppe')}</td></tr><tr><td>A/P</td><td>${gvf('asset-ap')}</td></tr><tr><td>Debt</td><td>${gvf('asset-debt')}</td></tr>`;
          resultsText = (document.getElementById('asset-results') || {}).innerText || '';
        },
        'Canadian Mortgage Calculator': () => {
          assumptions = `<tr><td>Home Price</td><td>${gvf('mort-price')}</td></tr><tr><td>Down Payment</td><td>${gv('mort-down')}%</td></tr><tr><td>Rate</td><td>${gv('mort-rate')}%</td></tr><tr><td>Amortization</td><td>${gv('mort-amort')} yrs</td></tr>`;
          resultsText = (document.getElementById('mortgage-results') || {}).innerText || '';
        },
        'Investment Returns (CAGR)': () => {
          assumptions = `<tr><td>Initial</td><td>${gvf('cagr-initial')}</td></tr><tr><td>Final</td><td>${gvf('cagr-final')}</td></tr><tr><td>Period</td><td>${gv('cagr-years')} yrs</td></tr>`;
          resultsText = (document.getElementById('cagr-results') || {}).innerText || '';
        },
        'Investment Returns (DCA)': () => {
          assumptions = `<tr><td>Monthly</td><td>${gvf('dca-monthly')}</td></tr><tr><td>Return</td><td>${gv('dca-return')}%</td></tr><tr><td>Years</td><td>${gv('dca-years')}</td></tr><tr><td>Initial</td><td>${gvf('dca-initial')}</td></tr><tr><td>Inflation</td><td>${gv('dca-inflation')}%</td></tr>`;
          resultsText = (document.getElementById('dca-results') || {}).innerText || '';
        },
        'RRSP vs TFSA Optimizer': () => {
          assumptions = `<tr><td>Income</td><td>${gvf('ret-income')}</td></tr><tr><td>Contribution</td><td>${gvf('ret-contribution')}</td></tr><tr><td>Age</td><td>${gv('ret-age')}</td></tr><tr><td>Retire Age</td><td>${gv('ret-retire-age')}</td></tr><tr><td>Return</td><td>${gv('ret-return')}%</td></tr>`;
          resultsText = (document.getElementById('retirement-results') || {}).innerText || '';
        },
        'Compound Interest': () => {
          assumptions = `<tr><td>Initial</td><td>${gvf('comp-initial')}</td></tr><tr><td>Monthly</td><td>${gvf('comp-monthly')}</td></tr><tr><td>Rate</td><td>${gv('comp-rate')}%</td></tr><tr><td>Years</td><td>${gv('comp-years')}</td></tr>`;
          resultsText = (document.getElementById('compound-results') || {}).innerText || '';
        },
        'M&A Deal Analyzer': () => {
          assumptions = `<tr><td>Acquirer EPS</td><td>$${gv('ma-acq-eps')}</td></tr><tr><td>Target EPS</td><td>$${gv('ma-tgt-eps')}</td></tr><tr><td>Premium</td><td>${gv('ma-premium')}%</td></tr>`;
          resultsText = (document.getElementById('ma-results') || {}).innerText || '';
        },
        'Startup Runway': () => {
          assumptions = `<tr><td>Cash</td><td>${gvf('rw-cash')}</td></tr><tr><td>Revenue</td><td>${gvf('rw-revenue')}</td></tr><tr><td>Growth</td><td>${gv('rw-growth')}%</td></tr><tr><td>Fixed Costs</td><td>${gvf('rw-fixed')}</td></tr>`;
          resultsText = 'Burn Rate: ' + gv('rw-burn') + '\nRunway: ' + gv('rw-runway-growth') + '\nCash Zero: ' + gv('rw-zero-date');
        },
        'Net Worth Tracker': () => {
          assumptions = `<tr><td>Assets</td><td>${gv('nw-total-assets')}</td></tr><tr><td>Liabilities</td><td>${gv('nw-total-liabilities')}</td></tr>`;
          resultsText = 'Net Worth: ' + gv('nw-networth') + '\nLiquid: ' + gv('nw-liquid');
        }
      };

      if (calcMap[calcName]) calcMap[calcName]();

      const fullDate = new Date().toLocaleString('en-US', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', timeZoneName: 'short' });
      const html = `<!DOCTYPE html><html><head><title>FiggyBank ‚Äî ${calcName}</title><style>
@media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact}.no-print{display:none!important}@page{margin:1.5cm 2cm 2cm 2cm;}}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Segoe UI',system-ui,-apple-system,Arial,sans-serif;max-width:700px;margin:0 auto;padding:2.5rem 2rem;color:#1a1a2e;font-size:14px;line-height:1.6;}
.header{text-align:center;padding-bottom:1.5rem;margin-bottom:2rem;border-bottom:3px solid #6366f1;position:relative;}
.header::after{content:'';display:block;width:60px;height:3px;background:linear-gradient(90deg,#6366f1,#10b981);margin:0 auto;position:absolute;bottom:-3px;left:50%;transform:translateX(-50%);}
.header .logo{font-size:2rem;margin-bottom:0.25rem;}
.header h1{color:#6366f1;margin:0;font-size:1.6rem;font-weight:700;letter-spacing:-0.02em;}
.header .brand{font-size:0.85rem;color:#6366f1;margin-top:0.35rem;font-weight:600;letter-spacing:0.05em;text-transform:uppercase;}
.header .date{font-size:0.78rem;color:#999;margin-top:0.5rem;}
h2{color:#1a1a2e;font-size:1.05rem;font-weight:700;border-bottom:2px solid #e5e7eb;padding-bottom:0.5rem;margin:2rem 0 1rem;letter-spacing:-0.01em;}
h2 .icon{margin-right:0.4rem;}
table{width:100%;border-collapse:collapse;margin:0.75rem 0 1.5rem;}
tr:nth-child(even){background:#f9fafb;}
td{padding:0.6rem 0.85rem;border-bottom:1px solid #f0f0f5;font-size:0.88rem;}
td:first-child{color:#555;width:50%;}
td:last-child{font-weight:600;text-align:right;color:#1a1a2e;font-variant-numeric:tabular-nums;}
.results{background:linear-gradient(135deg,#f8f8ff,#f0f0ff);border:1px solid #e5e5f5;border-radius:10px;padding:1.75rem;margin:1rem 0 2rem;white-space:pre-line;font-size:0.88rem;line-height:1.9;}
.section-divider{height:1px;background:linear-gradient(90deg,transparent,#d1d5db,transparent);margin:1.5rem 0;}
.footer{margin-top:2.5rem;padding-top:1.25rem;border-top:2px solid #e5e7eb;text-align:center;}
.footer .disclaimer{font-size:0.7rem;color:#999;margin-bottom:0.75rem;line-height:1.5;}
.footer .branding{font-size:0.75rem;color:#6366f1;font-weight:600;}
.footer .branding a{color:#6366f1;text-decoration:none;}
.print-btn{display:block;margin:1.5rem auto 0;padding:0.75rem 2.5rem;background:linear-gradient(135deg,#6366f1,#4f46e5);color:white;border:none;border-radius:8px;font-size:0.95rem;cursor:pointer;font-weight:600;letter-spacing:0.02em;transition:transform 0.15s;}
.print-btn:hover{transform:scale(1.03);}
</style></head><body>
<div class="header">
<div class="logo">üßÆ</div>
<h1>${calcName}</h1>
<div class="brand">FiggyBank</div>
<div class="date">${fullDate}</div>
</div>
<h2><span class="icon">üìã</span>Input Assumptions</h2>
<table>${assumptions}</table>
<div class="section-divider"></div>
<h2><span class="icon">üìä</span>Results</h2>
<div class="results">${resultsText.replace(/\n/g, '<br>')}</div>
<div class="footer">
<div class="disclaimer"><strong>Disclaimer:</strong> This report is for informational and educational purposes only. It does not constitute financial, investment, tax, or legal advice. Consult a qualified professional before making financial decisions.</div>
<div class="branding">Generated by <a href="https://figgybank.ca">FiggyBank</a> ‚Äî figgybank.ca</div>
<div style="font-size:0.68rem;color:#bbb;margin-top:0.4rem;">¬© ${new Date().getFullYear()} FiggyBank. All rights reserved.</div>
</div>
<button class="print-btn no-print" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
</body></html>`;

      const w = window.open('', '_blank');
      w.document.write(html);
      w.document.close();
    }

    function copyResults(calcName) {
      let text = '\ud83d\udcca ' + calcName + ' \u2014 FiggyBank Report\n' + '\u2500'.repeat(40) + '\n';
      const resultIds = {
        'Business Valuation (DCF)': 'dcf-results',
        'Business Valuation (Multiples)': 'multiples-results',
        'Business Valuation (Asset-Based)': 'asset-results',
        'Canadian Mortgage Calculator': 'mortgage-results',
        'Investment Returns (CAGR)': 'cagr-results',
        'Investment Returns (DCA)': 'dca-results',
        'RRSP vs TFSA Optimizer': 'retirement-results',
        'Compound Interest': 'compound-results',
        'M&A Deal Analyzer': 'ma-results'
      };
      if (resultIds[calcName]) {
        const el = document.getElementById(resultIds[calcName]);
        if (el) text += el.innerText;
      } else if (calcName === 'Startup Runway') {
        text += 'Burn Rate: ' + document.getElementById('rw-burn').textContent + '\n';
        text += 'Runway: ' + document.getElementById('rw-runway-growth').textContent + '\n';
        text += 'Cash Zero: ' + document.getElementById('rw-zero-date').textContent + '\n';
      } else if (calcName === 'Net Worth Tracker') {
        text += 'Assets: ' + document.getElementById('nw-total-assets').textContent + '\n';
        text += 'Liabilities: ' + document.getElementById('nw-total-liabilities').textContent + '\n';
        text += 'Net Worth: ' + document.getElementById('nw-networth').textContent + '\n';
      }
      text += '\n' + '\u2500'.repeat(40) + '\nGenerated by FiggyBank \u00b7 figgybank.ca';
      navigator.clipboard.writeText(text).then(showCopyToast).catch(function() {
        const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); showCopyToast();
      });
    }

    function showCopyToast() {
      const existing = document.querySelector('.copy-toast');
      if (existing) existing.remove();
      const toast = document.createElement('div');
      toast.className = 'toast-success copy-toast';
      toast.innerHTML = '\ud83d\udccb Results copied!';
      document.body.appendChild(toast);
      setTimeout(function() { toast.remove(); }, 2500);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  VALUATION COMPARISON CHART
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function updateValuationComparison() {
      const compare = document.getElementById('val-compare');
      const chart = document.getElementById('val-compare-chart');
      if (!compare || !chart) return;

      let values = [];

      // DCF value
      try {
        const fcf = parseFloat(document.getElementById('dcf-fcf').value) || 0;
        const growth = (parseFloat(document.getElementById('dcf-growth').value) || 0) / 100;
        const terminal = (parseFloat(document.getElementById('dcf-terminal').value) || 0) / 100;
        const wacc = (parseFloat(document.getElementById('dcf-wacc').value) || 0) / 100;
        const years = parseInt(document.getElementById('dcf-years').value) || 5;
        const debt = parseFloat(document.getElementById('dcf-debt').value) || 0;
        if (wacc > terminal && fcf > 0) {
          let pv = 0;
          for (let i = 1; i <= years; i++) pv += (fcf * Math.pow(1 + growth, i)) / Math.pow(1 + wacc, i);
          const ff = fcf * Math.pow(1 + growth, years) * (1 + terminal);
          const tv = ff / (wacc - terminal);
          pv += tv / Math.pow(1 + wacc, years);
          values.push({ label: 'DCF', value: pv - debt, color: '#6366f1' });
        }
      } catch(e) {}

      // Multiples
      try {
        const rev = parseFloat(document.getElementById('mult-revenue').value) || 0;
        const ebitda = parseFloat(document.getElementById('mult-ebitda').value) || 0;
        const income = parseFloat(document.getElementById('mult-income').value) || 0;
        const evRev = parseFloat(document.getElementById('mult-ev-rev').value) || 0;
        const evEb = parseFloat(document.getElementById('mult-ev-ebitda').value) || 0;
        const pe = parseFloat(document.getElementById('mult-pe').value) || 0;
        const avg = (rev * evRev + ebitda * evEb + income * pe) / 3;
        if (avg > 0) values.push({ label: 'Multiples (Avg)', value: avg, color: '#8b5cf6' });
      } catch(e) {}

      // Asset
      try {
        const totalA = ['asset-cash','asset-ar','asset-inv','asset-ppe','asset-other'].reduce((s,id) => s + (parseFloat(document.getElementById(id).value)||0), 0);
        const totalL = ['asset-ap','asset-debt','asset-otherliab'].reduce((s,id) => s + (parseFloat(document.getElementById(id).value)||0), 0);
        const nav = totalA - totalL;
        if (nav !== 0) values.push({ label: 'Asset-Based (NAV)', value: nav, color: '#06b6d4' });
      } catch(e) {}

      if (values.length < 2) { compare.style.display = 'none'; return; }
      compare.style.display = 'block';

      const maxVal = Math.max(...values.map(v => Math.abs(v.value)));
      let html = '';
      values.forEach(v => {
        const pct = Math.abs(v.value) / maxVal * 100;
        html += '<div style="margin-bottom: 1rem;"><div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;"><span style="font-size: 0.85rem; font-weight: 600;">' + v.label + '</span><span class="mono" style="font-size: 0.85rem;">' + fmt(v.value) + '</span></div><div class="chart-bar"><div class="chart-bar-fill" style="width: ' + pct.toFixed(1) + '%; background: ' + v.color + ';"></div></div></div>';
      });

      const vals = values.map(v => v.value);
      const low = Math.min(...vals);
      const high = Math.max(...vals);
      const avg = vals.reduce((a,b) => a+b, 0) / vals.length;
      html += '<div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); border-top: 1px solid var(--border-primary); padding-top: 0.75rem; margin-top: 0.5rem;"><span>Low: ' + fmt(low) + '</span><span>Average: ' + fmt(avg) + '</span><span>High: ' + fmt(high) + '</span></div>';

      chart.innerHTML = html;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DEBOUNCE UTILITY (Performance)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function debounce(fn, ms) {
      let timer;
      return function() {
        const args = arguments, ctx = this;
        clearTimeout(timer);
        timer = setTimeout(function() { fn.apply(ctx, args); }, ms);
      };
    }

    // Debounce all slider inputs (50ms)
    (function() {
      const debouncedHandlers = new WeakMap();
      document.querySelectorAll('input[type="range"]').forEach(function(slider) {
        const origHandler = slider.getAttribute('oninput');
        if (origHandler) {
          const debouncedFn = debounce(function() {
            new Function(origHandler).call(slider);
          }, 50);
          // Keep display updates instant, debounce calculations
          slider.removeAttribute('oninput');
          slider.addEventListener('input', function() {
            // Update display value instantly (the span next to slider)
            const displayPart = origHandler.match(/document\.getElementById\([^)]+\)\.textContent\s*=\s*[^;]+/);
            if (displayPart) { try { new Function(displayPart[0]).call(slider); } catch(e){} }
            debouncedFn();
          });
        }
      });
    })();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  KEYBOARD SHORTCUTS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    (function() {
      const toolMap = {
        '1': 'valuation',
        '2': 'merger',
        '3': 'mortgage',
        '4': 'investment',
        '5': 'retirement',
        '6': 'compound',
        '7': 'runway',
        '8': 'networth',
        '9': 'lease',
        '0': 'tax'
      };

      document.addEventListener('keydown', function(e) {
        // Don't trigger when typing in inputs
        const tag = (e.target.tagName || '').toLowerCase();
        if (tag === 'input' || tag === 'textarea' || tag === 'select') return;

        const overlay = document.getElementById('shortcuts-overlay');

        if (e.key === '?') {
          e.preventDefault();
          overlay.classList.toggle('hidden');
          return;
        }

        if (e.key === 'Escape') {
          if (!overlay.classList.contains('hidden')) {
            overlay.classList.add('hidden');
          } else {
            showPage('home');
          }
          return;
        }

        if ((e.key === 'd' || e.key === 'D') && !e.ctrlKey && !e.metaKey) {
          toggleTheme();
          return;
        }

        if (toolMap[e.key]) {
          e.preventDefault();
          showPage(toolMap[e.key]);
        }
      });
    })();

    // ‚îÄ‚îÄ Global Calculation Counter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function incrementCalcCounter() {
      var count = parseInt(localStorage.getItem('figgybank-calc-count') || '0', 10) + 1;
      localStorage.setItem('figgybank-calc-count', count.toString());
      var el = document.getElementById('global-calc-counter');
      if (el) el.textContent = count.toLocaleString();
    }
    (function initCounter() {
      var count = parseInt(localStorage.getItem('figgybank-calc-count') || '0', 10);
      var el = document.getElementById('global-calc-counter');
      if (el) el.textContent = count > 0 ? count.toLocaleString() : '0';
    })();

    // ‚îÄ‚îÄ Side-by-Side Comparison ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calcMortgagePayment(principal, annualRate, amortYears) {
      // Canadian semi-annual compounding
      var semiRate = annualRate / 100 / 2;
      var monthlyRate = Math.pow(1 + semiRate, 1/6) - 1;
      var n = amortYears * 12;
      if (monthlyRate === 0) return { payment: principal / n, totalInterest: 0, totalCost: principal };
      var payment = principal * monthlyRate * Math.pow(1 + monthlyRate, n) / (Math.pow(1 + monthlyRate, n) - 1);
      var totalCost = payment * n;
      return { payment: payment, totalInterest: totalCost - principal, totalCost: totalCost };
    }

    function calculateComparison() {
      incrementCalcCounter();
      var aPrice = parseFloat(document.getElementById('cmp-a-price').value) || 0;
      var aRate = parseFloat(document.getElementById('cmp-a-rate').value) || 0;
      var aAmort = parseInt(document.getElementById('cmp-a-amort').value) || 25;
      var aDown = Math.min(100, Math.max(0, parseFloat(document.getElementById('cmp-a-down').value) || 0));
      var bPrice = Math.max(0, parseFloat(document.getElementById('cmp-b-price').value) || 0);
      var bRate = Math.max(0, parseFloat(document.getElementById('cmp-b-rate').value) || 0);
      var bAmort = Math.max(1, parseInt(document.getElementById('cmp-b-amort').value) || 25);
      var bDown = Math.min(100, Math.max(0, parseFloat(document.getElementById('cmp-b-down').value) || 0));

      var aPrincipal = aPrice * (1 - aDown / 100);
      var bPrincipal = bPrice * (1 - bDown / 100);
      var a = calcMortgagePayment(aPrincipal, aRate, aAmort);
      var b = calcMortgagePayment(bPrincipal, bRate, bAmort);

      document.getElementById('cmp-a-payment').textContent = fmtFull(a.payment);
      document.getElementById('cmp-b-payment').textContent = fmtFull(b.payment);
      document.getElementById('cmp-a-interest').textContent = fmtFull(a.totalInterest);
      document.getElementById('cmp-b-interest').textContent = fmtFull(b.totalInterest);
      document.getElementById('cmp-a-total').textContent = fmtFull(a.totalCost);
      document.getElementById('cmp-b-total').textContent = fmtFull(b.totalCost);

      var diff = Math.abs(a.totalCost - b.totalCost);
      var verdict = '';
      if (a.totalCost < b.totalCost) {
        verdict = 'üÖ∞Ô∏è Scenario A saves you <strong>' + fmtFull(diff) + '</strong> in total cost!';
      } else if (b.totalCost < a.totalCost) {
        verdict = 'üÖ±Ô∏è Scenario B saves you <strong>' + fmtFull(diff) + '</strong> in total cost!';
      } else {
        verdict = 'Both scenarios have the same total cost.';
      }
      var pmtDiff = Math.abs(a.payment - b.payment);
      verdict += '<br><span style="font-size:0.9rem;">Monthly payment difference: ' + fmtFull(pmtDiff) + '</span>';
      // CMHC warning
      if (aDown < 20) verdict += '<br><span style="font-size:0.8rem;color:var(--brand-warning);">‚ö†Ô∏è Scenario A requires CMHC insurance (down payment &lt; 20%)</span>';
      if (bDown < 20) verdict += '<br><span style="font-size:0.8rem;color:var(--brand-warning);">‚ö†Ô∏è Scenario B requires CMHC insurance (down payment &lt; 20%)</span>';
      document.getElementById('cmp-verdict').innerHTML = verdict;
    }

    // ‚îÄ‚îÄ Currency Converter ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function convertCurrency() {
      incrementCalcCounter();
      var cad = parseFloat(document.getElementById('currency-amount').value) || 0;
      if (cad < 0) cad = 0;
      // Rates: how many foreign units per 1 CAD (derived from "how many CAD per 1 foreign")
      var usd = cad / 1.36;
      var eur = cad / 1.47;
      var gbp = cad / 1.72;
      var inr = cad / 0.016;
      var jpy = cad / 0.009;
      function fmtCur(symbol, val, decimals) {
        return symbol + val.toLocaleString('en-CA', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
      }
      document.getElementById('cur-usd').textContent = fmtCur('$', usd, 2);
      document.getElementById('cur-eur').textContent = fmtCur('‚Ç¨', eur, 2);
      document.getElementById('cur-gbp').textContent = fmtCur('¬£', gbp, 2);
      document.getElementById('cur-inr').textContent = fmtCur('‚Çπ', inr, 0);
      document.getElementById('cur-jpy').textContent = fmtCur('¬•', jpy, 0);
      var aud = cad * 1.1236;
      document.getElementById('cur-aud').textContent = fmtCur('A$', aud, 2);
    }

    // ‚îÄ‚îÄ Rule of 72 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calcRule72(source) {
      if (source === 'rate') {
        var rate = parseFloat(document.getElementById('r72-rate').value) || 0;
        if (rate > 0) {
          var years = 72 / rate;
          document.getElementById('r72-rate-result').textContent = '‚âà ' + years.toFixed(1) + ' years to double';
          document.getElementById('r72-years').value = years.toFixed(1);
          document.getElementById('r72-years-result').textContent = '‚âà ' + rate.toFixed(1) + '% rate needed';
        } else {
          document.getElementById('r72-rate-result').textContent = 'Enter a rate above 0%';
          document.getElementById('r72-rate-result').style.color = 'var(--text-muted)';
          return;
        }
      } else {
        var years = parseFloat(document.getElementById('r72-years').value) || 0;
        if (years > 0) {
          var rate = 72 / years;
          document.getElementById('r72-years-result').textContent = '‚âà ' + rate.toFixed(1) + '% rate needed';
          document.getElementById('r72-rate').value = rate.toFixed(1);
          document.getElementById('r72-rate-result').textContent = '‚âà ' + years.toFixed(1) + ' years to double';
        } else {
          document.getElementById('r72-years-result').textContent = 'Enter a time above 0 years';
          document.getElementById('r72-years-result').style.color = 'var(--text-muted)';
          return;
        }
      }
      // Reset colors after valid input
      document.getElementById('r72-rate-result').style.color = 'var(--brand-primary)';
      document.getElementById('r72-years-result').style.color = 'var(--brand-primary)';
    }

    // ‚îÄ‚îÄ Lease vs Buy Calculator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateLeaseBuy() {
      var price = Math.max(0, parseFloat(document.getElementById('lb-price').value) || 0);
      var leasePayment = Math.max(0, parseFloat(document.getElementById('lb-lease-payment').value) || 0);
      var leaseTerm = Math.max(1, parseInt(document.getElementById('lb-lease-term').value) || 48);
      var residual = Math.max(0, parseFloat(document.getElementById('lb-residual').value) || 0);
      var buyRate = Math.max(0, (parseFloat(document.getElementById('lb-buy-rate').value) || 0)) / 100 / 12;
      var buyTerm = Math.max(1, parseInt(document.getElementById('lb-buy-term').value) || 60);
      var down = Math.max(0, parseFloat(document.getElementById('lb-down').value) || 0);
      var insDiff = parseFloat(document.getElementById('lb-insurance-diff').value) || 0;
      var maintDiff = parseFloat(document.getElementById('lb-maint-diff').value) || 0;
      if (price === 0 && leasePayment === 0) {
        document.getElementById('lease-buy-results').innerHTML = '<div class="glass-card" style="padding:var(--space-lg);text-align:center;color:var(--text-secondary);">Enter vehicle price and lease details to compare.</div>';
        document.getElementById('lease-buy-chart').innerHTML = '';
        return;
      }

      // Total lease cost
      var totalLease = leasePayment * leaseTerm;

      // Buy: monthly loan payment
      var loanAmt = price - down;
      var buyMonthly = buyRate > 0
        ? loanAmt * buyRate * Math.pow(1 + buyRate, buyTerm) / (Math.pow(1 + buyRate, buyTerm) - 1)
        : loanAmt / buyTerm;
      var totalLoanPayments = buyMonthly * buyTerm;
      var totalBuyInterest = totalLoanPayments - loanAmt;

      // Depreciation calculation (buy scenario)
      var annualDepreciation = (price - residual) / (leaseTerm / 12);
      var totalDepreciation = price - residual;

      // Compare over lease term period
      var compMonths = leaseTerm;
      var leaseCostOverPeriod = leasePayment * compMonths;
      // Buy cost over same period: payments made + down - residual value + running cost diffs
      var buyPaymentsInPeriod = buyMonthly * Math.min(compMonths, buyTerm);
      var buyCostOverPeriod = down + buyPaymentsInPeriod - residual + (insDiff + maintDiff) * compMonths;
      var costDiff = leaseCostOverPeriod - buyCostOverPeriod;

      // Break-even: find month where cumulative lease = cumulative buy
      var cumLease = 0, cumBuy = down;
      var breakEven = null;
      for (var m = 1; m <= Math.max(leaseTerm, buyTerm) + 12; m++) {
        cumLease += leasePayment;
        if (m <= buyTerm) cumBuy += buyMonthly;
        cumBuy += (insDiff + maintDiff);
        // After lease term, lessee has nothing; buyer has residual
        if (m === leaseTerm && cumLease <= cumBuy - residual && !breakEven) {
          breakEven = m;
        }
        if (!breakEven && cumBuy - residual <= cumLease) {
          breakEven = m;
        }
      }

      var verdict = buyCostOverPeriod < leaseCostOverPeriod ? 'Buying is cheaper' : 'Leasing is cheaper';
      var verdictColor = buyCostOverPeriod < leaseCostOverPeriod ? 'var(--brand-success)' : 'var(--brand-primary)';
      var savings = Math.abs(costDiff);

      document.getElementById('lease-buy-results').innerHTML = `
        <div class="result-card" style="border-left: 4px solid var(--brand-primary);">
          <div class="result-label">Total Lease Cost (${compMonths} mo)</div>
          <div class="result-value">${fmtFull(leaseCostOverPeriod)}</div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.25rem;">${fmtFull(leasePayment)}/mo ¬∑ No ownership at end</div>
        </div>
        <div class="result-card" style="border-left: 4px solid var(--brand-success);">
          <div class="result-label">Total Buy Cost (${compMonths} mo, net of residual)</div>
          <div class="result-value" style="background:linear-gradient(135deg,var(--brand-success),var(--brand-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">${fmtFull(buyCostOverPeriod)}</div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.25rem;">${fmtFull(buyMonthly)}/mo loan ¬∑ ${fmtFull(residual)} residual value</div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg); text-align: center;">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">${buyCostOverPeriod < leaseCostOverPeriod ? 'üèÜ' : 'üèÜ'}</div>
          <div style="font-size: 1.1rem; font-weight: 700; color: ${verdictColor};">${verdict}</div>
          <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">You save <strong>${fmtFull(savings)}</strong> over ${compMonths} months</div>
          ${breakEven ? `<div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.5rem;">Break-even point: ~${breakEven} months</div>` : ''}
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Details</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Down Payment</div><div class="mono" style="font-weight:700;">${fmtFull(down)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Loan Interest</div><div class="mono" style="font-weight:700;">${fmtFull(totalBuyInterest)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Monthly Buy Payment</div><div class="mono" style="font-weight:700;">${fmtFull(buyMonthly)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Running Cost Diff/mo</div><div class="mono" style="font-weight:700;">${fmtFull(insDiff + maintDiff)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Total Depreciation</div><div class="mono" style="font-weight:700;color:var(--brand-danger);">${fmtFull(totalDepreciation)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Annual Depreciation</div><div class="mono" style="font-weight:700;">${fmtFull(annualDepreciation)}/yr</div></div>
          </div>
        </div>
      `;

      // Bar chart comparison
      var maxCost = Math.max(leaseCostOverPeriod, buyCostOverPeriod);
      document.getElementById('lease-buy-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Cost Comparison Over ${compMonths} Months</div>
        <div style="margin-bottom: 1rem;">
          <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;"><span>Lease</span><span class="mono">${fmtFull(leaseCostOverPeriod)}</span></div>
          <div class="chart-bar"><div class="chart-bar-fill" style="width:${(leaseCostOverPeriod/maxCost*100).toFixed(1)}%;background:linear-gradient(90deg,var(--brand-primary),var(--brand-secondary));"></div></div>
        </div>
        <div>
          <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;"><span>Buy (net of residual)</span><span class="mono">${fmtFull(buyCostOverPeriod)}</span></div>
          <div class="chart-bar"><div class="chart-bar-fill" style="width:${(buyCostOverPeriod/maxCost*100).toFixed(1)}%;background:linear-gradient(90deg,var(--brand-success),var(--brand-accent));"></div></div>
        </div>
        <div style="margin-top:1rem;font-size:0.8rem;color:var(--text-muted);text-align:center;">
          Difference: <strong style="color:${verdictColor}">${fmtFull(savings)}</strong> in favour of ${buyCostOverPeriod < leaseCostOverPeriod ? 'buying' : 'leasing'}
        </div>
      `;
    }

    // ‚îÄ‚îÄ Canadian Tax Estimator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function calculateTax() {
      var province = document.getElementById('tax-province').value;
      var employment = Math.max(0, parseFloat(document.getElementById('tax-employment').value) || 0);
      var selfEmp = Math.max(0, parseFloat(document.getElementById('tax-self').value) || 0);
      var capGains = Math.max(0, parseFloat(document.getElementById('tax-capgains').value) || 0);
      var dividends = Math.max(0, parseFloat(document.getElementById('tax-dividends').value) || 0);
      var rrsp = Math.max(0, parseFloat(document.getElementById('tax-rrsp').value) || 0);
      var otherDed = Math.max(0, parseFloat(document.getElementById('tax-other-ded').value) || 0);
      if (employment === 0 && selfEmp === 0 && capGains === 0 && dividends === 0) {
        document.getElementById('tax-results').innerHTML = '<div class="glass-card" style="padding:var(--space-lg);text-align:center;color:var(--text-secondary);">Enter your income to estimate taxes.</div>';
        document.getElementById('tax-chart').innerHTML = '';
        var pc = document.getElementById('tax-province-compare'); if (pc) pc.innerHTML = '';
        return;
      }

      // Gross income
      var grossIncome = employment + selfEmp + capGains * 0.5 + dividends * 1.38; // gross-up dividends
      var deductions = rrsp + otherDed;
      var taxableIncome = Math.max(0, grossIncome - deductions);

      // 2025 Federal brackets
      var fedBrackets = [
        [57375, 0.15], [57375, 0.205], [43718, 0.26], [61532, 0.29], [Infinity, 0.33]
      ];
      var fedBasic = 16129; // basic personal amount
      var fedTax = calcBracketTax(taxableIncome, fedBrackets) - fedBasic * 0.15;
      // Dividend tax credit (federal): 15.0198% of grossed-up amount
      var fedDTC = dividends * 1.38 * 0.150198;
      fedTax = Math.max(0, fedTax - fedDTC);

      // Provincial brackets
      var provBrackets = getProvBrackets(province);
      var provBasic = getProvBasic(province);
      var provRate1 = provBrackets[0][1];
      var provTax = calcBracketTax(taxableIncome, provBrackets) - provBasic * provRate1;
      // Provincial dividend tax credit
      var provDTCRate = getProvDTCRate(province);
      var provDTC = dividends * 1.38 * provDTCRate;
      provTax = Math.max(0, provTax - provDTC);

      // CPP (2025): max pensionable earnings $71,300, basic exemption $3,500, rate 5.95%
      var cppEarnings = Math.min(employment + selfEmp, 71300) - 3500;
      var cppEmployee = Math.max(0, cppEarnings * 0.0595);
      var cppSelf = selfEmp > 0 ? cppEmployee * 2 * (selfEmp / (employment + selfEmp)) : 0;
      var cpp = employment > 0 ? cppEmployee : 0;
      cpp += cppSelf;
      // CPP2: earnings between $71,300 and $81,200 at 4%
      var cpp2Earnings = Math.min(employment + selfEmp, 81200) - 71300;
      if (cpp2Earnings > 0) cpp += cpp2Earnings * 0.04;

      // EI (2025): max insurable $65,700, rate 1.64%
      var eiEarnings = Math.min(employment, 65700);
      var ei = eiEarnings * 0.0164;

      var totalTax = fedTax + provTax + cpp + ei;
      var afterTax = employment + selfEmp + capGains + dividends - totalTax;
      var avgRate = grossIncome > 0 ? (totalTax / (employment + selfEmp + capGains + dividends)) * 100 : 0;

      // Marginal rate: federal + provincial top bracket
      var margFed = getMarginalRate(taxableIncome, fedBrackets);
      var margProv = getMarginalRate(taxableIncome, provBrackets);
      var margRate = (margFed + margProv) * 100;

      var totalGross = employment + selfEmp + capGains + dividends;

      document.getElementById('tax-results').innerHTML = `
        <div class="result-card">
          <div class="result-label">Total Tax</div>
          <div class="result-value">${fmtFull(totalTax)}</div>
        </div>
        <div class="result-card" style="border-left: 4px solid var(--brand-success);">
          <div class="result-label">After-Tax Income</div>
          <div class="result-value" style="background:linear-gradient(135deg,var(--brand-success),var(--brand-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;">${fmtFull(afterTax)}</div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Tax Breakdown</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Federal Tax</div><div class="mono" style="font-weight:700;">${fmtFull(fedTax)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Provincial Tax</div><div class="mono" style="font-weight:700;">${fmtFull(provTax)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">CPP Contributions</div><div class="mono" style="font-weight:700;">${fmtFull(cpp)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">EI Premiums</div><div class="mono" style="font-weight:700;">${fmtFull(ei)}</div></div>
          </div>
        </div>
        <div class="glass-card" style="padding: var(--space-lg);">
          <div style="font-size: 0.75rem; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.75rem;">Rates</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; font-size: 0.85rem;">
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Average Tax Rate</div><div class="mono" style="font-weight:700;">${avgRate.toFixed(1)}%</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Marginal Tax Rate</div><div class="mono" style="font-weight:700;color:var(--brand-warning);">${margRate.toFixed(1)}%</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Taxable Income</div><div class="mono" style="font-weight:700;">${fmtFull(taxableIncome)}</div></div>
            <div><div style="font-size:0.72rem;color:var(--text-muted);">Deductions</div><div class="mono" style="font-weight:700;">${fmtFull(deductions)}</div></div>
          </div>
        </div>
      `;

      // Waterfall chart
      var steps = [
        { label: 'Gross Income', value: totalGross, color: 'var(--brand-primary)' },
        { label: 'Deductions', value: -deductions, color: 'var(--text-muted)' },
        { label: 'Taxable Income', value: taxableIncome, color: 'var(--brand-secondary)' },
        { label: 'Federal Tax', value: -fedTax, color: 'var(--brand-danger)' },
        { label: 'Provincial Tax', value: -provTax, color: 'var(--brand-warning)' },
        { label: 'CPP + EI', value: -(cpp + ei), color: 'var(--text-muted)' },
        { label: 'Net Income', value: afterTax, color: 'var(--brand-success)' }
      ];
      var maxStep = Math.max(...steps.map(s => Math.abs(s.value)));
      document.getElementById('tax-chart').innerHTML = `
        <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">Tax Breakdown Waterfall</div>
        ${steps.map(s => `
          <div style="margin-bottom: 0.75rem;">
            <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.25rem;">
              <span>${s.label}</span>
              <span class="mono" style="color:${s.value < 0 ? 'var(--brand-danger)' : 'var(--text-primary)'}">${s.value < 0 ? '-' : ''}${fmtFull(Math.abs(s.value))}</span>
            </div>
            <div class="chart-bar"><div class="chart-bar-fill" style="width:${(Math.abs(s.value)/maxStep*100).toFixed(1)}%;background:${s.color};"></div></div>
          </div>
        `).join('')}
      `;

      // Province Comparison
      const provCompare = document.getElementById('tax-province-compare');
      if (provCompare) {
        const allProvs = ['ON','BC','AB','QC','MB','SK','NS','NB','NL','PE'];
        const provNames = {ON:'Ontario',BC:'British Columbia',AB:'Alberta',QC:'Quebec',MB:'Manitoba',SK:'Saskatchewan',NS:'Nova Scotia',NB:'New Brunswick',NL:'Newfoundland',PE:'PEI'};
        let provTaxes = allProvs.map(pv => {
          const pb = getProvBrackets(pv);
          const pBasic = getProvBasic(pv);
          const pTax = Math.max(0, calcBracketTax(taxableIncome, pb) - pBasic * pb[0][1]);
          const dtcR = getProvDTCRate(pv);
          const pDTC = dividends * 1.38 * dtcR;
          const total = Math.max(0, fedTax + Math.max(0, pTax - pDTC) + cpp + ei);
          return { prov: pv, name: provNames[pv], tax: total, afterTax: totalGross - total };
        }).sort((a,b) => a.tax - b.tax);
        const maxTax = Math.max(...provTaxes.map(p => p.tax));
        provCompare.innerHTML = `
          <div style="font-size: 0.85rem; font-weight: 700; margin-bottom: 1rem;">üó∫Ô∏è Tax Across All Provinces</div>
          ${provTaxes.map(p => `
            <div style="margin-bottom: 0.5rem;">
              <div style="display:flex;justify-content:space-between;font-size:0.8rem;margin-bottom:0.2rem;">
                <span${p.prov === province ? ' style="font-weight:700;color:var(--brand-primary);"' : ''}>${p.prov === province ? '‚Üí ' : ''}${p.name}</span>
                <span class="mono">${fmtFull(p.tax)} (take-home: ${fmtFull(p.afterTax)})</span>
              </div>
              <div class="chart-bar" style="height:6px;"><div class="chart-bar-fill" style="width:${(p.tax/maxTax*100).toFixed(1)}%;background:${p.prov === province ? 'linear-gradient(90deg,var(--brand-primary),var(--brand-accent))' : 'var(--border-hover)'};"></div></div>
            </div>
          `).join('')}
        `;
      }
    }

    function calcBracketTax(income, brackets) {
      var tax = 0, remaining = income;
      for (var i = 0; i < brackets.length; i++) {
        var amt = Math.min(remaining, brackets[i][0]);
        tax += amt * brackets[i][1];
        remaining -= amt;
        if (remaining <= 0) break;
      }
      return tax;
    }

    function getMarginalRate(income, brackets) {
      var remaining = income;
      for (var i = 0; i < brackets.length; i++) {
        if (remaining <= brackets[i][0]) return brackets[i][1];
        remaining -= brackets[i][0];
      }
      return brackets[brackets.length - 1][1];
    }

    function getProvBrackets(prov) {
      var b = {
        'ON': [[52886,0.0505],[52889,0.0915],[44225,0.1116],[70000,0.1216],[Infinity,0.1316]],
        'BC': [[47937,0.0506],[47938,0.077],[14201,0.105],[23588,0.1229],[47568,0.147],[71520,0.168],[Infinity,0.205]],
        'AB': [[148269,0.10],[29653,0.12],[59308,0.13],[118615,0.14],[Infinity,0.15]],
        'QC': [[51780,0.14],[51765,0.19],[22455,0.24],[Infinity,0.2575]]
      };
      // Simplified flat-ish brackets for other provinces
      var simple = {
        'MB': [[47000,0.108],[53000,0.1275],[Infinity,0.174]],
        'SK': [[52057,0.105],[96677,0.125],[Infinity,0.145]],
        'NS': [[29590,0.0879],[29590,0.1495],[33820,0.1667],[57000,0.175],[Infinity,0.21]],
        'NB': [[49958,0.094],[49958,0.14],[85148,0.16],[64936,0.195],[Infinity,0.203]],
        'NL': [[43198,0.087],[43197,0.145],[67849,0.158],[61699,0.178],[59927,0.198],[Infinity,0.218]],
        'PE': [[32656,0.0965],[31657,0.1363],[40687,0.1665],[35000,0.18],[Infinity,0.1875]]
      };
      return b[prov] || simple[prov] || [[Infinity, 0.12]];
    }

    function getProvBasic(prov) {
      var basics = {'ON':11865,'BC':12580,'AB':21003,'QC':18056,'MB':15780,'SK':17661,'NS':8481,'NB':13044,'NL':10818,'PE':13500};
      return basics[prov] || 12000;
    }

    function getProvDTCRate(prov) {
      var rates = {'ON':0.10,'BC':0.12,'AB':0.0812,'QC':0.117,'MB':0.08,'SK':0.11,'NS':0.0885,'NB':0.14,'NL':0.063,'PE':0.105};
      return rates[prov] || 0.10;
    }

    // ‚îÄ‚îÄ Patch existing calculators to increment counter ‚îÄ‚îÄ
    (function patchCounters() {
      var fns = ['calculateDCF','calculateMultiples','calculateAsset','calculateMortgage',
        'calculateCAGR','calculateDCA','calculateRetirement','calculateCompound',
        'calculateMA','calculateRunway','calculateNetWorth','calculateSalary','calculateDebt',
        'calculateLeaseBuy','calculateTax'];
      fns.forEach(function(name) {
        var orig = window[name];
        if (typeof orig === 'function') {
          window[name] = function() {
            incrementCalcCounter();
            return orig.apply(this, arguments);
          };
        }
      });
    })();

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(function(){});
    }
  </script>
  <script src="milestones.js"></script>
  <script>
    // ‚ïê‚ïê‚ïê AFFILIATE UPGRADE ‚ïê‚ïê‚ïê
/* =============================================
   FiggyBank Affiliate Upgrade JS
   ============================================= */

const AFFILIATE_TAG = 'figgy0a0-20';

function amazonLink(asin) {
  return `https://www.amazon.ca/dp/${asin}?tag=${AFFILIATE_TAG}`;
}

// ‚îÄ‚îÄ Product Database ‚îÄ‚îÄ

const PRODUCTS = {
  wealthyBarber:  { title: 'The Wealthy Barber Returns', author: 'David Chilton', asin: '0143190008', pitch: 'The classic Canadian guide to building wealth simply.', stars: 5 },
  tfsa:           { title: 'Tax-Free Savings Accounts', author: 'Gordon Pape', asin: '1459721646', pitch: 'Maximize your TFSA ‚Äî the most powerful savings tool in Canada.', stars: 4 },
  howNot:         { title: 'How NOT to Move Back in with Your Parents', author: 'Rob Chicken', asin: '0143191292', pitch: 'A young Canadian\'s guide to financial independence.', stars: 4 },
  millionaire:    { title: 'Millionaire Teacher', author: 'Andrew Hallam', asin: '1119356296', pitch: 'Nine rules of wealth you should have learned in school.', stars: 5 },
  wealthing:      { title: 'Wealthing Like Rabbits', author: 'Robert R. Brown', asin: '0993874177', pitch: 'An original introduction to personal finance.', stars: 5 },
  commonSense:    { title: 'The Little Book of Common Sense Investing', author: 'John C. Bogle', asin: '1119404509', pitch: 'The only way to guarantee your fair share of market returns.', stars: 5 },
  moneyMakeover:  { title: 'The Total Money Makeover', author: 'Dave Ramsey', asin: '1595555277', pitch: 'A proven plan for financial fitness.', stars: 5 },
  builtToSell:    { title: 'Built to Sell', author: 'John Warrillow', asin: '1591845823', pitch: 'Creating a business that can thrive without you.', stars: 5 },
  artOfSelling:   { title: 'The Art of Selling Your Business', author: 'John Warrillow', asin: '1733478159', pitch: 'Winning strategies for maximizing your exit.', stars: 4 },
};

const P = PRODUCTS;

const AFFILIATE_DB = {
  mortgage:   [P.wealthyBarber, P.millionaire, P.wealthing],
  tax:        [P.wealthyBarber, P.tfsa, P.howNot],
  capgains:   [P.millionaire, P.tfsa],
  tfsa:       [P.tfsa, P.wealthyBarber, P.howNot],
  rrsp:       [P.wealthyBarber, P.tfsa, P.howNot],
  retirement: [P.millionaire, P.wealthyBarber, P.wealthing],
  incometax:  [P.wealthyBarber, P.tfsa, P.howNot],
  investment: [P.millionaire, P.commonSense, P.wealthing],
  compound:   [P.millionaire, P.commonSense, P.wealthing],
  debt:       [P.moneyMakeover, P.wealthing],
  networth:   [P.wealthyBarber, P.millionaire, P.wealthing],
  valuation:  [P.builtToSell, P.artOfSelling],
  merger:     [P.builtToSell, P.artOfSelling],
  fhsa:       [P.wealthyBarber, P.millionaire, P.wealthing],
  resp:       [P.wealthyBarber, P.tfsa, P.howNot],
  rentbuy:    [P.wealthyBarber, P.millionaire, P.wealthing],
  gic:        [P.tfsa, P.wealthyBarber],
  cpp:        [P.wealthyBarber, P.millionaire],
  salary:     [P.wealthyBarber, P.howNot],
  runway:     [P.builtToSell, P.artOfSelling],
  lease:      [P.wealthyBarber, P.wealthing],
  compare:    [P.millionaire, P.commonSense],
  currency:   [P.commonSense, P.millionaire],
};

// ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ

function starsHTML(n) {
  return '<span class="affiliate-inline__stars">' + '‚òÖ'.repeat(n) + '‚òÜ'.repeat(5 - n) + '</span>';
}

function detectCalcId() {
  const path = window.location.pathname.replace(/\/$/, '').split('/').pop() || '';
  // try matching known IDs
  for (const id of Object.keys(AFFILIATE_DB)) {
    if (path.includes(id)) return id;
  }
  // fallback: check body class or id
  for (const id of Object.keys(AFFILIATE_DB)) {
    if (document.body.className.includes(id) || document.getElementById(id)) return id;
  }
  return null;
}

// ‚îÄ‚îÄ A: Inline Result Affiliate Card ‚îÄ‚îÄ

function injectAffiliateSuggestion(calcId, resultData) {
  // Remove previous
  document.querySelectorAll('.affiliate-inline-injected').forEach(el => el.remove());

  const product = getSmartRecommendation(calcId, resultData) || (AFFILIATE_DB[calcId] && AFFILIATE_DB[calcId][0]);
  if (!product) return;

  const card = document.createElement('a');
  card.href = amazonLink(product.asin);
  card.target = '_blank';
  card.rel = 'noopener noreferrer sponsored';
  card.className = 'affiliate-inline affiliate-inline-injected';
  card.innerHTML = `
    <div class="affiliate-inline__icon">üìñ</div>
    <div class="affiliate-inline__body">
      <div class="affiliate-inline__label">Sponsored</div>
      <div class="affiliate-inline__heading">üìñ Want to learn more?</div>
      <div class="affiliate-inline__title">${product.title}</div>
      <div class="affiliate-inline__author">by ${product.author}</div>
      ${starsHTML(product.stars)}
      <div class="affiliate-inline__pitch">${product.pitch}</div>
    </div>
    <span class="affiliate-inline__cta">View on Amazon.ca ‚Üí</span>
  `;

  // Insert after first result card area
  const results = document.querySelector('.calc-results, .results-section, [class*="result"]');
  if (results) {
    results.parentNode.insertBefore(card, results.nextSibling);
  } else {
    // fallback: append to main
    const main = document.querySelector('main, .calculator, .container');
    if (main) main.appendChild(card);
  }
}

// ‚îÄ‚îÄ B: Floating Smart Tip ‚îÄ‚îÄ

function showSmartTip(calcId) {
  if (!calcId || !AFFILIATE_DB[calcId]) return;

  const storageKey = `smarttip_dismissed_${calcId}`;
  const dismissed = localStorage.getItem(storageKey);
  if (dismissed && Date.now() - parseInt(dismissed, 10) < 86400000) return;

  // Remove existing
  document.querySelectorAll('.smart-tip').forEach(el => el.remove());

  const product = AFFILIATE_DB[calcId][Math.floor(Math.random() * AFFILIATE_DB[calcId].length)];

  const tip = document.createElement('div');
  tip.className = 'smart-tip';
  tip.innerHTML = `
    <div class="smart-tip__header">
      <span class="smart-tip__header-text">üí° Smart Tip</span>
      <button class="smart-tip__close" aria-label="Close">‚úï</button>
    </div>
    <div class="smart-tip__body">
      <div class="smart-tip__emoji">üìö</div>
      <div class="smart-tip__info">
        <div class="smart-tip__title">${product.title}</div>
        <div class="smart-tip__author">by ${product.author}</div>
        <div class="smart-tip__stars">${'‚òÖ'.repeat(product.stars)}${'‚òÜ'.repeat(5 - product.stars)}</div>
      </div>
    </div>
    <div class="smart-tip__footer">
      <a href="${amazonLink(product.asin)}" target="_blank" rel="noopener noreferrer sponsored" class="smart-tip__btn">View on Amazon.ca ‚Üí</a>
      <div class="smart-tip__sponsored">Sponsored</div>
    </div>
  `;

  tip.querySelector('.smart-tip__close').addEventListener('click', function (e) {
    e.stopPropagation();
    localStorage.setItem(storageKey, String(Date.now()));
    tip.style.opacity = '0';
    tip.style.transform = 'translateY(20px)';
    setTimeout(() => tip.remove(), 300);
  });

  document.body.appendChild(tip);
}

// ‚îÄ‚îÄ C: Results-Based Smart Recommendations ‚îÄ‚îÄ

function getSmartRecommendation(calcId, metrics) {
  if (!metrics || typeof metrics !== 'object') return null;

  // RRSP refund > $3000 ‚Üí tax planning
  if ((calcId === 'rrsp' || calcId === 'tax') && metrics.refund > 3000) {
    return P.wealthyBarber;
  }
  // Mortgage payment > $3000/mo ‚Üí homebuying guide
  if ((calcId === 'mortgage' || calcId === 'rentbuy') && metrics.monthlyPayment > 3000) {
    return P.wealthing;
  }
  // Capital gains tax > $10000 ‚Üí tax optimization
  if (calcId === 'capgains' && metrics.taxOwed > 10000) {
    return P.tfsa;
  }
  // Debt payoff > 5 years ‚Üí debt-free book
  if (calcId === 'debt' && metrics.yearsToPayoff > 5) {
    return P.moneyMakeover;
  }
  // High investment return ‚Üí investing book
  if ((calcId === 'investment' || calcId === 'compound') && metrics.totalReturn > 100000) {
    return P.commonSense;
  }
  // Business valuation high ‚Üí built to sell
  if ((calcId === 'valuation' || calcId === 'merger') && metrics.valuation > 500000) {
    return P.builtToSell;
  }

  return null;
}

// ‚îÄ‚îÄ E: Enhance Existing Affiliate Sections ‚îÄ‚îÄ

function enhanceExistingAffiliates() {
  document.querySelectorAll('.affiliate-resources').forEach(section => {
    if (section.dataset.enhanced) return;
    section.dataset.enhanced = 'true';

    // Add NEW badge to heading
    const heading = section.querySelector('h2, h3, h4');
    if (heading && !heading.querySelector('.aff-new-badge')) {
      const badge = document.createElement('span');
      badge.className = 'aff-new-badge';
      badge.textContent = 'NEW';
      heading.appendChild(badge);
    }

    // Enhance links
    section.querySelectorAll('a[href*="amazon"]').forEach(link => {
      if (link.querySelector('.aff-enhanced-cta')) return;

      // Add star rating before link if not present
      const starsEl = document.createElement('span');
      starsEl.className = 'affiliate-inline__stars';
      starsEl.textContent = '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ';
      starsEl.style.display = 'block';
      starsEl.style.marginBottom = '0.25rem';
      link.parentNode.insertBefore(starsEl, link);

      // Add CTA button without overwriting card content
      link.classList.add('aff-enhanced-cta');
      if (!link.querySelector('.aff-cta-btn')) {
        const ctaBtn = document.createElement('span');
        ctaBtn.className = 'aff-cta-btn';
        ctaBtn.textContent = 'View on Amazon.ca ‚Üí';
        ctaBtn.style.cssText = 'display:inline-block;margin-top:0.5rem;padding:0.4rem 0.8rem;background:#FF6B6B;color:#fff;border-radius:6px;font-size:0.8rem;font-weight:600;';
        const infoDiv = link.querySelector('.affiliate-info');
        if (infoDiv) { infoDiv.appendChild(ctaBtn); } else { link.appendChild(ctaBtn); }
      }
    });
  });
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ

function initAffiliateUpgrade() {
  const calcId = detectCalcId();

  // Enhance existing affiliate sections immediately
  enhanceExistingAffiliates();

  // Smart tip after 8 seconds
  if (calcId) {
    setTimeout(() => showSmartTip(calcId), 8000);
  }

  // Watch for calculator result changes
  const resultEls = document.querySelectorAll('.calc-results, .results-section, [class*="calc-result"]');
  if (resultEls.length > 0) {
    const observer = new MutationObserver(() => {
      // Debounce
      clearTimeout(observer._timer);
      observer._timer = setTimeout(() => {
        // Try to extract metrics from result elements
        const metrics = {};
        resultEls.forEach(el => {
          const text = el.textContent || '';
          // Simple number extraction for known patterns
          const dollarMatch = text.match(/\$[\d,]+\.?\d*/g);
          if (dollarMatch) {
            const vals = dollarMatch.map(v => parseFloat(v.replace(/[$,]/g, '')));
            if (calcId === 'rrsp' || calcId === 'tax') metrics.refund = Math.max(...vals);
            if (calcId === 'mortgage') metrics.monthlyPayment = Math.min(...vals.filter(v => v > 100));
            if (calcId === 'capgains') metrics.taxOwed = Math.max(...vals);
            if (calcId === 'investment' || calcId === 'compound') metrics.totalReturn = Math.max(...vals);
            if (calcId === 'valuation' || calcId === 'merger') metrics.valuation = Math.max(...vals);
          }
          const yearMatch = text.match(/(\d+\.?\d*)\s*year/i);
          if (yearMatch && calcId === 'debt') metrics.yearsToPayoff = parseFloat(yearMatch[1]);
        });

        injectAffiliateSuggestion(calcId, metrics);
      }, 500);
    });

    resultEls.forEach(el => observer.observe(el, { childList: true, subtree: true, characterData: true }));
  }
}

// Auto-init on DOM ready
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initAffiliateUpgrade);
} else {
  initAffiliateUpgrade();
}

    initAffiliateUpgrade();
</script>
</body>
</html>